const t={debug:!1,locale:"en-US",enableShadowDom:!0,enableMainWrapper:!0,enableRouter:!0,autoInsertMainWrapper:!1,autoInit:!0,mainTagName:"app-main",routerTagName:"view-router",layoutPath:"",autoLoadFromImportMap:!1,optimizeList:!0,optimizeListElements:!0,optimizeAccessor:!0};function n(){return t}const e=n();function i(t){throw new Error(`${t} requires at least one option`)}function s(t){throw new Error(`${t} requires a number as option`)}function o(t){throw new Error(`${t} requires a number value`)}function r(t){throw new Error(`${t} requires a date value`)}const l=n(),u={eq:t=>{const n=t?.[0]??i("eq");return t=>{if("number"==typeof t){const e=Number(n);return isNaN(e)&&s("eq"),t===e}return t===n}},ne:t=>{const n=t?.[0]??i("ne");return t=>{if("number"==typeof t){const e=Number(n);return isNaN(e)&&s("eq"),t!==e}return t!==n}},not:t=>t=>("boolean"!=typeof t&&function(t){throw new Error(`${t} requires a boolean value`)}("not"),!t),lt:t=>{const n=t?.[0]??i("lt"),e=Number(n);return isNaN(e)&&s("lt"),t=>("number"!=typeof t&&o("lt"),t<e)},le:t=>{const n=t?.[0]??i("le"),e=Number(n);return isNaN(e)&&s("le"),t=>("number"!=typeof t&&o("le"),t<=e)},gt:t=>{const n=t?.[0]??i("gt"),e=Number(n);return isNaN(e)&&s("gt"),t=>("number"!=typeof t&&o("gt"),t>e)},ge:t=>{const n=t?.[0]??i("ge"),e=Number(n);return isNaN(e)&&s("ge"),t=>("number"!=typeof t&&o("ge"),t>=e)},inc:t=>{const n=t?.[0]??i("inc"),e=Number(n);return isNaN(e)&&s("inc"),t=>("number"!=typeof t&&o("inc"),t+e)},dec:t=>{const n=t?.[0]??i("dec"),e=Number(n);return isNaN(e)&&s("dec"),t=>("number"!=typeof t&&o("dec"),t-e)},mul:t=>{const n=t?.[0]??i("mul"),e=Number(n);return isNaN(e)&&s("mul"),t=>("number"!=typeof t&&o("mul"),t*e)},div:t=>{const n=t?.[0]??i("div"),e=Number(n);return isNaN(e)&&s("div"),t=>("number"!=typeof t&&o("div"),t/e)},fix:t=>{const n=Number(t?.[0]??0);return isNaN(n)&&s("div"),t=>("number"!=typeof t&&o("div"),t.toFixed(n))},locale:t=>{const n=t?.[0]??l.locale;return t=>("number"!=typeof t&&o("locale"),t.toLocaleString(n))},uc:t=>t=>t.toString().toUpperCase(),lc:t=>t=>t.toString().toLowerCase(),cap:t=>t=>{const n=t.toString();return 0===n.length?n:1===n.length?n.toUpperCase():n.charAt(0).toUpperCase()+n.slice(1)},trim:t=>t=>t.toString().trim(),slice:t=>{const n=t?.[0]??i("slice"),e=Number(n);return isNaN(e)&&s("slice"),t=>t.toString().slice(e)},substr:t=>{const n=t?.[0]??i("substr"),e=Number(n);isNaN(e)&&s("substr");const o=t?.[1]??i("substr"),r=Number(o);return isNaN(r)&&s("substr"),t=>t.toString().substr(e,r)},pad:t=>{const n=t?.[0]??i("pad"),e=Number(n);isNaN(e)&&s("pad");const o=t?.[1]??"0";return t=>t.toString().padStart(e,o)},rep:t=>{const n=t?.[0]??i("rep"),e=Number(n);return isNaN(e)&&s("rep"),t=>t.toString().repeat(e)},rev:t=>t=>t.toString().split("").reverse().join(""),int:t=>t=>parseInt(t,10),float:t=>t=>parseFloat(t),round:t=>{const n=t?.[0]??0,e=Math.pow(10,Number(n));return isNaN(e)&&s("round"),t=>("number"!=typeof t&&o("round"),Math.round(t*e)/e)},floor:t=>{const n=t?.[0]??0,e=Math.pow(10,Number(n));return isNaN(e)&&s("floor"),t=>("number"!=typeof t&&o("floor"),Math.floor(t*e)/e)},ceil:t=>{const n=t?.[0]??0,e=Math.pow(10,Number(n));return isNaN(e)&&s("ceil"),t=>("number"!=typeof t&&o("ceil"),Math.ceil(t*e)/e)},percent:t=>{const n=Number(t?.[0]??0);return isNaN(n)&&s("percent"),t=>("number"!=typeof t&&o("percent"),t.toFixed(n)+"%")},date:t=>{const n=t?.[0]??l.locale;return t=>(t instanceof Date||r("date"),t.toLocaleDateString(n))},time:t=>{const n=t?.[0]??l.locale;return t=>(t instanceof Date||r("time"),t.toLocaleTimeString(n))},datetime:t=>{const n=t?.[0]??l.locale;return t=>(t instanceof Date||r("datetime"),t.toLocaleString(n))},ymd:t=>{const n=t?.[0]??"-";return t=>{t instanceof Date||r("ymd");const e=t.getFullYear().toString(),i=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0");return`${e}${n}${i}${n}${s}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const n=t?.[0]??i("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?n:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},a=u,c=u;let h=0;function d(){return++h}function f(t){throw new Error(t)}const p={};const m={};function g(t,n){const e=new CSSStyleSheet;e.replaceSync(n),function(t,n){m[t]=n}(t,e)}function w(t,n){let e=t;if(0===n.length)return e;for(let t=0;t<n.length&&(e=e?.childNodes[n[t]]??null,null!==e);t++);return e}function y(t,n){const e=t[n.name];return e||f(`outputBuiltinFiltersFn: filter not found: ${name}`),e(n.options)}const b=new Map;function N(t,n){let e=b.get(n);if(void 0===e){e=[];for(let i=0;i<n.length;i++)e.push(y(t,n[i]));b.set(n,e)}return e}class x{#t;#n;#e;#i;#s;#o=[];get node(){return this.#n}get name(){return this.#e}get t(){return this.#e}get binding(){return this.#t}get i(){return this.#s}get filters(){return this.#i}get o(){return this.#o}constructor(t,n,e,i,s){this.#t=t,this.#n=n,this.#e=e,this.#i=i,this.#s=s}init(){}l(t){f("BindingNode: assignValue not implemented")}u(t,n){f("BindingNode: updateElements not implemented")}h(t){}p(t){if(t.m.has(this.binding))return;const n=this.binding.v.N(t.C);this.l(n),t.m.add(this.binding)}get S(){return this.node instanceof HTMLSelectElement}get value(){return null}get $(){return null}get I(){return!1}}class v extends x{#r;get t(){return this.#r}constructor(t,n,e,i,s){super(t,n,e,i,s);const[,o]=this.name.split(".");this.#r=o}l(t){(null==t||Number.isNaN(t))&&(t="");this.node.setAttribute(this.t,t.toString())}}class C extends x{l(t){Array.isArray(t)||f("BindingNodeCheckbox.update: value is not array");const n=this.node;n.checked=t.map((t=>t.toString())).includes(n.value)}}class S extends x{l(t){Array.isArray(t)||f("BindingNodeClassList.update: value is not array");this.node.className=t.join(" ")}}class $ extends x{#r;get t(){return this.#r}constructor(t,n,e,i,s){super(t,n,e,i,s);const[,o]=this.name.split(".");this.#r=o}l(t){"boolean"!=typeof t&&f("BindingNodeClassName.update: value is not boolean");const n=this.node;t?n.classList.add(this.t):n.classList.remove(this.t)}}const I="data-bind",P="@@:",L="@@|",B=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","watch","unwatch","eval","arguments","let","var","const","class","function","null","true","false","new","return"]),M={};class E{static id=0;id=++E.id;P=this.id.toString();pattern;L;B;M;T;k;R;F;V;A;O;H;W;D;q;j;_;G;Z;U;J;children={};constructor(t){const n=n=>t===n?this:T(n),e=t.split("."),i=[],s=[],o=[],r={},l=[],u=[],a=[];let c="",h="",d=0;for(let t=0;t<e.length;t++)c+=e[t],"*"===e[t]&&(o.push(c),r[c]=d,l.push(n(c)),u.push(h),a.push(n(h)),d++),i.push(c),s.push(n(c)),h=c,c+=".";const f=o.length>0?o[o.length-1]:null,p=i.length>1?i[i.length-2]:null;this.pattern=t,this.L=e,this.B=e[e.length-1],this.M=i,this.T=new Set(i),this.k=s,this.R=new Set(s),this.F=o,this.V=new Set(o),this.O=r,this.A=l,this.H=new Set(l),this.W=u,this.D=new Set(u),this.q=a,this.j=new Set(a),this._=f,this.G=f?n(f):null,this.Z=p,this.U=p?n(p):null,this.J=d,this.U&&(this.U.children[this.B]=this)}}function T(t){const n=M[t];return void 0!==n?n:(B.has(t)&&f(`getStructuredPathInfo: pattern is reserved word: ${t}`),M[t]=new E(t))}const k=new Map;class R{static id=0;id=++R.id;name;elements;K;J;X;Y;info;constructor(t){const n=t.split("."),e=n.slice(),i=[];let s=0,o=0,r="",l=0,u="none",a=[];for(let t=0;t<n.length;t++){const u=n[t];if("*"===u)e[t]="*",a.push(null),s++,l++;else{const n=Number(u);Number.isNaN(n)||(e[t]="*",a.push(n),o++,l++)}r+=u,i.push(r),r+=t<n.length-1?".":""}const c=T(e.join("."));(s>0||o>0)&&(u=s===l?"context":o===l?"all":"partial"),this.name=t,this.elements=n,this.K=i,this.J=l,this.X=u,this.Y=a,this.info=c}}function F(t){let n;return k.get(t)??(k.set(t,n=new R(t)),n)}class V{info;#l;get tt(){return null===this.#l?null:this.#l.deref()??f("listIndex is null")}key;constructor(t,n){this.info=t,this.#l=null!==n?new WeakRef(n):null,this.key=function(t,n){return null==n?t.P:t.P+"#"+n.P}(t,n)}}const A=new WeakMap,O=new Map;function H(t,n){let e=null;if(null!==n){let i=A.get(n);return void 0===i&&(i=new Map,A.set(n,i)),e=i.get(t),void 0===e&&(e=new V(t,n),i.set(t,e)),e}return e=O.get(t),void 0===e&&(e=new V(t,null),O.set(t,e)),e}function z(t,n){const e=t.nt[t.et];if(null==e)return null;if(null==e.info)return null;if(null==e.tt)return null;const i=e.info.O[n];return void 0!==i?e.tt.at(i):null}function W(t,n,e){switch(t.X){case"none":return null;case"context":return z(e,t.info._??f("lastWildcardPath is null"))??f(`ListIndex not found: ${t.info.pattern}`);case"all":let n=null;for(let i=0;i<t.info.J;i++){const s=t.info.q[i]??f("wildcardParentPattern is null"),o=H(s,n);n=(e.st.it(o)??f(`ListIndex not found: ${s.pattern}`))[t.Y[i]??f("wildcardIndex is null")]??f(`ListIndex not found: ${s.pattern}`)}return n;case"partial":f(`Partial wildcard type is not supported yet: ${t.info.pattern}`)}}const D="state",q=Symbol.for(`${D}.GetByRef`),j=Symbol.for(`${D}.SetByRef`),_=Symbol.for(`${D}.SetCacheable`),G=Symbol.for(`${D}.ConnectedCallback`),Z=Symbol.for(`${D}.DisconnectedCallback`);function U(t,n){if(t.et>=0){const e=t.nt[t.et]?.info??null;null!==e&&t.st.rt.ot.has(e.pattern)&&!t.st.rt.ut.has(e.pattern)&&e.pattern!==n.info.pattern&&t.st.rt.ct(e.pattern,n.info.pattern)}}function J(t,n,e){t.et++,t.et>=t.nt.length&&t.nt.push(null),t.nt[t.et]=n;try{return e()}finally{t.nt[t.et]=null,t.et--}}function K(t,n,e,i){if(U(i,n),i.st.ht.startsWith(n.info)&&0===i.st.rt.ot.intersection(n.info.T).size)return i.st.ht.get(n);if(n.info.pattern in t)return J(i,n,(()=>Reflect.get(t,n.info.pattern,e)));{const s=n.info.U??f("propRef.stateProp.parentInfo is undefined"),o=H(s,s.J<n.info.J?n.tt?.dt??null:n.tt),r=K(t,o,e,i),l=n.info.B;if("*"===l){const t=n.tt?.index??f("propRef.listIndex?.index is undefined");return Reflect.get(r,t)}return Reflect.get(r,l)}}function Q(t,n,e,i,s){try{if(s.st.ht.startsWith(n.info)&&0===s.st.rt.ut.intersection(n.info.T).size)return s.st.ht.set(n,e);if(n.info.pattern in t)return J(s,n,(()=>Reflect.set(t,n.info.pattern,e,i)));{const o=n.info.U??f("propRef.stateProp.parentInfo is undefined"),r=H(o,o.J<n.info.J?n.tt?.dt??null:n.tt),l=K(t,r,i,s),u=n.info.B;if("*"===u){const t=n.tt?.index??f("propRef.listIndex?.index is undefined");return Reflect.set(l,t,e)}return Reflect.set(l,u,e)}}finally{s.wt.ft(n)}}function X(t,n,e,i){return(n,s,o)=>{const r=T(n),l=i.nt[i.et]?.info??null;null!==l&&l.pattern!==r.pattern&&i.st.rt.ot.has(l.pattern)&&!i.st.rt.ut.has(l.pattern)&&i.st.rt.ct(l.pattern,r.pattern);let u=null;for(let t=0;t<r.q.length;t++){const n=r.q[t]??f("wildcardParentPath is null"),e=H(n,u);u=(i.st.it(e)??[])[s[t]??f("index is null")]??f(`ListIndex not found: ${n.pattern}`)}const a=H(r,u);return void 0===o?K(t,a,e,i):Q(t,a,o,e,i)}}function Y(t,n,e,i){return t=>{const n=i.nt[i.et]?.info??f("Internal error: refStack is null.");i.st.rt.ot.has(n.pattern)&&n.pattern!==t&&i.st.rt.ct(n.pattern,t)}}const tt={};for(let t=0;t<32;t++)tt[`$${t+1}`]=t;function nt(t,n,e,i){const s=tt[n];if(void 0!==s){const t=i.nt[i.et]?.tt;return t?.yt[s]??f(`ListIndex not found: ${n.toString()}`)}if("string"==typeof n){if("$"===n[0])switch(n){case"$resolve":return X(t,0,e,i);case"$getAll":return function(t,n,e,i){const s=X(t,0,e,i);return(t,n)=>{const e=T(t),o=i.nt[i.et]?.info??null;if(null!==o&&o.pattern!==e.pattern&&i.st.rt.ot.has(o.pattern)&&!i.st.rt.ut.has(o.pattern)&&i.st.rt.ct(o.pattern,e.pattern),void 0===n){for(let t=0;t<e.A.length;t++){const s=e.A[t]??f("wildcardPattern is null"),o=z(i,s.pattern);if(o){n=o.yt;break}}void 0===n&&(n=[])}const r=(t,n,e,s,o,l,u)=>{const a=t[n]??null;if(null===a)return void u.push(l);const c=H(a,e),h=i.st.it(c)??f(`ListIndex not found: ${a.pattern}`),d=s[o]??null;if(null===d)for(let e=0;e<h.length;e++){const i=h[e];r(t,n+1,i,s,o+1,l.concat(i.index),u)}else{const e=h[d]??f(`ListIndex not found: ${a.pattern}`);n+1<t.length&&r(t,n+1,e,s,o+1,l.concat(e.index),u)}},l=[];r(e.q,0,null,n,0,[],l);const u=[];for(let t=0;t<l.length;t++)u.push(s(e.pattern,l[t]));return u}}(t,0,e,i);case"$trackDependency":return Y(0,0,0,i);case"$navigate":return t=>te()?.navigate(t);case"$component":return i.st.bt}const s=F(n),o=W(s,0,i),r=H(s.info,o);return K(t,r,e,i)}if("symbol"==typeof n)switch(n){case q:return n=>K(t,n,e,i);case j:return(n,s)=>Q(t,n,s,e,i);case G:return()=>async function(t,n,e){const i=Reflect.get(t,"$connectedCallback");"function"==typeof i&&await i.call(e)}(t,0,e);case Z:return()=>async function(t,n,e){const i=Reflect.get(t,"$disconnectedCallback");"function"==typeof i&&await i.call(e)}(t,0,e);default:return Reflect.get(t,n,e)}}let et=class{st;Nt=null;xt=Array(32).fill(null);vt=-1;nt=Array(32).fill(null);et=-1;Ct=null;wt;constructor(t,n){this.st=t,this.wt=n}get(t,n,e){return nt(t,n,e,this)}set(t,n,e,i){return function(t,n,e,i,s){if("string"==typeof n){const o=F(n),r=W(o,0,s);return Q(t,H(o.info,r),e,i,s)}return Reflect.set(t,n,e,i)}(t,n,e,i,this)}};async function it(t,n,e,i,s){const o=new et(t,n),r=new Proxy(e,o);return async function(t,n,e){t.Ct&&f("already in loop context"),t.Ct=n;try{n?await async function(t,n,e){t.et++,t.et>=t.nt.length&&t.nt.push(null),t.nt[t.et]=n;try{await e()}finally{t.nt[t.et]=null,t.et--}}(t,n.St,e):await e()}finally{t.Ct=null}}(o,i,(async()=>{await s(r)}))}let st=0,ot=0;class rt{#u=null;#a=0;#c=0;#h;#d=++ot;#f=this.#d.toString();constructor(t,n){this.#u=t,this.#a=t?t.position+1:0,this.#c=n,this.#h=st}get dt(){return this.#u}get id(){return this.#d}get P(){return this.#f}get position(){return this.#a}get length(){return this.#a+1}get index(){return this.#c}set index(t){this.#c=t,this.#h=++st,this.yt[this.#a]=t}get version(){return this.#h}get $t(){return null!==this.#u&&(this.#u.$t||this.#u.version>this.#h)}#p;get yt(){return null===this.#u?void 0===this.#p&&(this.#p=[this.#c]):(void 0===this.#p||this.$t)&&(this.#p=[...this.#u.yt,this.#c],this.#h=st),this.#p}#m;get It(){return null===this.#u?void 0===this.#m&&(this.#m=[new WeakRef(this)]):void 0===this.#m&&(this.#m=[...this.#u.It,new WeakRef(this)]),this.#m}get Pt(){return`${this.position+1}`}at(t){return t>=0?this.It[t]?.deref()||null:this.It[this.It.length+t]?.deref()||null}}function lt(t,n){return new rt(t,n)}class ut{Z;Lt;name;Bt;level;constructor(t,n,e){this.Z=t,this.Lt=t?t+"."+n:n,this.name=n,this.level=e,this.Bt=new Map}find(t,n=0){if(n>=t.length)return null;const e=t[n],i=this.Bt.get(e);return i?n===t.length-1?i:i.find(t,n+1):null}appendChild(t){let n=this.Bt.get(t);if(!n){const e=this.Z?this.Z+"."+this.name:this.name;n=new ut(e,t,this.level+1),this.Bt.set(t,n)}return n}}const at=new Map;function ct(t,n){let e=at.get(t);e||(e=new Map,at.set(t,e));let i=e.get(n)??null;if(i)return i;const s=T(n);return i=t.find(s.L),e.set(n,i),i}function ht(t,n){const e=T(n);if(null===e.Z)return t.appendChild(n);{let n=ct(t,e.Z);return null===n&&(n=ht(t,e.Z)),n.appendChild(e.B)}}function dt(t,n,e,i){let s;U(i,n);try{if(null!==i.cache){if(s=i.cache.get(n),void 0!==s)return s;if(i.cache.has(n))return}try{if(i.st.ht.startsWith(n.info)&&0===i.st.rt.ot.intersection(n.info.T).size)return s=i.st.ht.get(n);if(n.info.pattern in t)return s=J(i,n,(()=>Reflect.get(t,n.info.pattern,e)));{const o=n.info.U??f("propRef.stateProp.parentInfo is undefined"),r=H(o,o.J<n.info.J?n.tt?.dt??null:n.tt),l=dt(t,r,e,i),u=n.info.B;if("*"===u){const t=n.tt?.index??f("propRef.listIndex?.index is undefined");return s=Reflect.get(l,t)}return s=Reflect.get(l,u)}}finally{null!==i.cache&&i.cache.set(n,s)}}finally{null!=i.Mt&&i.st.rt.Et.has(n.info.pattern)&&i.Mt.Tt(n,s,!0)}}function ft(t,n,e,i){return(n,s,o)=>{const r=T(n),l=i.nt[i.et]?.info??null;null!==l&&l.pattern!==r.pattern&&i.st.rt.ot.has(l.pattern)&&!i.st.rt.ut.has(l.pattern)&&i.st.rt.ct(l.pattern,r.pattern);let u=null;for(let t=0;t<r.q.length;t++){const n=r.q[t]??f("wildcardParentPath is null"),e=H(n,u);u=(i.st.it(e)??[])[s[t]??f("index is null")]??f(`ListIndex not found: ${n.pattern}`)}const a=H(r,u);if(void 0===o)return dt(t,a,e,i);f(`Cannot set value on a readonly proxy: ${n}`)}}function pt(t,n,e,i){const s=tt[n];if(void 0!==s){const t=i.nt[i.et]?.tt;return t?.yt[s]??f(`ListIndex not found: ${n.toString()}`)}if("string"==typeof n){if("$"===n[0])switch(n){case"$resolve":return ft(t,0,e,i);case"$getAll":return function(t,n,e,i){const s=ft(t,0,e,i);return(t,n)=>{const o=T(t),r=i.nt[i.et]?.info??null;if(null!==r&&r.pattern!==o.pattern&&i.st.rt.ot.has(r.pattern)&&!i.st.rt.ut.has(r.pattern)&&i.st.rt.ct(r.pattern,o.pattern),void 0===n){for(let t=0;t<o.A.length;t++){const e=o.A[t]??f("wildcardPattern is null"),s=z(i,e.pattern);if(s){n=s.yt;break}}void 0===n&&(n=[])}const l=(t,n,s,o,r,u,a)=>{const c=t[n]??null;if(null===c)return void a.push(u);const h=H(c,s);let d=i.st.it(h);null===d&&(e[q](h),d=i.st.it(h),null===d&&f(`ListIndex is not found: ${c.pattern}`));const p=o[r]??null;if(null===p)for(let e=0;e<d.length;e++){const i=d[e];l(t,n+1,i,o,r+1,u.concat(i.index),a)}else{const e=d[p]??f(`ListIndex not found: ${c.pattern}`);n+1<t.length&&l(t,n+1,e,o,r+1,u.concat(e.index),a)}},u=[];l(o.q,0,null,n,0,[],u);const a=[];for(let t=0;t<u.length;t++)a.push(s(o.pattern,u[t]));return a}}(t,0,e,i);case"$trackDependency":return Y(0,0,0,i);case"$navigate":return t=>te()?.navigate(t);case"$component":return i.st.bt}const s=F(n),o=W(s,0,i),r=H(s.info,o);return dt(t,r,e,i)}if("symbol"==typeof n)switch(n){case q:return n=>dt(t,n,e,i);case _:return t=>function(t,n){t.cache=new Map;try{n()}finally{t.cache=null}}(i,t);default:return Reflect.get(t,n,e)}}class mt{st;cache=null;Nt=null;xt=Array(32).fill(null);vt=-1;nt=Array(32).fill(null);et=-1;Ct=null;Mt=null;constructor(t,n){this.st=t,this.Mt=n}get(t,n,e){return pt(t,n,e,this)}set(t,n,e,i){f(`Cannot set property ${String(n)} of readonly state.`)}}function gt(t,n,e=null){return new Proxy(n,new mt(t,e))}class wt{#g=new Set;#w=new Set;#y;#b=null;#N=new Map;constructor(t){this.#y=t}get m(){return this.#g}get kt(){return this.#w}get C(){return this.#b||f("ReadonlyState is not initialized."),this.#b}get st(){return this.#y||f("Engine is not initialized."),this.#y}Rt(t){this.#N.clear(),this.#w.clear(),this.#g.clear();const n=this.#b=gt(this.#y,this.#y.state,this);try{n[_]((()=>{for(let n=0;n<t.length;n++){const e=t[n],i=ct(this.#y.rt.Ft,e.info.pattern);null===i&&f(`PathNode not found: ${e.info.pattern}`),this.Vt(e,i)}}))}finally{this.#b=null}}Tt(t,n=void 0,e=!1){let i=this.#N.get(t);if(void 0===i){const[s,o]=this.st.At(t);let r=e?n:this.C[q](t);i=function(t,n,e,i){const s=e||[],o=n||[],r=i||[];if(s===o||0===s.length&&0===o.length)return{Ot:n,Ht:e,zt:r,Wt:r};if(0===s.length)return{Ot:n,Ht:e,zt:r,Wt:[],Dt:new Set(r)};if(0===o.length){const i=[];for(let n=0;n<s.length;n++)i.push(lt(t,n));return{Ot:n,Ht:e,zt:r,Wt:i,qt:new Set(i)}}{const l=new Map;for(let t=0;t<o.length;t++)l.set(o[t],r[t]);const u=new Set,a=new Set(i),c=new Set,h=new Set,d=[];for(let n=0;n<s.length;n++){const e=s[n];let i=l.get(e);void 0===i?(i=lt(t,n),u.add(i)):(i.index!==n&&(i.index=n,h.add(i)),a.delete(i)),d.push(i)}return{Ot:n,Ht:e,zt:r,Wt:d,qt:u,Dt:a,jt:c,_t:h}}}(t.tt,s,r,o),this.#N.set(t,i),s!==r&&this.st.Gt(t,r,i.Wt)}return i}Vt(t,n){if(this.kt.has(t))return;this.kt.add(t);const e=this.#y.Zt(t);for(let t=0;t<e.length;t++){const n=e[t];this.m.has(n)||n.p(this)}for(const[e,i]of n.Bt){const n=T(i.Lt);if("*"===e){const e=this.Tt(t);for(const t of e.qt??[]){const e=H(n,t);this.Vt(e,i)}}else{const e=H(n,t.tt);this.Vt(e,i)}}const i=this.#y.rt.Ut.get(t.info.pattern);if(i)for(const t of i){const n=T(t),e=ct(this.#y.rt.Ft,n.pattern);if(null===e&&f(`PathNode not found: ${n.pattern}`),n.J>0){const t=n.q,i=(s,o,r)=>{const l=this.#y.it(s)||[];if(o+1<t.length)for(let n=0;n<l.length;n++){const e=H(r,l[n]);i(e,o+1,t[o+1])}else for(let t=0;t<l.length;t++){const i=H(n,l[t]);this.Vt(i,e)}},s=H(n.q[0],null);i(s,0,n.q[1]||null)}else{const t=H(n,null);this.Vt(t,e)}}}}class yt{queue=[];#x=!1;#v=!1;#y=null;ft(t){this.queue.push(t),this.#v||(this.#v=!0,queueMicrotask((()=>{this.Jt()})))}async Kt(t,n,e){try{this.#x=!0,this.#y=t,await it(t,this,t.state,n,(async t=>{await e(t)}))}finally{this.#x=!1}}Jt(){try{for(;this.queue.length>0;){const e=this.queue;this.queue=[],this.#y||f("Engine is not initialized."),t=e,n=this.#y,new wt(n).Rt(t)}}finally{this.#v=!1}var t,n}}async function bt(t,n,e){const i=new yt;await i.Kt(t,n,(async t=>{await e(i,t)}))}class Nt extends x{#r;constructor(t,n,e,i,s){super(t,n,e,i,s),this.#r=this.name.slice(2);n.addEventListener(this.t,(t=>this.Qt(t)))}get t(){return this.#r}update(){}async Qt(t){const n=this.binding.st,e=this.binding.Yt.Xt,i=e?.tn().map((t=>t.tt.index))??[],s=this.i;s.includes("preventDefault")&&t.preventDefault(),s.includes("stopPropagation")&&t.stopPropagation(),await bt(n,e,(async(n,e)=>{const s=this.binding.v.nn(e);"function"!=typeof s&&f(`BindingNodeEvent: ${this.name} is not a function.`),await Reflect.apply(s,e,[t,...i])}))}p(t){}}const xt=(t,n,e)=>(i,s,o)=>{const r=N(o,n);return new Nt(i,s,t,r,e)};class vt extends x{#d;get id(){return this.#d}constructor(t,n,e,i,s){super(t,n,e,i,s);const o=this.node.textContent?.slice(3)??f("BindingNodeBlock.id: invalid node");this.#d=Number(o)}}class Ct extends vt{#C;#S;#$=[];#o;get o(){return this.#o}constructor(t,n,e,i,s){super(t,n,e,i,s);const o=H(T(""),null);this.#C=Sn(this.binding,this.id,this.binding.st,o),this.#S=this.#o=[this.#C]}l(t){f("BindingNodeIf.assignValue: not implemented")}p(t){if(t.m.has(this.binding))return;const n=this.binding.v.N(t.C);"boolean"!=typeof n&&f("BindingNodeIf.update: value is not boolean");const e=this.node.parentNode;null==e&&f("BindingNodeIf.update: parentNode is null"),n?(this.#C.en(e,this.node),this.#C.p(t),this.#o=this.#S):(this.#C.unmount(),this.#o=this.#$),t.m.add(this.binding)}}const St=new Set;class $t extends vt{#o=[];#I=new WeakMap;#P=[];#L=0;#B=void 0;get o(){return this.#o}get I(){return!0}init(){}sn(t){let n;if(this.#L>=0)n=this.#P[this.#L],this.#L--,n.rn(t);else{const e=H(this.ln,t);n=Sn(this.binding,this.id,this.binding.st,e)}return this.#I.set(t,n),n}un(t){t.unmount(),t.Ct?.an()}get cn(){return this.#L}set cn(t){this.#L=t}get hn(){return this.#P.length}set hn(t){t<0&&f("BindingNodeFor.setPoolLength: length is negative"),this.#P.length=t}get ln(){if(void 0===this.#B){const t=this.binding.v.pattern+".*";this.#B=T(t)}return this.#B}l(t){f("BindingNodeFor.assignValue: Not implemented. Use update or applyChange.")}p(t){if(t.m.has(this.binding))return;let n=[];const e=new Set,i=t.Tt(this.binding.v.St),s=this.node.parentNode??f("BindingNodeFor.update: parentNode is null"),o=i.Ot?.length===i.Dt?.size&&(i.Ot?.length??0)>0;let r=!1;if(o){const t=Array.from(s.childNodes),n=this.#o.at(-1)??f("BindingNodeFor.update: lastContent is null");let e=t[0];for(;e&&e.nodeType===Node.TEXT_NODE&&""===e.textContent?.trim();)e=e.nextSibling;let i=t.at(-1)??null;for(;i&&i.nodeType===Node.TEXT_NODE&&""===i.textContent?.trim();)i=i.previousSibling;e===this.node&&i===n.dn(s)&&(r=!0)}if(o&&r){s.textContent="",s.append(this.node);for(let t=0;t<this.#o.length;t++){const n=this.#o[t];n.Ct?.an()}this.#P.push(...this.#o)}else{if(i.Dt)for(const t of i.Dt){const n=this.#I.get(t);void 0===n&&f("BindingNodeFor.applyChange: bindContent is not found"),this.un(n),e.add(n)}this.#P.push(...e)}let l=null;const u=this.node;this.cn=this.hn-1;const a=i.Ht?.length===i.qt?.size&&(i.Ht?.length??0)>0,c=a?document.createDocumentFragment():s,h=a?null:u,d=i.qt??St;for(const e of i.Wt){const i=l?.dn(c)??h;let s;d.has(e)?(s=this.sn(e),s.en(c,i),s.p(t)):(s=this.#I.get(e),void 0===s&&f("BindingNodeFor.applyChange: bindContent is not found"),i?.nextSibling!==s.fn&&s.en(c,i)),n.push(s),l=s}if(a){const t=u.nextSibling;s.insertBefore(c,t)}this.hn=this.cn+1,this.#o=n}}const It=(t,n,e)=>(i,s,o)=>{const r=N(o,n);return new $t(i,s,t,r,e)},Pt="textContent",Lt={radio:"checked",checkbox:"checked",button:"onclick"},Bt={},Mt={HTMLElement:t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLOptionElement?"value":t instanceof HTMLButtonElement||t instanceof HTMLAnchorElement?"onclick":t instanceof HTMLFormElement?"onsubmit":t instanceof HTMLInputElement?Lt[t.type]??"value":Pt,SVGElement:void 0,Text:t=>Pt,pn:void 0};const Et={value:"input",checked:"change",selected:"change"};class Tt extends x{get value(){return this.node[this.name]}get $(){let t=this.value;for(let n=0;n<this.filters.length;n++)t=this.filters[n](t);return t}constructor(t,n,e,i,s){super(t,n,e,i,s);if(!(this.node instanceof HTMLElement))return;if(!((o=this.node)instanceof HTMLInputElement||o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement))return;var o;const r=function(t,n){const e=t.constructor.name+"\t"+(t.type??"");return Bt[e]??(Bt[e]=Mt[n]?.(t))}(this.node,"HTMLElement");if(r!==this.name)return;s.length>1&&f(`BindingNodeProperty: ${this.name} has multiple decorators`);const l=(s[0]?.startsWith("on")?s[0]?.slice(2):s[0])??null??Et[this.name]??"readonly";if("readonly"===l||"ro"===l)return;const u=this.binding.st;this.node.addEventListener(l,(async()=>{const n=this.binding.Yt.Xt,e=this.$;await bt(u,n,(async(n,i)=>{t.mn(i,e)}))}))}init(){}l(t){(null==t||Number.isNaN(t))&&(t=""),this.node[this.name]=t}}const kt=(t,n,e)=>(i,s,o)=>{const r=N(o,n);return new Tt(i,s,t,r,e)};class Rt extends x{l(t){(null==t||Number.isNaN(t))&&(t="");const n=this.node;n.checked=t.toString()===n.value.toString()}}class Ft extends x{#r;get t(){return this.#r}constructor(t,n,e,i,s){super(t,n,e,i,s);const[,o]=this.name.split(".");this.#r=o}l(t){(null==t||Number.isNaN(t))&&(t="");this.node.style.setProperty(this.t,t.toString())}}const Vt="component-state-input",At=Symbol.for(`${Vt}.AssignState`),Ot=Symbol.for(`${Vt}.NotifyRedraw`),Ht=new WeakMap;class zt extends x{#r;get t(){return this.#r}constructor(t,n,e,i,s){super(t,n,e,i,s);const[,o]=this.name.split(".");this.#r=o}init(){const t=this.binding.st;var n,e;n=t.bt,e=this.node,Ht.set(e,n);let i=t.gn.get(this.node);void 0===i&&t.gn.set(this.node,i=new Set),i.add(this.binding)}l(t){}h(t){const n=[],e=this.binding.v.info,i=this.binding.v.tt?.at(e.J-1)??null,s=(i?.length??0)-1;for(const o of t)if(e.L.length>o.info.L.length){if(e.T.has(o.info.pattern)){const t=(o.tt?.length??0)-1;if(t>=0){if(null===i)continue;if(o.tt!==i?.at(t))continue}const s=H(e,i);n.push(s)}}else if(!o.info.T.has(e.pattern)){if(s>=0&&o.tt?.at(s)!==i)continue;n.push(o)}if(0===n.length)return;this.node.state[Ot](n)}}const Wt={0:{class:(t,n,e)=>(i,s,o)=>{const r=N(o,n);return new S(i,s,t,r,e)},checkbox:(t,n,e)=>(i,s,o)=>{const r=N(o,n);return new C(i,s,t,r,e)},radio:(t,n,e)=>(i,s,o)=>{const r=N(o,n);return new Rt(i,s,t,r,e)}},1:{if:(t,n,e)=>(i,s,o)=>{const r=N(o,n);return new Ct(i,s,t,r,e)}}},Dt={class:(t,n,e)=>(i,s,o)=>{const r=N(o,n);return new $(i,s,t,r,e)},attr:(t,n,e)=>(i,s,o)=>{const r=N(o,n);return new v(i,s,t,r,e)},style:(t,n,e)=>(i,s,o)=>{const r=N(o,n);return new Ft(i,s,t,r,e)},state:(t,n,e)=>(i,s,o)=>{const r=N(o,n);return new zt(i,s,t,r,e)}};const qt={};function jt(t,n,e,i){const s=t instanceof Comment,o=t instanceof Element,r=s+"\t"+o+"\t"+n,l=qt[r]??(qt[r]=function(t,n,e){const i=Wt[t?1:0][e];if(void 0!==i)return i;if(t&&"for"===e)return It;t&&f(`getBindingNodeCreator: unknown node property ${e}`);const s=e.split("."),o=Dt[s[0]];return void 0!==o?o:n&&e.startsWith("on")?xt:kt}(s,o,n));return l(n,e,i)}class _t{#t;#M;#E;#i;#T=null;#k=null;#R=null;get pattern(){return this.#M}get info(){return this.#E}get tt(){return this.St.tt}get St(){return null!==this.#T?(null===this.#R&&(this.#R=H(this.#E,this.#T.tt)),this.#R):this.#k??f("ref is null")}get filters(){return this.#i}get binding(){return this.#t}constructor(t,n,e){this.#t=t,this.#M=n,this.#E=T(n),this.#k=0===this.#E.J?H(this.#E,null):null,this.#i=e}nn(t){return t[q](this.St)}N(t){let n=t[q](this.St);for(let t=0;t<this.#i.length;t++)n=this.#i[t](n);return n}init(){if(this.info.J>0){const t=this.info._??f("BindingState.init: wildcardLastParentPath is null");this.#T=this.binding.Yt.Xt?.find(t)??f("BindingState.init: loopContext is null"),this.#R=null}this.binding.st.wn(this.St,this.binding)}l(t,n){t[j](this.St,n)}}class Gt{#t;#F;#i;#T=null;get pattern(){return f("Not implemented")}get info(){return f("Not implemented")}get tt(){return this.#T?.tt??f("listIndex is null")}get St(){return this.#T?.St??f("ref is null")}get filters(){return this.#i}get binding(){return this.#t}constructor(t,n,e){this.#t=t;const i=Number(n.slice(1));isNaN(i)&&f("BindingStateIndex: pattern is not a number"),this.#F=i,this.#i=e}nn(t){return this.tt?.index??f("listIndex is null")}N(t){let n=this.tt?.index??f("listIndex is null");for(let t=0;t<this.#i.length;t++)n=this.#i[t](n);return n}init(){const t=(this.binding.Yt.Xt??f("BindingState.init: loopContext is null")).tn();this.#T=t[this.#F-1]??f("BindingState.init: currentLoopContext is null");const n=this.binding.st.yn.get(this.tt);void 0===n?this.binding.st.yn.set(this.tt,new Set([this.binding])):n.add(this.binding)}l(t,n){f("BindingStateIndex: assignValue is not implemented")}}const Zt=new RegExp(/^\$\d+$/);function Ut(t,n){return Zt.test(t)?((t,n)=>(e,i)=>{const s=N(i,n);return new Gt(e,t,s)})(t,n):((t,n)=>(e,i)=>{const s=N(i,n);return new _t(e,t,s)})(t,n)}const Jt={};function Kt(t,n=(t=>t.constructor.name+"\t"+(t instanceof Comment?t.textContent?.[2]??"":""))(t)){return Jt[n]??(Jt[n]=(t=>t instanceof Comment&&":"===t.textContent?.[2]?"Text":t instanceof HTMLElement?"HTMLElement":t instanceof Comment&&"|"===t.textContent?.[2]?"Template":t instanceof SVGElement?"SVGElement":f(`Unknown NodeType: ${t.nodeType}`))(t))}const Qt=t=>t.trim(),Xt=t=>t.length>0,Yt=new RegExp(/^#(.*)#$/),tn=t=>{const n=Yt.exec(t);return n?decodeURIComponent(n[1]):t},nn=t=>{const[n,...e]=t.split(",").map(Qt);return{name:n,options:e.map(tn)}},en=t=>{const[n,...e]=t.split("|").map(Qt);return{bn:n,filters:e.map(nn)}},sn=t=>t.split(";").map(Qt).filter(Xt).map((t=>(t=>{const[n,e=null]=t.split("@").map(Qt),i=e?e.split(",").map(Qt):[],[s,o]=n.split(":").map(Qt),{bn:r,filters:l}=en(s),{bn:u,filters:a}=en(o);return{Nn:r,xn:u,vn:l,Cn:a,i:i}})(t))),on={};const rn=t=>{t.removeAttribute("data-bind")},ln={HTMLElement:rn,SVGElement:rn,Text:void 0,pn:void 0};const un={Text:t=>{const n=document.createTextNode("");return t.parentNode?.replaceChild(n,t),n},HTMLElement:void 0,pn:void 0,SVGElement:void 0};class an{nodeType;Sn;$n;In=new Map;constructor(t){this.nodeType=Kt(t);const n=function(t,n){switch(t){case"Text":return"textContent:"+(n.textContent?.slice(3).trim()??"");case"HTMLElement":case"SVGElement":return n.getAttribute(I)??"";case"Template":{const t=n.textContent?.slice(3).trim();return(wn(Number(t))??f(`Template not found: ${t}`)).getAttribute(I)??""}default:return""}}(this.nodeType,t);(function(t,n){ln[n]?.(t)})(t=function(t,n){return un[n]?.(t)??t}(t,this.nodeType),this.nodeType),this.Sn=function(t){let n=[];for(;null!==t.parentNode;)n=[Array.from(t.parentNode.childNodes).indexOf(t),...n],t=t.parentNode;return n}(t),this.$n=function(t){return""===t.trim()?[]:on[t]??(on[t]=sn(t))}(n);for(let n=0;n<this.$n.length;n++){const e=this.$n[n],i={Pn:jt(t,e.Nn,e.vn,e.i),Ln:Ut(e.xn,e.Cn)};this.In.set(e,i)}}}function cn(t){const n=[],e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode:t=>t instanceof Element?t.hasAttribute(I)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:function(t){return t instanceof Comment&&(0===t.textContent?.indexOf(P)||0===t.textContent?.indexOf(L))}(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;e.nextNode();)n.push(e.currentNode);return n}const hn={},dn={},fn={};function pn(t){return cn(t).map((t=>function(t){return new an(t)}(t)))}const mn={};function gn(t,n,e){var i;return i=n.content,Array.from(i.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE||(t.nodeValue??"").trim()||i.removeChild(t)})),function(t,n,e=t){const i=pn(n),s=fn[e]??(fn[e]=new Set),o=dn[e]??(dn[e]=new Set);for(let t=0;t<i.length;t++){const n=i[t];for(let t=0;t<n.$n.length;t++){const e=n.$n[t];s.add(e.xn),"for"===e.Nn&&o.add(e.xn)}}hn[t]=i}(t,n.content,e),mn[t]=n,t}function wn(t){return mn[t]??f(`getTemplateById: template not found: ${t}`)}class yn{Yt;node;st;Bn;v;version;constructor(t,n,e,i,s){this.Yt=t,this.node=n,this.st=e,this.Bn=i(this,n,e.Mn),this.v=s(this,e.En)}get o(){return this.Bn.o}init(){this.Bn.init(),this.v.init()}mn(t,n){return this.v.l(t,n)}h(t){this.Bn.h(t)}p(t){t.m.has(this)||this.Bn.p(t)}}function bn(t,n,e,i,s){return new yn(t,n,e,i,s)}class Nn{#R;#E;#C;constructor(t,n){this.#R=t,this.#E=t.info,this.#C=n}get St(){return this.#R??f("ref is null")}get path(){return this.St.info.pattern??f("info.pattern is null")}get info(){return this.St.info??f("info is null")}get tt(){return this.St.tt??f("listIndex is required")}rn(t){this.#R=H(this.#E,t)}an(){this.#R=null}get Tn(){return this.#C}#V;get kn(){if(void 0===this.#V){let t=this.Tn;for(;null!==t;){if(null!==t.Ct&&t.Ct!==this){this.#V=t.Ct;break}t=t.Rn?.Yt??null}void 0===this.#V&&(this.#V=null)}return this.#V}#A={};find(t){let n=this.#A[t];if(void 0===n){let e=this;for(;null!==e&&e.path!==t;)e=e.kn;n=this.#A[t]=e}return n}Fn(t){let n=this;for(;null!==n;)t(n),n=n.kn}tn(){const t=[];return this.Fn((n=>{t.unshift(n)})),t}}function xn(t){const n=wn(t)??f(`BindContent: template is not found: ${t}`),e=document.importNode(n.content,!0);if(Object.keys(Gn).length>0){const t=e.querySelectorAll(":not(:defined)");for(let n=0;n<t.length;n++){Un(t[n].tagName.toLowerCase())}}return e}function vn(t,n,e,i){const s=(t=>hn[t])(n)??f("BindContent: data-bind is not set"),o=[];for(let n=0;n<s.length;n++){const r=s[n],l=w(i,r.Sn)??f(`BindContent: node is not found: ${r.Sn}`);for(let n=0;n<r.$n.length;n++){const i=r.$n[n],s=r.In.get(i)??f(`BindContent: creator is not found: ${i}`),u=bn(t,l,e,s.Pn,s.Ln);o.push(u)}}return o}class Cn{Ct;Rn;childNodes;fragment;st;#d;get id(){return this.#d}get Vn(){return this.childNodes.length>0&&this.childNodes[0].parentNode!==this.fragment}get fn(){return this.childNodes[0]??null}get An(){return this.childNodes[this.childNodes.length-1]??null}dn(t){const n=this.On[this.On.length-1],e=this.An;if(void 0!==n&&n.node===e&&n.o.length>0){const e=(n.o.at(-1)??f("BindContent: childBindContent is not found")).dn(t);if(null!==e)return e}return t!==e?.parentNode?null:e}#O;get Xt(){if(void 0===this.#O){let t=this;for(;null!==t&&null===t.Ct;)t=t.Rn?.Yt??null;this.#O=t?.Ct??null}return this.#O}constructor(t,n,e,i){this.Rn=t,this.#d=n,this.fragment=xn(n),this.childNodes=Array.from(this.fragment.childNodes),this.st=e,this.Ct=null!==i.tt?new Nn(i,this):null,this.On=vn(this,n,e,this.fragment)}mount(t){for(let n=0;n<this.childNodes.length;n++)t.appendChild(this.childNodes[n])}Hn(t,n){for(let e=0;e<this.childNodes.length;e++)t.insertBefore(this.childNodes[e],n)}en(t,n){const e=n?.nextSibling??null;for(let n=0;n<this.childNodes.length;n++)t.insertBefore(this.childNodes[n],e)}unmount(){const t=this.childNodes[0]?.parentElement??null;if(null!==t)for(let n=0;n<this.childNodes.length;n++)t.removeChild(this.childNodes[n])}On=[];init(){for(let t=0;t<this.On.length;t++)this.On[t].init()}rn(t){null==this.Ct&&f("BindContent: loopContext is null"),this.Ct.rn(t),this.init()}p(t){for(let n=0;n<this.On.length;n++){const e=this.On[n];t.m.has(e)||e.p(t)}}}function Sn(t,n,e,i){const s=new Cn(t,n,e,i);return s.init(),s}function $n(t,n,e){if(n.enableShadowDom)if(null===n.zn||function(t){try{const n=document.createElement(t);return"function"==typeof n.attachShadow&&(n.attachShadow({mode:"open"}),!0)}catch{return!1}}(n.zn)){if(!t.shadowRoot){t.attachShadow({mode:"open"}).adoptedStyleSheets=[e]}}else f(`ComponentEngine: Shadow DOM not supported for builtin components that extend ${n.zn}`);else{const n=function(t){let n=t;for(;n;){if(n instanceof ShadowRoot)return n;n=n.parentNode}}(t.parentNode)||document,i=n.adoptedStyleSheets;i.includes(e)||(n.adoptedStyleSheets=[...i,e])}}class In{Wn=new Set;Dn=new Set;qn=new Map;jn=new Map;_n=new Map;Gn=new Map;On=new WeakSet;Zn(t){if(this.On.has(t))return;const n=t.v.pattern,e=t.Bn.t;if(this.qn.has(n))throw new Error(`Parent path "${n}" already has a child path.`);if(this.jn.has(e))throw new Error(`Child path "${e}" already has a parent path.`);this.qn.set(n,e),this.jn.set(e,n),this.Wn.add(n),this.Dn.add(e),this._n.set(n,t),this.Gn.set(e,t),this.On.add(t)}Un(t){return this.qn.get(t)}Jn(t){return this.jn.get(t)}Kn(t){const n=T(t).T.intersection(this.Dn);0===n.size&&f(`No parent path found for child path "${t}".`);const e=Array.from(n),i=e[e.length-1],s=t.slice(i.length),o=this.jn.get(i);return void 0===o&&f(`No parent path found for child path "${t}".`),o+s}Qn(t){const n=T(t).T.intersection(this.Wn);0===n.size&&f(`No child path found for parent path "${t}".`);const e=Array.from(n),i=e[e.length-1],s=t.slice(i.length),o=this.qn.get(i);return void 0===o&&f(`No child path found for parent path "${t}".`),o+s}Xn(t){if(0===this.Dn.size)return null;const n=t.T.intersection(this.Dn);if(0===n.size)return null;{const t=Array.from(n);return t[t.length-1]}}bind(t,n){const e=t.Yn(n);for(const t of e??[])this.Zn(t)}}class Pn{te;st;constructor(t,n){this.te=n,this.st=t}ee(t){bt(this.st,null,(async(n,e)=>{for(const[n,i]of Object.entries(t)){const t=H(T(n),null);e[j](t,i)}}))}h(t){for(const n of t)try{const t=T(this.te.Qn(n.info.pattern)),e=n.tt,i=H(t,e);this.st.getPropertyValue(i);bt(this.st,null,(async(n,i)=>{const s=H(t,e);n.ft(s)}))}catch(t){}}get(t,n,e){if(n===At)return this.ee.bind(this);if(n===Ot)return this.h.bind(this);if("string"==typeof n){const t=H(T(n),null);return this.st.getPropertyValue(t)}f(`Property "${String(n)}" is not supported in ComponentStateInput.`)}set(t,n,e,i){if("string"==typeof n){const t=H(T(n),null);return this.st.ie(t,e),!0}f(`Property "${String(n)}" is not supported in ComponentStateInput.`)}}class Ln{binding;constructor(t){this.binding=t}get(t){const n=this.binding.Xn(t.info);null===n&&f(`No child path found for path "${t.info.toString()}".`);const e=this.binding.Gn.get(n);void 0===e&&f(`No binding found for child path "${n}".`);const i=H(T(this.binding.Kn(t.info.pattern)),t.tt??e.v.tt);return e.st.getPropertyValue(i)}set(t,n){const e=this.binding.Xn(t.info);null===e&&f(`No child path found for path "${t.info.toString()}".`);const i=this.binding.Gn.get(e);void 0===i&&f(`No binding found for child path "${e}".`);const s=T(this.binding.Kn(t.info.pattern)),o=i.st,r=H(s,t.tt??i.v.tt);return bt(o,null,(async(t,e)=>{e[j](r,n)})),!0}startsWith(t){return null!==this.binding.Xn(t)}it(t){const n=this.binding.Xn(t.info);null===n&&f(`No child path found for path "${t.info.toString()}".`);const e=this.binding.Gn.get(n);void 0===e&&f(`No binding found for child path "${n}".`);const i=H(T(this.binding.Kn(t.info.pattern)),t.tt);return e.st.it(i)}}class Bn{type="autonomous";config;se;styleSheet;oe;state;Mn;En;#C=null;get Tn(){return null===this.#C&&f("bindContent is not initialized yet"),this.#C}re=HTMLElement;bt;yn=new WeakMap;gn=new WeakMap;ue=new Set;#H=Promise.withResolvers();#z=null;#W=function(){return new In}();ae;ht;#D=null;#q=null;#j=!1;constructor(t,n){this.config=t,this.config.zn&&(this.type="builtin");const e=n.constructor;var i;this.se=e.se,this.styleSheet=e.styleSheet,this.oe=e.oe,this.state=new this.oe,this.Mn=e.Mn,this.En=e.En,this.bt=n,this.ae=function(t,n){const e=new Pn(t,n);return new Proxy({},e)}(this,this.#W),this.ht=(i=this.#W,new Ln(i))}get rt(){return this.bt.constructor.rt}ce(){for(const t in this.state)B.has(t)||this.rt.he.has(t)||(this.rt.he.add(t),ht(this.rt.Ft,t));const t=this.bt.constructor,n=H(T(""),null);this.#C=Sn(null,t.id,this,n)}get de(){return this.#H}async connectedCallback(){if(await(this.#z?.promise),await(this.bt.fe?.de.promise),this.bt.dataset.state)try{const t=JSON.parse(this.bt.dataset.state);this.ae[At](t)}catch(t){f("Failed to parse state from dataset")}const t=this.bt.fe;if(t&&(t.pe(this.bt),this.#W.bind(t,this.bt)),this.config.me)$n(this.bt,this.config,this.styleSheet);else{this.#q=this.bt.parentNode,this.#D=document.createComment("Structive block placeholder");try{this.#j=!0,this.bt.replaceWith(this.#D)}finally{this.#j=!1}}if(this.config.me)this.Tn.mount(this.bt.shadowRoot??this.bt);else{const t=this.#q??f("Block parent node is not set");this.Tn.en(t,this.#D)}await bt(this,null,(async(t,n)=>{for(const n of this.rt.he){const e=T(n);if(1!==e.L.length)continue;if(this.rt.we.has(n))continue;const i=H(e,null);t.ft(i)}await n[G]()})),queueMicrotask((()=>{this.#H.resolve()}))}async disconnectedCallback(){this.#z=Promise.withResolvers();try{if(this.#j)return;await bt(this,null,(async(t,n)=>{await n[Z]()})),this.bt.fe?.ye(this.bt),this.config.me||(this.#D?.remove(),this.#D=null,this.#q=null)}finally{this.#z.resolve()}}#_={};#G=new WeakMap;#Z=new WeakMap;be(){return{list:null,It:null,On:[]}}Ne(t){if(null===t.tt){let n=this.#_[t.info.id];return void 0===n&&(n=this.be(),this.#_[t.info.id]=n),n}{let n=this.#G.get(t.tt);void 0===n&&(n={},this.#G.set(t.tt,n));let e=n[t.info.id];return void 0===e&&(e=this.be(),n[t.info.id]=e),e}}wn(t,n){this.Ne(t).On.push(n)}Gt(t,n,e){const i=this.Ne(t);i.list=n,i.It=e}Zt(t){return this.Ne(t).On}it(t){if(this.ht.startsWith(t.info))return this.ht.it(t);return this.Ne(t).It}At(t){const n=this.Ne(t);return[n.list,n.It]}getPropertyValue(t){return gt(this,this.state)[q](t)}ie(t,n){bt(this,null,(async(e,i)=>{i[j](t,n)}))}pe(t){this.ue.add(t)}ye(t){this.ue.delete(t)}}const Mn=/\{\{([^\}]+)\}\}/g,En=new Set(["if","for","endif","endfor","elseif","else"]);const Tn="http://www.w3.org/2000/svg";function kn(t,n,e=t){if(n.parentNode?.replaceChild(document.createComment(`${L}${t}`),n),n.namespaceURI===Tn){const t=document.createElement("template"),e=Array.from(n.childNodes);for(let n=0;n<e.length;n++){const i=e[n];t.content.appendChild(i)}const i=n.getAttribute(I);t.setAttribute(I,i??""),n=t}return n.content.querySelectorAll("template").forEach((t=>{kn(d(),t,e)})),gn(t,n,e),t}function Rn(t,n){const e=document.createElement("template");e.dataset.id=t.toString(),e.innerHTML=function(t){const n=[];return t.replaceAll(Mn,((t,e)=>{e=e.trim();const[i]=e.split(":");if(!En.has(i))return`\x3c!--${P}${e}--\x3e`;const s=e.slice(i.length+1).trim(),o={type:i,xe:e,ve:s};if("if"===i||"for"===i)return n.push(o),`<template data-bind="${e}">`;if("endif"===i){const t=[];for(;;){const e=n.pop()??f("replaceMustacheToTemplateOrEmbed: endif without if");if("if"===e.type){t.push("</template>");break}"elseif"===e.type?t.push("</template>"):f("replaceMustacheToTemplateOrEmbed: endif without if")}return t.join("")}if("endfor"===i){if("for"===(n.pop()??f("replaceMustacheToTemplateOrEmbed: endif without if")).type)return"</template>";f("replaceMustacheToTemplateOrEmbed: endfor without for")}else if("elseif"===i){const t=n.at(-1)??f("replaceMustacheToTemplateOrEmbed: elseif without if");if("if"===t.type||"elseif"===t.type)return n.push(o),`</template><template data-bind="if:${t.ve}|not"><template data-bind="if:${s}">`;f("replaceMustacheToTemplateOrEmbed: elseif without if")}else if("else"===i){const t=n.at(-1)??f("replaceMustacheToTemplateOrEmbed: else without if");if("if"===t.type)return`</template><template data-bind="if:${t.ve}|not">`;f("replaceMustacheToTemplateOrEmbed: else without if")}else f("replaceMustacheToTemplateOrEmbed: unknown type")}))}(n),kn(t,e)}const Fn=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/,Vn=/^[a-zA-Z_$][0-9a-zA-Z_$]*(\.[a-zA-Z_$][0-9a-zA-Z_$]*|\.\*)*$/;function An(t,n){const e=new Set(t.M).intersection(n);let i=-1,s="";for(const t of e){const n=t.split(".");1!==n.length&&(n.length>i&&(i=n.length,s=t))}if(s.length>0){if(!Vn.test(s))throw new Error(`Invalid path: ${s}`);const n=T(s),e=[];let i=n.J;for(let s=n.L.length;s<t.L.length;s++){const n=t.L[s];if("*"===n)e.push("[this.$"+(i+1)+"]"),i++;else{if(!Fn.test(n))throw new Error(`Invalid segment name: ${n}`);e.push("."+n)}}const o=e.join("");return{get:new Function("",`return this["${s}"]${o};`),set:new Function("value",`this["${s}"]${o} = value;`)}}{const n=[];let e=0;for(let i=0;i<t.L.length;i++){const s=t.L[i];if("*"===s)n.push("[this.$"+(e+1)+"]"),e++;else{if(!Fn.test(s))throw new Error(`Invalid segment name: ${s}`);n.push((n.length>0?".":"")+s)}}const i=n.join("");return{get:new Function("",`return this.${i};`),set:new Function("value",`this.${i} = value;`)}}}class On{he=new Set;Et=new Set;elements=new Set;we=new Set;ot=new Set;ut=new Set;Ce=new Set;Se=new Map;Ut=new Map;Ft=function(){return new ut("","",0)}();#d;#U;constructor(t){this.#d=t.id,this.#U=t.oe;const n=(t=>fn[t]??[])(this.#d);for(const t of n){const n=T(t);this.he=this.he.union(n.T)}const e=(t=>dn[t]??[])(this.#d);this.Et=this.Et.union(e);for(const t of e){const n=t+".*";this.elements.add(n)}let i=this.#U.prototype;for(;i&&i!==Object.prototype;){const t=Object.getOwnPropertyDescriptors(i);if(t)for(const[n,e]of Object.entries(t)){if(B.has(n))continue;if("function"==typeof e.value){this.we.add(n);continue}const t=void 0!==e.get,i=void 0!==e.set,s=T(n);this.he=this.he.union(s.T),t&&this.ot.add(n),i&&this.ut.add(n)}i=Object.getPrototypeOf(i)}for(const t of this.he){if(this.ot.has(t))continue;if(this.ut.has(t))continue;const n=T(t);if(1===n.L.length)continue;const e=An(n,this.ot);Object.defineProperty(this.#U.prototype,t,{get:e.get,set:e.set,enumerable:!0,configurable:!0}),this.Ce.add(t)}for(const t of this.he){ht(this.Ft,t);const n=T(t);n.Z&&(this.Se.get(n.Z)?.add(t)??this.Se.set(n.Z,new Set([t])))}}ct(t,n){this.Ut.get(n)?.add(t)??this.Ut.set(n,new Set([t]))}}function Hn(t){const e=function(t){const e=n();return{me:void 0===t.me||t.me,enableShadowDom:t.enableShadowDom??e.enableShadowDom,zn:t.zn??null}}(t.oe.$e??{}),i=d(),{Ie:s,Pe:o,oe:r}=t,l=Object.assign({},c),u=Object.assign({},a);r.Le=!0,Rn(i,s),g(i,o),function(t,n){p[t]=n}(i,r);const h=function(t){return t?document.createElement(t).constructor:HTMLElement}(e.zn),w=e.zn;return class extends h{#y;constructor(){super(),this.#y=function(t,n){return new Bn(t,n)}(e,this),this.#y.ce()}connectedCallback(){this.#y.connectedCallback()}disconnectedCallback(){this.#y.disconnectedCallback()}#J;get fe(){var t;return void 0===this.#J&&(this.#J=(t=this,Ht.get(t)??null)),this.#J}get state(){return this.#y.ae}get Be(){return this.#y.oe.Le??!1}get de(){return this.#y.de}Yn(t){return this.#y.gn.get(t)??null}pe(t){this.#y.pe(t)}ye(t){this.#y.ye(t)}static define(t){w?customElements.define(t,this,{zn:w}):customElements.define(t,this)}static get id(){return i}static#K=s;static get Ie(){return this.#K}static set Ie(t){this.#K=t,Rn(this.id,t),this.#Q=null,this.#X=null}static#Y=o;static get Pe(){return this.#Y}static set Pe(t){this.#Y=t,g(this.id,t),this.#tt=null}static#Q=null;static get se(){return this.#Q||(this.#Q=wn(this.id)),this.#Q}static#tt=null;static get styleSheet(){return this.#tt||(this.#tt=function(t){return m[t]??f(`getStyleSheetById: stylesheet not found: ${t}`)}(this.id)),this.#tt}static#U=null;static get oe(){return this.#U||(this.#U=function(t){return p[t]??f(`getStateClassById: stateClass not found: ${t}`)}(this.id)),this.#U}static#nt=l;static get Mn(){return this.#nt}static#et=u;static get En(){return this.#et}static#X=null;static get rt(){return this.#X||(this.#X=new On(this)),this.#X}}}function zn(t){return t.replaceAll(/<!--\{\{([^\}]+)\}\}-->/g,((t,n)=>`{{${n}}}`))}async function Wn(t){const n=await fetch(import.meta.resolve(t));return async function(t){const n=document.createElement("template");n.innerHTML=function(t){return t.replaceAll(/\{\{([^\}]+)\}\}/g,((t,n)=>`\x3c!--{{${n}}}--\x3e`))}(t);const e=n.content.querySelector("template");e?.remove();const i=n.content.querySelector("script[type=module]"),s=btoa(String.fromCodePoint(...(new TextEncoder).encode(i.text))),o=i?await import("data:application/javascript;base64,"+s):{};i?.remove();const r=n.content.querySelector("style");r?.remove();const l=o.default??class{};return{text:t,Ie:zn(e?.innerHTML??"").trim(),Pe:r?.textContent??"",oe:l}}(await n.text())}function Dn(t,n){n.define(t)}const qn="@routes/",jn="@components/",_n="#lazy",Gn={};async function Zn(){const t=function(){const t={};return document.querySelectorAll("script[type='importmap']").forEach((n=>{const e=JSON.parse(n.innerHTML);e.imports&&(t.imports=Object.assign(t.imports||{},e.imports))})),t}();if(t.imports){const n=new Map;for(const[e,i]of Object.entries(t.imports)){let t,i;if(e.startsWith(qn)){i=e.endsWith(_n);const n=e.slice(7,i?-5:void 0);t="routes"+n.replace(/:[^\s/]+/g,"").replace(/\//g,"-"),Yn(t,"/root"===n?"/":n)}e.startsWith(jn)&&(i=e.endsWith(_n),t=e.slice(12,i?-5:void 0)),t&&(i?Gn[t]=e:n.set(t,e))}for(const[t,e]of n.entries()){Dn(t,Hn(await Wn(e)))}}}function Un(t){const n=Gn[t];n?(delete Gn[t],queueMicrotask((async()=>{const e=Hn(await Wn(n));Dn(t,e)}))):console.warn(`loadLazyLoadComponent: alias not found for tagName: ${t}`)}const Jn="routes:",Kn=[];let Qn=null;class Xn extends HTMLElement{Me=window.location.pathname;Ee=window.location.pathname.split("/").pop()||"";Te=document.querySelector("base")?.href.replace(window.location.origin,"")||"/";ke;constructor(){super(),this.ke=this.Re.bind(this)}connectedCallback(){Qn=this,this.innerHTML='<slot name="content"></slot>',window.addEventListener("popstate",this.ke),window.dispatchEvent(new Event("popstate"))}disconnectedCallback(){window.removeEventListener("popstate",this.ke),Qn=null}Re(t){t.preventDefault(),this.Rt()}navigate(t){const n="/"===t[0]?this.Te+t.slice(1):t;history.pushState({},"",n),this.Rt()}Rt(){Array.from(this.childNodes).filter((t=>"content"===t.getAttribute?.("slot"))).forEach((t=>this.removeChild(t)));const t=window.location.pathname.split("/");t.at(-1)===this.Ee&&(t[t.length-1]="");const n=t.join("/").replace(this.Te,""),e="/"!==n[0]?"/"+n:n;let i,s={};for(const[t,n]of Kn){const o=new RegExp("^"+t.replace(/:[^\s/]+/g,"([^/]+)")+"$");if(o.test(e)){i=n;const r=e.match(o);if(r){(t.match(/:[^\s/]+/g)||[]).forEach(((t,n)=>{s[t.substring(1)]=r[n+1]}))}break}}if(i){const t=document.createElement(i);t.setAttribute("data-state",JSON.stringify(s)),t.setAttribute("slot","content"),this.appendChild(t),function(t){return Gn.hasOwnProperty(t)}(i)&&Un(i)}else{const t=document.createElement("h1");t.setAttribute("slot","content"),t.textContent="404 Not Found",this.appendChild(t)}}}function Yn(t,n){n.startsWith(Jn)&&(n=n.substring(Jn.length)),Kn.push([n,t])}function te(){return Qn}const ne="router",ee=`<slot name="${ne}"></slot>`;class ie extends HTMLElement{constructor(){super(),e.enableShadowDom&&this.attachShadow({mode:"open"})}async connectedCallback(){await this.Fe(),this.Rt()}get root(){return this.shadowRoot??this}async Fe(){if(e.layoutPath){const t=await fetch(e.layoutPath);if(t.ok){const n=await t.text(),e=document.createElement("template");e.innerHTML=n;const i=e.content.querySelector("template"),s=e.content.querySelector("style");if(this.root.appendChild(i?.content??document.createDocumentFragment()),s){const t=this.shadowRoot??document,n=t.adoptedStyleSheets;n.includes(s)||(t.adoptedStyleSheets=[...n,s])}}else f(`Failed to load layout from ${e.layoutPath}`)}else this.root.innerHTML=ee}Rt(){if(e.enableRouter){const t=document.createElement(e.routerTagName);t.setAttribute("slot",ne),this.root.appendChild(t)}}}const se=e;let oe=!1;async function re(t){await async function(t){for(const[n,i]of Object.entries(t)){let t=null;if(e.enableRouter){const t=i.startsWith("@routes")?i.slice(7):i;Yn(n,"/root"===t?"/":t)}t=await Wn(i),Dn(n,Hn(t))}}(t),se.autoInit&&await le()}async function le(){oe||(await async function(){if(e.autoLoadFromImportMap&&await Zn(),e.enableRouter&&customElements.define(e.routerTagName,Xn),e.enableMainWrapper&&(customElements.define(e.mainTagName,ie),e.autoInsertMainWrapper)){const t=document.createElement(e.mainTagName);document.body.appendChild(t)}}(),oe=!0)}export{le as bootstrapStructive,se as config,re as defineComponents};
//# sourceMappingURL=structive.min.js.map
