const t={debug:!1,locale:"en-US",enableShadowDom:!0,enableMainWrapper:!0,enableRouter:!0,autoInsertMainWrapper:!1,autoInit:!0,mainTagName:"app-main",routerTagName:"view-router",layoutPath:"",autoLoadFromImportMap:!1,optimizeList:!0,optimizeListElements:!0,optimizeAccessor:!0};function e(){return t}const n=e();function s(t){if("string"==typeof t)throw new Error(t);const{message:e,code:n,context:s,hint:o,t:i,o:r,i:c}=t,d=new Error(e);throw d.code=n,s&&(d.context=s),o&&(d.hint=o),i&&(d.t=i),r&&(d.o=r),c&&(d.i=c),d}function o(t){s({code:"FLT-202",message:`${t} requires at least one option`,context:{l:t},t:"./docs/error-codes.md#flt"})}function i(t){s({code:"FLT-202",message:`${t} requires a number as option`,context:{l:t},t:"./docs/error-codes.md#flt"})}function r(t){s({code:"FLT-202",message:`${t} requires a number value`,context:{l:t},t:"./docs/error-codes.md#flt"})}function c(t){s({code:"FLT-202",message:`${t} requires a date value`,context:{l:t},t:"./docs/error-codes.md#flt"})}const d=e(),l={eq:t=>{const e=t?.[0]??o("eq");return t=>{if("number"==typeof t){const n=Number(e);return isNaN(n)&&i("eq"),t===n}return t===e}},ne:t=>{const e=t?.[0]??o("ne");return t=>{if("number"==typeof t){const n=Number(e);return isNaN(n)&&i("eq"),t!==n}return t!==e}},not:t=>t=>{var e;return"boolean"!=typeof t&&s({code:"FLT-202",message:`${e="not"} requires a boolean value`,context:{l:e},t:"./docs/error-codes.md#flt"}),!t},lt:t=>{const e=t?.[0]??o("lt"),n=Number(e);return isNaN(n)&&i("lt"),t=>("number"!=typeof t&&r("lt"),t<n)},le:t=>{const e=t?.[0]??o("le"),n=Number(e);return isNaN(n)&&i("le"),t=>("number"!=typeof t&&r("le"),t<=n)},gt:t=>{const e=t?.[0]??o("gt"),n=Number(e);return isNaN(n)&&i("gt"),t=>("number"!=typeof t&&r("gt"),t>n)},ge:t=>{const e=t?.[0]??o("ge"),n=Number(e);return isNaN(n)&&i("ge"),t=>("number"!=typeof t&&r("ge"),t>=n)},inc:t=>{const e=t?.[0]??o("inc"),n=Number(e);return isNaN(n)&&i("inc"),t=>("number"!=typeof t&&r("inc"),t+n)},dec:t=>{const e=t?.[0]??o("dec"),n=Number(e);return isNaN(n)&&i("dec"),t=>("number"!=typeof t&&r("dec"),t-n)},mul:t=>{const e=t?.[0]??o("mul"),n=Number(e);return isNaN(n)&&i("mul"),t=>("number"!=typeof t&&r("mul"),t*n)},div:t=>{const e=t?.[0]??o("div"),n=Number(e);return isNaN(n)&&i("div"),t=>("number"!=typeof t&&r("div"),t/n)},fix:t=>{const e=Number(t?.[0]??0);return isNaN(e)&&i("div"),t=>("number"!=typeof t&&r("div"),t.toFixed(e))},locale:t=>{const e=t?.[0]??d.locale;return t=>("number"!=typeof t&&r("locale"),t.toLocaleString(e))},uc:t=>t=>t.toString().toUpperCase(),lc:t=>t=>t.toString().toLowerCase(),cap:t=>t=>{const e=t.toString();return 0===e.length?e:1===e.length?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1)},trim:t=>t=>t.toString().trim(),slice:t=>{const e=t?.[0]??o("slice"),n=Number(e);return isNaN(n)&&i("slice"),t=>t.toString().slice(n)},substr:t=>{const e=t?.[0]??o("substr"),n=Number(e);isNaN(n)&&i("substr");const s=t?.[1]??o("substr"),r=Number(s);return isNaN(r)&&i("substr"),t=>t.toString().substr(n,r)},pad:t=>{const e=t?.[0]??o("pad"),n=Number(e);isNaN(n)&&i("pad");const s=t?.[1]??"0";return t=>t.toString().padStart(n,s)},rep:t=>{const e=t?.[0]??o("rep"),n=Number(e);return isNaN(n)&&i("rep"),t=>t.toString().repeat(n)},rev:t=>t=>t.toString().split("").reverse().join(""),int:t=>t=>parseInt(t,10),float:t=>t=>parseFloat(t),round:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&i("round"),t=>("number"!=typeof t&&r("round"),Math.round(t*n)/n)},floor:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&i("floor"),t=>("number"!=typeof t&&r("floor"),Math.floor(t*n)/n)},ceil:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&i("ceil"),t=>("number"!=typeof t&&r("ceil"),Math.ceil(t*n)/n)},percent:t=>{const e=Number(t?.[0]??0);return isNaN(e)&&i("percent"),t=>("number"!=typeof t&&r("percent"),t.toFixed(e)+"%")},date:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("date"),t.toLocaleDateString(e))},time:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("time"),t.toLocaleTimeString(e))},datetime:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("datetime"),t.toLocaleString(e))},ymd:t=>{const e=t?.[0]??"-";return t=>{t instanceof Date||c("ymd");const n=t.getFullYear().toString(),s=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${n}${e}${s}${e}${o}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const e=t?.[0]??o("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?e:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},a=l,h=l;let u=0;function f(){return++u}const m={};const p={};function g(t,e){const n=new CSSStyleSheet;n.replaceSync(e),function(t,e){p[t]=e}(t,n)}function w(t,e){let n=t;if(0===e.length)return n;for(let t=0;t<e.length&&(n=n?.childNodes[e[t]]??null,null!==n);t++);return n}function x(t,e){const n=t[e.name];return n||s({code:"FLT-201",message:`Filter not found: ${e.name}`,context:{h:"createFilters.textToFilter",name:e.name},t:"./docs/error-codes.md#flt"}),n(e.options)}const y=new Map;function b(t,e){let n=y.get(e);if(void 0===n){n=[];for(let s=0;s<e.length;s++)n.push(x(t,e[s]));y.set(e,n)}return n}class N{#t;#e;#n;#s;#o;#i=[];get node(){return this.#e}get name(){return this.#n}get u(){return this.#n}get binding(){return this.#t}get m(){return this.#o}get filters(){return this.#s}get p(){return this.#i}constructor(t,e,n,s,o){this.#t=t,this.#e=e,this.#n=n,this.#s=s,this.#o=o}init(){}N(t){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingNode.assignValue",name:this.name},t:"/docs/error-codes.md#bind"})}I(t,e){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingNode.updateElements",name:this.name},t:"/docs/error-codes.md#bind"})}S(t){}v(t){if(t.T.has(this.binding))return;const e=this.binding.B.C(t.U,t.P);this.N(e),t.T.add(this.binding)}get $(){return this.node instanceof HTMLSelectElement}get value(){return null}get L(){return null}get M(){return!1}get D(){return!1}}class I extends N{#r;get u(){return this.#r}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,i]=this.name.split(".");this.#r=i}N(t){(null==t||Number.isNaN(t))&&(t="");this.node.setAttribute(this.u,t.toString())}}class S extends N{N(t){Array.isArray(t)||s({code:"BIND-201",message:"Value is not array",context:{h:"BindingNodeCheckbox.update",k:typeof t},t:"/docs/error-codes.md#bind",o:"error"});const e=this.node;e.checked=t.map((t=>t.toString())).includes(e.value)}}class v extends N{N(t){Array.isArray(t)||s({code:"BIND-201",message:"Value is not array",context:{h:"BindingNodeClassList.update",k:typeof t},t:"/docs/error-codes.md#bind",o:"error"});this.node.className=t.join(" ")}}class T extends N{#r;get u(){return this.#r}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,i]=this.name.split(".");this.#r=i}N(t){"boolean"!=typeof t&&s({code:"BIND-201",message:"Value is not boolean",context:{h:"BindingNodeClassName.update",k:typeof t},t:"/docs/error-codes.md#bind",o:"error"});const e=this.node;t?e.classList.add(this.u):e.classList.remove(this.u)}}let C=0,B=0;class U{#c=null;#d=0;#l=0;#a;#h=++B;#u=this.#h.toString();constructor(t,e){this.#c=t,this.#d=t?t.position+1:0,this.#l=e,this.#a=C}get A(){return this.#c}get id(){return this.#h}get F(){return this.#u}get position(){return this.#d}get length(){return this.#d+1}get index(){return this.#l}set index(t){this.#l=t,this.#a=++C,this.V[this.#d]=t}get version(){return this.#a}get R(){return null!==this.#c&&(this.#c.R||this.#c.version>this.#a)}#f;get V(){return null===this.#c?void 0===this.#f&&(this.#f=[this.#l]):(void 0===this.#f||this.R)&&(this.#f=[...this.#c.V,this.#l],this.#a=C),this.#f}#m;get W(){return null===this.#c?void 0===this.#m&&(this.#m=[new WeakRef(this)]):void 0===this.#m&&(this.#m=[...this.#c.W,new WeakRef(this)]),this.#m}get H(){return`${this.position+1}`}at(t){return t>=0?this.W[t]?.deref()||null:this.W[this.W.length+t]?.deref()||null}}function P(t,e){return new U(t,e)}function $(t,e,n,s){const o=n||[],i=e||[],r=s||[];if(o===i||0===o.length&&0===i.length)return{O:e,q:n,j:r,_:r,G:!0};if(0===o.length)return{O:e,q:n,j:r,_:[],K:new Set(r),G:!1};if(0===i.length){const s=[];for(let e=0;e<o.length;e++)s.push(P(t,e));return{O:e,q:n,j:r,_:s,Z:new Set(s),G:!1}}{const s=new Map;for(let t=0;t<i.length;t++)s.set(i[t],t);const c=new Set,d=new Set,l=new Set;let a=[],h=new Set,u=i.length===o.length;for(let e=0;e<o.length;e++){const n=o[e];if(u){if(n===i[e])continue;a=r.slice(0,e),h=new Set(a),u=!1}const d=s.get(n);if(void 0===d){const n=P(t,e);c.add(n),a.push(n)}else{const t=r[d];t.index!==e&&(t.index=e,l.add(t)),h.add(t),a.push(t)}}if(u)return{O:e,q:n,j:r,_:r,G:!0};for(let t=0;t<r.length;t++){const e=r[t];h.has(e)||d.add(e)}return{O:e,q:n,j:r,_:a,Z:c,K:d,J:l,G:!1}}}const L="data-bind",M="@@:",E="@@|",D=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","watch","unwatch","eval","arguments","let","var","const","class","function","null","true","false","new","return"]),k={};class A{static id=0;id=++A.id;F=this.id.toString();pattern;X;Y;tt;et;nt;st;ot;it;rt;ct;dt;ht;ut;ft;wt;xt;yt;bt;Nt;It;children={};constructor(t){const e=e=>t===e?this:F(e),n=t.split("."),s=[],o=[],i=[],r={},c=[],d=[],l=[];let a="",h="",u=0;for(let t=0;t<n.length;t++)a+=n[t],"*"===n[t]&&(i.push(a),r[a]=u,c.push(e(a)),d.push(h),l.push(e(h)),u++),s.push(a),o.push(e(a)),h=a,a+=".";const f=i.length>0?i[i.length-1]:null,m=s.length>1?s[s.length-2]:null;this.pattern=t,this.X=n,this.Y=n[n.length-1],this.tt=s,this.et=new Set(s),this.nt=o,this.st=new Set(o),this.ot=i,this.it=new Set(i),this.ct=r,this.rt=c,this.dt=new Set(c),this.ht=d,this.ut=new Set(d),this.ft=l,this.wt=new Set(l),this.xt=f,this.yt=f?e(f):null,this.bt=m,this.Nt=m?e(m):null,this.It=u,this.Nt&&(this.Nt.children[this.Y]=this)}}function F(t){D.has(t)&&s({code:"STATE-202",message:`Pattern is reserved word: ${t}`,context:{h:"getStructuredPathInfo",St:t},t:"./docs/error-codes.md#state"});const e=k[t];return void 0!==e?e:k[t]=new A(t)}class V{bt;vt;name;Tt;level;constructor(t,e,n){this.bt=t,this.vt=t?t+"."+e:e,this.name=e,this.level=n,this.Tt=new Map}find(t,e=0){if(e>=t.length)return null;const n=t[e],s=this.Tt.get(n);return s?e===t.length-1?s:s.find(t,e+1):null}appendChild(t){let e=this.Tt.get(t);if(!e){const n=this.bt?this.bt+"."+this.name:this.name;e=new V(n,t,this.level+1),this.Tt.set(t,e)}return e}}const R=new Map;function W(t,e){let n=R.get(t);n||(n=new Map,R.set(t,n));let s=n.get(e)??null;if(s)return s;const o=F(e);return s=t.find(o.X),n.set(e,s),s}function H(t,e){const n=F(e);if(null===n.bt)return t.appendChild(e);{let e=W(t,n.bt);return null===e&&(e=H(t,n.bt)),e.appendChild(n.Y)}}const O="state",z=Symbol.for(`${O}.GetByRef`),q=Symbol.for(`${O}.SetByRef`),j=Symbol.for(`${O}.ConnectedCallback`),_=Symbol.for(`${O}.DisconnectedCallback`),G=new Map;class K{static id=0;id=++K.id;name;elements;Ct;It;Bt;Ut;info;constructor(t){const e=t.split("."),n=e.slice(),s=[];let o=0,i=0,r="",c=0,d="none",l=[];for(let t=0;t<e.length;t++){const d=e[t];if("*"===d)n[t]="*",l.push(null),o++,c++;else{const e=Number(d);Number.isNaN(e)||(n[t]="*",l.push(e),i++,c++)}r+=d,s.push(r),r+=t<e.length-1?".":""}const a=F(n.join("."));(o>0||i>0)&&(d=o===c?"context":i===c?"all":"partial"),this.name=t,this.elements=e,this.Ct=s,this.It=c,this.Bt=d,this.Ut=l,this.info=a}}function Z(t){let e;return G.get(t)??(G.set(t,e=new K(t)),e)}class J{info;#p;get Pt(){return null===this.#p?null:this.#p.deref()??s({code:"LIST-201",message:"listIndex is null",context:{F:this.info.F,key:this.key},t:"./docs/error-codes.md#list"})}key;constructor(t,e){this.info=t,this.#p=null!==e?new WeakRef(e):null,this.key=function(t,e){return null==e?t.F:t.F+"#"+e.F}(t,e)}}const Q=new WeakMap,X={};function Y(t,e){let n=null;if(null!==e){let s=Q.get(e);return void 0===s&&(s={},Q.set(e,s)),n=s[t.pattern],void 0===n&&(n=new J(t,e),s[t.pattern]=n),n}return n=X[t.pattern],void 0===n&&(n=new J(t,null),X[t.pattern]=n),n}function tt(t,e){const n=t.$t;if(null==n)return null;if(null==n.info)return null;if(null==n.Pt)return null;const s=n.info.ct[e];return void 0!==s?n.Pt.at(s):null}function et(t,e,n){switch(t.Bt){case"none":return null;case"context":return tt(n,t.info.xt??s({code:"STATE-202",message:"lastWildcardPath is null",context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#state"}))??s({code:"LIST-201",message:`ListIndex not found: ${t.info.pattern}`,context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#list"});case"all":let e=null;for(let o=0;o<t.info.It;o++){const i=t.info.ft[o]??s({code:"STATE-202",message:"wildcardParentPattern is null",context:{h:"getListIndex",pattern:t.info.pattern,index:o},t:"/docs/error-codes.md#state"}),r=Y(i,e),c=n.Mt.Lt(r)??s({code:"LIST-201",message:`ListIndex not found: ${i.pattern}`,context:{h:"getListIndex",Et:i.pattern},t:"/docs/error-codes.md#list"}),d=t.Ut[o]??s({code:"STATE-202",message:"wildcardIndex is null",context:{h:"getListIndex",pattern:t.info.pattern,index:o},t:"/docs/error-codes.md#state"});e=c[d]??s({code:"LIST-201",message:`ListIndex not found: ${i.pattern}`,context:{h:"getListIndex",Et:i.pattern,Dt:d},t:"/docs/error-codes.md#list"})}return e;case"partial":s({code:"STATE-202",message:`Partial wildcard type is not supported yet: ${t.info.pattern}`,context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#state"})}}const nt={};for(let t=0;t<32;t++)nt[`$${t+1}`]=t;function st(t,e,n,o){let i;const r=o.Mt.At.kt.has(e.info.pattern);if(r){const t=o.Mt.cache.get(e),n=o.Vt.Ft.get(e.info.pattern);if(void 0!==t){if(void 0===n)return t.value;if(t.version>o.Vt.version)return t.value;if(!(t.version<o.Vt.version||t.Rt<n))return t.value}}if(function(t,e){if(t.Wt>=0){const n=t.$t?.info??null;null!==n&&t.Mt.At.Ht.has(n.pattern)&&n.pattern!==e.info.pattern&&t.Mt.At.Ot(n.pattern,e.info.pattern)}}(o,e),o.Mt.zt.startsWith(e.info)&&0===o.Mt.At.kt.intersection(e.info.et).size)return o.Mt.zt.get(e);if(e.info.pattern in t){o.Wt++,o.Wt>=o.qt.length&&o.qt.push(null),o.qt[o.Wt]=o.$t=e;try{return i=Reflect.get(t,e.info.pattern,n)}finally{o.qt[o.Wt]=null,o.Wt--,o.$t=o.Wt>=0?o.qt[o.Wt]:null,r&&o.Mt.cache.set(e,{value:i,version:o.Vt.version,Rt:o.Vt.Rt}),o.Mt.At.jt.has(e.info.pattern)&&o.Vt._t(e,i)}}else s({code:"STC-001",message:`Property "${e.info.pattern}" does not exist in state.`,t:"./docs/error-codes.md#stc"})}function ot(t,e,n,o,i){try{if(i.Mt.zt.startsWith(e.info)&&0===i.Mt.At.Gt.intersection(e.info.et).size)return i.Mt.zt.set(e,n);if(!(e.info.pattern in t)){const r=e.info.Nt??s({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{h:"setByRef",Kt:e.info.pattern},t:"/docs/error-codes.md#state"}),c=r.It<e.info.It?e.Pt?.A??null:e.Pt,d=st(t,Y(r,c),o,i),l=e.info.Y;if("*"===l){const t=e.Pt?.index??s({code:"STATE-202",message:"propRef.listIndex?.index is undefined",context:{h:"setByRef",Kt:e.info.pattern},t:"/docs/error-codes.md#state"});return Reflect.set(d,t,n)}return Reflect.set(d,l,n)}i.Wt++,i.Wt>=i.qt.length&&i.qt.push(null),i.qt[i.Wt]=i.$t=e;try{return Reflect.set(t,e.info.pattern,n,o)}finally{i.qt[i.Wt]=null,i.Wt--,i.$t=i.Wt>=0?i.qt[i.Wt]:null}}finally{i.Vt.Zt(e)}}function it(t,e,n,o){return(e,i,r)=>{const c=F(e),d=o.$t?.info??null;null!==d&&d.pattern!==c.pattern&&o.Mt.At.Ht.has(d.pattern)&&o.Mt.At.Ot(d.pattern,c.pattern),c.ft.length>i.length&&s({code:"STATE-202",message:`indexes length is insufficient: ${e}`,context:{path:e,Jt:c.ft.length,Qt:i.length},t:"/docs/error-codes.md#state",o:"error"});let l=null;for(let e=0;e<c.ft.length;e++){const r=c.ft[e],d=Y(r,l);st(t,d,n,o);const a=o.Mt.Lt(d);null===a&&s({code:"LIST-201",message:`ListIndexes not found: ${r.pattern}`,context:{pattern:r.pattern},t:"/docs/error-codes.md#list",o:"error"});const h=i[e];l=a[h]??s({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{pattern:r.pattern,index:h},t:"/docs/error-codes.md#list",o:"error"})}const a=Y(c,l),h=void 0!==r;if(q in n){if(!h)return st(t,a,n,o);ot(t,a,r,n,o)}else{if(!h)return st(t,a,n,o);s({code:"STATE-202",message:`Cannot set value on a readonly proxy: ${e}`,context:{path:e},t:"/docs/error-codes.md#state",o:"error"})}}}function rt(t,e,n,o){const i=nt[e];if(void 0!==i){const t=o.$t?.Pt;return t?.V[i]??s({code:"LIST-201",message:`ListIndex not found: ${e.toString()}`,context:{Xt:String(e),V:t?.V??null,index:i},t:"/docs/error-codes.md#list",o:"error"})}if("string"==typeof e){if("$"===e[0])switch(e){case"$resolve":return it(t,0,n,o);case"$getAll":return function(t,e,n,o){const i=it(t,0,n,o);return(e,r)=>{const c=F(e),d=o.$t?.info??null;if(null!==d&&d.pattern!==c.pattern&&o.Mt.At.Ht.has(d.pattern)&&o.Mt.At.Ot(d.pattern,c.pattern),void 0===r){for(let t=0;t<c.rt.length;t++){const e=c.rt[t]??s({code:"BIND-201",message:"wildcardPattern is null",context:{index:t,Yt:c.pattern},t:"/docs/error-codes.md#bind",o:"error"}),n=tt(o,e.pattern);if(n){r=n.V;break}}void 0===r&&(r=[])}const l=(e,i,r,c,d,a,h)=>{const u=e[i]??null;if(null===u)return void h.push(a);const f=Y(u,r);st(t,f,n,o);const m=o.Mt.Lt(f);null===m&&s({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{pattern:u.pattern},t:"/docs/error-codes.md#list",o:"error"});const p=c[d]??null;if(null===p)for(let t=0;t<m.length;t++){const n=m[t];l(e,i+1,n,c,d+1,a.concat(n.index),h)}else{const t=m[p]??s({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{pattern:u.pattern,index:p},t:"/docs/error-codes.md#list",o:"error"});i+1<e.length?l(e,i+1,t,c,d+1,a.concat(t.index),h):h.push(a.concat(t.index))}},a=[];l(c.ft,0,null,r,0,[],a);const h=[];for(let t=0;t<a.length;t++)h.push(i(c.pattern,a[t]));return h}}(t,0,n,o);case"$trackDependency":return function(t,e,n,o){return t=>{const e=o.$t?.info??s({code:"STATE-202",message:"Internal error: lastRefStack is null",context:{h:"trackDependency",path:t},t:"/docs/error-codes.md#state"});o.Mt.At.kt.has(e.pattern)&&e.pattern!==t&&o.Mt.At.Ot(e.pattern,t)}}(0,0,0,o);case"$navigate":return t=>qe?.navigate(t);case"$component":return o.Mt.te}const i=Z(e),r=et(i,0,o),c=Y(i.info,r);return st(t,c,n,o)}if("symbol"==typeof e){if(!o.symbols.has(e))return Reflect.get(t,e,n);switch(e){case z:return e=>st(t,e,n,o);case q:return(e,s)=>ot(t,e,s,n,o);case j:return()=>async function(t,e,n){const s=Reflect.get(t,"$connectedCallback");"function"==typeof s&&await s.call(n)}(t,0,n);case _:return()=>async function(t,e,n){const s=Reflect.get(t,"$disconnectedCallback");"function"==typeof s&&await s.call(n)}(t,0,n)}}}let ct=class{Mt;Vt;qt=Array(32).fill(null);Wt=-1;$t=null;ee=null;symbols=new Set([z]);se=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e){this.Mt=t,this.Vt=e}get(t,e,n){return rt(t,e,n,this)}set(t,e,n,o){s({code:"STATE-202",message:`Cannot set property ${String(e)} of readonly state`,context:{h:"createReadonlyStateProxy.set",Xt:String(e)},t:"./docs/error-codes.md#state"})}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.se.has(e)}};class dt{Mt;qt=Array(32).fill(null);Wt=-1;$t=null;ee=null;Vt;symbols=new Set([z,q,j,_]);se=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e){this.Mt=t,this.Vt=e}get(t,e,n){return rt(t,e,n,this)}set(t,e,n,s){return function(t,e,n,s,o){if("string"==typeof e){const i=Z(e),r=et(i,0,o);return ot(t,Y(i.info,r),n,s,o)}return Reflect.set(t,e,n,s)}(t,e,n,s,this)}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.se.has(e)}}async function lt(t,e,n,o,i){const r=new dt(t,e),c=new Proxy(n,r);return async function(t,e,n){t.ee&&s({code:"STATE-301",message:"already in loop context",context:{h:"setLoopContext"},t:"/docs/error-codes.md#state"}),t.ee=e;try{e?await async function(t,e,n){t.Wt++,t.Wt>=t.qt.length&&t.qt.push(null),t.qt[t.Wt]=t.$t=e;try{await n()}finally{t.qt[t.Wt]=null,t.Wt--,t.$t=t.Wt>=0?t.qt[t.Wt]:null}}(t,e.oe,n):await n()}finally{t.ee=null}}(r,o,(async()=>{await i(c,r)}))}class at{#g=new Set;#w=new Set;#x;#y=null;#b=null;#N=new Map;#I=new Map;#S;constructor(t,e){this.#x=t,this.#S=e}get T(){return this.#g}get ie(){return this.#w}get U(){return this.#y||s({code:"UPD-002",message:"ReadonlyState not initialized",t:"./docs/error-codes.md#upd"}),this.#y}get P(){return this.#b||s({code:"UPD-002",message:"ReadonlyHandler not initialized",t:"./docs/error-codes.md#upd"}),this.#b}get Mt(){return this.#x||s({code:"UPD-001",message:"Engine not initialized",t:"./docs/error-codes.md#upd"}),this.#x}re(t){const e=new Set;for(let n=0;n<t.length;n++){const o=t[n];if(this.Mt.At.jt.has(o.info.pattern)){e.add(o);continue}if(!this.Mt.At.elements.has(o.info.pattern))continue;this.#w.add(o),null===o.info.Nt&&s({code:"UPD-004",message:`ParentInfo is null for ref: ${o.key}`,context:{ce:o.key,pattern:o.info.pattern},t:"./docs/error-codes.md#upd"});const i=Y(o.info.Nt,o.Pt?.at(-2)||null);if(e.has(i))continue;let r=this.#I.get(i);void 0===r&&(r=[],this.#I.set(i,r));const c=o.Pt??s({code:"UPD-003",message:`ListIndex is null for ref: ${o.key}`,context:{ce:o.key,pattern:o.info.pattern},t:"./docs/error-codes.md#upd"});r.push(c.index)}for(const[t,e]of this.#I){this.#N.set(t,null);try{const n=this.U[z](t),{de:o,W:i}=this.Mt.ae(t);null!=o&&null!=i||s({code:"UPD-005",message:`OldListValue or OldListIndexes is null for ref: ${t.key}`,context:{ce:t.key,pattern:t.info.pattern},t:"./docs/error-codes.md#upd"});const r={O:o,q:n,j:i,_:Array.from(i),J:new Set,he:new Set,G:!0};for(let n=0;n<e.length;n++){const o=e[n],i=r.q?.[o],c=r.O?.indexOf(i)??-1;if(-1===c)r.he?.add(r._[o]);else{const e=r.j?.[c]??s({code:"UPD-004",message:`ListIndex not found for value: ${i}`,context:{ce:t.key,pattern:t.info.pattern},t:"./docs/error-codes.md#upd"});e.index=o,r._[o]=e,r.J?.add(e)}r.G=!1}this.#N.set(t,r),this.Mt.ue(t,n??null,r._);const c=W(this.#x.At.fe,t.info.pattern);null===c&&s({code:"PATH-101",message:`PathNode not found: ${t.info.pattern}`,context:{pattern:t.info.pattern},t:"./docs/error-codes.md#path"}),this.me(t,c)}finally{}}}pe(t){this.#N.clear(),this.#I.clear(),this.#w.clear(),this.#g.clear(),this.#S.we(((e,n)=>{this.#y=e,this.#b=n;try{this.re(t);for(let e=0;e<t.length;e++){const n=t[e],o=W(this.#x.At.fe,n.info.pattern);null===o&&s({code:"PATH-101",message:`PathNode not found: ${n.info.pattern}`,context:{pattern:n.info.pattern},t:"./docs/error-codes.md#path"}),this.me(n,o)}}finally{this.#y=null,this.#b=null}}))}_t(t){return this.U[z](t),this.#S.xe(t)??null}me(t,e){if(this.ie.has(t))return;this.ie.add(t);const n=this.#x.ye(t);for(let t=0;t<n.length;t++){const e=n[t];this.T.has(e)||e.v(this)}for(const[n,o]of e.Tt){const e=F(o.vt);if("*"===n){const n=this.#S.xe(t)??null;null===n&&s({code:"UPD-006",message:"ListDiff is null during renderItem",context:{ce:t.key,pattern:t.info.pattern},t:"./docs/error-codes.md#upd"});for(const t of n.Z??[]){const n=Y(e,t);this.me(n,o)}}else{const n=Y(e,t.Pt);this.me(n,o)}}const o=this.#x.At.be.get(t.info.pattern);if(o)for(const t of o){const e=F(t),n=W(this.#x.At.fe,e.pattern);if(null===n&&s({code:"PATH-101",message:`PathNode not found: ${e.pattern}`,context:{pattern:e.pattern},t:"./docs/error-codes.md#path"}),e.It>0){const t=e.ft,s=(o,i,r)=>{this.U[z](o);const c=this.#x.Lt(o)||[];if(i+1<t.length)for(let e=0;e<c.length;e++){const n=Y(r,c[e]);s(n,i+1,t[i+1])}else for(let t=0;t<c.length;t++){const s=Y(e,c[t]);this.me(s,n)}},o=Y(e.ft[0],null);s(o,0,e.ft[1]||null)}else{const t=Y(e,null);this.me(t,n)}}}}class ht{queue=[];#v=!1;#T=!1;#x;#C=void 0;#a;#B=0;#N=new WeakMap;#U=new WeakMap;#P=new Map;get Ft(){return this.#P}get Ne(){return this.#N}get version(){return this.#a}get Rt(){return this.#B}Ie(t){let e=this.#U.get(t);return void 0===e&&(e=this.#x.ae(t)),e}_t(t,e){const n=this.#N.get(t);if(void 0!==n){if($(t.Pt,n.q,e,n._).G)return!1}const s=this.Ie(t),o=$(t.Pt,s?.list,e,s?.W);return o.G?(this.#N.set(t,o),!1):(this.#N.set(t,o),this.#x.ue(t,o.q??null,o._),this.#U.set(t,s??{list:null,W:null,de:null}),!0)}xe(t){return this.#N.get(t)}constructor(t){this.#x=t,this.#a=t.Se()}get state(){if(!this.#C)throw new Error("State not initialized");return this.#C}Zt(t){this.#B++,this.queue.push(t),this.ve(this.#x,t.info.pattern,this.#P,this.#B),this.#T||(this.#T=!0,queueMicrotask((()=>{this.Te()})))}async update(t,e){try{this.#v=!0,await lt(this.#x,this,this.#x.state,t,(async(t,n)=>{this.#C=t,await e(t,n)}))}finally{this.#v=!1}}we(t){const e=(n=this.#x,new ct(n,this));var n;const s=function(t,e){return new Proxy(t,e)}(this.#x.state,e);return t(s,e)}Te(){try{for(;this.queue.length>0;){const n=this.queue;this.queue=[],this.#x||s({code:"UPD-001",message:"Engine not initialized",t:"./docs/error-codes.md#upd"}),t=n,e=this.#x,new at(e,this).pe(t)}}finally{this.#T=!1}var t,e}Ce(t,e,n,o,i,r){if(r.has(e))return;r.add(e),o.set(e,i);for(const[e,s]of n.Tt.entries()){const e=s.vt;this.Ce(t,e,s,o,i,r)}const c=t.At.be.get(e)??[];for(const e of c){const n=W(t.At.fe,e);null===n&&s({code:"UPD-004",message:`Path node not found for pattern: ${e}`,t:"./docs/error-codes.md#upd"}),this.Ce(t,e,n,o,i,r)}}ve(t,e,n,o){const i=W(t.At.fe,e);null===i&&s({code:"UPD-003",message:`Path node not found for pattern: ${e}`,t:"./docs/error-codes.md#upd"}),this.Ce(t,e,i,n,o,new Set)}}function ut(t,e){return e(new ht(t))}class ft extends N{#r;constructor(t,e,n,s,o){super(t,e,n,s,o),this.#r=this.name.slice(2);e.addEventListener(this.u,(t=>this.Be(t)))}get u(){return this.#r}update(){}async Be(t){const e=this.binding.Mt,n=this.binding.Pe.Ue,o=n?.$e().map((t=>t.Pt.index))??[],i=this.m;i.includes("preventDefault")&&t.preventDefault(),i.includes("stopPropagation")&&t.stopPropagation(),await ut(e,(async e=>{await e.update(n,(async(e,n)=>{const i=this.binding.B.Le(e,n);"function"!=typeof i&&s({code:"BIND-201",message:`${this.name} is not a function`,context:{h:"BindingNodeEvent.handler",name:this.name,k:typeof i},t:"/docs/error-codes.md#bind",o:"error"}),await Reflect.apply(i,e,[t,...o])}))}))}v(t){}}const mt=(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new ft(s,o,t,r,n)};class pt extends N{#h;get id(){return this.#h}get D(){return!0}constructor(t,e,n,o,i){super(t,e,n,o,i);const r=this.node.textContent?.slice(3)??s({code:"BIND-201",message:"Invalid node",context:{h:"BindingNodeBlock.id",textContent:this.node.textContent??null},t:"/docs/error-codes.md#bind",o:"error"});this.#h=Number(r)}}class gt extends pt{#$;#L;#M=[];#i;get p(){return this.#i}constructor(t,e,n,s,o){super(t,e,n,s,o);const i=Y(F(""),null);this.#$=ge(this.binding,this.id,this.binding.Mt,i),this.#L=this.#i=[this.#$]}N(t){s({code:"BIND-201",message:"Not implemented",context:{h:"BindingNodeIf.assignValue",name:this.name},t:"/docs/error-codes.md#bind",o:"error"})}v(t){if(t.T.has(this.binding))return;const e=this.binding.B.C(t.U,t.P);"boolean"!=typeof e&&s({code:"BIND-201",message:"Value is not boolean",context:{h:"BindingNodeIf.update",valueType:typeof e},t:"/docs/error-codes.md#bind",o:"error"});const n=this.node.parentNode;null==n&&s({code:"BIND-201",message:"ParentNode is null",context:{h:"BindingNodeIf.update",nodeType:this.node.nodeType},t:"/docs/error-codes.md#bind",o:"error"}),e?(this.#$.Me(n,this.node),this.#$.v(t),this.#i=this.#L):(this.#$.unmount(),this.#i=this.#M),t.T.add(this.binding)}}const wt=new Set;class xt extends pt{#i=[];#E=new WeakMap;#D=[];#k=0;#A=void 0;get p(){return this.#i}get M(){return!0}init(){}Ee(t){let e;if(this.#k>=0)e=this.#D[this.#k],this.#k--,e.De(t);else{const n=Y(this.ke,t);e=ge(this.binding,this.id,this.binding.Mt,n)}return this.#E.set(t,e),e}Ae(t){t.unmount(),t.ee?.Fe()}get Ve(){return this.#k}set Ve(t){this.#k=t}get Re(){return this.#D.length}set Re(t){t<0&&s({code:"BIND-202",message:"Length is negative",context:{h:"BindingNodeFor.setPoolLength",length:t},t:"./docs/error-codes.md#bind"}),this.#D.length=t}get ke(){if(void 0===this.#A){const t=this.binding.B.pattern+".*";this.#A=F(t)}return this.#A}N(t){s({code:"BIND-301",message:"Not implemented. Use update or applyChange",context:{h:"BindingNodeFor.assignValue"},t:"./docs/error-codes.md#bind"})}v(t){if(t.T.has(this.binding))return;let e=[];const n=new Set,o=t._t(this.binding.B.oe);null===o&&s({code:"BIND-201",message:"ListDiff is null",context:{h:"BindingNodeFor.applyChange"},t:"./docs/error-codes.md#bind"});const i=this.node.parentNode??s({code:"BIND-201",message:"ParentNode is null",context:{h:"BindingNodeFor.applyChange"},t:"./docs/error-codes.md#bind"}),r=o.O?.length===o.K?.size&&(o.O?.length??0)>0;let c=!1;if(r){const t=Array.from(i.childNodes),e=this.#i.at(-1)??s({code:"BIND-201",message:"Last content is null",context:{h:"BindingNodeFor.applyChange"},t:"/docs/error-codes.md#bind"});let n=t[0];for(;n&&n.nodeType===Node.TEXT_NODE&&""===n.textContent?.trim();)n=n.nextSibling;let o=t.at(-1)??null;for(;o&&o.nodeType===Node.TEXT_NODE&&""===o.textContent?.trim();)o=o.previousSibling;n===this.node&&o===e.We(i)&&(c=!0)}if(r&&c){i.textContent="",i.append(this.node);for(let t=0;t<this.#i.length;t++){const e=this.#i[t];e.ee?.Fe()}this.#D.push(...this.#i)}else{if(o.K)for(const t of o.K){const e=this.#E.get(t);void 0===e&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",He:"removes"},t:"./docs/error-codes.md#bind"}),this.Ae(e),n.add(e)}this.#D.push(...n)}let d=null;const l=this.node;this.Ve=this.Re-1;if(0===(o.Z?.size??0)&&0===(o.K?.size??0)&&((o.J?.size??0)>0||(o.he?.size??0)>0)){if((o.J?.size??0)>0){const t=Array.from(this.#i),n=Array.from(o.J??[]);n.sort(((t,e)=>t.index-e.index));for(const e of n){const n=this.#E.get(e);void 0===n&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",He:"reorder"},t:"/docs/error-codes.md#bind"}),t[e.index]=n;const o=t[e.index-1]?.We(i)??l;n.Me(i,o)}e=t}if((o.he?.size??0)>0)for(const e of o.he??[]){const n=this.#E.get(e);void 0===n&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",He:"overwrites"},t:"./docs/error-codes.md#bind"}),n.v(t)}}else{const n=i,r=l,c=o.Z??wt;for(const i of o._){const o=d?.We(n)??r;let l;c.has(i)?(l=this.Ee(i),l.Me(n,o),l.v(t)):(l=this.#E.get(i),void 0===l&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",He:"reuse"},t:"./docs/error-codes.md#bind"}),o?.nextSibling!==l.Oe&&l.Me(n,o)),e.push(l),d=l}}this.Re=this.Ve+1,this.#i=e}}const yt=(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new xt(s,o,t,r,n)},bt="textContent",Nt={radio:"checked",checkbox:"checked",button:"onclick"},It={},St={HTMLElement:t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLOptionElement?"value":t instanceof HTMLButtonElement||t instanceof HTMLAnchorElement?"onclick":t instanceof HTMLFormElement?"onsubmit":t instanceof HTMLInputElement?Nt[t.type]??"value":bt,SVGElement:void 0,Text:t=>bt,ze:void 0};const vt={value:"input",checked:"change",selected:"change"};class Tt extends N{get value(){return this.node[this.name]}get L(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}constructor(t,e,n,o,i){super(t,e,n,o,i);if(!(this.node instanceof HTMLElement))return;if(!((r=this.node)instanceof HTMLInputElement||r instanceof HTMLTextAreaElement||r instanceof HTMLSelectElement))return;var r;const c=function(t,e){const n=t.constructor.name+"\t"+(t.type??"");return It[n]??(It[n]=St[e]?.(t))}(this.node,"HTMLElement");if(c!==this.name)return;i.length>1&&s({code:"BIND-201",message:"Has multiple decorators",context:{h:"BindingNodeProperty.constructor",name:this.name,qe:i.length},t:"/docs/error-codes.md#bind",o:"error"});const d=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??vt[this.name]??"readonly";if("readonly"===d||"ro"===d)return;const l=this.binding.Mt;this.node.addEventListener(d,(async()=>{const e=this.binding.Pe.Ue,n=this.L;await ut(l,(async s=>{await s.update(e,(async(e,s)=>{t.je(e,s,n)}))}))}))}init(){}N(t){(null==t||Number.isNaN(t))&&(t=""),this.node[this.name]=t}}const Ct=(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new Tt(s,o,t,r,n)};class Bt extends N{N(t){(null==t||Number.isNaN(t))&&(t="");const e=this.node;e.checked=t.toString()===e.value.toString()}}class Ut extends N{#r;get u(){return this.#r}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,i]=this.name.split(".");this.#r=i}N(t){(null==t||Number.isNaN(t))&&(t="");this.node.style.setProperty(this.u,t.toString())}}const Pt="component-state-input",$t=Symbol.for(`${Pt}.AssignState`),Lt=Symbol.for(`${Pt}.NotifyRedraw`),Mt=new WeakMap;class Et extends N{#r;get u(){return this.#r}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,i]=this.name.split(".");this.#r=i}init(){const t=this.binding.Mt;var e,n;e=t.te,n=this.node,Mt.set(n,e);let s=t._e.get(this.node);void 0===s&&t._e.set(this.node,s=new Set),s.add(this.binding)}N(t){}S(t){const e=[],n=this.binding.B.info,s=this.binding.B.Pt?.at(n.It-1)??null,o=(s?.length??0)-1;for(const i of t)if(n.X.length>i.info.X.length){if(n.et.has(i.info.pattern)){const t=(i.Pt?.length??0)-1;if(t>=0){if(null===s)continue;if(i.Pt!==s?.at(t))continue}const o=Y(n,s);e.push(o)}}else if(!i.info.et.has(n.pattern)){if(o>=0&&i.Pt?.at(o)!==s)continue;e.push(i)}if(0===e.length)return;this.node.state[Lt](e)}}const Dt={0:{class:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new v(s,o,t,r,n)},checkbox:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new S(s,o,t,r,n)},radio:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new Bt(s,o,t,r,n)}},1:{if:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new gt(s,o,t,r,n)}}},kt={class:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new T(s,o,t,r,n)},attr:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new I(s,o,t,r,n)},style:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new Ut(s,o,t,r,n)},state:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new Et(s,o,t,r,n)}};const At={};function Ft(t,e,n,o){const i=t instanceof Comment,r=t instanceof Element,c=i+"\t"+r+"\t"+e,d=At[c]??(At[c]=function(t,e,n){const o=Dt[t?1:0][n];if(void 0!==o)return o;if(t&&"for"===n)return yt;t&&s(`getBindingNodeCreator: unknown node property ${n}`);const i=n.split("."),r=kt[i[0]];return void 0!==r?r:e&&n.startsWith("on")?mt:Ct}(i,r,e));return d(e,n,o)}class Vt{#t;#F;#V;#s;#R=null;#W=null;#H=null;get pattern(){return this.#F}get info(){return this.#V}get Pt(){return this.oe.Pt}get oe(){return null!==this.#R?(null===this.#H&&(this.#H=Y(this.#V,this.#R.Pt)),this.#H):this.#W??s({code:"BIND-201",message:"ref is null",context:{pattern:this.#F},t:"/docs/error-codes.md#bind",o:"error"})}get filters(){return this.#s}get binding(){return this.#t}constructor(t,e,n){this.#t=t,this.#F=e,this.#V=F(e),this.#W=0===this.#V.It?Y(this.#V,null):null,this.#s=n}Le(t,e){return st(this.binding.Mt.state,this.oe,t,e)}C(t,e){let n=st(this.binding.Mt.state,this.oe,t,e);for(let t=0;t<this.#s.length;t++)n=this.#s[t](n);return n}init(){if(this.info.It>0){const t=this.info.xt??s({code:"BIND-201",message:"Wildcard last parentPath is null",context:{h:"BindingState.init",pattern:this.#F},t:"/docs/error-codes.md#bind",o:"error"});this.#R=this.binding.Pe.Ue?.find(t)??s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindingState.init",xt:t},t:"/docs/error-codes.md#bind",o:"error"}),this.#H=null}this.binding.Mt.Ge(this.oe,this.binding)}N(t,e,n){ot(this.binding.Mt.state,this.oe,n,t,e)}}class Rt{#t;#O;#s;#R=null;get pattern(){return s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.pattern"},t:"/docs/error-codes.md#bind"})}get info(){return s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.info"},t:"/docs/error-codes.md#bind"})}get Pt(){return this.#R?.Pt??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.listIndex"},t:"/docs/error-codes.md#list"})}get oe(){return this.#R?.oe??s({code:"STATE-202",message:"ref is null",context:{h:"BindingStateIndex.ref"},t:"/docs/error-codes.md#state"})}get filters(){return this.#s}get binding(){return this.#t}constructor(t,e,n){this.#t=t;const o=Number(e.slice(1));isNaN(o)&&s({code:"BIND-202",message:"Pattern is not a number",context:{h:"BindingStateIndex.constructor",pattern:e},t:"/docs/error-codes.md#bind"}),this.#O=o,this.#s=n}Le(t,e){return this.Pt?.index??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.getValue"},t:"/docs/error-codes.md#list"})}C(t,e){let n=this.Pt?.index??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.getFilteredValue"},t:"/docs/error-codes.md#list"});for(let t=0;t<this.#s.length;t++)n=this.#s[t](n);return n}init(){const t=(this.binding.Pe.Ue??s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindingStateIndex.init"},t:"/docs/error-codes.md#bind"})).$e();this.#R=t[this.#O-1]??s({code:"BIND-201",message:"Current loopContext is null",context:{h:"BindingStateIndex.init",Ke:this.#O},t:"/docs/error-codes.md#bind"});const e=this.binding.Mt.Ze.get(this.Pt);void 0===e?this.binding.Mt.Ze.set(this.Pt,new Set([this.binding])):e.add(this.binding)}N(t,e,n){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.assignValue"},t:"/docs/error-codes.md#bind"})}}const Wt=new RegExp(/^\$\d+$/);function Ht(t,e){return Wt.test(t)?((t,e)=>(n,s)=>{const o=b(s,e);return new Rt(n,t,o)})(t,e):((t,e)=>(n,s)=>{const o=b(s,e);return new Vt(n,t,o)})(t,e)}const Ot={};function zt(t,e=(t=>t.constructor.name+"\t"+(t instanceof Comment?t.textContent?.[2]??"":""))(t)){return Ot[e]??(Ot[e]=(t=>t instanceof Comment&&":"===t.textContent?.[2]?"Text":t instanceof HTMLElement?"HTMLElement":t instanceof Comment&&"|"===t.textContent?.[2]?"Template":t instanceof SVGElement?"SVGElement":s(`Unknown NodeType: ${t.nodeType}`))(t))}const qt=t=>t.trim(),jt=t=>t.length>0,_t=new RegExp(/^#(.*)#$/),Gt=t=>{const e=_t.exec(t);return e?decodeURIComponent(e[1]):t},Kt=t=>{const[e,...n]=t.split(",").map(qt);return{name:e,options:n.map(Gt)}},Zt=t=>{const[e,...n]=t.split("|").map(qt);return{Je:e,filters:n.map(Kt)}},Jt=t=>t.split(";").map(qt).filter(jt).map((t=>(t=>{const[e,n=null]=t.split("@").map(qt),s=n?n.split(",").map(qt):[],[o,i]=e.split(":").map(qt),{Je:r,filters:c}=Zt(o),{Je:d,filters:l}=Zt(i);return{Qe:r,Xe:d,Ye:c,tn:l,m:s}})(t))),Qt={};const Xt=t=>{t.removeAttribute("data-bind")},Yt={HTMLElement:Xt,SVGElement:Xt,Text:void 0,ze:void 0};const te={Text:t=>{const e=document.createTextNode("");return t.parentNode?.replaceChild(e,t),e},HTMLElement:void 0,ze:void 0,SVGElement:void 0};class ee{nodeType;en;nn;sn=new Map;constructor(t){this.nodeType=zt(t);const e=function(t,e){switch(t){case"Text":return"textContent:"+(e.textContent?.slice(3).trim()??"");case"HTMLElement":case"SVGElement":return e.getAttribute(L)??"";case"Template":{const t=e.textContent?.slice(3).trim();return(le(Number(t))??s(`Template not found: ${t}`)).getAttribute(L)??""}default:return""}}(this.nodeType,t);(function(t,e){Yt[e]?.(t)})(t=function(t,e){return te[e]?.(t)??t}(t,this.nodeType),this.nodeType),this.en=function(t){let e=[];for(;null!==t.parentNode;)e=[Array.from(t.parentNode.childNodes).indexOf(t),...e],t=t.parentNode;return e}(t),this.nn=function(t){return""===t.trim()?[]:Qt[t]??(Qt[t]=Jt(t))}(e);for(let e=0;e<this.nn.length;e++){const n=this.nn[e],s={rn:Ft(t,n.Qe,n.Ye,n.m),cn:Ht(n.Xe,n.tn)};this.sn.set(n,s)}}}function ne(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode:t=>t instanceof Element?t.hasAttribute(L)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:function(t){return t instanceof Comment&&(0===t.textContent?.indexOf(M)||0===t.textContent?.indexOf(E))}(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;n.nextNode();)e.push(n.currentNode);return e}const se={},oe={},ie={};function re(t){return ne(t).map((t=>function(t){return new ee(t)}(t)))}const ce={};function de(t,e,n){var s;return s=e.content,Array.from(s.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE||(t.nodeValue??"").trim()||s.removeChild(t)})),function(t,e,n=t){const s=re(e),o=ie[n]??(ie[n]=new Set),i=oe[n]??(oe[n]=new Set);for(let t=0;t<s.length;t++){const e=s[t];for(let t=0;t<e.nn.length;t++){const n=e.nn[t];o.add(n.Xe),"for"===n.Qe&&i.add(n.Xe)}}se[t]=s}(t,e.content,n),ce[t]=e,t}function le(t){return ce[t]??s({code:"TMP-001",message:`Template not found: ${t}`,context:{h:"registerTemplate.getTemplateById",dn:t},t:"./docs/error-codes.md#tmp"})}class ae{Pe;node;Mt;ln;B;version;constructor(t,e,n,s,o){this.Pe=t,this.node=e,this.Mt=n,this.ln=s(this,e,n.an),this.B=o(this,n.hn)}get p(){return this.ln.p}init(){this.ln.init(),this.B.init()}je(t,e,n){return this.B.N(t,e,n)}S(t){this.ln.S(t)}v(t){t.T.has(this)||this.ln.v(t)}}function he(t,e,n,s,o){return new ae(t,e,n,s,o)}class ue{#H;#V;#$;constructor(t,e){this.#H=t,this.#V=t.info,this.#$=e}get oe(){return this.#H??s({code:"STATE-202",message:"ref is null",context:{h:"LoopContext.ref",path:this.#V.pattern},t:"/docs/error-codes.md#state"})}get path(){return this.oe.info.pattern}get info(){return this.oe.info}get Pt(){return this.oe.Pt??s({code:"LIST-201",message:"listIndex is required",context:{h:"LoopContext.listIndex",path:this.#V.pattern},t:"/docs/error-codes.md#list"})}De(t){this.#H=Y(this.#V,t)}Fe(){this.#H=null}get un(){return this.#$}#z;get fn(){if(void 0===this.#z){let t=this.un;for(;null!==t;){if(null!==t.ee&&t.ee!==this){this.#z=t.ee;break}t=t.mn?.Pe??null}void 0===this.#z&&(this.#z=null)}return this.#z}#q={};find(t){let e=this.#q[t];if(void 0===e){let n=this;for(;null!==n&&n.path!==t;)n=n.fn;e=this.#q[t]=n}return e}pn(t){let e=this;for(;null!==e;)t(e),e=e.fn}$e(){const t=[];return this.pn((e=>{t.unshift(e)})),t}}function fe(t){const e=le(t)??s({code:"BIND-101",message:`Template not found: ${t}`,context:{h:"BindContent.createContent",dn:t},t:"./docs/error-codes.md#bind"}),n=document.importNode(e.content,!0);if(Object.keys(Re).length>0){const t=n.querySelectorAll(":not(:defined)");for(let e=0;e<t.length;e++){He(t[e].tagName.toLowerCase())}}return n}function me(t,e,n,o){const i=(t=>se[t])(e)??s({code:"BIND-101",message:"Data-bind is not set",context:{h:"BindContent.createBindings",dn:e},t:"./docs/error-codes.md#bind"}),r=[],c=[];for(let d=0;d<i.length;d++){const l=i[d],a=w(o,l.en)??s({code:"BIND-102",message:`Node not found: ${l.en}`,context:{h:"BindContent.createBindings",dn:e,en:l.en},t:"./docs/error-codes.md#bind"});for(let o=0;o<l.nn.length;o++){const i=l.nn[o],d=l.sn.get(i)??s({code:"BIND-103",message:`Creator not found: ${i}`,context:{h:"BindContent.createBindings",dn:e,gn:i},t:"./docs/error-codes.md#bind"}),h=he(t,a,n,d.rn,d.cn);h.ln.D&&c.push(h),r.push(h)}}return[r,c]}class pe{ee;mn;childNodes;fragment;Mt;wn=[];xn=[];#h;get id(){return this.#h}get yn(){return this.childNodes.length>0&&this.childNodes[0].parentNode!==this.fragment}get Oe(){return this.childNodes[0]??null}get bn(){return this.childNodes[this.childNodes.length-1]??null}get Nn(){return this.xn.length>0}We(t){const e=this.wn[this.wn.length-1],n=this.bn;if(void 0!==e&&e.node===n&&e.p.length>0){const n=(e.p.at(-1)??s({code:"BIND-104",message:"Child bindContent not found",context:{h:"BindContent.getLastNode",dn:this.#h},t:"./docs/error-codes.md#bind"})).We(t);if(null!==n)return n}return t!==n?.parentNode?null:n}#j;get Ue(){if(void 0===this.#j){let t=this;for(;null!==t&&null===t.ee;)t=t.mn?.Pe??null;this.#j=t?.ee??null}return this.#j}constructor(t,e,n,s){this.mn=t,this.#h=e,this.fragment=fe(e),this.childNodes=Array.from(this.fragment.childNodes),this.Mt=n,this.ee=null!==s.Pt?new ue(s,this):null;const[o,i]=me(this,e,n,this.fragment);this.wn=o,this.xn=i}mount(t){for(let e=0;e<this.childNodes.length;e++)t.appendChild(this.childNodes[e])}In(t,e){for(let n=0;n<this.childNodes.length;n++)t.insertBefore(this.childNodes[n],e)}Me(t,e){const n=e?.nextSibling??null;for(let e=0;e<this.childNodes.length;e++)t.insertBefore(this.childNodes[e],n)}unmount(){const t=this.childNodes[0]?.parentNode??null;if(null!==t)for(let e=0;e<this.childNodes.length;e++)t.removeChild(this.childNodes[e])}init(){for(let t=0;t<this.wn.length;t++)this.wn[t].init()}De(t){null==this.ee&&s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindContent.assignListIndex",dn:this.#h},t:"./docs/error-codes.md#bind"}),this.ee.De(t),this.init()}v(t){for(let e=0;e<this.wn.length;e++){const n=this.wn[e];t.T.has(n)||n.v(t)}}}function ge(t,e,n,s){const o=new pe(t,e,n,s);return o.init(),o}function we(t,e,n){if(e.enableShadowDom)if(null===e.Sn||function(t){try{const e=document.createElement(t);return"function"==typeof e.attachShadow&&(e.attachShadow({mode:"open"}),!0)}catch{return!1}}(e.Sn)){if(!t.shadowRoot){t.attachShadow({mode:"open"}).adoptedStyleSheets=[n]}}else s(`ComponentEngine: Shadow DOM not supported for builtin components that extend ${e.Sn}`);else{const e=function(t){let e=t;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}}(t.parentNode)||document,s=e.adoptedStyleSheets;s.includes(n)||(e.adoptedStyleSheets=[...s,n])}}class xe{vn=new Set;Tn=new Set;Cn=new Map;Bn=new Map;Un=new Map;Pn=new Map;wn=new WeakSet;$n(t){if(this.wn.has(t))return;const e=t.B.pattern,n=t.ln.u;this.Cn.has(e)&&s({code:"STATE-303",message:`Parent path "${e}" already has a child path`,context:{bt:e,Ln:this.Cn.get(e)},t:"./docs/error-codes.md#state"}),this.Bn.has(n)&&s({code:"STATE-303",message:`Child path "${n}" already has a parent path`,context:{Mn:n,En:this.Bn.get(n)},t:"./docs/error-codes.md#state"}),this.Cn.set(e,n),this.Bn.set(n,e),this.vn.add(e),this.Tn.add(n),this.Un.set(e,t),this.Pn.set(n,t),this.wn.add(t)}Dn(t){return this.Cn.get(t)}kn(t){return this.Bn.get(t)}An(t){const e=F(t).et.intersection(this.Tn);0===e.size&&s({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{Mn:t},t:"./docs/error-codes.md#state"});const n=Array.from(e),o=n[n.length-1],i=t.slice(o.length),r=this.Bn.get(o);return void 0===r&&s({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{Mn:t,Fn:o},t:"./docs/error-codes.md#state"}),r+i}Vn(t){const e=F(t).et.intersection(this.vn);0===e.size&&s({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{bt:t},t:"./docs/error-codes.md#state"});const n=Array.from(e),o=n[n.length-1],i=t.slice(o.length),r=this.Cn.get(o);return void 0===r&&s({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{bt:t,Fn:o},t:"./docs/error-codes.md#state"}),r+i}Rn(t){if(0===this.Tn.size)return null;const e=t.et.intersection(this.Tn);if(0===e.size)return null;{const t=Array.from(e);return t[t.length-1]}}bind(t,e){const n=t.Wn(e);for(const t of n??[])this.$n(t)}}class ye{Hn;Mt;constructor(t,e){this.Hn=e,this.Mt=t}On(t){ut(this.Mt,(e=>{e.update(null,((e,n)=>{for(const[n,s]of Object.entries(t)){const t=Y(F(n),null);e[q](t,s)}}))}))}S(t){for(const e of t)try{const t=F(this.Hn.Vn(e.info.pattern)),n=Y(t,e.Pt),s=this.Mt.getPropertyValue(n);ut(this.Mt,(t=>{t.update(null,((t,e)=>{t[q](n,s)}))}))}catch(t){}}get(t,e,n){if(e===$t)return this.On.bind(this);if(e===Lt)return this.S.bind(this);if("string"==typeof e){const t=Y(F(e),null);return this.Mt.getPropertyValue(t)}s(`Property "${String(e)}" is not supported in ComponentStateInput.`)}set(t,e,n,o){if("string"==typeof e){const t=Y(F(e),null);return this.Mt.zn(t,n),!0}s(`Property "${String(e)}" is not supported in ComponentStateInput.`)}}class be{binding;constructor(t){this.binding=t}get(t){const e=this.binding.Rn(t.info);null===e&&s(`No child path found for path "${t.info.toString()}".`);const n=this.binding.Pn.get(e);void 0===n&&s(`No binding found for child path "${e}".`);const o=Y(F(this.binding.An(t.info.pattern)),t.Pt??n.B.Pt);return n.Mt.getPropertyValue(o)}set(t,e){const n=this.binding.Rn(t.info);null===n&&s(`No child path found for path "${t.info.toString()}".`);const o=this.binding.Pn.get(n);void 0===o&&s(`No binding found for child path "${n}".`);const i=F(this.binding.An(t.info.pattern)),r=o.Mt,c=Y(i,t.Pt??o.B.Pt);return ut(r,(t=>{t.update(null,((t,n)=>{t[q](c,e)}))})),!0}startsWith(t){return null!==this.binding.Rn(t)}Lt(t){const e=this.binding.Rn(t.info);null===e&&s(`No child path found for path "${t.info.toString()}".`);const n=this.binding.Pn.get(e);void 0===n&&s(`No binding found for child path "${e}".`);const o=Y(F(this.binding.An(t.info.pattern)),t.Pt);return n.Mt.Lt(o)}}const Ne={list:null,W:null,de:null};class Ie{type="autonomous";config;qn;styleSheet;jn;state;an;hn;#$=null;get un(){return null===this.#$&&s({code:"BIND-201",message:"bindContent not initialized yet",context:{h:"ComponentEngine.bindContent.get",_n:this.te.constructor.id},t:"./docs/error-codes.md#bind"}),this.#$}Gn=HTMLElement;te;Ze=new WeakMap;_e=new WeakMap;Kn=new Set;#_=Promise.withResolvers();#G=null;#K=function(){return new xe}();Zn;zt;#Z=null;#J=null;#Q=!1;#X=0;get Jn(){return this.#X}Se(){return++this.#X}cache=new WeakMap;constructor(t,e){this.config=t,this.config.Sn&&(this.type="builtin");const n=e.constructor;var s;this.qn=n.qn,this.styleSheet=n.styleSheet,this.jn=n.jn,this.state=new this.jn,this.an=n.an,this.hn=n.hn,this.te=e,this.Zn=function(t,e){const n=new ye(t,e);return new Proxy({},n)}(this,this.#K),this.zt=(s=this.#K,new be(s))}get At(){return this.te.constructor.At}Qn(){for(const t in this.state)D.has(t)||this.At.Xn.has(t)||(this.At.Xn.add(t),H(this.At.fe,t));const t=this.te.constructor,e=Y(F(""),null);this.#$=ge(null,t.id,this,e)}get Yn(){return this.#_}async connectedCallback(){if(await(this.#G?.promise),await(this.te.ts?.Yn.promise),this.te.dataset.state)try{const t=JSON.parse(this.te.dataset.state);this.Zn[$t](t)}catch(t){s({code:"STATE-202",message:"Failed to parse state from dataset",context:{h:"ComponentEngine.connectedCallback",es:this.te.dataset.state},t:"./docs/error-codes.md#state",i:t})}const t=this.te.ts;if(t&&(t.ns(this.te),this.#K.bind(t,this.te)),this.config.ss)we(this.te,this.config,this.styleSheet);else{this.#J=this.te.parentNode,this.#Z=document.createComment("Structive block placeholder");try{this.#Q=!0,this.te.replaceWith(this.#Z)}finally{this.#Q=!1}}if(this.config.ss)this.un.mount(this.te.shadowRoot??this.te);else{const t=this.#J??s({code:"BIND-201",message:"Block parent node is not set",context:{h:"ComponentEngine.connectedCallback",mode:"block"},t:"./docs/error-codes.md#bind"});this.un.Me(t,this.#Z)}await ut(this,(async t=>{await t.update(null,(async(e,n)=>{for(const e of this.At.Xn){const n=F(e);if(1!==n.X.length)continue;if(this.At.rs.has(e))continue;const s=Y(n,null);t.Zt(s)}await e[j]()}))})),queueMicrotask((()=>{this.#_.resolve()}))}async disconnectedCallback(){this.#G=Promise.withResolvers();try{if(this.#Q)return;await ut(this,(async t=>{await t.update(null,(async(t,e)=>{await t[_]()}))})),this.te.ts?.cs(this.te),this.config.ss||(this.#Z?.remove(),this.#Z=null,this.#J=null)}finally{this.#G.resolve()}}#Y={};#tt=new WeakMap;#et=new WeakMap;#nt=new WeakMap;#st=new WeakMap;#ot=new WeakMap;#it=new WeakMap;Ge(t,e){const n=this.#ot.get(t);void 0===n?this.#ot.set(t,[e]):n.push(e)}ue(t,e,n){if(this.At.jt.has(t.info.pattern)){const s={list:e,W:n,de:e?Array.from(e):null};this.#et.set(t,s)}}ye(t){const e=this.#ot.get(t);return void 0!==e?e:[]}Lt(t){return this.zt.startsWith(t.info)?this.zt.Lt(t):this.#et.get(t)?.W??null}ae(t){const e=this.#et.get(t);return void 0===e?Ne:e}getPropertyValue(t){let e;return ut(this,(n=>{e=n.we(((e,n)=>e[z](t)))})),e}zn(t,e){ut(this,(n=>{n.update(null,((n,s)=>{n[q](t,e)}))}))}ns(t){this.Kn.add(t)}cs(t){this.Kn.delete(t)}}const Se=/\{\{([^\}]+)\}\}/g,ve=new Set(["if","for","endif","endfor","elseif","else"]);const Te="http://www.w3.org/2000/svg";function Ce(t,e,n=t){if(e.parentNode?.replaceChild(document.createComment(`${E}${t}`),e),e.namespaceURI===Te){const t=document.createElement("template"),n=Array.from(e.childNodes);for(let e=0;e<n.length;e++){const s=n[e];t.content.appendChild(s)}const s=e.getAttribute(L);t.setAttribute(L,s??""),e=t}return e.content.querySelectorAll("template").forEach((t=>{Ce(f(),t,n)})),de(t,e,n),t}function Be(t,e){const n=document.createElement("template");n.dataset.id=t.toString(),n.innerHTML=function(t){const e=[];return t.replaceAll(Se,((t,n)=>{n=n.trim();const[o]=n.split(":");if(!ve.has(o))return`\x3c!--${M}${n}--\x3e`;const i=n.slice(o.length+1).trim(),r={type:o,ds:n,ls:i};if("if"===o||"for"===o)return e.push(r),`<template data-bind="${n}">`;if("endif"===o){const t=[];for(;;){const o=e.pop()??s({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",ds:n,hs:e.length},t:"./docs/error-codes.md#tmp"});if("if"===o.type){t.push("</template>");break}"elseif"===o.type?t.push("</template>"):s({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",us:o.type,ds:n},t:"./docs/error-codes.md#tmp"})}return t.join("")}if("endfor"===o){const t=e.pop()??s({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",ds:n,hs:e.length},t:"./docs/error-codes.md#tmp"});if("for"===t.type)return"</template>";s({code:"TMP-102",message:"Endfor without for",context:{h:"replaceMustacheWithTemplateTag",us:t.type,ds:n},t:"./docs/error-codes.md#tmp"})}else if("elseif"===o){const t=e.at(-1)??s({code:"TMP-102",message:"Elseif without if",context:{h:"replaceMustacheWithTemplateTag",ds:n,hs:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type||"elseif"===t.type)return e.push(r),`</template><template data-bind="if:${t.ls}|not"><template data-bind="if:${i}">`;s({code:"TMP-102",message:"Elseif without if",context:{h:"replaceMustacheWithTemplateTag",us:t.type,ds:n},t:"./docs/error-codes.md#tmp"})}else if("else"===o){const t=e.at(-1)??s({code:"TMP-102",message:"Else without if",context:{h:"replaceMustacheWithTemplateTag",ds:n,hs:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type)return`</template><template data-bind="if:${t.ls}|not">`;s({code:"TMP-102",message:"Else without if",context:{h:"replaceMustacheWithTemplateTag",us:t.type,ds:n},t:"./docs/error-codes.md#tmp"})}else s({code:"TMP-102",message:"Unknown type",context:{h:"replaceMustacheWithTemplateTag",type:o,ds:n},t:"./docs/error-codes.md#tmp"})}))}(e),Ce(t,n)}const Ue=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/,Pe=/^[a-zA-Z_$][0-9a-zA-Z_$]*(\.[a-zA-Z_$][0-9a-zA-Z_$]*|\.\*)*$/;function $e(t,e){const n=new Set(t.tt).intersection(e);let o=-1,i="";for(const t of n){const e=t.split(".");1!==e.length&&(e.length>o&&(o=e.length,i=t))}if(i.length>0){Pe.test(i)||s({code:"STATE-202",message:`Invalid path: ${i}`,context:{fs:i},t:"./docs/error-codes.md#state"});const e=F(i),n=[];let o=e.It;for(let r=e.X.length;r<t.X.length;r++){const e=t.X[r];"*"===e?(n.push("[this.$"+(o+1)+"]"),o++):(Ue.test(e)||s({code:"STATE-202",message:`Invalid segment name: ${e}`,context:{ps:e,fs:i},t:"./docs/error-codes.md#state"}),n.push("."+e))}const r=n.join("");return{get:new Function("",`return this["${i}"]${r};`),set:new Function("value",`this["${i}"]${r} = value;`)}}{const e=[];let n=0;for(let o=0;o<t.X.length;o++){const i=t.X[o];"*"===i?(e.push("[this.$"+(n+1)+"]"),n++):(Ue.test(i)||s({code:"STATE-202",message:`Invalid segment name: ${i}`,context:{ps:i},t:"./docs/error-codes.md#state"}),e.push((e.length>0?".":"")+i))}const o=e.join("");return{get:new Function("",`return this.${o};`),set:new Function("value",`this.${o} = value;`)}}}class Le{Xn=new Set;jt=new Set;elements=new Set;rs=new Set;kt=new Set;Ht=new Set;Gt=new Set;gs=new Set;ws=new Set;xs=new Map;be=new Map;fe=function(){return new V("","",0)}();#h;#rt;constructor(t){this.#h=t.id,this.#rt=t.jn;const e=(t=>ie[t]??[])(this.#h);for(const t of e){const e=F(t);this.Xn=this.Xn.union(e.et)}const n=(t=>oe[t]??[])(this.#h);this.jt=this.jt.union(n);for(const t of n){const e=t+".*";this.elements.add(e)}let s=this.#rt.prototype;for(;s&&s!==Object.prototype;){const t=Object.getOwnPropertyDescriptors(s);if(t)for(const[e,n]of Object.entries(t)){if(D.has(e))continue;if("function"==typeof n.value){this.rs.add(e);continue}const t=void 0!==n.get,s=void 0!==n.set,o=F(e);this.Xn=this.Xn.union(o.et),t&&this.kt.add(e),s&&this.Gt.add(e),t&&!s&&this.Ht.add(e),t&&s&&this.gs.add(e)}s=Object.getPrototypeOf(s)}for(const t of this.Xn){if(this.kt.has(t))continue;if(this.Gt.has(t))continue;const e=F(t);if(1===e.X.length)continue;const n=$e(e,this.kt);Object.defineProperty(this.#rt.prototype,t,{get:n.get,set:n.set,enumerable:!0,configurable:!0}),this.ws.add(t)}for(const t of this.Xn){H(this.fe,t);const e=F(t);e.bt&&(this.xs.get(e.bt)?.add(t)??this.xs.set(e.bt,new Set([t])))}}#ct=new Set;Ot(t,e){const n=`${e}=>${t}`;this.#ct.has(n)||(this.#ct.add(n),this.be.get(e)?.add(t)??this.be.set(e,new Set([t])))}}function Me(t){const n=function(t){const n=e();return{ss:void 0===t.ss||t.ss,enableShadowDom:t.enableShadowDom??n.enableShadowDom,Sn:t.Sn??null}}(t.jn.ys??{}),o=f(),{bs:i,Ns:r,jn:c}=t,d=Object.assign({},h),l=Object.assign({},a);c.Is=!0,Be(o,i),g(o,r),function(t,e){m[t]=e}(o,c);const u=function(t){return t?document.createElement(t).constructor:HTMLElement}(n.Sn),w=n.Sn;return class extends u{#x;constructor(){super(),this.#x=function(t,e){return new Ie(t,e)}(n,this),this.#x.Qn()}connectedCallback(){this.#x.connectedCallback()}disconnectedCallback(){this.#x.disconnectedCallback()}#dt;get ts(){var t;return void 0===this.#dt&&(this.#dt=(t=this,Mt.get(t)??null)),this.#dt}get state(){return this.#x.Zn}get Ss(){return this.#x.jn.Is??!1}get Yn(){return this.#x.Yn}Wn(t){return this.#x._e.get(t)??null}ns(t){this.#x.ns(t)}cs(t){this.#x.cs(t)}static define(t){w?customElements.define(t,this,{Sn:w}):customElements.define(t,this)}static get id(){return o}static#lt=i;static get bs(){return this.#lt}static set bs(t){this.#lt=t,Be(this.id,t),this.#at=null,this.#ht=null}static#ut=r;static get Ns(){return this.#ut}static set Ns(t){this.#ut=t,g(this.id,t),this.#ft=null}static#at=null;static get qn(){return this.#at||(this.#at=le(this.id)),this.#at}static#ft=null;static get styleSheet(){return this.#ft||(this.#ft=function(t){return p[t]??s({code:"CSS-001",message:`Stylesheet not found: ${t}`,context:{h:"registerStyleSheet.getStyleSheetById",vs:t},t:"./docs/error-codes.md#css"})}(this.id)),this.#ft}static#rt=null;static get jn(){return this.#rt||(this.#rt=function(t){return m[t]??s({code:"STATE-101",message:`StateClass not found: ${t}`,context:{h:"registerStateClass.getStateClassById",Ts:t},t:"./docs/error-codes.md#state"})}(this.id)),this.#rt}static#mt=d;static get an(){return this.#mt}static#pt=l;static get hn(){return this.#pt}static#ht=null;static get At(){return this.#ht||(this.#ht=new Le(this)),this.#ht}}}function Ee(t){return t.replaceAll(/<!--\{\{([^\}]+)\}\}-->/g,((t,e)=>`{{${e}}}`))}async function De(t){const e=import.meta.resolve?import.meta.resolve(t):t,n=await fetch(e);return async function(t){const e=document.createElement("template");e.innerHTML=function(t){return t.replaceAll(/\{\{([^\}]+)\}\}/g,((t,e)=>`\x3c!--{{${e}}}--\x3e`))}(t);const n=e.content.querySelector("template");n?.remove();const s=e.content.querySelector("script[type=module]");let o={};if(s){const t=btoa(String.fromCodePoint(...(new TextEncoder).encode(s.text)));o=await import("data:application/javascript;base64,"+t)}s?.remove();const i=e.content.querySelector("style");i?.remove();const r=o.default??class{};return{text:t,bs:Ee(n?.innerHTML??"").trim(),Ns:i?.textContent??"",jn:r}}(await n.text())}function ke(t,e){e.define(t)}const Ae="@routes/",Fe="@components/",Ve="#lazy",Re={};async function We(){const t=function(){const t={};return document.querySelectorAll("script[type='importmap']").forEach((e=>{const n=JSON.parse(e.innerHTML);n.imports&&(t.imports=Object.assign(t.imports||{},n.imports))})),t}();if(t.imports){const e=new Map;for(const[n,s]of Object.entries(t.imports)){let t,s;if(n.startsWith(Ae)){s=n.endsWith(Ve);const e=n.slice(7,s?-5:void 0);t="routes"+e.replace(/:[^\s/]+/g,"").replace(/\//g,"-"),_e(t,"/root"===e?"/":e)}n.startsWith(Fe)&&(s=n.endsWith(Ve),t=n.slice(12,s?-5:void 0)),t&&(s?Re[t]=n:e.set(t,n))}for(const[t,n]of e.entries()){ke(t,Me(await De(n)))}}}function He(t){const e=Re[t];if(e)delete Re[t],queueMicrotask((async()=>{const n=Me(await De(e));ke(t,n)}));else{const e={code:"IMP-201",message:`Alias not found for tagName: ${t}`,context:{h:"loadFromImportMap.loadLazyLoadComponent",tagName:t},t:"./docs/error-codes.md#imp",o:"warn"};console.warn(e.message,{code:e.code,context:e.context,t:e.t,o:e.o})}}const Oe="routes:",ze=[];let qe=null;class je extends HTMLElement{Cs=window.location.pathname;Bs=window.location.pathname.split("/").pop()||"";Us=document.querySelector("base")?.href.replace(window.location.origin,"")||"/";Ps;constructor(){super(),this.Ps=this.$s.bind(this)}connectedCallback(){qe=this,this.innerHTML='<slot name="content"></slot>',window.addEventListener("popstate",this.Ps),window.dispatchEvent(new Event("popstate"))}disconnectedCallback(){window.removeEventListener("popstate",this.Ps),qe=null}$s(t){t.preventDefault(),this.pe()}navigate(t){const e="/"===t[0]?this.Us+t.slice(1):t;history.pushState({},"",e),this.pe()}pe(){Array.from(this.childNodes).filter((t=>"content"===t.getAttribute?.("slot"))).forEach((t=>this.removeChild(t)));const t=window.location.pathname.split("/");t.at(-1)===this.Bs&&(t[t.length-1]="");const e=t.join("/").replace(this.Us,""),n="/"!==e[0]?"/"+e:e;let s,o={};for(const[t,e]of ze){const i=new RegExp("^"+t.replace(/:[^\s/]+/g,"([^/]+)")+"$");if(i.test(n)){s=e;const r=n.match(i);if(r){(t.match(/:[^\s/]+/g)||[]).forEach(((t,e)=>{o[t.substring(1)]=r[e+1]}))}break}}if(s){const t=document.createElement(s);t.setAttribute("data-state",JSON.stringify(o)),t.setAttribute("slot","content"),this.appendChild(t),function(t){return Re.hasOwnProperty(t)}(s)&&He(s)}else{const t=document.createElement("h1");t.setAttribute("slot","content"),t.textContent="404 Not Found",this.appendChild(t)}}}function _e(t,e){e.startsWith(Oe)&&(e=e.substring(Oe.length)),ze.push([e,t])}const Ge="router",Ke=`<slot name="${Ge}"></slot>`;class Ze extends HTMLElement{constructor(){super(),n.enableShadowDom&&this.attachShadow({mode:"open"})}async connectedCallback(){await this.Ls(),this.pe()}get root(){return this.shadowRoot??this}async Ls(){if(n.layoutPath){const t=await fetch(n.layoutPath);if(t.ok){const e=await t.text(),n=document.createElement("template");n.innerHTML=e;const s=n.content.querySelector("template"),o=n.content.querySelector("style");if(this.root.appendChild(s?.content??document.createDocumentFragment()),o){const t=this.shadowRoot??document,e=t.adoptedStyleSheets;e.includes(o)||(t.adoptedStyleSheets=[...e,o])}}else s({code:"TMP-101",message:`Failed to load layout from ${n.layoutPath}`,context:{layoutPath:n.layoutPath},t:"/docs/error-codes.md#tmp",o:"error"})}else this.root.innerHTML=Ke}pe(){if(n.enableRouter){const t=document.createElement(n.routerTagName);t.setAttribute("slot",Ge),this.root.appendChild(t)}}}const Je=n;let Qe=!1;async function Xe(t){await async function(t){for(const[e,s]of Object.entries(t)){let t=null;if(n.enableRouter){const t=s.startsWith("@routes")?s.slice(7):s;_e(e,"/root"===t?"/":t)}t=await De(s),ke(e,Me(t))}}(t),Je.autoInit&&await Ye()}async function Ye(){Qe||(await async function(){if(n.autoLoadFromImportMap&&await We(),n.enableRouter&&customElements.define(n.routerTagName,je),n.enableMainWrapper&&(customElements.define(n.mainTagName,Ze),n.autoInsertMainWrapper)){const t=document.createElement(n.mainTagName);document.body.appendChild(t)}}(),Qe=!0)}export{Ye as bootstrapStructive,Je as config,Xe as defineComponents};
//# sourceMappingURL=structive.min.js.map
