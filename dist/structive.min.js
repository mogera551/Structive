const t={debug:!1,locale:"en-US",enableShadowDom:!0,enableMainWrapper:!0,enableRouter:!0,autoInsertMainWrapper:!1,autoInit:!0,mainTagName:"app-main",routerTagName:"view-router",layoutPath:"",autoLoadFromImportMap:!1,optimizeList:!0,optimizeListElements:!0,optimizeAccessor:!0};function e(){return t}const n=e();function s(t){if("string"==typeof t)throw new Error(t);const{message:e,code:n,context:s,hint:o,t:r,o:i,i:c}=t,d=new Error(e);throw d.code=n,s&&(d.context=s),o&&(d.hint=o),r&&(d.t=r),i&&(d.o=i),c&&(d.i=c),d}function o(t){s({code:"FLT-202",message:`${t} requires at least one option`,context:{l:t},t:"./docs/error-codes.md#flt"})}function r(t){s({code:"FLT-202",message:`${t} requires a number as option`,context:{l:t},t:"./docs/error-codes.md#flt"})}function i(t){s({code:"FLT-202",message:`${t} requires a number value`,context:{l:t},t:"./docs/error-codes.md#flt"})}function c(t){s({code:"FLT-202",message:`${t} requires a date value`,context:{l:t},t:"./docs/error-codes.md#flt"})}const d=e(),a={eq:t=>{const e=t?.[0]??o("eq");return t=>{if("number"==typeof t){const n=Number(e);return isNaN(n)&&r("eq"),t===n}return t===e}},ne:t=>{const e=t?.[0]??o("ne");return t=>{if("number"==typeof t){const n=Number(e);return isNaN(n)&&r("eq"),t!==n}return t!==e}},not:t=>t=>{var e;return"boolean"!=typeof t&&s({code:"FLT-202",message:`${e="not"} requires a boolean value`,context:{l:e},t:"./docs/error-codes.md#flt"}),!t},lt:t=>{const e=t?.[0]??o("lt"),n=Number(e);return isNaN(n)&&r("lt"),t=>("number"!=typeof t&&i("lt"),t<n)},le:t=>{const e=t?.[0]??o("le"),n=Number(e);return isNaN(n)&&r("le"),t=>("number"!=typeof t&&i("le"),t<=n)},gt:t=>{const e=t?.[0]??o("gt"),n=Number(e);return isNaN(n)&&r("gt"),t=>("number"!=typeof t&&i("gt"),t>n)},ge:t=>{const e=t?.[0]??o("ge"),n=Number(e);return isNaN(n)&&r("ge"),t=>("number"!=typeof t&&i("ge"),t>=n)},inc:t=>{const e=t?.[0]??o("inc"),n=Number(e);return isNaN(n)&&r("inc"),t=>("number"!=typeof t&&i("inc"),t+n)},dec:t=>{const e=t?.[0]??o("dec"),n=Number(e);return isNaN(n)&&r("dec"),t=>("number"!=typeof t&&i("dec"),t-n)},mul:t=>{const e=t?.[0]??o("mul"),n=Number(e);return isNaN(n)&&r("mul"),t=>("number"!=typeof t&&i("mul"),t*n)},div:t=>{const e=t?.[0]??o("div"),n=Number(e);return isNaN(n)&&r("div"),t=>("number"!=typeof t&&i("div"),t/n)},fix:t=>{const e=Number(t?.[0]??0);return isNaN(e)&&r("div"),t=>("number"!=typeof t&&i("div"),t.toFixed(e))},locale:t=>{const e=t?.[0]??d.locale;return t=>("number"!=typeof t&&i("locale"),t.toLocaleString(e))},uc:t=>t=>t.toString().toUpperCase(),lc:t=>t=>t.toString().toLowerCase(),cap:t=>t=>{const e=t.toString();return 0===e.length?e:1===e.length?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1)},trim:t=>t=>t.toString().trim(),slice:t=>{const e=t?.[0]??o("slice"),n=Number(e);return isNaN(n)&&r("slice"),t=>t.toString().slice(n)},substr:t=>{const e=t?.[0]??o("substr"),n=Number(e);isNaN(n)&&r("substr");const s=t?.[1]??o("substr"),i=Number(s);return isNaN(i)&&r("substr"),t=>t.toString().substr(n,i)},pad:t=>{const e=t?.[0]??o("pad"),n=Number(e);isNaN(n)&&r("pad");const s=t?.[1]??"0";return t=>t.toString().padStart(n,s)},rep:t=>{const e=t?.[0]??o("rep"),n=Number(e);return isNaN(n)&&r("rep"),t=>t.toString().repeat(n)},rev:t=>t=>t.toString().split("").reverse().join(""),int:t=>t=>parseInt(t,10),float:t=>t=>parseFloat(t),round:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&r("round"),t=>("number"!=typeof t&&i("round"),Math.round(t*n)/n)},floor:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&r("floor"),t=>("number"!=typeof t&&i("floor"),Math.floor(t*n)/n)},ceil:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&r("ceil"),t=>("number"!=typeof t&&i("ceil"),Math.ceil(t*n)/n)},percent:t=>{const e=Number(t?.[0]??0);return isNaN(e)&&r("percent"),t=>("number"!=typeof t&&i("percent"),t.toFixed(e)+"%")},date:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("date"),t.toLocaleDateString(e))},time:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("time"),t.toLocaleTimeString(e))},datetime:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("datetime"),t.toLocaleString(e))},ymd:t=>{const e=t?.[0]??"-";return t=>{t instanceof Date||c("ymd");const n=t.getFullYear().toString(),s=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${n}${e}${s}${e}${o}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const e=t?.[0]??o("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?e:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},l=a,h=a;let u=0;function f(){return++u}const m={};const p={};function g(t,e){const n=new CSSStyleSheet;n.replaceSync(e),function(t,e){p[t]=e}(t,n)}function w(t,e){let n=t;if(0===e.length)return n;for(let t=0;t<e.length&&(n=n?.childNodes[e[t]]??null,null!==n);t++);return n}function y(t,e){const n=t[e.name];return n||s({code:"FLT-201",message:`Filter not found: ${e.name}`,context:{h:"createFilters.textToFilter",name:e.name},t:"./docs/error-codes.md#flt"}),n(e.options)}const x=new Map;function b(t,e){let n=x.get(e);if(void 0===n){n=[];for(let s=0;s<e.length;s++)n.push(y(t,e[s]));x.set(e,n)}return n}class N{#t;#e;#n;#s;#o;#r=[];get node(){return this.#e}get name(){return this.#n}get u(){return this.#n}get binding(){return this.#t}get m(){return this.#o}get filters(){return this.#s}get p(){return this.#r}constructor(t,e,n,s,o){this.#t=t,this.#e=e,this.#n=n,this.#s=s,this.#o=o}init(){}N(t){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingNode.assignValue",name:this.name},t:"/docs/error-codes.md#bind"})}I(t,e){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingNode.updateElements",name:this.name},t:"/docs/error-codes.md#bind"})}S(t){}v(t){if(t.C.has(this.binding))return;const e=this.binding.P.T(t.U);this.N(e),t.C.add(this.binding)}get B(){return this.node instanceof HTMLSelectElement}get value(){return null}get L(){return null}get $(){return!1}}class I extends N{#i;get u(){return this.#i}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,r]=this.name.split(".");this.#i=r}N(t){(null==t||Number.isNaN(t))&&(t="");this.node.setAttribute(this.u,t.toString())}}class S extends N{N(t){Array.isArray(t)||s({code:"BIND-201",message:"Value is not array",context:{h:"BindingNodeCheckbox.update",M:typeof t},t:"/docs/error-codes.md#bind",o:"error"});const e=this.node;e.checked=t.map((t=>t.toString())).includes(e.value)}}class v extends N{N(t){Array.isArray(t)||s({code:"BIND-201",message:"Value is not array",context:{h:"BindingNodeClassList.update",M:typeof t},t:"/docs/error-codes.md#bind",o:"error"});this.node.className=t.join(" ")}}class C extends N{#i;get u(){return this.#i}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,r]=this.name.split(".");this.#i=r}N(t){"boolean"!=typeof t&&s({code:"BIND-201",message:"Value is not boolean",context:{h:"BindingNodeClassName.update",M:typeof t},t:"/docs/error-codes.md#bind",o:"error"});const e=this.node;t?e.classList.add(this.u):e.classList.remove(this.u)}}const T="data-bind",P="@@:",U="@@|",B=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","watch","unwatch","eval","arguments","let","var","const","class","function","null","true","false","new","return"]),L={};class ${static id=0;id=++$.id;D=this.id.toString();pattern;A;k;R;F;V;W;H;O;q;j;_;G;K;Z;J;X;Y;tt;et;nt;children={};constructor(t){const e=e=>t===e?this:E(e),n=t.split("."),s=[],o=[],r=[],i={},c=[],d=[],a=[];let l="",h="",u=0;for(let t=0;t<n.length;t++)l+=n[t],"*"===n[t]&&(r.push(l),i[l]=u,c.push(e(l)),d.push(h),a.push(e(h)),u++),s.push(l),o.push(e(l)),h=l,l+=".";const f=r.length>0?r[r.length-1]:null,m=s.length>1?s[s.length-2]:null;this.pattern=t,this.A=n,this.k=n[n.length-1],this.R=s,this.F=new Set(s),this.V=o,this.W=new Set(o),this.H=r,this.O=new Set(r),this.j=i,this.q=c,this._=new Set(c),this.G=d,this.K=new Set(d),this.Z=a,this.J=new Set(a),this.X=f,this.Y=f?e(f):null,this.tt=m,this.et=m?e(m):null,this.nt=u,this.et&&(this.et.children[this.k]=this)}}function E(t){B.has(t)&&s({code:"STATE-202",message:`Pattern is reserved word: ${t}`,context:{h:"getStructuredPathInfo",st:t},t:"./docs/error-codes.md#state"});const e=L[t];return void 0!==e?e:L[t]=new $(t)}const M=new Map;class D{static id=0;id=++D.id;name;elements;ot;nt;rt;it;info;constructor(t){const e=t.split("."),n=e.slice(),s=[];let o=0,r=0,i="",c=0,d="none",a=[];for(let t=0;t<e.length;t++){const d=e[t];if("*"===d)n[t]="*",a.push(null),o++,c++;else{const e=Number(d);Number.isNaN(e)||(n[t]="*",a.push(e),r++,c++)}i+=d,s.push(i),i+=t<e.length-1?".":""}const l=E(n.join("."));(o>0||r>0)&&(d=o===c?"context":r===c?"all":"partial"),this.name=t,this.elements=e,this.ot=s,this.nt=c,this.rt=d,this.it=a,this.info=l}}function A(t){let e;return M.get(t)??(M.set(t,e=new D(t)),e)}class k{info;#c;get ct(){return null===this.#c?null:this.#c.deref()??s({code:"LIST-201",message:"listIndex is null",context:{D:this.info.D,key:this.key},t:"./docs/error-codes.md#list"})}key;constructor(t,e){this.info=t,this.#c=null!==e?new WeakRef(e):null,this.key=function(t,e){return null==e?t.D:t.D+"#"+e.D}(t,e)}#d=void 0;dt(){if(void 0!==this.#d)return this.#d;const t=this.info.et;if(null===t)return this.#d=null;if(t.nt===this.info.nt)return this.#d=V(t,this.ct);if(t.nt<this.info.nt){if(t.nt>0){const e=this.ct?.at(t.nt-1)??s({code:"BIND-201",message:"Inconsistent wildcard count between parentInfo and info",context:{ht:this.info.pattern,ut:t.pattern},t:"/docs/error-codes.md#bind",o:"error"});return this.#d=V(t,e)}return this.#d=V(t,null)}s({code:"BIND-201",message:"Inconsistent wildcard count between parentInfo and info",context:{ht:this.info.pattern,ut:t.pattern},t:"/docs/error-codes.md#bind",o:"error"})}}const R=new WeakMap,F=new Map;function V(t,e){let n=null;if(null!==e){let s=R.get(e);return void 0===s&&(s=new Map,R.set(e,s)),n=s.get(t),void 0===n&&(n=new k(t,e),s.set(t,n)),n}return n=F.get(t),void 0===n&&(n=new k(t,null),F.set(t,n)),n}function W(t,e){const n=t.ft;if(null==n)return null;if(null==n.info)return null;if(null==n.ct)return null;const s=n.info.j[e];return void 0!==s?n.ct.at(s):null}function H(t,e,n){switch(t.rt){case"none":return null;case"context":return W(n,t.info.X??s({code:"STATE-202",message:"lastWildcardPath is null",context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#state"}))??s({code:"LIST-201",message:`ListIndex not found: ${t.info.pattern}`,context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#list"});case"all":let e=null;for(let o=0;o<t.info.nt;o++){const r=t.info.Z[o]??s({code:"STATE-202",message:"wildcardParentPattern is null",context:{h:"getListIndex",pattern:t.info.pattern,index:o},t:"/docs/error-codes.md#state"}),i=V(r,e),c=n.U.wt(i)??s({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{h:"getListIndex",yt:r.pattern},t:"/docs/error-codes.md#list"}),d=t.it[o]??s({code:"STATE-202",message:"wildcardIndex is null",context:{h:"getListIndex",pattern:t.info.pattern,index:o},t:"/docs/error-codes.md#state"});e=c[d]??s({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{h:"getListIndex",yt:r.pattern,xt:d},t:"/docs/error-codes.md#list"})}return e;case"partial":s({code:"STATE-202",message:`Partial wildcard type is not supported yet: ${t.info.pattern}`,context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#state"})}}const O="state",z=Symbol.for(`${O}.GetByRef`),q=Symbol.for(`${O}.SetByRef`),j=Symbol.for(`${O}.GetAccessor`),_=Symbol.for(`${O}.ConnectedCallback`),G=Symbol.for(`${O}.DisconnectedCallback`);function K(t,e,n,o){return t=>{const e=o.ft?.info??s({code:"STATE-202",message:"Internal error: lastRefStack is null",context:{h:"trackDependency",path:t},t:"/docs/error-codes.md#state"});o.It.Nt.bt.has(e.pattern)&&e.pattern!==t&&o.It.Nt.St(e.pattern,t)}}const Z={};for(let t=0;t<32;t++)Z[`$${t+1}`]=t;function J(t,e,n,o){return(t,e,n)=>{const r=E(t),i=o.ft?.info??null;null!==i&&i.pattern!==r.pattern&&o.It.Nt.bt.has(i.pattern)&&!o.It.Nt.vt.has(i.pattern)&&o.It.Nt.St(i.pattern,r.pattern),r.Z.length>e.length&&s({code:"STATE-202",message:`indexes length is insufficient: ${t}`,context:{path:t,Ct:r.Z.length,Tt:e.length},t:"/docs/error-codes.md#state",o:"error"});let c=null;for(let t=0;t<r.Z.length;t++){const n=r.Z[t],i=V(n,c),d=o.U.wt(i)??s({code:"LIST-201",message:`ListIndexes not found: ${n.pattern}`,context:{pattern:n.pattern},t:"/docs/error-codes.md#list",o:"error"}),a=e[t];c=d[a]??s({code:"LIST-201",message:`ListIndex not found: ${n.pattern}`,context:{pattern:n.pattern,index:a},t:"/docs/error-codes.md#list",o:"error"})}const d=V(r,c);return void 0!==n?o.U.Pt(d,n):o.U.Ut(d)}}function Q(t,e,n){t.Bt++,t.Bt>=t.Lt.length&&t.Lt.push(null),t.Lt[t.Bt]=t.ft=e;try{return n()}finally{t.Lt[t.Bt]=null,t.Bt--,t.ft=t.Bt>=0?t.Lt[t.Bt]:null}}function X(t,e,n,o){if(function(t,e){if(t.Bt>=0){const n=t.ft?.info??null;null!==n&&t.It.Nt.bt.has(n.pattern)&&!t.It.Nt.vt.has(n.pattern)&&n.pattern!==e.info.pattern&&t.It.Nt.St(n.pattern,e.info.pattern)}}(o,e),o.It.$t.startsWith(e.info)&&0===o.It.Nt.bt.intersection(e.info.F).size)return o.It.$t.get(e);if(e.info.pattern in t)return Q(o,e,(()=>Reflect.get(t,e.info.pattern,n)));{const t=e.dt()??s({code:"STATE-202",message:"propRef.getParentRef() returned null",context:{h:"getByRefWritable",Et:e.info.pattern},t:"/docs/error-codes.md#state"}),n=o.U.Ut(t),r=e.info.k;if("*"===r){const t=e.ct?.index??s({code:"STATE-202",message:"propRef.listIndex?.index is undefined",context:{h:"getByRefWritable",Et:e.info.pattern},t:"/docs/error-codes.md#state"});return Reflect.get(n,t)}return Reflect.get(n,r)}}function Y(t,e,n,o){const r=J(0,0,0,o);return(t,e)=>{const n=E(t),i=o.ft?.info??null;if(null!==i&&i.pattern!==n.pattern&&o.It.Nt.bt.has(i.pattern)&&!o.It.Nt.vt.has(i.pattern)&&o.It.Nt.St(i.pattern,n.pattern),void 0===e){for(let t=0;t<n.q.length;t++){const r=n.q[t]??s({code:"BIND-201",message:"wildcardPattern is null",context:{index:t,ht:n.pattern},t:"/docs/error-codes.md#bind",o:"error"}),i=W(o,r.pattern);if(i){e=i.Mt;break}}void 0===e&&(e=[])}const c=(t,e,n,r,i,d,a)=>{const l=t[e]??null;if(null===l)return void a.push(d);const h=V(l,n),u=o.U.wt(h)??s({code:"LIST-201",message:`ListIndex not found: ${l.pattern}`,context:{pattern:l.pattern},t:"/docs/error-codes.md#list",o:"error"}),f=r[i]??null;if(null===f)for(let n=0;n<u.length;n++){const s=u[n];c(t,e+1,s,r,i+1,d.concat(s.index),a)}else{const n=u[f]??s({code:"LIST-201",message:`ListIndex not found: ${l.pattern}`,context:{pattern:l.pattern,index:f},t:"/docs/error-codes.md#list",o:"error"});e+1<t.length?c(t,e+1,n,r,i+1,d.concat(n.index),a):a.push(d.concat(n.index))}},d=[];c(n.Z,0,null,e,0,[],d);const a=[];for(let t=0;t<d.length;t++)a.push(r(n.pattern,d[t]));return a}}let tt=0,et=0;class nt{#a=null;#l=0;#h=0;#u;#f=++et;#m=this.#f.toString();constructor(t,e){this.#a=t,this.#l=t?t.position+1:0,this.#h=e,this.#u=tt}get Dt(){return this.#a}get id(){return this.#f}get D(){return this.#m}get position(){return this.#l}get length(){return this.#l+1}get index(){return this.#h}set index(t){this.#h=t,this.#u=++tt,this.Mt[this.#l]=t}get version(){return this.#u}get At(){return null!==this.#a&&(this.#a.At||this.#a.version>this.#u)}#p;get Mt(){return null===this.#a?void 0===this.#p&&(this.#p=[this.#h]):(void 0===this.#p||this.At)&&(this.#p=[...this.#a.Mt,this.#h],this.#u=tt),this.#p}#g;get kt(){return null===this.#a?void 0===this.#g&&(this.#g=[new WeakRef(this)]):void 0===this.#g&&(this.#g=[...this.#a.kt,new WeakRef(this)]),this.#g}get Rt(){return`${this.position+1}`}at(t){return t>=0?this.kt[t]?.deref()||null:this.kt[this.kt.length+t]?.deref()||null}}function st(t,e){return new nt(t,e)}function ot(t,e,n,s){const o=n||[],r=e||[],i=s||[];if(o===r||0===o.length&&0===r.length)return{Ft:e,Vt:n,Wt:i,Ht:i};if(0===o.length)return{Ft:e,Vt:n,Wt:i,Ht:[],Ot:new Set(i)};if(0===r.length){const s=[];for(let e=0;e<o.length;e++)s.push(st(t,e));return{Ft:e,Vt:n,Wt:i,Ht:s,zt:new Set(s)}}{const s=new Map;for(let t=0;t<r.length;t++)s.set(r[t],t);const c=new Set,d=new Set,a=new Set,l=[],h=new Set;for(let e=0;e<o.length;e++){const n=o[e],r=s.get(n);if(void 0===r){const n=st(t,e);c.add(n),l.push(n)}else{const t=i[r];t.index!==e&&(t.index=e,a.add(t)),h.add(r),l.push(t)}}for(let t=0;t<i.length;t++)h.has(t)||d.add(i[t]);return{Ft:e,Vt:n,Wt:i,Ht:l,zt:c,Ot:d,qt:a}}}class rt{#u;#w;#y;#x=new Map;#b=new Set;constructor(t,e,n){this.#w=t,this.#y=e,this.#u=n}jt(t){return this.#w.jt(t)??s({code:"CACHE-201",message:"cacheEntry is null",context:{h:"PropertyAccessor.getCacheEntry",Et:t.info.pattern},t:"/docs/error-codes.md#cache"})}_t(t,e,n){const s=t[z](n);return e.Pt(s,this.#u),this.#w.Nt.Gt.has(n.info.pattern)&&this.Kt(t,n),s}Ut(t,e){const n=this.jt(e);return n.Zt(t[j])&&this._t(t,n,e),n.value}Jt(t,e){const n=this.jt(e);this._t(t,n,e)}Pt(t,e,n){try{t[q](e,n);this.jt(e).Pt(n,this.#u)}finally{this.#y.Qt(e)}}wt(t,e){const n=this.jt(e);return n.Zt(t[j])&&this._t(t,n,e),this.#w.wt(e)}Xt(t,e){const n=this.jt(e);return n.Zt(t[j])&&this._t(t,n,e),this.#w.Yt(e)}te(t,e){const n=this.jt(e);return n.Zt(t[j])&&this._t(t,n,e),this.#w.te(e)}Kt(t,e){if(this.#b.has(e))return console.warn("Circular reference detected in calcListDiff:",Array.from(this.#b).map((t=>t.key))),null;this.#b.add(e);try{let n=this.#x.get(e);const s=this.Ut(t,e);if(void 0===n){const[t,o]=this.#w.Yt(e);n=ot(e.ct,t,s,o),this.#x.set(e,n),t!==s&&this.#w.ee(e,s,n.Ht)}else n.Vt!==s&&(n=ot(e.ct,n.Ft,s,n.Wt),this.#x.set(e,n),this.#w.ee(e,s,n.Ht));return n}finally{this.#b.delete(e)}}se(t){return this.#x.get(t)??null}}class it{#N;#I;constructor(t,e){this.#N=t,this.#I=e}Ut(t){return this.#I.Ut(this.#N,t)}Jt(t){this.#I.Jt(this.#N,t)}Pt(t,e){q in this.#N||s({code:"PROP-001",message:"State is not writable",t:"./docs/error-codes.md#prop"}),this.#I.Pt(this.#N,t,e)}wt(t){return this.#I.wt(this.#N,t)}Xt(t){return this.#I.Xt(this.#N,t)}te(t){return this.#I.te(this.#N,t)}Kt(t){return this.#I.Kt(this.#N,t)}se(t){return this.#I.se(t)}async connectedCallback(){return _ in this.#N||s({code:"PROP-002",message:"State does not support connectedCallback",t:"./docs/error-codes.md#prop"}),await this.#N[_]()}async disconnectedCallback(){return G in this.#N||s({code:"PROP-003",message:"State does not support disconnectedCallback",t:"./docs/error-codes.md#prop"}),await this.#N[G]()}get state(){return this.#N}}function ct(t,e){return new it(t,e)}let dt=class{It;#S=void 0;Lt=Array(32).fill(null);Bt=-1;ft=null;#v=new Set([z]);#C=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t){this.It=t}oe(t,e){return this.#S=ct(e,t),this.#S}get U(){return this.#S||s({code:"STATE-201",message:"accessor is not set",context:{h:"StateHandler.accessor"},t:"/docs/error-codes.md#state",o:"error"}),this.#S}get(t,e,n){return function(t,e,n,o){const r=Z[e];if(void 0!==r){const t=o.ft?.ct;return t?.Mt[r]??s({code:"LIST-201",message:`ListIndex not found: ${e.toString()}`,context:{re:String(e),Mt:t?.Mt??null,index:r},t:"/docs/error-codes.md#list",o:"error"})}if("string"==typeof e){if("$"===e[0])switch(e){case"$resolve":return J(0,0,0,o);case"$getAll":return Y(0,0,0,o);case"$trackDependency":return K(0,0,0,o);case"$navigate":return t=>sn()?.navigate(t);case"$component":return o.It.ie}const t=A(e),n=H(t,0,o),s=V(t.info,n);return o.U.Ut(s)}if("symbol"==typeof e)switch(e){case z:return e=>X(t,e,n,o);case j:return o.U;default:return Reflect.get(t,e,n)}}(t,e,n,this)}set(t,e,n,o){s({code:"STATE-202",message:`Cannot set property ${String(e)} of readonly state`,context:{h:"createReadonlyStateProxy.set",re:String(e)},t:"./docs/error-codes.md#state"})}has(t,e){return Reflect.has(t,e)||this.#v.has(e)||this.#C.has(e)}};function at(t,e,n){const s=new dt(t),o=new Proxy(n,s);return s.oe(e,o),o}function lt(t,e,n,o){const r=Z[e];if(void 0!==r){const t=o.ft?.ct;return t?.Mt[r]??s({code:"LIST-201",message:`ListIndex not found: ${e.toString()}`,context:{re:String(e),Mt:t?.Mt??null,index:r},t:"/docs/error-codes.md#list",o:"error"})}if("string"==typeof e){if("$"===e[0])switch(e){case"$resolve":return J(0,0,0,o);case"$getAll":return Y(0,0,0,o);case"$trackDependency":return K(0,0,0,o);case"$navigate":return t=>sn()?.navigate(t);case"$component":return o.It.ie}const t=A(e),n=H(t,0,o),s=V(t.info,n);return o.U.Ut(s)}if("symbol"==typeof e)switch(e){case z:return e=>X(t,e,n,o);case q:return(e,r)=>function(t,e,n,o,r){if(r.It.$t.startsWith(e.info)&&0===r.It.Nt.vt.intersection(e.info.F).size)return r.It.$t.set(e,n);if(e.info.pattern in t)return Q(r,e,(()=>Reflect.set(t,e.info.pattern,n,o)));{const t=e.dt()??s({code:"STATE-202",message:"propRef.getParentRef() returned null",context:{h:"setByRef",Et:e.info.pattern},t:"/docs/error-codes.md#state"}),o=r.U.Ut(t),i=e.info.k;if("*"===i){const t=e.ct?.index??s({code:"STATE-202",message:"propRef.listIndex?.index is undefined",context:{h:"setByRef",Et:e.info.pattern},t:"/docs/error-codes.md#state"});return Reflect.set(o,t,n)}return Reflect.set(o,i,n)}}(t,e,r,n,o);case j:return o.U;case _:return()=>async function(t,e,n){const s=Reflect.get(t,"$connectedCallback");"function"==typeof s&&await s.call(n)}(t,0,n);case G:return()=>async function(t,e,n){const s=Reflect.get(t,"$disconnectedCallback");"function"==typeof s&&await s.call(n)}(t,0,n);default:return Reflect.get(t,e,n)}}class ht{It;#S=void 0;Lt=Array(32).fill(null);Bt=-1;ft=null;ce=null;#v=new Set([z,q,_,G]);#C=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t){this.It=t}oe(t,e){return this.#S=ct(e,t),this.#S}get U(){return this.#S||s({code:"STATE-201",message:"accessor is not set",context:{h:"StateHandler.accessor"},t:"/docs/error-codes.md#state",o:"error"}),this.#S}get(t,e,n){return lt(t,e,n,this)}set(t,e,n,s){return function(t,e,n,s,o){if("string"==typeof e){const t=A(e),s=H(t,0,o),r=V(t.info,s);return o.U.Pt(r,n),!0}return Reflect.set(t,e,n,s)}(t,e,n,s,this)}has(t,e){return Reflect.has(t,e)||this.#v.has(e)||this.#C.has(e)}}async function ut(t,e,n,o,r){const i=new ht(t),c=new Proxy(n,i);return i.oe(e,c),async function(t,e,n){t.ce&&s({code:"STATE-301",message:"already in loop context",context:{h:"setLoopContext"},t:"/docs/error-codes.md#state"}),t.ce=e;try{e?await async function(t,e,n){t.Bt++,t.Bt>=t.Lt.length&&t.Lt.push(null),t.Lt[t.Bt]=t.ft=e;try{await n()}finally{t.Lt[t.Bt]=null,t.Bt--,t.ft=t.Bt>=0?t.Lt[t.Bt]:null}}(t,e.de,n):await n()}finally{t.ce=null}}(i,o,(async()=>{await r(c)}))}class ft{tt;ae;name;he;level;constructor(t,e,n){this.tt=t,this.ae=t?t+"."+e:e,this.name=e,this.level=n,this.he=new Map}find(t,e=0){if(e>=t.length)return null;const n=t[e],s=this.he.get(n);return s?e===t.length-1?s:s.find(t,e+1):null}appendChild(t){let e=this.he.get(t);if(!e){const n=this.tt?this.tt+"."+this.name:this.name;e=new ft(n,t,this.level+1),this.he.set(t,e)}return e}}const mt=new Map;function pt(t,e){let n=mt.get(t);n||(n=new Map,mt.set(t,n));let s=n.get(e)??null;if(s)return s;const o=E(e);return s=t.find(o.A),n.set(e,s),s}function gt(t,e){const n=E(e);if(null===n.tt)return t.appendChild(e);{let e=pt(t,n.tt);return null===e&&(e=gt(t,n.tt)),e.appendChild(n.k)}}class wt{#u;get version(){return this.#u}#T=new Set;#P=new Set;#w;#y;#U=null;#B=new Map;constructor(t,e,n){this.#w=t,this.#y=e,this.#u=n}get C(){return this.#T}get ue(){return this.#P}get fe(){return this.#U||s({code:"UPD-002",message:"ReadonlyState not initialized",t:"./docs/error-codes.md#upd"}),this.#U}get It(){return this.#w}get me(){return this.#y}get U(){return this.fe[j]??s({code:"UPD-002",message:"ReadonlyState not initialized",t:"./docs/error-codes.md#upd"})}pe(t){const e=new Set;for(let n=0;n<t.length;n++){const o=t[n];if(this.It.Nt.Gt.has(o.info.pattern)){e.add(o);continue}if(!this.It.Nt.elements.has(o.info.pattern))continue;this.#P.add(o),null===o.info.et&&s({code:"UPD-004",message:`ParentInfo is null for ref: ${o.key}`,context:{we:o.key,pattern:o.info.pattern},t:"./docs/error-codes.md#upd"});const r=o.dt()??s({code:"UPD-004",message:`ParentInfo is null for ref: ${o.key}`,context:{we:o.key,pattern:o.info.pattern},t:"./docs/error-codes.md#upd"});if(e.has(r))continue;let i=this.#B.get(r);void 0===i&&(i=[],this.#B.set(r,i));const c=o.ct??s({code:"UPD-003",message:`ListIndex is null for ref: ${o.key}`,context:{we:o.key,pattern:o.info.pattern},t:"./docs/error-codes.md#upd"});i.push(c.index)}for(const[t,e]of this.#B)try{const n=this.fe[z](t),[,o,r]=this.It.Yt(t);null!=r&&null!=o||s({code:"UPD-005",message:`OldListValue or OldListIndexes is null for ref: ${t.key}`,context:{we:t.key,pattern:t.info.pattern},t:"./docs/error-codes.md#upd"});const i={Ft:r,Vt:n,Wt:o,Ht:Array.from(o),qt:new Set,ye:new Set};for(let n=0;n<e.length;n++){const o=e[n],r=i.Vt?.[o],c=i.Ft?.indexOf(r)??-1;if(-1===c)i.ye?.add(i.Ht[o]);else{const e=i.Wt?.[c]??s({code:"UPD-004",message:`ListIndex not found for value: ${r}`,context:{we:t.key,pattern:t.info.pattern},t:"./docs/error-codes.md#upd"});e.index=o,i.Ht[o]=e,i.qt?.add(e)}}this.It.ee(t,n??null,i.Ht);const c=pt(this.#w.Nt.xe,t.info.pattern);null===c&&s({code:"PATH-101",message:`PathNode not found: ${t.info.pattern}`,context:{pattern:t.info.pattern},t:"./docs/error-codes.md#path"}),this.be(t,c)}finally{}}Ne(t){this.#B.clear(),this.#P.clear(),this.#T.clear(),this.#U=at(this.#w,this.#y.context,this.#w.state);try{this.pe(t);for(let e=0;e<t.length;e++){const n=t[e],o=pt(this.#w.Nt.xe,n.info.pattern);null===o&&s({code:"PATH-101",message:`PathNode not found: ${n.info.pattern}`,context:{pattern:n.info.pattern},t:"./docs/error-codes.md#path"}),this.be(n,o)}}finally{this.#U=null}}be(t,e){if(this.ue.has(t))return;this.ue.add(t);const n=this.U.te(t);for(let t=0;t<n.length;t++){const e=n[t];this.C.has(e)||e.v(this)}const o=this.U.Kt(t);if(null!==o)for(const t of o.qt??[]){const e=this.#w.Ie.get(t);for(const t of e??[])this.C.has(t)||t.v(this)}for(const[n,r]of e.he){const e=E(r.ae);if("*"===n){null===o&&s({code:"UPD-006",message:"ListDiff is null during renderItem",context:{we:t.key,pattern:t.info.pattern},t:"./docs/error-codes.md#upd"});for(const t of o.zt??[]){const n=V(e,t);this.be(n,r)}}else{const n=V(e,t.ct);this.be(n,r)}}const r=this.#w.Nt.Se.get(t.info.pattern);if(r)for(const t of r){const e=E(t),n=pt(this.#w.Nt.xe,e.pattern);if(null===n&&s({code:"PATH-101",message:`PathNode not found: ${e.pattern}`,context:{pattern:e.pattern},t:"./docs/error-codes.md#path"}),e.nt>0){const t=e.Z,s=(o,r,i)=>{const c=this.U.wt(o)||[];if(r+1<t.length)for(let e=0;e<c.length;e++){const n=V(i,c[e]);s(n,r+1,t[r+1])}else for(let t=0;t<c.length;t++){const s=V(e,c[t]);this.be(s,n)}},o=V(e.Z[0],null);s(o,0,e.Z[1]||null)}else{const t=V(e,null);this.be(t,n)}}}}function yt(t,e,n,s){new wt(e,n,s).Ne(t)}class xt{queue=[];#L=!1;#$=!1;#w;#u;#I;#x=new Map;constructor(t,e){this.#w=t,this.#u=e,this.#I=function(t,e,n){return new rt(t,e,n)}(t,this,this.#u)}get version(){return this.#u}get context(){return this.#I}get ve(){return this.#x}Qt(t){this.queue.push(t),this.#$||(this.#$=!0,queueMicrotask((()=>{this.Ce()})))}async Te(t,e){try{this.#L=!0,await ut(this.#w,this.#I,this.#w.state,t,(async t=>{await e(t)}))}finally{this.#L=!1}}Ce(){try{for(;this.queue.length>0;){const t=this.queue;this.queue=[],this.#w||s({code:"UPD-001",message:"Engine not initialized",t:"./docs/error-codes.md#upd"}),yt(t,this.#w,this,this.#u)}}finally{this.#$=!1}}Pe(){return at(this.#w,this.#I,this.#w.state)}Ue(){return this.Pe()[j]}}function bt(t){return new xt(t,t.Be())}async function Nt(t,e,n){const s=bt(t);await s.Te(e,(async t=>{await n(s,t[j])}))}class It extends N{#i;constructor(t,e,n,s,o){super(t,e,n,s,o),this.#i=this.name.slice(2);e.addEventListener(this.u,(t=>this.Le(t)))}get u(){return this.#i}update(){}async Le(t){const e=this.binding.It,n=this.binding.Ee.$e,o=n?.Me().map((t=>t.ct.index))??[],r=this.m;r.includes("preventDefault")&&t.preventDefault(),r.includes("stopPropagation")&&t.stopPropagation(),await Nt(e,n,(async(e,n)=>{const r=this.binding.P.Ut(n);"function"!=typeof r&&s({code:"BIND-201",message:`${this.name} is not a function`,context:{h:"BindingNodeEvent.handler",name:this.name,M:typeof r},t:"/docs/error-codes.md#bind",o:"error"}),await Reflect.apply(r,n.state,[t,...o])}))}v(t){}}const St=(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new It(s,o,t,i,n)};class vt extends N{#f;get id(){return this.#f}constructor(t,e,n,o,r){super(t,e,n,o,r);const i=this.node.textContent?.slice(3)??s({code:"BIND-201",message:"Invalid node",context:{h:"BindingNodeBlock.id",textContent:this.node.textContent??null},t:"/docs/error-codes.md#bind",o:"error"});this.#f=Number(i)}}class Ct extends vt{#E;#M;#D=[];#r;get p(){return this.#r}constructor(t,e,n,s,o){super(t,e,n,s,o);const r=V(E(""),null);this.#E=Ce(this.binding,this.id,this.binding.It,r),this.#M=this.#r=[this.#E]}N(t){s({code:"BIND-201",message:"Not implemented",context:{h:"BindingNodeIf.assignValue",name:this.name},t:"/docs/error-codes.md#bind",o:"error"})}v(t){if(t.C.has(this.binding))return;const e=this.binding.P.T(t.U);"boolean"!=typeof e&&s({code:"BIND-201",message:"Value is not boolean",context:{h:"BindingNodeIf.update",valueType:typeof e},t:"/docs/error-codes.md#bind",o:"error"});const n=this.node.parentNode;null==n&&s({code:"BIND-201",message:"ParentNode is null",context:{h:"BindingNodeIf.update",nodeType:this.node.nodeType},t:"/docs/error-codes.md#bind",o:"error"}),e?(this.#E.De(n,this.node),this.#E.v(t),this.#r=this.#M):(this.#E.unmount(),this.#r=this.#D),t.C.add(this.binding)}}const Tt=new Set;class Pt extends vt{#r=[];#A=new WeakMap;#k=[];#R=0;#F=void 0;get p(){return this.#r}get $(){return!0}init(){}Ae(t){let e;if(this.#R>=0)e=this.#k[this.#R],this.#R--,e.ke(t);else{const n=V(this.Re,t);e=Ce(this.binding,this.id,this.binding.It,n)}return this.#A.set(t,e),e}Fe(t){t.unmount(),t.ce?.Ve()}get We(){return this.#R}set We(t){this.#R=t}get He(){return this.#k.length}set He(t){t<0&&s({code:"BIND-202",message:"Length is negative",context:{h:"BindingNodeFor.setPoolLength",length:t},t:"./docs/error-codes.md#bind"}),this.#k.length=t}get Re(){if(void 0===this.#F){const t=this.binding.P.pattern+".*";this.#F=E(t)}return this.#F}N(t){s({code:"BIND-301",message:"Not implemented. Use update or applyChange",context:{h:"BindingNodeFor.assignValue"},t:"./docs/error-codes.md#bind"})}v(t){if(t.C.has(this.binding))return;let e=[];const n=new Set,o=t.U.Kt(this.binding.P.de);null===o&&s({code:"BIND-201",message:"ListDiff is null",context:{h:"BindingNodeFor.applyChange"},t:"./docs/error-codes.md#bind"});const r=this.node.parentNode??s({code:"BIND-201",message:"ParentNode is null",context:{h:"BindingNodeFor.applyChange"},t:"./docs/error-codes.md#bind"}),i=o.Ft?.length===o.Ot?.size&&(o.Ft?.length??0)>0;let c=!1;if(i){const t=Array.from(r.childNodes),e=this.#r.at(-1)??s({code:"BIND-201",message:"Last content is null",context:{h:"BindingNodeFor.applyChange"},t:"/docs/error-codes.md#bind"});let n=t[0];for(;n&&n.nodeType===Node.TEXT_NODE&&""===n.textContent?.trim();)n=n.nextSibling;let o=t.at(-1)??null;for(;o&&o.nodeType===Node.TEXT_NODE&&""===o.textContent?.trim();)o=o.previousSibling;n===this.node&&o===e.Oe(r)&&(c=!0)}if(i&&c){r.textContent="",r.append(this.node);for(let t=0;t<this.#r.length;t++){const e=this.#r[t];e.ce?.Ve()}this.#k.push(...this.#r)}else{if(o.Ot)for(const t of o.Ot){const e=this.#A.get(t);void 0===e&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",ze:"removes"},t:"./docs/error-codes.md#bind"}),this.Fe(e),n.add(e)}this.#k.push(...n)}let d=null;const a=this.node;this.We=this.He-1;const l=o.Vt?.length===o.zt?.size&&(o.Vt?.length??0)>0;if(0===(o.zt?.size??0)&&0===(o.Ot?.size??0)&&((o.qt?.size??0)>0||(o.ye?.size??0)>0)){if((o.qt?.size??0)>0){const t=Array.from(this.#r),n=Array.from(o.qt??[]);n.sort(((t,e)=>t.index-e.index));for(const e of n){const n=this.#A.get(e);void 0===n&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",ze:"reorder"},t:"/docs/error-codes.md#bind"}),t[e.index]=n;const o=t[e.index-1]?.Oe(r)??a;n.De(r,o)}e=t}if((o.ye?.size??0)>0)for(const e of o.ye??[]){const n=this.#A.get(e);void 0===n&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",ze:"overwrites"},t:"./docs/error-codes.md#bind"}),n.v(t)}}else{const n=l?document.createDocumentFragment():r,i=l?null:a,c=o.zt??Tt;for(const r of o.Ht){const o=d?.Oe(n)??i;let a;c.has(r)?(a=this.Ae(r),a.De(n,o),a.v(t)):(a=this.#A.get(r),void 0===a&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",ze:"reuse"},t:"./docs/error-codes.md#bind"}),o?.nextSibling!==a.qe&&a.De(n,o)),e.push(a),d=a}if(l){const t=a.nextSibling;r.insertBefore(n,t)}}this.He=this.We+1,this.#r=e}}const Ut=(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Pt(s,o,t,i,n)},Bt="textContent",Lt={radio:"checked",checkbox:"checked",button:"onclick"},$t={},Et={HTMLElement:t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLOptionElement?"value":t instanceof HTMLButtonElement||t instanceof HTMLAnchorElement?"onclick":t instanceof HTMLFormElement?"onsubmit":t instanceof HTMLInputElement?Lt[t.type]??"value":Bt,SVGElement:void 0,Text:t=>Bt,je:void 0};const Mt={value:"input",checked:"change",selected:"change"};class Dt extends N{get value(){return this.node[this.name]}get L(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}constructor(t,e,n,o,r){super(t,e,n,o,r);if(!(this.node instanceof HTMLElement))return;if(!((i=this.node)instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement))return;var i;const c=function(t,e){const n=t.constructor.name+"\t"+(t.type??"");return $t[n]??($t[n]=Et[e]?.(t))}(this.node,"HTMLElement");if(c!==this.name)return;r.length>1&&s({code:"BIND-201",message:"Has multiple decorators",context:{h:"BindingNodeProperty.constructor",name:this.name,_e:r.length},t:"/docs/error-codes.md#bind",o:"error"});const d=(r[0]?.startsWith("on")?r[0]?.slice(2):r[0])??null??Mt[this.name]??"readonly";if("readonly"===d||"ro"===d)return;const a=this.binding.It;this.node.addEventListener(d,(async()=>{const e=this.binding.Ee.$e,n=this.L;await Nt(a,e,(async(e,s)=>{t.Ge(s,n)}))}))}init(){}N(t){(null==t||Number.isNaN(t))&&(t=""),this.node[this.name]=t}}const At=(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Dt(s,o,t,i,n)};class kt extends N{N(t){(null==t||Number.isNaN(t))&&(t="");const e=this.node;e.checked=t.toString()===e.value.toString()}}class Rt extends N{#i;get u(){return this.#i}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,r]=this.name.split(".");this.#i=r}N(t){(null==t||Number.isNaN(t))&&(t="");this.node.style.setProperty(this.u,t.toString())}}const Ft="component-state-input",Vt=Symbol.for(`${Ft}.AssignState`),Wt=Symbol.for(`${Ft}.NotifyRedraw`),Ht=new WeakMap;class Ot extends N{#i;get u(){return this.#i}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,r]=this.name.split(".");this.#i=r}init(){const t=this.binding.It;var e,n;e=t.ie,n=this.node,Ht.set(n,e);let s=t.Ke.get(this.node);void 0===s&&t.Ke.set(this.node,s=new Set),s.add(this.binding)}N(t){}S(t){const e=[],n=this.binding.P.info,s=this.binding.P.ct?.at(n.nt-1)??null,o=(s?.length??0)-1;for(const r of t)if(n.A.length>r.info.A.length){if(n.F.has(r.info.pattern)){const t=(r.ct?.length??0)-1;if(t>=0){if(null===s)continue;if(r.ct!==s?.at(t))continue}const o=V(n,s);e.push(o)}}else if(!r.info.F.has(n.pattern)){if(o>=0&&r.ct?.at(o)!==s)continue;e.push(r)}if(0===e.length)return;this.node.state[Wt](e)}}const zt={0:{class:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new v(s,o,t,i,n)},checkbox:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new S(s,o,t,i,n)},radio:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new kt(s,o,t,i,n)}},1:{if:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Ct(s,o,t,i,n)}}},qt={class:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new C(s,o,t,i,n)},attr:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new I(s,o,t,i,n)},style:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Rt(s,o,t,i,n)},state:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Ot(s,o,t,i,n)}};const jt={};function _t(t,e,n,o){const r=t instanceof Comment,i=t instanceof Element,c=r+"\t"+i+"\t"+e,d=jt[c]??(jt[c]=function(t,e,n){const o=zt[t?1:0][n];if(void 0!==o)return o;if(t&&"for"===n)return Ut;t&&s(`getBindingNodeCreator: unknown node property ${n}`);const r=n.split("."),i=qt[r[0]];return void 0!==i?i:e&&n.startsWith("on")?St:At}(r,i,e));return d(e,n,o)}class Gt{#t;#V;#W;#s;#H=null;#O=null;#z=null;get pattern(){return this.#V}get info(){return this.#W}get ct(){return this.de.ct}get de(){return null!==this.#H?(null===this.#z&&(this.#z=V(this.#W,this.#H.ct)),this.#z):this.#O??s({code:"BIND-201",message:"ref is null",context:{pattern:this.#V},t:"/docs/error-codes.md#bind",o:"error"})}get filters(){return this.#s}get binding(){return this.#t}constructor(t,e,n){this.#t=t,this.#V=e,this.#W=E(e),this.#O=0===this.#W.nt?V(this.#W,null):null,this.#s=n}Ut(t){return t.Ut(this.de)}T(t){let e=t.Ut(this.de);for(let t=0;t<this.#s.length;t++)e=this.#s[t](e);return e}init(){if(this.info.nt>0){const t=this.info.X??s({code:"BIND-201",message:"Wildcard last parentPath is null",context:{h:"BindingState.init",pattern:this.#V},t:"/docs/error-codes.md#bind",o:"error"});this.#H=this.binding.Ee.$e?.find(t)??s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindingState.init",X:t},t:"/docs/error-codes.md#bind",o:"error"}),this.#z=null}this.binding.It.Ze(this.de,this.binding)}N(t,e){t.Pt(this.de,e)}}class Kt{#t;#q;#s;#H=null;get pattern(){return s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.pattern"},t:"/docs/error-codes.md#bind"})}get info(){return s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.info"},t:"/docs/error-codes.md#bind"})}get ct(){return this.#H?.ct??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.listIndex"},t:"/docs/error-codes.md#list"})}get de(){return this.#H?.de??s({code:"STATE-202",message:"ref is null",context:{h:"BindingStateIndex.ref"},t:"/docs/error-codes.md#state"})}get filters(){return this.#s}get binding(){return this.#t}constructor(t,e,n){this.#t=t;const o=Number(e.slice(1));isNaN(o)&&s({code:"BIND-202",message:"Pattern is not a number",context:{h:"BindingStateIndex.constructor",pattern:e},t:"/docs/error-codes.md#bind"}),this.#q=o,this.#s=n}Ut(t){return this.ct?.index??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.getValue"},t:"/docs/error-codes.md#list"})}T(t){let e=this.ct?.index??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.getFilteredValue"},t:"/docs/error-codes.md#list"});for(let t=0;t<this.#s.length;t++)e=this.#s[t](e);return e}init(){const t=(this.binding.Ee.$e??s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindingStateIndex.init"},t:"/docs/error-codes.md#bind"})).Me();this.#H=t[this.#q-1]??s({code:"BIND-201",message:"Current loopContext is null",context:{h:"BindingStateIndex.init",Je:this.#q},t:"/docs/error-codes.md#bind"});const e=this.binding.It.Ie.get(this.ct);void 0===e?this.binding.It.Ie.set(this.ct,new Set([this.binding])):e.add(this.binding)}N(t,e){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.assignValue"},t:"/docs/error-codes.md#bind"})}}const Zt=new RegExp(/^\$\d+$/);function Jt(t,e){return Zt.test(t)?((t,e)=>(n,s)=>{const o=b(s,e);return new Kt(n,t,o)})(t,e):((t,e)=>(n,s)=>{const o=b(s,e);return new Gt(n,t,o)})(t,e)}const Qt={};function Xt(t,e=(t=>t.constructor.name+"\t"+(t instanceof Comment?t.textContent?.[2]??"":""))(t)){return Qt[e]??(Qt[e]=(t=>t instanceof Comment&&":"===t.textContent?.[2]?"Text":t instanceof HTMLElement?"HTMLElement":t instanceof Comment&&"|"===t.textContent?.[2]?"Template":t instanceof SVGElement?"SVGElement":s(`Unknown NodeType: ${t.nodeType}`))(t))}const Yt=t=>t.trim(),te=t=>t.length>0,ee=new RegExp(/^#(.*)#$/),ne=t=>{const e=ee.exec(t);return e?decodeURIComponent(e[1]):t},se=t=>{const[e,...n]=t.split(",").map(Yt);return{name:e,options:n.map(ne)}},oe=t=>{const[e,...n]=t.split("|").map(Yt);return{Qe:e,filters:n.map(se)}},re=t=>t.split(";").map(Yt).filter(te).map((t=>(t=>{const[e,n=null]=t.split("@").map(Yt),s=n?n.split(",").map(Yt):[],[o,r]=e.split(":").map(Yt),{Qe:i,filters:c}=oe(o),{Qe:d,filters:a}=oe(r);return{Xe:i,Ye:d,tn:c,en:a,m:s}})(t))),ie={};const ce=t=>{t.removeAttribute("data-bind")},de={HTMLElement:ce,SVGElement:ce,Text:void 0,je:void 0};const ae={Text:t=>{const e=document.createTextNode("");return t.parentNode?.replaceChild(e,t),e},HTMLElement:void 0,je:void 0,SVGElement:void 0};class le{nodeType;nn;sn;rn=new Map;constructor(t){this.nodeType=Xt(t);const e=function(t,e){switch(t){case"Text":return"textContent:"+(e.textContent?.slice(3).trim()??"");case"HTMLElement":case"SVGElement":return e.getAttribute(T)??"";case"Template":{const t=e.textContent?.slice(3).trim();return(ye(Number(t))??s(`Template not found: ${t}`)).getAttribute(T)??""}default:return""}}(this.nodeType,t);(function(t,e){de[e]?.(t)})(t=function(t,e){return ae[e]?.(t)??t}(t,this.nodeType),this.nodeType),this.nn=function(t){let e=[];for(;null!==t.parentNode;)e=[Array.from(t.parentNode.childNodes).indexOf(t),...e],t=t.parentNode;return e}(t),this.sn=function(t){return""===t.trim()?[]:ie[t]??(ie[t]=re(t))}(e);for(let e=0;e<this.sn.length;e++){const n=this.sn[e],s={cn:_t(t,n.Xe,n.tn,n.m),dn:Jt(n.Ye,n.en)};this.rn.set(n,s)}}}function he(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode:t=>t instanceof Element?t.hasAttribute(T)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:function(t){return t instanceof Comment&&(0===t.textContent?.indexOf(P)||0===t.textContent?.indexOf(U))}(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;n.nextNode();)e.push(n.currentNode);return e}const ue={},fe={},me={};function pe(t){return he(t).map((t=>function(t){return new le(t)}(t)))}const ge={};function we(t,e,n){var s;return s=e.content,Array.from(s.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE||(t.nodeValue??"").trim()||s.removeChild(t)})),function(t,e,n=t){const s=pe(e),o=me[n]??(me[n]=new Set),r=fe[n]??(fe[n]=new Set);for(let t=0;t<s.length;t++){const e=s[t];for(let t=0;t<e.sn.length;t++){const n=e.sn[t];o.add(n.Ye),"for"===n.Xe&&r.add(n.Ye)}}ue[t]=s}(t,e.content,n),ge[t]=e,t}function ye(t){return ge[t]??s({code:"TMP-001",message:`Template not found: ${t}`,context:{h:"registerTemplate.getTemplateById",an:t},t:"./docs/error-codes.md#tmp"})}class xe{Ee;node;It;ln;P;version;constructor(t,e,n,s,o){this.Ee=t,this.node=e,this.It=n,this.ln=s(this,e,n.hn),this.P=o(this,n.un)}get p(){return this.ln.p}init(){this.ln.init(),this.P.init()}Ge(t,e){return this.P.N(t,e)}S(t){this.ln.S(t)}v(t){t.C.has(this)||this.ln.v(t)}}function be(t,e,n,s,o){return new xe(t,e,n,s,o)}class Ne{#z;#W;#E;constructor(t,e){this.#z=t,this.#W=t.info,this.#E=e}get de(){return this.#z??s({code:"STATE-202",message:"ref is null",context:{h:"LoopContext.ref",path:this.#W.pattern},t:"/docs/error-codes.md#state"})}get path(){return this.de.info.pattern}get info(){return this.de.info}get ct(){return this.de.ct??s({code:"LIST-201",message:"listIndex is required",context:{h:"LoopContext.listIndex",path:this.#W.pattern},t:"/docs/error-codes.md#list"})}ke(t){this.#z=V(this.#W,t)}Ve(){this.#z=null}get fn(){return this.#E}#j;get mn(){if(void 0===this.#j){let t=this.fn;for(;null!==t;){if(null!==t.ce&&t.ce!==this){this.#j=t.ce;break}t=t.pn?.Ee??null}void 0===this.#j&&(this.#j=null)}return this.#j}#_={};find(t){let e=this.#_[t];if(void 0===e){let n=this;for(;null!==n&&n.path!==t;)n=n.mn;e=this.#_[t]=n}return e}gn(t){let e=this;for(;null!==e;)t(e),e=e.mn}Me(){const t=[];return this.gn((e=>{t.unshift(e)})),t}}function Ie(t){const e=ye(t)??s({code:"BIND-101",message:`Template not found: ${t}`,context:{h:"BindContent.createContent",an:t},t:"./docs/error-codes.md#bind"}),n=document.importNode(e.content,!0);if(Object.keys(Ze).length>0){const t=n.querySelectorAll(":not(:defined)");for(let e=0;e<t.length;e++){Qe(t[e].tagName.toLowerCase())}}return n}function Se(t,e,n,o){const r=(t=>ue[t])(e)??s({code:"BIND-101",message:"Data-bind is not set",context:{h:"BindContent.createBindings",an:e},t:"./docs/error-codes.md#bind"}),i=[];for(let c=0;c<r.length;c++){const d=r[c],a=w(o,d.nn)??s({code:"BIND-102",message:`Node not found: ${d.nn}`,context:{h:"BindContent.createBindings",an:e,nn:d.nn},t:"./docs/error-codes.md#bind"});for(let o=0;o<d.sn.length;o++){const r=d.sn[o],c=d.rn.get(r)??s({code:"BIND-103",message:`Creator not found: ${r}`,context:{h:"BindContent.createBindings",an:e,wn:r},t:"./docs/error-codes.md#bind"}),l=be(t,a,n,c.cn,c.dn);i.push(l)}}return i}class ve{ce;pn;childNodes;fragment;It;#f;get id(){return this.#f}get yn(){return this.childNodes.length>0&&this.childNodes[0].parentNode!==this.fragment}get qe(){return this.childNodes[0]??null}get xn(){return this.childNodes[this.childNodes.length-1]??null}Oe(t){const e=this.bn[this.bn.length-1],n=this.xn;if(void 0!==e&&e.node===n&&e.p.length>0){const n=(e.p.at(-1)??s({code:"BIND-104",message:"Child bindContent not found",context:{h:"BindContent.getLastNode",an:this.#f},t:"./docs/error-codes.md#bind"})).Oe(t);if(null!==n)return n}return t!==n?.parentNode?null:n}#G;get $e(){if(void 0===this.#G){let t=this;for(;null!==t&&null===t.ce;)t=t.pn?.Ee??null;this.#G=t?.ce??null}return this.#G}constructor(t,e,n,s){this.pn=t,this.#f=e,this.fragment=Ie(e),this.childNodes=Array.from(this.fragment.childNodes),this.It=n,this.ce=null!==s.ct?new Ne(s,this):null,this.bn=Se(this,e,n,this.fragment)}mount(t){for(let e=0;e<this.childNodes.length;e++)t.appendChild(this.childNodes[e])}Nn(t,e){for(let n=0;n<this.childNodes.length;n++)t.insertBefore(this.childNodes[n],e)}De(t,e){const n=e?.nextSibling??null;for(let e=0;e<this.childNodes.length;e++)t.insertBefore(this.childNodes[e],n)}unmount(){const t=this.childNodes[0]?.parentNode??null;if(null!==t)for(let e=0;e<this.childNodes.length;e++)t.removeChild(this.childNodes[e])}bn=[];init(){for(let t=0;t<this.bn.length;t++)this.bn[t].init()}ke(t){null==this.ce&&s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindContent.assignListIndex",an:this.#f},t:"./docs/error-codes.md#bind"}),this.ce.ke(t),this.init()}v(t){for(let e=0;e<this.bn.length;e++){const n=this.bn[e];t.C.has(n)||n.v(t)}}}function Ce(t,e,n,s){const o=new ve(t,e,n,s);return o.init(),o}function Te(t,e,n){if(e.enableShadowDom)if(null===e.In||function(t){try{const e=document.createElement(t);return"function"==typeof e.attachShadow&&(e.attachShadow({mode:"open"}),!0)}catch{return!1}}(e.In)){if(!t.shadowRoot){t.attachShadow({mode:"open"}).adoptedStyleSheets=[n]}}else s(`ComponentEngine: Shadow DOM not supported for builtin components that extend ${e.In}`);else{const e=function(t){let e=t;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}}(t.parentNode)||document,s=e.adoptedStyleSheets;s.includes(n)||(e.adoptedStyleSheets=[...s,n])}}class Pe{Sn=new Set;vn=new Set;Cn=new Map;Tn=new Map;Pn=new Map;Un=new Map;bn=new WeakSet;Bn(t){if(this.bn.has(t))return;const e=t.P.pattern,n=t.ln.u;this.Cn.has(e)&&s({code:"STATE-303",message:`Parent path "${e}" already has a child path`,context:{tt:e,Ln:this.Cn.get(e)},t:"./docs/error-codes.md#state"}),this.Tn.has(n)&&s({code:"STATE-303",message:`Child path "${n}" already has a parent path`,context:{$n:n,En:this.Tn.get(n)},t:"./docs/error-codes.md#state"}),this.Cn.set(e,n),this.Tn.set(n,e),this.Sn.add(e),this.vn.add(n),this.Pn.set(e,t),this.Un.set(n,t),this.bn.add(t)}Mn(t){return this.Cn.get(t)}Dn(t){return this.Tn.get(t)}An(t){const e=E(t).F.intersection(this.vn);0===e.size&&s({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{$n:t},t:"./docs/error-codes.md#state"});const n=Array.from(e),o=n[n.length-1],r=t.slice(o.length),i=this.Tn.get(o);return void 0===i&&s({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{$n:t,kn:o},t:"./docs/error-codes.md#state"}),i+r}Rn(t){const e=E(t).F.intersection(this.Sn);0===e.size&&s({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{tt:t},t:"./docs/error-codes.md#state"});const n=Array.from(e),o=n[n.length-1],r=t.slice(o.length),i=this.Cn.get(o);return void 0===i&&s({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{tt:t,kn:o},t:"./docs/error-codes.md#state"}),i+r}Fn(t){if(0===this.vn.size)return null;const e=t.F.intersection(this.vn);if(0===e.size)return null;{const t=Array.from(e);return t[t.length-1]}}bind(t,e){const n=t.Vn(e);for(const t of n??[])this.Bn(t)}}class Ue{Wn;It;constructor(t,e){this.Wn=e,this.It=t}Hn(t){Nt(this.It,null,(async(e,n)=>{for(const[e,s]of Object.entries(t)){const t=V(E(e),null);n.Pt(t,s)}}))}S(t){for(const e of t)try{const t=E(this.Wn.Rn(e.info.pattern)),n=e.ct,s=V(t,n);this.It.getPropertyValue(s);Nt(this.It,null,(async(e,s)=>{const o=V(t,n);e.Qt(o)}))}catch(t){}}get(t,e,n){if(e===Vt)return this.Hn.bind(this);if(e===Wt)return this.S.bind(this);if("string"==typeof e){const t=V(E(e),null);return this.It.getPropertyValue(t)}s(`Property "${String(e)}" is not supported in ComponentStateInput.`)}set(t,e,n,o){if("string"==typeof e){const t=V(E(e),null);return this.It.On(t,n),!0}s(`Property "${String(e)}" is not supported in ComponentStateInput.`)}}class Be{binding;constructor(t){this.binding=t}get(t){const e=this.binding.Fn(t.info);null===e&&s(`No child path found for path "${t.info.toString()}".`);const n=this.binding.Un.get(e);void 0===n&&s(`No binding found for child path "${e}".`);const o=V(E(this.binding.An(t.info.pattern)),t.ct??n.P.ct);return n.It.getPropertyValue(o)}set(t,e){const n=this.binding.Fn(t.info);null===n&&s(`No child path found for path "${t.info.toString()}".`);const o=this.binding.Un.get(n);void 0===o&&s(`No binding found for child path "${n}".`);const r=E(this.binding.An(t.info.pattern)),i=o.It,c=V(r,t.ct??o.P.ct);return Nt(i,null,(async(t,n)=>{n.Pt(c,e)})),!0}startsWith(t){return null!==this.binding.Fn(t)}wt(t){const e=this.binding.Fn(t.info);null===e&&s(`No child path found for path "${t.info.toString()}".`);const n=this.binding.Un.get(e);void 0===n&&s(`No binding found for child path "${e}".`);const o=V(E(this.binding.An(t.info.pattern)),t.ct);return n.It.wt(o)}}class Le{#K;#u=-1;#w;#z;#Z=new Set;constructor(t,e){this.#w=t,this.#z=e,this.#K=void 0}get value(){return this.#K?.constructor===WeakRef?this.#K.deref():this.#K}get version(){return this.#u}Pt(t,e){this.#K=function(t){return null==t||"object"!=typeof t}(t)?t:new WeakRef(t),this.#u=e}jt(t){const e=this.#w.jt(t);return null===e&&s({code:"CACHE-200",message:"Cache entry is null",context:{h:"CacheEntry.getCacheEntry",Et:t.info.pattern},t:"/docs/error-codes.md#cache"}),e}Zt(t,e=new Set){if(this.#Z.has(this.#z))return console.warn("Circular reference detected in cache entry dirty check:",Array.from(this.#Z).map((t=>t.key))),!1;this.#Z.add(this.#z);try{if(e.has(this.#z))return!1;if(e.add(this.#z),this.#u<0)return!0;const n=this.#z.dt();if(null!==n){const s=this.jt(n);if(this.version<s.version)return!0;if(s.Zt(t,e))return!0}const s=this.#w.Nt.zn.get(this.#z.info.pattern);if(void 0===s||0===s.size)return!1;for(const n of s){const s=E(n);if(0===s.nt){const n=V(s,null),o=this.jt(n);if(this.version<o.version)return!0;if(o.Zt(t,e))return!0}else{const n=s.Z,o=(r,i,c)=>{const d=t.wt(r)||[];if(i+1<n.length)for(let t=0;t<d.length;t++){const e=V(c,d[t]);if(o(e,i+1,n[i+1]))return!0}else for(let n=0;n<d.length;n++){const o=V(s,d[n]),r=this.jt(o);if(this.version<r.version)return!0;if(r.Zt(t,e))return!0}return!1},r=V(s.Z[0],null);if(o(r,0,s.Z[1]||null))return!0}}return!1}finally{this.#Z.delete(this.#z)}}}function $e(t,e){return new Le(t,e)}class Ee{type="autonomous";config;qn;styleSheet;jn;state;hn;un;#E=null;get fn(){return null===this.#E&&s({code:"BIND-201",message:"bindContent not initialized yet",context:{h:"ComponentEngine.bindContent.get",_n:this.ie.constructor.id},t:"./docs/error-codes.md#bind"}),this.#E}Gn=HTMLElement;ie;Ie=new WeakMap;Ke=new WeakMap;Kn=new Set;#J=Promise.withResolvers();#Q=null;#X=function(){return new Pe}();Zn;$t;#Y=null;#tt=null;#et=!1;#nt=1;constructor(t,e){this.config=t,this.config.In&&(this.type="builtin");const n=e.constructor;var s;this.qn=n.qn,this.styleSheet=n.styleSheet,this.jn=n.jn,this.state=new this.jn,this.hn=n.hn,this.un=n.un,this.ie=e,this.Zn=function(t,e){const n=new Ue(t,e);return new Proxy({},n)}(this,this.#X),this.$t=(s=this.#X,new Be(s))}get Nt(){return this.ie.constructor.Nt}Jn(){for(const t in this.state)B.has(t)||this.Nt.Qn.has(t)||(this.Nt.Qn.add(t),gt(this.Nt.xe,t));const t=this.ie.constructor,e=V(E(""),null);this.#E=Ce(null,t.id,this,e)}get Xn(){return this.#J}async connectedCallback(){if(await(this.#Q?.promise),await(this.ie.Yn?.Xn.promise),this.ie.dataset.state)try{const t=JSON.parse(this.ie.dataset.state);this.Zn[Vt](t)}catch(t){s({code:"STATE-202",message:"Failed to parse state from dataset",context:{h:"ComponentEngine.connectedCallback",ts:this.ie.dataset.state},t:"./docs/error-codes.md#state",i:t})}const t=this.ie.Yn;if(t&&(t.es(this.ie),this.#X.bind(t,this.ie)),this.config.ns)Te(this.ie,this.config,this.styleSheet);else{this.#tt=this.ie.parentNode,this.#Y=document.createComment("Structive block placeholder");try{this.#et=!0,this.ie.replaceWith(this.#Y)}finally{this.#et=!1}}if(this.config.ns)this.fn.mount(this.ie.shadowRoot??this.ie);else{const t=this.#tt??s({code:"BIND-201",message:"Block parent node is not set",context:{h:"ComponentEngine.connectedCallback",mode:"block"},t:"./docs/error-codes.md#bind"});this.fn.De(t,this.#Y)}await Nt(this,null,(async(t,e)=>{for(const e of this.Nt.Qn){const n=E(e);if(1!==n.A.length)continue;if(this.Nt.ss.has(e))continue;const s=V(n,null);t.Qt(s)}await e.connectedCallback()})),queueMicrotask((()=>{this.#J.resolve()}))}async disconnectedCallback(){this.#Q=Promise.withResolvers();try{if(this.#et)return;await Nt(this,null,(async(t,e)=>{await e.disconnectedCallback()})),this.ie.Yn?.rs(this.ie),this.config.ns||(this.#Y?.remove(),this.#Y=null,this.#tt=null)}finally{this.#Q.resolve()}}#st={};#ot=new WeakMap;cs(t){return{list:null,kt:null,bn:[],ds:null,ls:$e(this,t)}}hs(t){if(null===t.ct){let e=this.#st[t.info.id];return void 0===e&&(e=this.cs(t),this.#st[t.info.id]=e),e}{let e=this.#ot.get(t.ct);void 0===e&&(e={},this.#ot.set(t.ct,e));let n=e[t.info.id];return void 0===n&&(n=this.cs(t),e[t.info.id]=n),n}}Ze(t,e){this.hs(t).bn.push(e)}ee(t,e,n){const s=this.hs(t);s.list=e,s.kt=n,s.ds=e?Array.from(e):null}us(t,e){this.hs(t).ls=e}te(t){return this.hs(t).bn}wt(t){if(this.$t.startsWith(t.info))return this.$t.wt(t);return this.hs(t).kt}Yt(t){const e=this.hs(t);return[e.list,e.kt,e.ds]}jt(t){return this.hs(t).ls}fs(t){return null!=this.hs(t).ls}getPropertyValue(t){return bt(this).Ue().Ut(t)}On(t,e){Nt(this,null,(async(n,s)=>{s.Pt(t,e)}))}es(t){this.Kn.add(t)}rs(t){this.Kn.delete(t)}Be(){return this.#nt++}}const Me=/\{\{([^\}]+)\}\}/g,De=new Set(["if","for","endif","endfor","elseif","else"]);const Ae="http://www.w3.org/2000/svg";function ke(t,e,n=t){if(e.parentNode?.replaceChild(document.createComment(`${U}${t}`),e),e.namespaceURI===Ae){const t=document.createElement("template"),n=Array.from(e.childNodes);for(let e=0;e<n.length;e++){const s=n[e];t.content.appendChild(s)}const s=e.getAttribute(T);t.setAttribute(T,s??""),e=t}return e.content.querySelectorAll("template").forEach((t=>{ke(f(),t,n)})),we(t,e,n),t}function Re(t,e){const n=document.createElement("template");n.dataset.id=t.toString(),n.innerHTML=function(t){const e=[];return t.replaceAll(Me,((t,n)=>{n=n.trim();const[o]=n.split(":");if(!De.has(o))return`\x3c!--${P}${n}--\x3e`;const r=n.slice(o.length+1).trim(),i={type:o,ps:n,gs:r};if("if"===o||"for"===o)return e.push(i),`<template data-bind="${n}">`;if("endif"===o){const t=[];for(;;){const o=e.pop()??s({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",ps:n,ws:e.length},t:"./docs/error-codes.md#tmp"});if("if"===o.type){t.push("</template>");break}"elseif"===o.type?t.push("</template>"):s({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",ys:o.type,ps:n},t:"./docs/error-codes.md#tmp"})}return t.join("")}if("endfor"===o){const t=e.pop()??s({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",ps:n,ws:e.length},t:"./docs/error-codes.md#tmp"});if("for"===t.type)return"</template>";s({code:"TMP-102",message:"Endfor without for",context:{h:"replaceMustacheWithTemplateTag",ys:t.type,ps:n},t:"./docs/error-codes.md#tmp"})}else if("elseif"===o){const t=e.at(-1)??s({code:"TMP-102",message:"Elseif without if",context:{h:"replaceMustacheWithTemplateTag",ps:n,ws:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type||"elseif"===t.type)return e.push(i),`</template><template data-bind="if:${t.gs}|not"><template data-bind="if:${r}">`;s({code:"TMP-102",message:"Elseif without if",context:{h:"replaceMustacheWithTemplateTag",ys:t.type,ps:n},t:"./docs/error-codes.md#tmp"})}else if("else"===o){const t=e.at(-1)??s({code:"TMP-102",message:"Else without if",context:{h:"replaceMustacheWithTemplateTag",ps:n,ws:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type)return`</template><template data-bind="if:${t.gs}|not">`;s({code:"TMP-102",message:"Else without if",context:{h:"replaceMustacheWithTemplateTag",ys:t.type,ps:n},t:"./docs/error-codes.md#tmp"})}else s({code:"TMP-102",message:"Unknown type",context:{h:"replaceMustacheWithTemplateTag",type:o,ps:n},t:"./docs/error-codes.md#tmp"})}))}(e),ke(t,n)}const Fe=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/,Ve=/^[a-zA-Z_$][0-9a-zA-Z_$]*(\.[a-zA-Z_$][0-9a-zA-Z_$]*|\.\*)*$/;function We(t,e){const n=new Set(t.R).intersection(e);let o=-1,r="";for(const t of n){const e=t.split(".");1!==e.length&&(e.length>o&&(o=e.length,r=t))}if(r.length>0){Ve.test(r)||s({code:"STATE-202",message:`Invalid path: ${r}`,context:{xs:r},t:"./docs/error-codes.md#state"});const e=E(r),n=[];let o=e.nt;for(let i=e.A.length;i<t.A.length;i++){const e=t.A[i];"*"===e?(n.push("[this.$"+(o+1)+"]"),o++):(Fe.test(e)||s({code:"STATE-202",message:`Invalid segment name: ${e}`,context:{bs:e,xs:r},t:"./docs/error-codes.md#state"}),n.push("."+e))}const i=n.join("");return{get:new Function("",`return this["${r}"]${i};`),set:new Function("value",`this["${r}"]${i} = value;`)}}{const e=[];let n=0;for(let o=0;o<t.A.length;o++){const r=t.A[o];"*"===r?(e.push("[this.$"+(n+1)+"]"),n++):(Fe.test(r)||s({code:"STATE-202",message:`Invalid segment name: ${r}`,context:{bs:r},t:"./docs/error-codes.md#state"}),e.push((e.length>0?".":"")+r))}const o=e.join("");return{get:new Function("",`return this.${o};`),set:new Function("value",`this.${o} = value;`)}}}class He{Qn=new Set;Gt=new Set;elements=new Set;ss=new Set;bt=new Set;vt=new Set;Ns=new Set;Is=new Map;Se=new Map;zn=new Map;xe=function(){return new ft("","",0)}();#f;#rt;constructor(t){this.#f=t.id,this.#rt=t.jn;const e=(t=>me[t]??[])(this.#f);for(const t of e){const e=E(t);this.Qn=this.Qn.union(e.F)}const n=(t=>fe[t]??[])(this.#f);this.Gt=this.Gt.union(n);for(const t of n){const e=t+".*";this.elements.add(e)}let s=this.#rt.prototype;for(;s&&s!==Object.prototype;){const t=Object.getOwnPropertyDescriptors(s);if(t)for(const[e,n]of Object.entries(t)){if(B.has(e))continue;if("function"==typeof n.value){this.ss.add(e);continue}const t=void 0!==n.get,s=void 0!==n.set,o=E(e);this.Qn=this.Qn.union(o.F),t&&this.bt.add(e),s&&this.vt.add(e)}s=Object.getPrototypeOf(s)}for(const t of this.Qn){if(this.bt.has(t))continue;if(this.vt.has(t))continue;const e=E(t);if(1===e.A.length)continue;const n=We(e,this.bt);Object.defineProperty(this.#rt.prototype,t,{get:n.get,set:n.set,enumerable:!0,configurable:!0}),this.Ns.add(t)}for(const t of this.Qn){gt(this.xe,t);const e=E(t);e.tt&&(this.Is.get(e.tt)?.add(t)??this.Is.set(e.tt,new Set([t])))}}St(t,e){this.Se.get(e)?.add(t)??this.Se.set(e,new Set([t])),this.zn.get(t)?.add(e)??this.zn.set(t,new Set([e]))}}function Oe(t){const n=function(t){const n=e();return{ns:void 0===t.ns||t.ns,enableShadowDom:t.enableShadowDom??n.enableShadowDom,In:t.In??null}}(t.jn.Ss??{}),o=f(),{vs:r,Cs:i,jn:c}=t,d=Object.assign({},h),a=Object.assign({},l);c.Ts=!0,Re(o,r),g(o,i),function(t,e){m[t]=e}(o,c);const u=function(t){return t?document.createElement(t).constructor:HTMLElement}(n.In),w=n.In;return class extends u{#w;constructor(){super(),this.#w=function(t,e){return new Ee(t,e)}(n,this),this.#w.Jn()}connectedCallback(){this.#w.connectedCallback()}disconnectedCallback(){this.#w.disconnectedCallback()}#it;get Yn(){var t;return void 0===this.#it&&(this.#it=(t=this,Ht.get(t)??null)),this.#it}get state(){return this.#w.Zn}get Ps(){return this.#w.jn.Ts??!1}get Xn(){return this.#w.Xn}Vn(t){return this.#w.Ke.get(t)??null}es(t){this.#w.es(t)}rs(t){this.#w.rs(t)}static define(t){w?customElements.define(t,this,{In:w}):customElements.define(t,this)}static get id(){return o}static#ct=r;static get vs(){return this.#ct}static set vs(t){this.#ct=t,Re(this.id,t),this.#dt=null,this.#at=null}static#lt=i;static get Cs(){return this.#lt}static set Cs(t){this.#lt=t,g(this.id,t),this.#ht=null}static#dt=null;static get qn(){return this.#dt||(this.#dt=ye(this.id)),this.#dt}static#ht=null;static get styleSheet(){return this.#ht||(this.#ht=function(t){return p[t]??s({code:"CSS-001",message:`Stylesheet not found: ${t}`,context:{h:"registerStyleSheet.getStyleSheetById",Us:t},t:"./docs/error-codes.md#css"})}(this.id)),this.#ht}static#rt=null;static get jn(){return this.#rt||(this.#rt=function(t){return m[t]??s({code:"STATE-101",message:`StateClass not found: ${t}`,context:{h:"registerStateClass.getStateClassById",Bs:t},t:"./docs/error-codes.md#state"})}(this.id)),this.#rt}static#ut=d;static get hn(){return this.#ut}static#ft=a;static get un(){return this.#ft}static#at=null;static get Nt(){return this.#at||(this.#at=new He(this)),this.#at}}}function ze(t){return t.replaceAll(/<!--\{\{([^\}]+)\}\}-->/g,((t,e)=>`{{${e}}}`))}async function qe(t){const e=import.meta.resolve?import.meta.resolve(t):t,n=await fetch(e);return async function(t){const e=document.createElement("template");e.innerHTML=function(t){return t.replaceAll(/\{\{([^\}]+)\}\}/g,((t,e)=>`\x3c!--{{${e}}}--\x3e`))}(t);const n=e.content.querySelector("template");n?.remove();const s=e.content.querySelector("script[type=module]");let o={};if(s){const t=btoa(String.fromCodePoint(...(new TextEncoder).encode(s.text)));o=await import("data:application/javascript;base64,"+t)}s?.remove();const r=e.content.querySelector("style");r?.remove();const i=o.default??class{};return{text:t,vs:ze(n?.innerHTML??"").trim(),Cs:r?.textContent??"",jn:i}}(await n.text())}function je(t,e){e.define(t)}const _e="@routes/",Ge="@components/",Ke="#lazy",Ze={};async function Je(){const t=function(){const t={};return document.querySelectorAll("script[type='importmap']").forEach((e=>{const n=JSON.parse(e.innerHTML);n.imports&&(t.imports=Object.assign(t.imports||{},n.imports))})),t}();if(t.imports){const e=new Map;for(const[n,s]of Object.entries(t.imports)){let t,s;if(n.startsWith(_e)){s=n.endsWith(Ke);const e=n.slice(7,s?-5:void 0);t="routes"+e.replace(/:[^\s/]+/g,"").replace(/\//g,"-"),nn(t,"/root"===e?"/":e)}n.startsWith(Ge)&&(s=n.endsWith(Ke),t=n.slice(12,s?-5:void 0)),t&&(s?Ze[t]=n:e.set(t,n))}for(const[t,n]of e.entries()){je(t,Oe(await qe(n)))}}}function Qe(t){const e=Ze[t];if(e)delete Ze[t],queueMicrotask((async()=>{const n=Oe(await qe(e));je(t,n)}));else{const e={code:"IMP-201",message:`Alias not found for tagName: ${t}`,context:{h:"loadFromImportMap.loadLazyLoadComponent",tagName:t},t:"./docs/error-codes.md#imp",o:"warn"};console.warn(e.message,{code:e.code,context:e.context,t:e.t,o:e.o})}}const Xe="routes:",Ye=[];let tn=null;class en extends HTMLElement{Ls=window.location.pathname;$s=window.location.pathname.split("/").pop()||"";Es=document.querySelector("base")?.href.replace(window.location.origin,"")||"/";Ms;constructor(){super(),this.Ms=this.Ds.bind(this)}connectedCallback(){tn=this,this.innerHTML='<slot name="content"></slot>',window.addEventListener("popstate",this.Ms),window.dispatchEvent(new Event("popstate"))}disconnectedCallback(){window.removeEventListener("popstate",this.Ms),tn=null}Ds(t){t.preventDefault(),this.Ne()}navigate(t){const e="/"===t[0]?this.Es+t.slice(1):t;history.pushState({},"",e),this.Ne()}Ne(){Array.from(this.childNodes).filter((t=>"content"===t.getAttribute?.("slot"))).forEach((t=>this.removeChild(t)));const t=window.location.pathname.split("/");t.at(-1)===this.$s&&(t[t.length-1]="");const e=t.join("/").replace(this.Es,""),n="/"!==e[0]?"/"+e:e;let s,o={};for(const[t,e]of Ye){const r=new RegExp("^"+t.replace(/:[^\s/]+/g,"([^/]+)")+"$");if(r.test(n)){s=e;const i=n.match(r);if(i){(t.match(/:[^\s/]+/g)||[]).forEach(((t,e)=>{o[t.substring(1)]=i[e+1]}))}break}}if(s){const t=document.createElement(s);t.setAttribute("data-state",JSON.stringify(o)),t.setAttribute("slot","content"),this.appendChild(t),function(t){return Ze.hasOwnProperty(t)}(s)&&Qe(s)}else{const t=document.createElement("h1");t.setAttribute("slot","content"),t.textContent="404 Not Found",this.appendChild(t)}}}function nn(t,e){e.startsWith(Xe)&&(e=e.substring(Xe.length)),Ye.push([e,t])}function sn(){return tn}const on="router",rn=`<slot name="${on}"></slot>`;class cn extends HTMLElement{constructor(){super(),n.enableShadowDom&&this.attachShadow({mode:"open"})}async connectedCallback(){await this.As(),this.Ne()}get root(){return this.shadowRoot??this}async As(){if(n.layoutPath){const t=await fetch(n.layoutPath);if(t.ok){const e=await t.text(),n=document.createElement("template");n.innerHTML=e;const s=n.content.querySelector("template"),o=n.content.querySelector("style");if(this.root.appendChild(s?.content??document.createDocumentFragment()),o){const t=this.shadowRoot??document,e=t.adoptedStyleSheets;e.includes(o)||(t.adoptedStyleSheets=[...e,o])}}else s({code:"TMP-101",message:`Failed to load layout from ${n.layoutPath}`,context:{layoutPath:n.layoutPath},t:"/docs/error-codes.md#tmp",o:"error"})}else this.root.innerHTML=rn}Ne(){if(n.enableRouter){const t=document.createElement(n.routerTagName);t.setAttribute("slot",on),this.root.appendChild(t)}}}const dn=n;let an=!1;async function ln(t){await async function(t){for(const[e,s]of Object.entries(t)){let t=null;if(n.enableRouter){const t=s.startsWith("@routes")?s.slice(7):s;nn(e,"/root"===t?"/":t)}t=await qe(s),je(e,Oe(t))}}(t),dn.autoInit&&await hn()}async function hn(){an||(await async function(){if(n.autoLoadFromImportMap&&await Je(),n.enableRouter&&customElements.define(n.routerTagName,en),n.enableMainWrapper&&(customElements.define(n.mainTagName,cn),n.autoInsertMainWrapper)){const t=document.createElement(n.mainTagName);document.body.appendChild(t)}}(),an=!0)}export{hn as bootstrapStructive,dn as config,ln as defineComponents};
//# sourceMappingURL=structive.min.js.map
