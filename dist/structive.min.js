const t={debug:!1,locale:"en-US",enableShadowDom:!0,enableMainWrapper:!0,enableRouter:!0,autoInsertMainWrapper:!1,autoInit:!0,mainTagName:"app-main",routerTagName:"view-router",layoutPath:"",autoLoadFromImportMap:!1,optimizeList:!0,optimizeListElements:!0,optimizeAccessor:!0};function e(){return t}const n=e();function s(t){if("string"==typeof t)throw new Error(t);const{message:e,code:n,context:s,hint:o,t:r,o:i,i:c}=t,d=new Error(e);throw d.code=n,s&&(d.context=s),o&&(d.hint=o),r&&(d.t=r),i&&(d.o=i),c&&(d.i=c),d}function o(t){s({code:"FLT-202",message:`${t} requires at least one option`,context:{l:t},t:"./docs/error-codes.md#flt"})}function r(t){s({code:"FLT-202",message:`${t} requires a number as option`,context:{l:t},t:"./docs/error-codes.md#flt"})}function i(t){s({code:"FLT-202",message:`${t} requires a number value`,context:{l:t},t:"./docs/error-codes.md#flt"})}function c(t){s({code:"FLT-202",message:`${t} requires a date value`,context:{l:t},t:"./docs/error-codes.md#flt"})}const d=e(),l={eq:t=>{const e=t?.[0]??o("eq");return t=>{if("number"==typeof t){const n=Number(e);return isNaN(n)&&r("eq"),t===n}return t===e}},ne:t=>{const e=t?.[0]??o("ne");return t=>{if("number"==typeof t){const n=Number(e);return isNaN(n)&&r("eq"),t!==n}return t!==e}},not:t=>t=>{var e;return"boolean"!=typeof t&&s({code:"FLT-202",message:`${e="not"} requires a boolean value`,context:{l:e},t:"./docs/error-codes.md#flt"}),!t},lt:t=>{const e=t?.[0]??o("lt"),n=Number(e);return isNaN(n)&&r("lt"),t=>("number"!=typeof t&&i("lt"),t<n)},le:t=>{const e=t?.[0]??o("le"),n=Number(e);return isNaN(n)&&r("le"),t=>("number"!=typeof t&&i("le"),t<=n)},gt:t=>{const e=t?.[0]??o("gt"),n=Number(e);return isNaN(n)&&r("gt"),t=>("number"!=typeof t&&i("gt"),t>n)},ge:t=>{const e=t?.[0]??o("ge"),n=Number(e);return isNaN(n)&&r("ge"),t=>("number"!=typeof t&&i("ge"),t>=n)},inc:t=>{const e=t?.[0]??o("inc"),n=Number(e);return isNaN(n)&&r("inc"),t=>("number"!=typeof t&&i("inc"),t+n)},dec:t=>{const e=t?.[0]??o("dec"),n=Number(e);return isNaN(n)&&r("dec"),t=>("number"!=typeof t&&i("dec"),t-n)},mul:t=>{const e=t?.[0]??o("mul"),n=Number(e);return isNaN(n)&&r("mul"),t=>("number"!=typeof t&&i("mul"),t*n)},div:t=>{const e=t?.[0]??o("div"),n=Number(e);return isNaN(n)&&r("div"),t=>("number"!=typeof t&&i("div"),t/n)},fix:t=>{const e=Number(t?.[0]??0);return isNaN(e)&&r("div"),t=>("number"!=typeof t&&i("div"),t.toFixed(e))},locale:t=>{const e=t?.[0]??d.locale;return t=>("number"!=typeof t&&i("locale"),t.toLocaleString(e))},uc:t=>t=>t.toString().toUpperCase(),lc:t=>t=>t.toString().toLowerCase(),cap:t=>t=>{const e=t.toString();return 0===e.length?e:1===e.length?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1)},trim:t=>t=>t.toString().trim(),slice:t=>{const e=t?.[0]??o("slice"),n=Number(e);return isNaN(n)&&r("slice"),t=>t.toString().slice(n)},substr:t=>{const e=t?.[0]??o("substr"),n=Number(e);isNaN(n)&&r("substr");const s=t?.[1]??o("substr"),i=Number(s);return isNaN(i)&&r("substr"),t=>t.toString().substr(n,i)},pad:t=>{const e=t?.[0]??o("pad"),n=Number(e);isNaN(n)&&r("pad");const s=t?.[1]??"0";return t=>t.toString().padStart(n,s)},rep:t=>{const e=t?.[0]??o("rep"),n=Number(e);return isNaN(n)&&r("rep"),t=>t.toString().repeat(n)},rev:t=>t=>t.toString().split("").reverse().join(""),int:t=>t=>parseInt(t,10),float:t=>t=>parseFloat(t),round:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&r("round"),t=>("number"!=typeof t&&i("round"),Math.round(t*n)/n)},floor:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&r("floor"),t=>("number"!=typeof t&&i("floor"),Math.floor(t*n)/n)},ceil:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&r("ceil"),t=>("number"!=typeof t&&i("ceil"),Math.ceil(t*n)/n)},percent:t=>{const e=Number(t?.[0]??0);return isNaN(e)&&r("percent"),t=>("number"!=typeof t&&i("percent"),t.toFixed(e)+"%")},date:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("date"),t.toLocaleDateString(e))},time:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("time"),t.toLocaleTimeString(e))},datetime:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("datetime"),t.toLocaleString(e))},ymd:t=>{const e=t?.[0]??"-";return t=>{t instanceof Date||c("ymd");const n=t.getFullYear().toString(),s=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${n}${e}${s}${e}${o}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const e=t?.[0]??o("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?e:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},a=l,u=l;let h=0;function f(){return++h}const m={};const p={};function g(t,e){const n=new CSSStyleSheet;n.replaceSync(e),function(t,e){p[t]=e}(t,n)}function w(t,e){let n=t;if(0===e.length)return n;for(let t=0;t<e.length&&(n=n?.childNodes[e[t]]??null,null!==n);t++);return n}function x(t,e){const n=t[e.name];return n||s({code:"FLT-201",message:`Filter not found: ${e.name}`,context:{u:"createFilters.textToFilter",name:e.name},t:"./docs/error-codes.md#flt"}),n(e.options)}const y=new Map;function b(t,e){let n=y.get(e);if(void 0===n){n=[];for(let s=0;s<e.length;s++)n.push(x(t,e[s]));y.set(e,n)}return n}class N{#t;#e;#n;#s;#o;#r=[];get node(){return this.#e}get name(){return this.#n}get h(){return this.#n}get binding(){return this.#t}get m(){return this.#o}get filters(){return this.#s}get p(){return this.#r}constructor(t,e,n,s,o){this.#t=t,this.#e=e,this.#n=n,this.#s=s,this.#o=o}init(){}N(t){s({code:"BIND-301",message:"Not implemented",context:{u:"BindingNode.assignValue",name:this.name},t:"/docs/error-codes.md#bind"})}I(t,e){s({code:"BIND-301",message:"Not implemented",context:{u:"BindingNode.updateElements",name:this.name},t:"/docs/error-codes.md#bind"})}S(t){}v(t){if(t.T.has(this.binding))return;const e=this.binding.B.C(t.U,t.P);this.N(e),t.T.add(this.binding)}get $(){return this.node instanceof HTMLSelectElement}get value(){return null}get L(){return null}get M(){return!1}get D(){return!1}}class I extends N{#i;get h(){return this.#i}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,r]=this.name.split(".");this.#i=r}N(t){(null==t||Number.isNaN(t))&&(t="");this.node.setAttribute(this.h,t.toString())}}class S extends N{N(t){Array.isArray(t)||s({code:"BIND-201",message:"Value is not array",context:{u:"BindingNodeCheckbox.update",k:typeof t},t:"/docs/error-codes.md#bind",o:"error"});const e=this.node;e.checked=t.map((t=>t.toString())).includes(e.value)}}class v extends N{N(t){Array.isArray(t)||s({code:"BIND-201",message:"Value is not array",context:{u:"BindingNodeClassList.update",k:typeof t},t:"/docs/error-codes.md#bind",o:"error"});this.node.className=t.join(" ")}}class T extends N{#i;get h(){return this.#i}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,r]=this.name.split(".");this.#i=r}N(t){"boolean"!=typeof t&&s({code:"BIND-201",message:"Value is not boolean",context:{u:"BindingNodeClassName.update",k:typeof t},t:"/docs/error-codes.md#bind",o:"error"});const e=this.node;t?e.classList.add(this.h):e.classList.remove(this.h)}}const C="data-bind",B="@@:",U="@@|",P=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","watch","unwatch","eval","arguments","let","var","const","class","function","null","true","false","new","return"]),$={};class L{static id=0;id=++L.id;A=this.id.toString();pattern;R;F;V;W;H;O;q;j;_;G;K;Z;J;X;Y;tt;et;nt;st;ot;children={};constructor(t){const e=e=>t===e?this:M(e),n=t.split("."),s=[],o=[],r=[],i={},c=[],d=[],l=[];let a="",u="",h=0;for(let t=0;t<n.length;t++)a+=n[t],"*"===n[t]&&(r.push(a),i[a]=h,c.push(e(a)),d.push(u),l.push(e(u)),h++),s.push(a),o.push(e(a)),u=a,a+=".";const f=r.length>0?r[r.length-1]:null,m=s.length>1?s[s.length-2]:null;this.pattern=t,this.R=n,this.F=n[n.length-1],this.V=s,this.W=new Set(s),this.H=o,this.O=new Set(o),this.q=r,this.j=new Set(r),this.G=i,this._=c,this.K=new Set(c),this.Z=d,this.J=new Set(d),this.X=l,this.Y=new Set(l),this.tt=f,this.et=f?e(f):null,this.nt=m,this.st=m?e(m):null,this.ot=h,this.st&&(this.st.children[this.F]=this)}}function M(t){P.has(t)&&s({code:"STATE-202",message:`Pattern is reserved word: ${t}`,context:{u:"getStructuredPathInfo",rt:t},t:"./docs/error-codes.md#state"});const e=$[t];return void 0!==e?e:$[t]=new L(t)}const E=new Map;class D{static id=0;id=++D.id;name;elements;it;ot;ct;dt;info;constructor(t){const e=t.split("."),n=e.slice(),s=[];let o=0,r=0,i="",c=0,d="none",l=[];for(let t=0;t<e.length;t++){const d=e[t];if("*"===d)n[t]="*",l.push(null),o++,c++;else{const e=Number(d);Number.isNaN(e)||(n[t]="*",l.push(e),r++,c++)}i+=d,s.push(i),i+=t<e.length-1?".":""}const a=M(n.join("."));(o>0||r>0)&&(d=o===c?"context":r===c?"all":"partial"),this.name=t,this.elements=e,this.it=s,this.ot=c,this.ct=d,this.dt=l,this.info=a}}function k(t){let e;return E.get(t)??(E.set(t,e=new D(t)),e)}class A{info;#c;get ut(){return null===this.#c?null:this.#c.deref()??s({code:"LIST-201",message:"listIndex is null",context:{A:this.info.A,key:this.key},t:"./docs/error-codes.md#list"})}key;constructor(t,e){this.info=t,this.#c=null!==e?new WeakRef(e):null,this.key=function(t,e){return null==e?t.A:t.A+"#"+e.A}(t,e)}}const R=new WeakMap,F={};function V(t,e){let n=null;if(null!==e){let s=R.get(e);return void 0===s&&(s={},R.set(e,s)),n=s[t.pattern],void 0===n&&(n=new A(t,e),s[t.pattern]=n),n}return n=F[t.pattern],void 0===n&&(n=new A(t,null),F[t.pattern]=n),n}function W(t,e){const n=t.ht;if(null==n)return null;if(null==n.info)return null;if(null==n.ut)return null;const s=n.info.G[e];return void 0!==s?n.ut.at(s):null}function H(t,e,n){switch(t.ct){case"none":return null;case"context":return W(n,t.info.tt??s({code:"STATE-202",message:"lastWildcardPath is null",context:{u:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#state"}))??s({code:"LIST-201",message:`ListIndex not found: ${t.info.pattern}`,context:{u:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#list"});case"all":let e=null;for(let o=0;o<t.info.ot;o++){const r=t.info.X[o]??s({code:"STATE-202",message:"wildcardParentPattern is null",context:{u:"getListIndex",pattern:t.info.pattern,index:o},t:"/docs/error-codes.md#state"}),i=V(r,e),c=n.wt.ft(i)??s({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{u:"getListIndex",xt:r.pattern},t:"/docs/error-codes.md#list"}),d=t.dt[o]??s({code:"STATE-202",message:"wildcardIndex is null",context:{u:"getListIndex",pattern:t.info.pattern,index:o},t:"/docs/error-codes.md#state"});e=c[d]??s({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{u:"getListIndex",xt:r.pattern,yt:d},t:"/docs/error-codes.md#list"})}return e;case"partial":s({code:"STATE-202",message:`Partial wildcard type is not supported yet: ${t.info.pattern}`,context:{u:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#state"})}}const O="state",z=Symbol.for(`${O}.GetByRef`),q=Symbol.for(`${O}.SetByRef`),j=Symbol.for(`${O}.SetCacheable`),_=Symbol.for(`${O}.ConnectedCallback`),G=Symbol.for(`${O}.DisconnectedCallback`);function K(t,e){if(t.bt>=0){const n=t.ht?.info??null;null!==n&&t.wt.It.Nt.has(n.pattern)&&!t.wt.It.St.has(n.pattern)&&n.pattern!==e.info.pattern&&t.wt.It.vt(n.pattern,e.info.pattern)}}function Z(t,e,n,o){if(K(o,e),o.wt.Tt.startsWith(e.info)&&0===o.wt.It.Nt.intersection(e.info.W).size)return o.wt.Tt.get(e);if(!(e.info.pattern in t)){const r=e.info.st??s({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{u:"getByRefWritable",Ct:e.info.pattern},t:"/docs/error-codes.md#state"}),i=Z(t,V(r,r.ot<e.info.ot?e.ut?.Bt??null:e.ut),n,o),c=e.info.F;if("*"===c){const t=e.ut?.index??s({code:"STATE-202",message:"propRef.listIndex?.index is undefined",context:{u:"getByRefWritable",Ct:e.info.pattern},t:"/docs/error-codes.md#state"});return Reflect.get(i,t)}return Reflect.get(i,c)}o.bt++,o.bt>=o.Ut.length&&o.Ut.push(null),o.Ut[o.bt]=o.ht=e;try{return Reflect.get(t,e.info.pattern,n)}finally{o.Ut[o.bt]=null,o.bt--,o.ht=o.bt>=0?o.Ut[o.bt]:null}}function J(t,e,n,o,r){try{if(r.wt.Tt.startsWith(e.info)&&0===r.wt.It.St.intersection(e.info.W).size)return r.wt.Tt.set(e,n);if(!(e.info.pattern in t)){const i=e.info.st??s({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{u:"setByRef",Ct:e.info.pattern},t:"/docs/error-codes.md#state"}),c=i.ot<e.info.ot?e.ut?.Bt??null:e.ut,d=Z(t,V(i,c),o,r),l=e.info.F;if("*"===l){const t=e.ut?.index??s({code:"STATE-202",message:"propRef.listIndex?.index is undefined",context:{u:"setByRef",Ct:e.info.pattern},t:"/docs/error-codes.md#state"});return Reflect.set(d,t,n)}return Reflect.set(d,l,n)}r.bt++,r.bt>=r.Ut.length&&r.Ut.push(null),r.Ut[r.bt]=r.ht=e;try{return Reflect.set(t,e.info.pattern,n,o)}finally{r.Ut[r.bt]=null,r.bt--,r.ht=r.bt>=0?r.Ut[r.bt]:null}}finally{r.$t.Pt(e)}}function Q(t,e,n,o){let r;K(o,e);try{if(null!==o.cache){if(r=o.cache.get(e),void 0!==r)return r;if(o.cache.has(e))return}try{if(o.wt.Tt.startsWith(e.info)&&0===o.wt.It.Nt.intersection(e.info.W).size)return r=o.wt.Tt.get(e);if(!(e.info.pattern in t)){const i=e.info.st??s({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{u:"getByRefReadonly",Ct:e.info.pattern},t:"/docs/error-codes.md#state"}),c=i.ot<e.info.ot?e.ut?.Bt??null:e.ut,d=Q(t,V(i,c),n,o),l=e.info.F;if("*"===l){const t=e.ut?.index??s({code:"STATE-202",message:"propRef.listIndex?.index is undefined",context:{u:"getByRefReadonly",Ct:e.info.pattern},t:"/docs/error-codes.md#state"});return r=Reflect.get(d,t)}return r=Reflect.get(d,l)}o.bt++,o.bt>=o.Ut.length&&o.Ut.push(null),o.Ut[o.bt]=o.ht=e;try{return r=Reflect.get(t,e.info.pattern,n)}finally{o.Ut[o.bt]=null,o.bt--,o.ht=o.bt>=0?o.Ut[o.bt]:null}}finally{null!==o.cache&&o.cache.set(e,r)}}finally{null!=o.Lt&&o.wt.It.Mt.has(e.info.pattern)&&o.Lt.Et(e,r,!0)}}function X(t,e,n,o){return(e,r,i)=>{const c=M(e),d=o.ht?.info??null;null!==d&&d.pattern!==c.pattern&&o.wt.It.Nt.has(d.pattern)&&!o.wt.It.St.has(d.pattern)&&o.wt.It.vt(d.pattern,c.pattern),c.X.length>r.length&&s({code:"STATE-202",message:`indexes length is insufficient: ${e}`,context:{path:e,Dt:c.X.length,kt:r.length},t:"/docs/error-codes.md#state",o:"error"});let l=null;for(let t=0;t<c.X.length;t++){const e=c.X[t],n=V(e,l),i=o.wt.ft(n)??s({code:"LIST-201",message:`ListIndexes not found: ${e.pattern}`,context:{pattern:e.pattern},t:"/docs/error-codes.md#list",o:"error"}),d=r[t];l=i[d]??s({code:"LIST-201",message:`ListIndex not found: ${e.pattern}`,context:{pattern:e.pattern,index:d},t:"/docs/error-codes.md#list",o:"error"})}const a=V(c,l),u=void 0!==i;if(j in n&&"cache"in o){if(!u)return Q(t,a,n,o);s({code:"STATE-202",message:`Cannot set value on a readonly proxy: ${e}`,context:{path:e},t:"/docs/error-codes.md#state",o:"error"})}else if(j in n||"cache"in o)s({code:"STATE-202",message:"Inconsistent proxy and handler types",context:{At:j in n,Rt:"cache"in o},t:"/docs/error-codes.md#state",o:"error"});else{if(!u)return Z(t,a,n,o);J(t,a,i,n,o)}}}function Y(t,e,n,o){return t=>{const e=o.ht?.info??s({code:"STATE-202",message:"Internal error: lastRefStack is null",context:{u:"trackDependency",path:t},t:"/docs/error-codes.md#state"});o.wt.It.Nt.has(e.pattern)&&e.pattern!==t&&o.wt.It.vt(e.pattern,t)}}const tt={};for(let t=0;t<32;t++)tt[`$${t+1}`]=t;function et(t,e,n,o){const r=tt[e];if(void 0!==r){const t=o.ht?.ut;return t?.Ft[r]??s({code:"LIST-201",message:`ListIndex not found: ${e.toString()}`,context:{Vt:String(e),Ft:t?.Ft??null,index:r},t:"/docs/error-codes.md#list",o:"error"})}if("string"==typeof e){if("$"===e[0])switch(e){case"$resolve":return X(t,0,n,o);case"$getAll":return function(t,e,n,o){const r=X(t,0,n,o);return(t,e)=>{const n=M(t),i=o.ht?.info??null;if(null!==i&&i.pattern!==n.pattern&&o.wt.It.Nt.has(i.pattern)&&!o.wt.It.St.has(i.pattern)&&o.wt.It.vt(i.pattern,n.pattern),void 0===e){for(let t=0;t<n._.length;t++){const r=n._[t]??s({code:"BIND-201",message:"wildcardPattern is null",context:{index:t,Wt:n.pattern},t:"/docs/error-codes.md#bind",o:"error"}),i=W(o,r.pattern);if(i){e=i.Ft;break}}void 0===e&&(e=[])}const c=(t,e,n,r,i,d,l)=>{const a=t[e]??null;if(null===a)return void l.push(d);const u=V(a,n),h=o.wt.ft(u)??s({code:"LIST-201",message:`ListIndex not found: ${a.pattern}`,context:{pattern:a.pattern},t:"/docs/error-codes.md#list",o:"error"}),f=r[i]??null;if(null===f)for(let n=0;n<h.length;n++){const s=h[n];c(t,e+1,s,r,i+1,d.concat(s.index),l)}else{const n=h[f]??s({code:"LIST-201",message:`ListIndex not found: ${a.pattern}`,context:{pattern:a.pattern,index:f},t:"/docs/error-codes.md#list",o:"error"});e+1<t.length?c(t,e+1,n,r,i+1,d.concat(n.index),l):l.push(d.concat(n.index))}},d=[];c(n.X,0,null,e,0,[],d);const l=[];for(let t=0;t<d.length;t++)l.push(r(n.pattern,d[t]));return l}}(t,0,n,o);case"$trackDependency":return Y(0,0,0,o);case"$navigate":return t=>Ye()?.navigate(t);case"$component":return o.wt.Ht}const r=k(e),i=H(r,0,o),c=V(r.info,i);return Z(t,c,n,o)}if("symbol"==typeof e)switch(e){case z:return e=>Z(t,e,n,o);case q:return(e,s)=>J(t,e,s,n,o);case _:return()=>async function(t,e,n){const s=Reflect.get(t,"$connectedCallback");"function"==typeof s&&await s.call(n)}(t,0,n);case G:return()=>async function(t,e,n){const s=Reflect.get(t,"$disconnectedCallback");"function"==typeof s&&await s.call(n)}(t,0,n);default:return Reflect.get(t,e,n)}}let nt=class{wt;Ut=Array(32).fill(null);bt=-1;ht=null;Ot=null;$t;#d=new Set([z,q,_,G]);#l=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e){this.wt=t,this.$t=e}get(t,e,n){return et(t,e,n,this)}set(t,e,n,s){return function(t,e,n,s,o){if("string"==typeof e){const r=k(e),i=H(r,0,o);return J(t,V(r.info,i),n,s,o)}return Reflect.set(t,e,n,s)}(t,e,n,s,this)}has(t,e){return Reflect.has(t,e)||this.#d.has(e)||this.#l.has(e)}};async function st(t,e,n,o,r){const i=new nt(t,e),c=new Proxy(n,i);return async function(t,e,n){t.Ot&&s({code:"STATE-301",message:"already in loop context",context:{u:"setLoopContext"},t:"/docs/error-codes.md#state"}),t.Ot=e;try{e?await async function(t,e,n){t.bt++,t.bt>=t.Ut.length&&t.Ut.push(null),t.Ut[t.bt]=t.ht=e;try{await n()}finally{t.Ut[t.bt]=null,t.bt--,t.ht=t.bt>=0?t.Ut[t.bt]:null}}(t,e.zt,n):await n()}finally{t.Ot=null}}(i,o,(async()=>{await r(c,i)}))}let ot=0,rt=0;class it{#a=null;#u=0;#h=0;#f;#m=++rt;#p=this.#m.toString();constructor(t,e){this.#a=t,this.#u=t?t.position+1:0,this.#h=e,this.#f=ot}get Bt(){return this.#a}get id(){return this.#m}get A(){return this.#p}get position(){return this.#u}get length(){return this.#u+1}get index(){return this.#h}set index(t){this.#h=t,this.#f=++ot,this.Ft[this.#u]=t}get version(){return this.#f}get qt(){return null!==this.#a&&(this.#a.qt||this.#a.version>this.#f)}#g;get Ft(){return null===this.#a?void 0===this.#g&&(this.#g=[this.#h]):(void 0===this.#g||this.qt)&&(this.#g=[...this.#a.Ft,this.#h],this.#f=ot),this.#g}#w;get jt(){return null===this.#a?void 0===this.#w&&(this.#w=[new WeakRef(this)]):void 0===this.#w&&(this.#w=[...this.#a.jt,new WeakRef(this)]),this.#w}get _t(){return`${this.position+1}`}at(t){return t>=0?this.jt[t]?.deref()||null:this.jt[this.jt.length+t]?.deref()||null}}function ct(t,e){return new it(t,e)}class dt{nt;Gt;name;Kt;level;constructor(t,e,n){this.nt=t,this.Gt=t?t+"."+e:e,this.name=e,this.level=n,this.Kt=new Map}find(t,e=0){if(e>=t.length)return null;const n=t[e],s=this.Kt.get(n);return s?e===t.length-1?s:s.find(t,e+1):null}appendChild(t){let e=this.Kt.get(t);if(!e){const n=this.nt?this.nt+"."+this.name:this.name;e=new dt(n,t,this.level+1),this.Kt.set(t,e)}return e}}const lt=new Map;function at(t,e){let n=lt.get(t);n||(n=new Map,lt.set(t,n));let s=n.get(e)??null;if(s)return s;const o=M(e);return s=t.find(o.R),n.set(e,s),s}function ut(t,e){const n=M(e);if(null===n.nt)return t.appendChild(e);{let e=at(t,n.nt);return null===e&&(e=ut(t,n.nt)),e.appendChild(n.F)}}function ht(t,e,n,o){const r=tt[e];if(void 0!==r){const t=o.ht?.ut;return t?.Ft[r]??s({code:"LIST-201",message:`ListIndex not found: ${e.toString()}`,context:{Vt:String(e),Ft:t?.Ft??null,index:r},t:"/docs/error-codes.md#list",o:"error"})}if("string"==typeof e){if("$"===e[0])switch(e){case"$resolve":return X(t,0,n,o);case"$getAll":return function(t,e,n,o){const r=X(t,0,n,o);return(t,e)=>{const i=M(t),c=o.ht?.info??null;if(null!==c&&c.pattern!==i.pattern&&o.wt.It.Nt.has(c.pattern)&&!o.wt.It.St.has(c.pattern)&&o.wt.It.vt(c.pattern,i.pattern),void 0===e){for(let t=0;t<i._.length;t++){const n=i._[t]??s({code:"BIND-201",message:"wildcardPattern is null",context:{index:t,Wt:i.pattern},t:"/docs/error-codes.md#bind",o:"error"}),r=W(o,n.pattern);if(r){e=r.Ft;break}}void 0===e&&(e=[])}const d=(t,e,r,i,c,l,a)=>{const u=t[e]??null;if(null===u)return void a.push(l);const h=V(u,r);let f=o.wt.ft(h);null===f&&(n[z](h),f=o.wt.ft(h),null===f&&s({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{pattern:u.pattern},t:"/docs/error-codes.md#list",o:"error"}));const m=i[c]??null;if(null===m)for(let n=0;n<f.length;n++){const s=f[n];d(t,e+1,s,i,c+1,l.concat(s.index),a)}else{const n=f[m]??s({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{pattern:u.pattern,index:m},t:"/docs/error-codes.md#list",o:"error"});e+1<t.length?d(t,e+1,n,i,c+1,l.concat(n.index),a):a.push(l.concat(n.index))}},l=[];d(i.X,0,null,e,0,[],l);const a=[];for(let t=0;t<l.length;t++)a.push(r(i.pattern,l[t]));return a}}(t,0,n,o);case"$trackDependency":return Y(0,0,0,o);case"$navigate":return t=>Ye()?.navigate(t);case"$component":return o.wt.Ht}const r=k(e),i=H(r,0,o),c=V(r.info,i);return Q(t,c,n,o)}if("symbol"==typeof e)switch(e){case z:return e=>Q(t,e,n,o);case j:return t=>function(t,e){t.cache=new Map;try{e()}finally{t.cache=null}}(o,t);default:return Reflect.get(t,e,n)}}class ft{wt;cache=null;Ut=Array(32).fill(null);bt=-1;ht=null;Ot=null;Lt=null;#d=new Set([z,j]);#l=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e){this.wt=t,this.Lt=e}get(t,e,n){return ht(t,e,n,this)}set(t,e,n,o){s({code:"STATE-202",message:`Cannot set property ${String(e)} of readonly state`,context:{u:"createReadonlyStateProxy.set",Vt:String(e)},t:"./docs/error-codes.md#state"})}has(t,e){return Reflect.has(t,e)||this.#d.has(e)||this.#l.has(e)}}function mt(t,e){return new ft(t,e)}function pt(t,e){return new Proxy(t,e)}class gt{#x=new Set;#y=new Set;#b;#N=null;#I=null;#S=new Map;#v=new Map;constructor(t){this.#b=t}get T(){return this.#x}get Zt(){return this.#y}get U(){return this.#N||s({code:"UPD-002",message:"ReadonlyState not initialized",t:"./docs/error-codes.md#upd"}),this.#N}get P(){return this.#I||s({code:"UPD-002",message:"ReadonlyHandler not initialized",t:"./docs/error-codes.md#upd"}),this.#I}get wt(){return this.#b||s({code:"UPD-001",message:"Engine not initialized",t:"./docs/error-codes.md#upd"}),this.#b}Jt(t){const e=new Set;for(let n=0;n<t.length;n++){const o=t[n];if(this.wt.It.Mt.has(o.info.pattern)){e.add(o);continue}if(!this.wt.It.elements.has(o.info.pattern))continue;this.#y.add(o),null===o.info.st&&s({code:"UPD-004",message:`ParentInfo is null for ref: ${o.key}`,context:{Qt:o.key,pattern:o.info.pattern},t:"./docs/error-codes.md#upd"});const r=V(o.info.st,o.ut?.at(-2)||null);if(e.has(r))continue;let i=this.#v.get(r);void 0===i&&(i=[],this.#v.set(r,i));const c=o.ut??s({code:"UPD-003",message:`ListIndex is null for ref: ${o.key}`,context:{Qt:o.key,pattern:o.info.pattern},t:"./docs/error-codes.md#upd"});i.push(c.index)}for(const[t,e]of this.#v){this.#S.set(t,null);try{const n=this.U[z](t),{Xt:o,jt:r}=this.wt.Yt(t);null!=o&&null!=r||s({code:"UPD-005",message:`OldListValue or OldListIndexes is null for ref: ${t.key}`,context:{Qt:t.key,pattern:t.info.pattern},t:"./docs/error-codes.md#upd"});const i={te:o,ee:n,se:r,oe:Array.from(r),re:new Set,ie:new Set};for(let n=0;n<e.length;n++){const o=e[n],r=i.ee?.[o],c=i.te?.indexOf(r)??-1;if(-1===c)i.ie?.add(i.oe[o]);else{const e=i.se?.[c]??s({code:"UPD-004",message:`ListIndex not found for value: ${r}`,context:{Qt:t.key,pattern:t.info.pattern},t:"./docs/error-codes.md#upd"});e.index=o,i.oe[o]=e,i.re?.add(e)}}this.#S.set(t,i),this.wt.ce(t,n??null,i.oe);const c=at(this.#b.It.de,t.info.pattern);null===c&&s({code:"PATH-101",message:`PathNode not found: ${t.info.pattern}`,context:{pattern:t.info.pattern},t:"./docs/error-codes.md#path"}),this.ae(t,c)}finally{}}}ue(t){this.#S.clear(),this.#v.clear(),this.#y.clear(),this.#x.clear(),this.#I=mt(this.#b,this);const e=this.#N=pt(this.#b.state,this.#I);try{e[j]((()=>{this.Jt(t);for(let e=0;e<t.length;e++){const n=t[e],o=at(this.#b.It.de,n.info.pattern);null===o&&s({code:"PATH-101",message:`PathNode not found: ${n.info.pattern}`,context:{pattern:n.info.pattern},t:"./docs/error-codes.md#path"}),this.ae(n,o)}}))}finally{this.#N=null}}Et(t,e=void 0,n=!1){let s=this.#S.get(t);if(void 0===s){this.#S.set(t,null);const{list:o,jt:r}=this.wt.Yt(t);let i=n?e:this.U[z](t);s=function(t,e,n,s){const o=n||[],r=e||[],i=s||[];if(o===r||0===o.length&&0===r.length)return{te:e,ee:n,se:i,oe:i};if(0===o.length)return{te:e,ee:n,se:i,oe:[],he:new Set(i)};if(0===r.length){const s=[];for(let e=0;e<o.length;e++)s.push(ct(t,e));return{te:e,ee:n,se:i,oe:s,fe:new Set(s)}}{const s=new Map;for(let t=0;t<r.length;t++)s.set(r[t],t);const c=new Set,d=new Set,l=new Set;let a=[],u=new Set,h=r.length===o.length;for(let e=0;e<o.length;e++){const n=o[e];if(h){if(n===r[e])continue;a=i.slice(0,e),u=new Set(a),h=!1}const d=s.get(n);if(void 0===d){const n=ct(t,e);c.add(n),a.push(n)}else{const t=i[d];t.index!==e&&(t.index=e,l.add(t)),u.add(t),a.push(t)}}if(h)return{te:e,ee:n,se:i,oe:i};for(let t=0;t<i.length;t++){const e=i[t];u.has(e)||d.add(e)}return{te:e,ee:n,se:i,oe:a,fe:c,he:d,re:l}}}(t.ut,o,i,r),this.#S.set(t,s),o!==i&&this.wt.ce(t,i,s.oe)}return s}ae(t,e){if(this.Zt.has(t))return;this.Zt.add(t);const n=this.#b.me(t);for(let t=0;t<n.length;t++){const e=n[t];this.T.has(e)||e.v(this)}for(const[n,o]of e.Kt){const e=M(o.Gt);if("*"===n){const n=this.Et(t);null===n&&s({code:"UPD-006",message:"ListDiff is null during renderItem",context:{Qt:t.key,pattern:t.info.pattern},t:"./docs/error-codes.md#upd"});for(const t of n.fe??[]){const n=V(e,t);this.ae(n,o)}}else{const n=V(e,t.ut);this.ae(n,o)}}const o=this.#b.It.pe.get(t.info.pattern);if(o)for(const t of o){const e=M(t),n=at(this.#b.It.de,e.pattern);if(null===n&&s({code:"PATH-101",message:`PathNode not found: ${e.pattern}`,context:{pattern:e.pattern},t:"./docs/error-codes.md#path"}),e.ot>0){const t=e.X,s=(o,r,i)=>{const c=this.#b.ft(o)||[];if(r+1<t.length)for(let e=0;e<c.length;e++){const n=V(i,c[e]);s(n,r+1,t[r+1])}else for(let t=0;t<c.length;t++){const s=V(e,c[t]);this.ae(s,n)}},o=V(e.X[0],null);s(o,0,e.X[1]||null)}else{const t=V(e,null);this.ae(t,n)}}}}class wt{queue=[];#T=!1;#C=!1;#b=null;Pt(t){this.queue.push(t),this.#C||(this.#C=!0,queueMicrotask((()=>{this.we()})))}async xe(t,e,n){try{this.#T=!0,this.#b=t,await st(t,this,t.state,e,(async(t,e)=>{await n(t,e)}))}finally{this.#T=!1}}we(){try{for(;this.queue.length>0;){const n=this.queue;this.queue=[],this.#b||s({code:"UPD-001",message:"Engine not initialized",t:"./docs/error-codes.md#upd"}),t=n,e=this.#b,new gt(e).ue(t)}}finally{this.#C=!1}var t,e}}async function xt(t,e,n){const s=new wt;await s.xe(t,e,(async(t,e)=>{await n(s,t,e)}))}class yt extends N{#i;constructor(t,e,n,s,o){super(t,e,n,s,o),this.#i=this.name.slice(2);e.addEventListener(this.h,(t=>this.ye(t)))}get h(){return this.#i}update(){}async ye(t){const e=this.binding.wt,n=this.binding.Ne.be,o=n?.Ie().map((t=>t.ut.index))??[],r=this.m;r.includes("preventDefault")&&t.preventDefault(),r.includes("stopPropagation")&&t.stopPropagation(),await xt(e,n,(async(e,n,r)=>{const i=this.binding.B.Se(n,r);"function"!=typeof i&&s({code:"BIND-201",message:`${this.name} is not a function`,context:{u:"BindingNodeEvent.handler",name:this.name,k:typeof i},t:"/docs/error-codes.md#bind",o:"error"}),await Reflect.apply(i,n,[t,...o])}))}v(t){}}const bt=(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new yt(s,o,t,i,n)};class Nt extends N{#m;get id(){return this.#m}get D(){return!0}constructor(t,e,n,o,r){super(t,e,n,o,r);const i=this.node.textContent?.slice(3)??s({code:"BIND-201",message:"Invalid node",context:{u:"BindingNodeBlock.id",textContent:this.node.textContent??null},t:"/docs/error-codes.md#bind",o:"error"});this.#m=Number(i)}}class It extends Nt{#B;#U;#P=[];#r;get p(){return this.#r}constructor(t,e,n,s,o){super(t,e,n,s,o);const r=V(M(""),null);this.#B=Ie(this.binding,this.id,this.binding.wt,r),this.#U=this.#r=[this.#B]}N(t){s({code:"BIND-201",message:"Not implemented",context:{u:"BindingNodeIf.assignValue",name:this.name},t:"/docs/error-codes.md#bind",o:"error"})}v(t){if(t.T.has(this.binding))return;const e=this.binding.B.C(t.U,t.P);"boolean"!=typeof e&&s({code:"BIND-201",message:"Value is not boolean",context:{u:"BindingNodeIf.update",valueType:typeof e},t:"/docs/error-codes.md#bind",o:"error"});const n=this.node.parentNode;null==n&&s({code:"BIND-201",message:"ParentNode is null",context:{u:"BindingNodeIf.update",nodeType:this.node.nodeType},t:"/docs/error-codes.md#bind",o:"error"}),e?(this.#B.ve(n,this.node),this.#B.v(t),this.#r=this.#U):(this.#B.unmount(),this.#r=this.#P),t.T.add(this.binding)}}const St=new Set;class vt extends Nt{#r=[];#$=new WeakMap;#L=[];#M=0;#E=void 0;get p(){return this.#r}get M(){return!0}init(){}Te(t){let e;if(this.#M>=0)e=this.#L[this.#M],this.#M--,e.Ce(t);else{const n=V(this.Be,t);e=Ie(this.binding,this.id,this.binding.wt,n)}return this.#$.set(t,e),e}Ue(t){t.unmount(),t.Ot?.Pe()}get $e(){return this.#M}set $e(t){this.#M=t}get Le(){return this.#L.length}set Le(t){t<0&&s({code:"BIND-202",message:"Length is negative",context:{u:"BindingNodeFor.setPoolLength",length:t},t:"./docs/error-codes.md#bind"}),this.#L.length=t}get Be(){if(void 0===this.#E){const t=this.binding.B.pattern+".*";this.#E=M(t)}return this.#E}N(t){s({code:"BIND-301",message:"Not implemented. Use update or applyChange",context:{u:"BindingNodeFor.assignValue"},t:"./docs/error-codes.md#bind"})}v(t){if(t.T.has(this.binding))return;let e=[];const n=new Set,o=t.Et(this.binding.B.zt);null===o&&s({code:"BIND-201",message:"ListDiff is null",context:{u:"BindingNodeFor.applyChange"},t:"./docs/error-codes.md#bind"});const r=this.node.parentNode??s({code:"BIND-201",message:"ParentNode is null",context:{u:"BindingNodeFor.applyChange"},t:"./docs/error-codes.md#bind"}),i=o.te?.length===o.he?.size&&(o.te?.length??0)>0;let c=!1;if(i){const t=Array.from(r.childNodes),e=this.#r.at(-1)??s({code:"BIND-201",message:"Last content is null",context:{u:"BindingNodeFor.applyChange"},t:"/docs/error-codes.md#bind"});let n=t[0];for(;n&&n.nodeType===Node.TEXT_NODE&&""===n.textContent?.trim();)n=n.nextSibling;let o=t.at(-1)??null;for(;o&&o.nodeType===Node.TEXT_NODE&&""===o.textContent?.trim();)o=o.previousSibling;n===this.node&&o===e.Me(r)&&(c=!0)}if(i&&c){r.textContent="",r.append(this.node);for(let t=0;t<this.#r.length;t++){const e=this.#r[t];e.Ot?.Pe()}this.#L.push(...this.#r)}else{if(o.he)for(const t of o.he){const e=this.#$.get(t);void 0===e&&s({code:"BIND-201",message:"BindContent not found",context:{u:"BindingNodeFor.applyChange",Ee:"removes"},t:"./docs/error-codes.md#bind"}),this.Ue(e),n.add(e)}this.#L.push(...n)}let d=null;const l=this.node;this.$e=this.Le-1;if(0===(o.fe?.size??0)&&0===(o.he?.size??0)&&((o.re?.size??0)>0||(o.ie?.size??0)>0)){if((o.re?.size??0)>0){const t=Array.from(this.#r),n=Array.from(o.re??[]);n.sort(((t,e)=>t.index-e.index));for(const e of n){const n=this.#$.get(e);void 0===n&&s({code:"BIND-201",message:"BindContent not found",context:{u:"BindingNodeFor.applyChange",Ee:"reorder"},t:"/docs/error-codes.md#bind"}),t[e.index]=n;const o=t[e.index-1]?.Me(r)??l;n.ve(r,o)}e=t}if((o.ie?.size??0)>0)for(const e of o.ie??[]){const n=this.#$.get(e);void 0===n&&s({code:"BIND-201",message:"BindContent not found",context:{u:"BindingNodeFor.applyChange",Ee:"overwrites"},t:"./docs/error-codes.md#bind"}),n.v(t)}}else{const n=r,i=l,c=o.fe??St;for(const r of o.oe){const o=d?.Me(n)??i;let l;c.has(r)?(l=this.Te(r),l.ve(n,o),l.v(t)):(l=this.#$.get(r),void 0===l&&s({code:"BIND-201",message:"BindContent not found",context:{u:"BindingNodeFor.applyChange",Ee:"reuse"},t:"./docs/error-codes.md#bind"}),o?.nextSibling!==l.De&&l.ve(n,o)),e.push(l),d=l}}this.Le=this.$e+1,this.#r=e}}const Tt=(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new vt(s,o,t,i,n)},Ct="textContent",Bt={radio:"checked",checkbox:"checked",button:"onclick"},Ut={},Pt={HTMLElement:t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLOptionElement?"value":t instanceof HTMLButtonElement||t instanceof HTMLAnchorElement?"onclick":t instanceof HTMLFormElement?"onsubmit":t instanceof HTMLInputElement?Bt[t.type]??"value":Ct,SVGElement:void 0,Text:t=>Ct,ke:void 0};const $t={value:"input",checked:"change",selected:"change"};class Lt extends N{get value(){return this.node[this.name]}get L(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}constructor(t,e,n,o,r){super(t,e,n,o,r);if(!(this.node instanceof HTMLElement))return;if(!((i=this.node)instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement))return;var i;const c=function(t,e){const n=t.constructor.name+"\t"+(t.type??"");return Ut[n]??(Ut[n]=Pt[e]?.(t))}(this.node,"HTMLElement");if(c!==this.name)return;r.length>1&&s({code:"BIND-201",message:"Has multiple decorators",context:{u:"BindingNodeProperty.constructor",name:this.name,Ae:r.length},t:"/docs/error-codes.md#bind",o:"error"});const d=(r[0]?.startsWith("on")?r[0]?.slice(2):r[0])??null??$t[this.name]??"readonly";if("readonly"===d||"ro"===d)return;const l=this.binding.wt;this.node.addEventListener(d,(async()=>{const e=this.binding.Ne.be,n=this.L;await xt(l,e,(async(e,s,o)=>{t.Re(s,o,n)}))}))}init(){}N(t){(null==t||Number.isNaN(t))&&(t=""),this.node[this.name]=t}}const Mt=(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Lt(s,o,t,i,n)};class Et extends N{N(t){(null==t||Number.isNaN(t))&&(t="");const e=this.node;e.checked=t.toString()===e.value.toString()}}class Dt extends N{#i;get h(){return this.#i}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,r]=this.name.split(".");this.#i=r}N(t){(null==t||Number.isNaN(t))&&(t="");this.node.style.setProperty(this.h,t.toString())}}const kt="component-state-input",At=Symbol.for(`${kt}.AssignState`),Rt=Symbol.for(`${kt}.NotifyRedraw`),Ft=new WeakMap;class Vt extends N{#i;get h(){return this.#i}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,r]=this.name.split(".");this.#i=r}init(){const t=this.binding.wt;var e,n;e=t.Ht,n=this.node,Ft.set(n,e);let s=t.Fe.get(this.node);void 0===s&&t.Fe.set(this.node,s=new Set),s.add(this.binding)}N(t){}S(t){const e=[],n=this.binding.B.info,s=this.binding.B.ut?.at(n.ot-1)??null,o=(s?.length??0)-1;for(const r of t)if(n.R.length>r.info.R.length){if(n.W.has(r.info.pattern)){const t=(r.ut?.length??0)-1;if(t>=0){if(null===s)continue;if(r.ut!==s?.at(t))continue}const o=V(n,s);e.push(o)}}else if(!r.info.W.has(n.pattern)){if(o>=0&&r.ut?.at(o)!==s)continue;e.push(r)}if(0===e.length)return;this.node.state[Rt](e)}}const Wt={0:{class:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new v(s,o,t,i,n)},checkbox:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new S(s,o,t,i,n)},radio:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Et(s,o,t,i,n)}},1:{if:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new It(s,o,t,i,n)}}},Ht={class:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new T(s,o,t,i,n)},attr:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new I(s,o,t,i,n)},style:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Dt(s,o,t,i,n)},state:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Vt(s,o,t,i,n)}};const Ot={};function zt(t,e,n,o){const r=t instanceof Comment,i=t instanceof Element,c=r+"\t"+i+"\t"+e,d=Ot[c]??(Ot[c]=function(t,e,n){const o=Wt[t?1:0][n];if(void 0!==o)return o;if(t&&"for"===n)return Tt;t&&s(`getBindingNodeCreator: unknown node property ${n}`);const r=n.split("."),i=Ht[r[0]];return void 0!==i?i:e&&n.startsWith("on")?bt:Mt}(r,i,e));return d(e,n,o)}class qt{#t;#D;#k;#s;#A=null;#R=null;#F=null;get pattern(){return this.#D}get info(){return this.#k}get ut(){return this.zt.ut}get zt(){return null!==this.#A?(null===this.#F&&(this.#F=V(this.#k,this.#A.ut)),this.#F):this.#R??s({code:"BIND-201",message:"ref is null",context:{pattern:this.#D},t:"/docs/error-codes.md#bind",o:"error"})}get filters(){return this.#s}get binding(){return this.#t}constructor(t,e,n){this.#t=t,this.#D=e,this.#k=M(e),this.#R=0===this.#k.ot?V(this.#k,null):null,this.#s=n}Se(t,e){let n;return n=q in t?Z(this.binding.wt.state,this.zt,t,e):Q(this.binding.wt.state,this.zt,t,e),n}C(t,e){let n;n=q in t?Z(this.binding.wt.state,this.zt,t,e):Q(this.binding.wt.state,this.zt,t,e);for(let t=0;t<this.#s.length;t++)n=this.#s[t](n);return n}init(){if(this.info.ot>0){const t=this.info.tt??s({code:"BIND-201",message:"Wildcard last parentPath is null",context:{u:"BindingState.init",pattern:this.#D},t:"/docs/error-codes.md#bind",o:"error"});this.#A=this.binding.Ne.be?.find(t)??s({code:"BIND-201",message:"LoopContext is null",context:{u:"BindingState.init",tt:t},t:"/docs/error-codes.md#bind",o:"error"}),this.#F=null}this.binding.wt.Ve(this.zt,this.binding)}N(t,e,n){J(this.binding.wt.state,this.zt,n,t,e)}}class jt{#t;#V;#s;#A=null;get pattern(){return s({code:"BIND-301",message:"Not implemented",context:{u:"BindingStateIndex.pattern"},t:"/docs/error-codes.md#bind"})}get info(){return s({code:"BIND-301",message:"Not implemented",context:{u:"BindingStateIndex.info"},t:"/docs/error-codes.md#bind"})}get ut(){return this.#A?.ut??s({code:"LIST-201",message:"listIndex is null",context:{u:"BindingStateIndex.listIndex"},t:"/docs/error-codes.md#list"})}get zt(){return this.#A?.zt??s({code:"STATE-202",message:"ref is null",context:{u:"BindingStateIndex.ref"},t:"/docs/error-codes.md#state"})}get filters(){return this.#s}get binding(){return this.#t}constructor(t,e,n){this.#t=t;const o=Number(e.slice(1));isNaN(o)&&s({code:"BIND-202",message:"Pattern is not a number",context:{u:"BindingStateIndex.constructor",pattern:e},t:"/docs/error-codes.md#bind"}),this.#V=o,this.#s=n}Se(t,e){return this.ut?.index??s({code:"LIST-201",message:"listIndex is null",context:{u:"BindingStateIndex.getValue"},t:"/docs/error-codes.md#list"})}C(t,e){let n=this.ut?.index??s({code:"LIST-201",message:"listIndex is null",context:{u:"BindingStateIndex.getFilteredValue"},t:"/docs/error-codes.md#list"});for(let t=0;t<this.#s.length;t++)n=this.#s[t](n);return n}init(){const t=(this.binding.Ne.be??s({code:"BIND-201",message:"LoopContext is null",context:{u:"BindingStateIndex.init"},t:"/docs/error-codes.md#bind"})).Ie();this.#A=t[this.#V-1]??s({code:"BIND-201",message:"Current loopContext is null",context:{u:"BindingStateIndex.init",We:this.#V},t:"/docs/error-codes.md#bind"});const e=this.binding.wt.He.get(this.ut);void 0===e?this.binding.wt.He.set(this.ut,new Set([this.binding])):e.add(this.binding)}N(t,e,n){s({code:"BIND-301",message:"Not implemented",context:{u:"BindingStateIndex.assignValue"},t:"/docs/error-codes.md#bind"})}}const _t=new RegExp(/^\$\d+$/);function Gt(t,e){return _t.test(t)?((t,e)=>(n,s)=>{const o=b(s,e);return new jt(n,t,o)})(t,e):((t,e)=>(n,s)=>{const o=b(s,e);return new qt(n,t,o)})(t,e)}const Kt={};function Zt(t,e=(t=>t.constructor.name+"\t"+(t instanceof Comment?t.textContent?.[2]??"":""))(t)){return Kt[e]??(Kt[e]=(t=>t instanceof Comment&&":"===t.textContent?.[2]?"Text":t instanceof HTMLElement?"HTMLElement":t instanceof Comment&&"|"===t.textContent?.[2]?"Template":t instanceof SVGElement?"SVGElement":s(`Unknown NodeType: ${t.nodeType}`))(t))}const Jt=t=>t.trim(),Qt=t=>t.length>0,Xt=new RegExp(/^#(.*)#$/),Yt=t=>{const e=Xt.exec(t);return e?decodeURIComponent(e[1]):t},te=t=>{const[e,...n]=t.split(",").map(Jt);return{name:e,options:n.map(Yt)}},ee=t=>{const[e,...n]=t.split("|").map(Jt);return{Oe:e,filters:n.map(te)}},ne=t=>t.split(";").map(Jt).filter(Qt).map((t=>(t=>{const[e,n=null]=t.split("@").map(Jt),s=n?n.split(",").map(Jt):[],[o,r]=e.split(":").map(Jt),{Oe:i,filters:c}=ee(o),{Oe:d,filters:l}=ee(r);return{ze:i,qe:d,je:c,_e:l,m:s}})(t))),se={};const oe=t=>{t.removeAttribute("data-bind")},re={HTMLElement:oe,SVGElement:oe,Text:void 0,ke:void 0};const ie={Text:t=>{const e=document.createTextNode("");return t.parentNode?.replaceChild(e,t),e},HTMLElement:void 0,ke:void 0,SVGElement:void 0};class ce{nodeType;Ge;Ke;Ze=new Map;constructor(t){this.nodeType=Zt(t);const e=function(t,e){switch(t){case"Text":return"textContent:"+(e.textContent?.slice(3).trim()??"");case"HTMLElement":case"SVGElement":return e.getAttribute(C)??"";case"Template":{const t=e.textContent?.slice(3).trim();return(pe(Number(t))??s(`Template not found: ${t}`)).getAttribute(C)??""}default:return""}}(this.nodeType,t);(function(t,e){re[e]?.(t)})(t=function(t,e){return ie[e]?.(t)??t}(t,this.nodeType),this.nodeType),this.Ge=function(t){let e=[];for(;null!==t.parentNode;)e=[Array.from(t.parentNode.childNodes).indexOf(t),...e],t=t.parentNode;return e}(t),this.Ke=function(t){return""===t.trim()?[]:se[t]??(se[t]=ne(t))}(e);for(let e=0;e<this.Ke.length;e++){const n=this.Ke[e],s={Je:zt(t,n.ze,n.je,n.m),Qe:Gt(n.qe,n._e)};this.Ze.set(n,s)}}}function de(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode:t=>t instanceof Element?t.hasAttribute(C)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:function(t){return t instanceof Comment&&(0===t.textContent?.indexOf(B)||0===t.textContent?.indexOf(U))}(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;n.nextNode();)e.push(n.currentNode);return e}const le={},ae={},ue={};function he(t){return de(t).map((t=>function(t){return new ce(t)}(t)))}const fe={};function me(t,e,n){var s;return s=e.content,Array.from(s.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE||(t.nodeValue??"").trim()||s.removeChild(t)})),function(t,e,n=t){const s=he(e),o=ue[n]??(ue[n]=new Set),r=ae[n]??(ae[n]=new Set);for(let t=0;t<s.length;t++){const e=s[t];for(let t=0;t<e.Ke.length;t++){const n=e.Ke[t];o.add(n.qe),"for"===n.ze&&r.add(n.qe)}}le[t]=s}(t,e.content,n),fe[t]=e,t}function pe(t){return fe[t]??s({code:"TMP-001",message:`Template not found: ${t}`,context:{u:"registerTemplate.getTemplateById",Xe:t},t:"./docs/error-codes.md#tmp"})}class ge{Ne;node;wt;Ye;B;version;constructor(t,e,n,s,o){this.Ne=t,this.node=e,this.wt=n,this.Ye=s(this,e,n.tn),this.B=o(this,n.en)}get p(){return this.Ye.p}init(){this.Ye.init(),this.B.init()}Re(t,e,n){return this.B.N(t,e,n)}S(t){this.Ye.S(t)}v(t){t.T.has(this)||this.Ye.v(t)}}function we(t,e,n,s,o){return new ge(t,e,n,s,o)}class xe{#F;#k;#B;constructor(t,e){this.#F=t,this.#k=t.info,this.#B=e}get zt(){return this.#F??s({code:"STATE-202",message:"ref is null",context:{u:"LoopContext.ref",path:this.#k.pattern},t:"/docs/error-codes.md#state"})}get path(){return this.zt.info.pattern}get info(){return this.zt.info}get ut(){return this.zt.ut??s({code:"LIST-201",message:"listIndex is required",context:{u:"LoopContext.listIndex",path:this.#k.pattern},t:"/docs/error-codes.md#list"})}Ce(t){this.#F=V(this.#k,t)}Pe(){this.#F=null}get nn(){return this.#B}#W;get sn(){if(void 0===this.#W){let t=this.nn;for(;null!==t;){if(null!==t.Ot&&t.Ot!==this){this.#W=t.Ot;break}t=t.rn?.Ne??null}void 0===this.#W&&(this.#W=null)}return this.#W}#H={};find(t){let e=this.#H[t];if(void 0===e){let n=this;for(;null!==n&&n.path!==t;)n=n.sn;e=this.#H[t]=n}return e}cn(t){let e=this;for(;null!==e;)t(e),e=e.sn}Ie(){const t=[];return this.cn((e=>{t.unshift(e)})),t}}function ye(t){const e=pe(t)??s({code:"BIND-101",message:`Template not found: ${t}`,context:{u:"BindContent.createContent",Xe:t},t:"./docs/error-codes.md#bind"}),n=document.importNode(e.content,!0);if(Object.keys(je).length>0){const t=n.querySelectorAll(":not(:defined)");for(let e=0;e<t.length;e++){Ge(t[e].tagName.toLowerCase())}}return n}function be(t,e,n,o){const r=(t=>le[t])(e)??s({code:"BIND-101",message:"Data-bind is not set",context:{u:"BindContent.createBindings",Xe:e},t:"./docs/error-codes.md#bind"}),i=[],c=[];for(let d=0;d<r.length;d++){const l=r[d],a=w(o,l.Ge)??s({code:"BIND-102",message:`Node not found: ${l.Ge}`,context:{u:"BindContent.createBindings",Xe:e,Ge:l.Ge},t:"./docs/error-codes.md#bind"});for(let o=0;o<l.Ke.length;o++){const r=l.Ke[o],d=l.Ze.get(r)??s({code:"BIND-103",message:`Creator not found: ${r}`,context:{u:"BindContent.createBindings",Xe:e,dn:r},t:"./docs/error-codes.md#bind"}),u=we(t,a,n,d.Je,d.Qe);u.Ye.D&&c.push(u),i.push(u)}}return[i,c]}class Ne{Ot;rn;childNodes;fragment;wt;ln=[];an=[];#m;get id(){return this.#m}get un(){return this.childNodes.length>0&&this.childNodes[0].parentNode!==this.fragment}get De(){return this.childNodes[0]??null}get hn(){return this.childNodes[this.childNodes.length-1]??null}get fn(){return this.an.length>0}Me(t){const e=this.ln[this.ln.length-1],n=this.hn;if(void 0!==e&&e.node===n&&e.p.length>0){const n=(e.p.at(-1)??s({code:"BIND-104",message:"Child bindContent not found",context:{u:"BindContent.getLastNode",Xe:this.#m},t:"./docs/error-codes.md#bind"})).Me(t);if(null!==n)return n}return t!==n?.parentNode?null:n}#O;get be(){if(void 0===this.#O){let t=this;for(;null!==t&&null===t.Ot;)t=t.rn?.Ne??null;this.#O=t?.Ot??null}return this.#O}constructor(t,e,n,s){this.rn=t,this.#m=e,this.fragment=ye(e),this.childNodes=Array.from(this.fragment.childNodes),this.wt=n,this.Ot=null!==s.ut?new xe(s,this):null;const[o,r]=be(this,e,n,this.fragment);this.ln=o,this.an=r}mount(t){for(let e=0;e<this.childNodes.length;e++)t.appendChild(this.childNodes[e])}mn(t,e){for(let n=0;n<this.childNodes.length;n++)t.insertBefore(this.childNodes[n],e)}ve(t,e){const n=e?.nextSibling??null;for(let e=0;e<this.childNodes.length;e++)t.insertBefore(this.childNodes[e],n)}unmount(){const t=this.childNodes[0]?.parentNode??null;if(null!==t)for(let e=0;e<this.childNodes.length;e++)t.removeChild(this.childNodes[e])}init(){for(let t=0;t<this.ln.length;t++)this.ln[t].init()}Ce(t){null==this.Ot&&s({code:"BIND-201",message:"LoopContext is null",context:{u:"BindContent.assignListIndex",Xe:this.#m},t:"./docs/error-codes.md#bind"}),this.Ot.Ce(t),this.init()}v(t){for(let e=0;e<this.ln.length;e++){const n=this.ln[e];t.T.has(n)||n.v(t)}}}function Ie(t,e,n,s){const o=new Ne(t,e,n,s);return o.init(),o}function Se(t,e,n){if(e.enableShadowDom)if(null===e.pn||function(t){try{const e=document.createElement(t);return"function"==typeof e.attachShadow&&(e.attachShadow({mode:"open"}),!0)}catch{return!1}}(e.pn)){if(!t.shadowRoot){t.attachShadow({mode:"open"}).adoptedStyleSheets=[n]}}else s(`ComponentEngine: Shadow DOM not supported for builtin components that extend ${e.pn}`);else{const e=function(t){let e=t;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}}(t.parentNode)||document,s=e.adoptedStyleSheets;s.includes(n)||(e.adoptedStyleSheets=[...s,n])}}class ve{gn=new Set;wn=new Set;xn=new Map;yn=new Map;bn=new Map;Nn=new Map;ln=new WeakSet;In(t){if(this.ln.has(t))return;const e=t.B.pattern,n=t.Ye.h;this.xn.has(e)&&s({code:"STATE-303",message:`Parent path "${e}" already has a child path`,context:{nt:e,Sn:this.xn.get(e)},t:"./docs/error-codes.md#state"}),this.yn.has(n)&&s({code:"STATE-303",message:`Child path "${n}" already has a parent path`,context:{vn:n,Tn:this.yn.get(n)},t:"./docs/error-codes.md#state"}),this.xn.set(e,n),this.yn.set(n,e),this.gn.add(e),this.wn.add(n),this.bn.set(e,t),this.Nn.set(n,t),this.ln.add(t)}Cn(t){return this.xn.get(t)}Bn(t){return this.yn.get(t)}Un(t){const e=M(t).W.intersection(this.wn);0===e.size&&s({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{vn:t},t:"./docs/error-codes.md#state"});const n=Array.from(e),o=n[n.length-1],r=t.slice(o.length),i=this.yn.get(o);return void 0===i&&s({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{vn:t,Pn:o},t:"./docs/error-codes.md#state"}),i+r}$n(t){const e=M(t).W.intersection(this.gn);0===e.size&&s({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{nt:t},t:"./docs/error-codes.md#state"});const n=Array.from(e),o=n[n.length-1],r=t.slice(o.length),i=this.xn.get(o);return void 0===i&&s({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{nt:t,Pn:o},t:"./docs/error-codes.md#state"}),i+r}Ln(t){if(0===this.wn.size)return null;const e=t.W.intersection(this.wn);if(0===e.size)return null;{const t=Array.from(e);return t[t.length-1]}}bind(t,e){const n=t.Mn(e);for(const t of n??[])this.In(t)}}class Te{En;wt;constructor(t,e){this.En=e,this.wt=t}Dn(t){xt(this.wt,null,(async(e,n,s)=>{for(const[e,s]of Object.entries(t)){const t=V(M(e),null);n[q](t,s)}}))}S(t){for(const e of t)try{const t=M(this.En.$n(e.info.pattern)),n=e.ut,s=V(t,n);this.wt.getPropertyValue(s);xt(this.wt,null,(async(e,s,o)=>{const r=V(t,n);e.Pt(r)}))}catch(t){}}get(t,e,n){if(e===At)return this.Dn.bind(this);if(e===Rt)return this.S.bind(this);if("string"==typeof e){const t=V(M(e),null);return this.wt.getPropertyValue(t)}s(`Property "${String(e)}" is not supported in ComponentStateInput.`)}set(t,e,n,o){if("string"==typeof e){const t=V(M(e),null);return this.wt.kn(t,n),!0}s(`Property "${String(e)}" is not supported in ComponentStateInput.`)}}class Ce{binding;constructor(t){this.binding=t}get(t){const e=this.binding.Ln(t.info);null===e&&s(`No child path found for path "${t.info.toString()}".`);const n=this.binding.Nn.get(e);void 0===n&&s(`No binding found for child path "${e}".`);const o=V(M(this.binding.Un(t.info.pattern)),t.ut??n.B.ut);return n.wt.getPropertyValue(o)}set(t,e){const n=this.binding.Ln(t.info);null===n&&s(`No child path found for path "${t.info.toString()}".`);const o=this.binding.Nn.get(n);void 0===o&&s(`No binding found for child path "${n}".`);const r=M(this.binding.Un(t.info.pattern)),i=o.wt,c=V(r,t.ut??o.B.ut);return xt(i,null,(async(t,n,s)=>{n[q](c,e)})),!0}startsWith(t){return null!==this.binding.Ln(t)}ft(t){const e=this.binding.Ln(t.info);null===e&&s(`No child path found for path "${t.info.toString()}".`);const n=this.binding.Nn.get(e);void 0===n&&s(`No binding found for child path "${e}".`);const o=V(M(this.binding.Un(t.info.pattern)),t.ut);return n.wt.ft(o)}}const Be={list:null,jt:null,Xt:null};class Ue{type="autonomous";config;An;styleSheet;Rn;state;tn;en;#B=null;get nn(){return null===this.#B&&s({code:"BIND-201",message:"bindContent not initialized yet",context:{u:"ComponentEngine.bindContent.get",Fn:this.Ht.constructor.id},t:"./docs/error-codes.md#bind"}),this.#B}Vn=HTMLElement;Ht;He=new WeakMap;Fe=new WeakMap;Wn=new Set;#z=Promise.withResolvers();#q=null;#j=function(){return new ve}();Hn;Tt;#_=null;#G=null;#K=!1;constructor(t,e){this.config=t,this.config.pn&&(this.type="builtin");const n=e.constructor;var s;this.An=n.An,this.styleSheet=n.styleSheet,this.Rn=n.Rn,this.state=new this.Rn,this.tn=n.tn,this.en=n.en,this.Ht=e,this.Hn=function(t,e){const n=new Te(t,e);return new Proxy({},n)}(this,this.#j),this.Tt=(s=this.#j,new Ce(s))}get It(){return this.Ht.constructor.It}On(){for(const t in this.state)P.has(t)||this.It.zn.has(t)||(this.It.zn.add(t),ut(this.It.de,t));const t=this.Ht.constructor,e=V(M(""),null);this.#B=Ie(null,t.id,this,e)}get qn(){return this.#z}async connectedCallback(){if(await(this.#q?.promise),await(this.Ht.jn?.qn.promise),this.Ht.dataset.state)try{const t=JSON.parse(this.Ht.dataset.state);this.Hn[At](t)}catch(t){s({code:"STATE-202",message:"Failed to parse state from dataset",context:{u:"ComponentEngine.connectedCallback",_n:this.Ht.dataset.state},t:"./docs/error-codes.md#state",i:t})}const t=this.Ht.jn;if(t&&(t.Gn(this.Ht),this.#j.bind(t,this.Ht)),this.config.Kn)Se(this.Ht,this.config,this.styleSheet);else{this.#G=this.Ht.parentNode,this.#_=document.createComment("Structive block placeholder");try{this.#K=!0,this.Ht.replaceWith(this.#_)}finally{this.#K=!1}}if(this.config.Kn)this.nn.mount(this.Ht.shadowRoot??this.Ht);else{const t=this.#G??s({code:"BIND-201",message:"Block parent node is not set",context:{u:"ComponentEngine.connectedCallback",mode:"block"},t:"./docs/error-codes.md#bind"});this.nn.ve(t,this.#_)}await xt(this,null,(async(t,e,n)=>{for(const e of this.It.zn){const n=M(e);if(1!==n.R.length)continue;if(this.It.Zn.has(e))continue;const s=V(n,null);t.Pt(s)}await e[_]()})),queueMicrotask((()=>{this.#z.resolve()}))}async disconnectedCallback(){this.#q=Promise.withResolvers();try{if(this.#K)return;await xt(this,null,(async(t,e,n)=>{await e[G]()})),this.Ht.jn?.Jn(this.Ht),this.config.Kn||(this.#_?.remove(),this.#_=null,this.#G=null)}finally{this.#q.resolve()}}#Z={};#J=new WeakMap;#Q=new WeakMap;#X=new WeakMap;#Y=new WeakMap;#tt=new WeakMap;#et=new WeakMap;Ve(t,e){const n=this.#tt.get(t);void 0===n?this.#tt.set(t,[e]):n.push(e)}ce(t,e,n){if(this.It.Mt.has(t.info.pattern)){const s={list:e,jt:n,Xt:e?Array.from(e):null};this.#Q.set(t,s)}}me(t){const e=this.#tt.get(t);return void 0!==e?e:[]}ft(t){return this.Tt.startsWith(t.info)?this.Tt.ft(t):this.#Q.get(t)?.jt??null}Yt(t){const e=this.#Q.get(t);return void 0===e?Be:e}getPropertyValue(t){const e=mt(this,null);return pt(this.state,e)[z](t)}kn(t,e){xt(this,null,(async(n,s,o)=>{s[q](t,e)}))}Gn(t){this.Wn.add(t)}Jn(t){this.Wn.delete(t)}}const Pe=/\{\{([^\}]+)\}\}/g,$e=new Set(["if","for","endif","endfor","elseif","else"]);const Le="http://www.w3.org/2000/svg";function Me(t,e,n=t){if(e.parentNode?.replaceChild(document.createComment(`${U}${t}`),e),e.namespaceURI===Le){const t=document.createElement("template"),n=Array.from(e.childNodes);for(let e=0;e<n.length;e++){const s=n[e];t.content.appendChild(s)}const s=e.getAttribute(C);t.setAttribute(C,s??""),e=t}return e.content.querySelectorAll("template").forEach((t=>{Me(f(),t,n)})),me(t,e,n),t}function Ee(t,e){const n=document.createElement("template");n.dataset.id=t.toString(),n.innerHTML=function(t){const e=[];return t.replaceAll(Pe,((t,n)=>{n=n.trim();const[o]=n.split(":");if(!$e.has(o))return`\x3c!--${B}${n}--\x3e`;const r=n.slice(o.length+1).trim(),i={type:o,Qn:n,Xn:r};if("if"===o||"for"===o)return e.push(i),`<template data-bind="${n}">`;if("endif"===o){const t=[];for(;;){const o=e.pop()??s({code:"TMP-102",message:"Endif without if",context:{u:"replaceMustacheWithTemplateTag",Qn:n,Yn:e.length},t:"./docs/error-codes.md#tmp"});if("if"===o.type){t.push("</template>");break}"elseif"===o.type?t.push("</template>"):s({code:"TMP-102",message:"Endif without if",context:{u:"replaceMustacheWithTemplateTag",ts:o.type,Qn:n},t:"./docs/error-codes.md#tmp"})}return t.join("")}if("endfor"===o){const t=e.pop()??s({code:"TMP-102",message:"Endif without if",context:{u:"replaceMustacheWithTemplateTag",Qn:n,Yn:e.length},t:"./docs/error-codes.md#tmp"});if("for"===t.type)return"</template>";s({code:"TMP-102",message:"Endfor without for",context:{u:"replaceMustacheWithTemplateTag",ts:t.type,Qn:n},t:"./docs/error-codes.md#tmp"})}else if("elseif"===o){const t=e.at(-1)??s({code:"TMP-102",message:"Elseif without if",context:{u:"replaceMustacheWithTemplateTag",Qn:n,Yn:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type||"elseif"===t.type)return e.push(i),`</template><template data-bind="if:${t.Xn}|not"><template data-bind="if:${r}">`;s({code:"TMP-102",message:"Elseif without if",context:{u:"replaceMustacheWithTemplateTag",ts:t.type,Qn:n},t:"./docs/error-codes.md#tmp"})}else if("else"===o){const t=e.at(-1)??s({code:"TMP-102",message:"Else without if",context:{u:"replaceMustacheWithTemplateTag",Qn:n,Yn:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type)return`</template><template data-bind="if:${t.Xn}|not">`;s({code:"TMP-102",message:"Else without if",context:{u:"replaceMustacheWithTemplateTag",ts:t.type,Qn:n},t:"./docs/error-codes.md#tmp"})}else s({code:"TMP-102",message:"Unknown type",context:{u:"replaceMustacheWithTemplateTag",type:o,Qn:n},t:"./docs/error-codes.md#tmp"})}))}(e),Me(t,n)}const De=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/,ke=/^[a-zA-Z_$][0-9a-zA-Z_$]*(\.[a-zA-Z_$][0-9a-zA-Z_$]*|\.\*)*$/;function Ae(t,e){const n=new Set(t.V).intersection(e);let o=-1,r="";for(const t of n){const e=t.split(".");1!==e.length&&(e.length>o&&(o=e.length,r=t))}if(r.length>0){ke.test(r)||s({code:"STATE-202",message:`Invalid path: ${r}`,context:{es:r},t:"./docs/error-codes.md#state"});const e=M(r),n=[];let o=e.ot;for(let i=e.R.length;i<t.R.length;i++){const e=t.R[i];"*"===e?(n.push("[this.$"+(o+1)+"]"),o++):(De.test(e)||s({code:"STATE-202",message:`Invalid segment name: ${e}`,context:{ns:e,es:r},t:"./docs/error-codes.md#state"}),n.push("."+e))}const i=n.join("");return{get:new Function("",`return this["${r}"]${i};`),set:new Function("value",`this["${r}"]${i} = value;`)}}{const e=[];let n=0;for(let o=0;o<t.R.length;o++){const r=t.R[o];"*"===r?(e.push("[this.$"+(n+1)+"]"),n++):(De.test(r)||s({code:"STATE-202",message:`Invalid segment name: ${r}`,context:{ns:r},t:"./docs/error-codes.md#state"}),e.push((e.length>0?".":"")+r))}const o=e.join("");return{get:new Function("",`return this.${o};`),set:new Function("value",`this.${o} = value;`)}}}class Re{zn=new Set;Mt=new Set;elements=new Set;Zn=new Set;Nt=new Set;St=new Set;ss=new Set;rs=new Map;pe=new Map;de=function(){return new dt("","",0)}();#m;#nt;constructor(t){this.#m=t.id,this.#nt=t.Rn;const e=(t=>ue[t]??[])(this.#m);for(const t of e){const e=M(t);this.zn=this.zn.union(e.W)}const n=(t=>ae[t]??[])(this.#m);this.Mt=this.Mt.union(n);for(const t of n){const e=t+".*";this.elements.add(e)}let s=this.#nt.prototype;for(;s&&s!==Object.prototype;){const t=Object.getOwnPropertyDescriptors(s);if(t)for(const[e,n]of Object.entries(t)){if(P.has(e))continue;if("function"==typeof n.value){this.Zn.add(e);continue}const t=void 0!==n.get,s=void 0!==n.set,o=M(e);this.zn=this.zn.union(o.W),t&&this.Nt.add(e),s&&this.St.add(e)}s=Object.getPrototypeOf(s)}for(const t of this.zn){if(this.Nt.has(t))continue;if(this.St.has(t))continue;const e=M(t);if(1===e.R.length)continue;const n=Ae(e,this.Nt);Object.defineProperty(this.#nt.prototype,t,{get:n.get,set:n.set,enumerable:!0,configurable:!0}),this.ss.add(t)}for(const t of this.zn){ut(this.de,t);const e=M(t);e.nt&&(this.rs.get(e.nt)?.add(t)??this.rs.set(e.nt,new Set([t])))}}#st=new Set;vt(t,e){const n=`${e}=>${t}`;this.#st.has(n)||(this.#st.add(n),this.pe.get(e)?.add(t)??this.pe.set(e,new Set([t])))}}function Fe(t){const n=function(t){const n=e();return{Kn:void 0===t.Kn||t.Kn,enableShadowDom:t.enableShadowDom??n.enableShadowDom,pn:t.pn??null}}(t.Rn.cs??{}),o=f(),{ds:r,ls:i,Rn:c}=t,d=Object.assign({},u),l=Object.assign({},a);c.us=!0,Ee(o,r),g(o,i),function(t,e){m[t]=e}(o,c);const h=function(t){return t?document.createElement(t).constructor:HTMLElement}(n.pn),w=n.pn;return class extends h{#b;constructor(){super(),this.#b=function(t,e){return new Ue(t,e)}(n,this),this.#b.On()}connectedCallback(){this.#b.connectedCallback()}disconnectedCallback(){this.#b.disconnectedCallback()}#ot;get jn(){var t;return void 0===this.#ot&&(this.#ot=(t=this,Ft.get(t)??null)),this.#ot}get state(){return this.#b.Hn}get hs(){return this.#b.Rn.us??!1}get qn(){return this.#b.qn}Mn(t){return this.#b.Fe.get(t)??null}Gn(t){this.#b.Gn(t)}Jn(t){this.#b.Jn(t)}static define(t){w?customElements.define(t,this,{pn:w}):customElements.define(t,this)}static get id(){return o}static#rt=r;static get ds(){return this.#rt}static set ds(t){this.#rt=t,Ee(this.id,t),this.#it=null,this.#ct=null}static#dt=i;static get ls(){return this.#dt}static set ls(t){this.#dt=t,g(this.id,t),this.#lt=null}static#it=null;static get An(){return this.#it||(this.#it=pe(this.id)),this.#it}static#lt=null;static get styleSheet(){return this.#lt||(this.#lt=function(t){return p[t]??s({code:"CSS-001",message:`Stylesheet not found: ${t}`,context:{u:"registerStyleSheet.getStyleSheetById",fs:t},t:"./docs/error-codes.md#css"})}(this.id)),this.#lt}static#nt=null;static get Rn(){return this.#nt||(this.#nt=function(t){return m[t]??s({code:"STATE-101",message:`StateClass not found: ${t}`,context:{u:"registerStateClass.getStateClassById",ps:t},t:"./docs/error-codes.md#state"})}(this.id)),this.#nt}static#at=d;static get tn(){return this.#at}static#ut=l;static get en(){return this.#ut}static#ct=null;static get It(){return this.#ct||(this.#ct=new Re(this)),this.#ct}}}function Ve(t){return t.replaceAll(/<!--\{\{([^\}]+)\}\}-->/g,((t,e)=>`{{${e}}}`))}async function We(t){const e=import.meta.resolve?import.meta.resolve(t):t,n=await fetch(e);return async function(t){const e=document.createElement("template");e.innerHTML=function(t){return t.replaceAll(/\{\{([^\}]+)\}\}/g,((t,e)=>`\x3c!--{{${e}}}--\x3e`))}(t);const n=e.content.querySelector("template");n?.remove();const s=e.content.querySelector("script[type=module]");let o={};if(s){const t=btoa(String.fromCodePoint(...(new TextEncoder).encode(s.text)));o=await import("data:application/javascript;base64,"+t)}s?.remove();const r=e.content.querySelector("style");r?.remove();const i=o.default??class{};return{text:t,ds:Ve(n?.innerHTML??"").trim(),ls:r?.textContent??"",Rn:i}}(await n.text())}function He(t,e){e.define(t)}const Oe="@routes/",ze="@components/",qe="#lazy",je={};async function _e(){const t=function(){const t={};return document.querySelectorAll("script[type='importmap']").forEach((e=>{const n=JSON.parse(e.innerHTML);n.imports&&(t.imports=Object.assign(t.imports||{},n.imports))})),t}();if(t.imports){const e=new Map;for(const[n,s]of Object.entries(t.imports)){let t,s;if(n.startsWith(Oe)){s=n.endsWith(qe);const e=n.slice(7,s?-5:void 0);t="routes"+e.replace(/:[^\s/]+/g,"").replace(/\//g,"-"),Xe(t,"/root"===e?"/":e)}n.startsWith(ze)&&(s=n.endsWith(qe),t=n.slice(12,s?-5:void 0)),t&&(s?je[t]=n:e.set(t,n))}for(const[t,n]of e.entries()){He(t,Fe(await We(n)))}}}function Ge(t){const e=je[t];if(e)delete je[t],queueMicrotask((async()=>{const n=Fe(await We(e));He(t,n)}));else{const e={code:"IMP-201",message:`Alias not found for tagName: ${t}`,context:{u:"loadFromImportMap.loadLazyLoadComponent",tagName:t},t:"./docs/error-codes.md#imp",o:"warn"};console.warn(e.message,{code:e.code,context:e.context,t:e.t,o:e.o})}}const Ke="routes:",Ze=[];let Je=null;class Qe extends HTMLElement{gs=window.location.pathname;ws=window.location.pathname.split("/").pop()||"";xs=document.querySelector("base")?.href.replace(window.location.origin,"")||"/";ys;constructor(){super(),this.ys=this.bs.bind(this)}connectedCallback(){Je=this,this.innerHTML='<slot name="content"></slot>',window.addEventListener("popstate",this.ys),window.dispatchEvent(new Event("popstate"))}disconnectedCallback(){window.removeEventListener("popstate",this.ys),Je=null}bs(t){t.preventDefault(),this.ue()}navigate(t){const e="/"===t[0]?this.xs+t.slice(1):t;history.pushState({},"",e),this.ue()}ue(){Array.from(this.childNodes).filter((t=>"content"===t.getAttribute?.("slot"))).forEach((t=>this.removeChild(t)));const t=window.location.pathname.split("/");t.at(-1)===this.ws&&(t[t.length-1]="");const e=t.join("/").replace(this.xs,""),n="/"!==e[0]?"/"+e:e;let s,o={};for(const[t,e]of Ze){const r=new RegExp("^"+t.replace(/:[^\s/]+/g,"([^/]+)")+"$");if(r.test(n)){s=e;const i=n.match(r);if(i){(t.match(/:[^\s/]+/g)||[]).forEach(((t,e)=>{o[t.substring(1)]=i[e+1]}))}break}}if(s){const t=document.createElement(s);t.setAttribute("data-state",JSON.stringify(o)),t.setAttribute("slot","content"),this.appendChild(t),function(t){return je.hasOwnProperty(t)}(s)&&Ge(s)}else{const t=document.createElement("h1");t.setAttribute("slot","content"),t.textContent="404 Not Found",this.appendChild(t)}}}function Xe(t,e){e.startsWith(Ke)&&(e=e.substring(Ke.length)),Ze.push([e,t])}function Ye(){return Je}const tn="router",en=`<slot name="${tn}"></slot>`;class nn extends HTMLElement{constructor(){super(),n.enableShadowDom&&this.attachShadow({mode:"open"})}async connectedCallback(){await this.Ns(),this.ue()}get root(){return this.shadowRoot??this}async Ns(){if(n.layoutPath){const t=await fetch(n.layoutPath);if(t.ok){const e=await t.text(),n=document.createElement("template");n.innerHTML=e;const s=n.content.querySelector("template"),o=n.content.querySelector("style");if(this.root.appendChild(s?.content??document.createDocumentFragment()),o){const t=this.shadowRoot??document,e=t.adoptedStyleSheets;e.includes(o)||(t.adoptedStyleSheets=[...e,o])}}else s({code:"TMP-101",message:`Failed to load layout from ${n.layoutPath}`,context:{layoutPath:n.layoutPath},t:"/docs/error-codes.md#tmp",o:"error"})}else this.root.innerHTML=en}ue(){if(n.enableRouter){const t=document.createElement(n.routerTagName);t.setAttribute("slot",tn),this.root.appendChild(t)}}}const sn=n;let on=!1;async function rn(t){await async function(t){for(const[e,s]of Object.entries(t)){let t=null;if(n.enableRouter){const t=s.startsWith("@routes")?s.slice(7):s;Xe(e,"/root"===t?"/":t)}t=await We(s),He(e,Fe(t))}}(t),sn.autoInit&&await cn()}async function cn(){on||(await async function(){if(n.autoLoadFromImportMap&&await _e(),n.enableRouter&&customElements.define(n.routerTagName,Qe),n.enableMainWrapper&&(customElements.define(n.mainTagName,nn),n.autoInsertMainWrapper)){const t=document.createElement(n.mainTagName);document.body.appendChild(t)}}(),on=!0)}export{cn as bootstrapStructive,sn as config,rn as defineComponents};
//# sourceMappingURL=structive.min.js.map
