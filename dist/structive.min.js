const t={debug:!1,locale:"en-US",enableShadowDom:!0,enableMainWrapper:!0,enableRouter:!0,autoInsertMainWrapper:!1,autoInit:!0,mainTagName:"app-main",routerTagName:"view-router",layoutPath:"",autoLoadFromImportMap:!1,optimizeList:!0,optimizeListElements:!0,optimizeAccessor:!0};function n(){return t}const e=n();function s(t){throw new Error(`${t} requires at least one option`)}function i(t){throw new Error(`${t} requires a number as option`)}function o(t){throw new Error(`${t} requires a number value`)}function r(t){throw new Error(`${t} requires a date value`)}const l=n(),u={eq:t=>{const n=t?.[0]??s("eq");return t=>{if("number"==typeof t){const e=Number(n);return isNaN(e)&&i("eq"),t===e}return t===n}},ne:t=>{const n=t?.[0]??s("ne");return t=>{if("number"==typeof t){const e=Number(n);return isNaN(e)&&i("eq"),t!==e}return t!==n}},not:t=>t=>("boolean"!=typeof t&&function(t){throw new Error(`${t} requires a boolean value`)}("not"),!t),lt:t=>{const n=t?.[0]??s("lt"),e=Number(n);return isNaN(e)&&i("lt"),t=>("number"!=typeof t&&o("lt"),t<e)},le:t=>{const n=t?.[0]??s("le"),e=Number(n);return isNaN(e)&&i("le"),t=>("number"!=typeof t&&o("le"),t<=e)},gt:t=>{const n=t?.[0]??s("gt"),e=Number(n);return isNaN(e)&&i("gt"),t=>("number"!=typeof t&&o("gt"),t>e)},ge:t=>{const n=t?.[0]??s("ge"),e=Number(n);return isNaN(e)&&i("ge"),t=>("number"!=typeof t&&o("ge"),t>=e)},inc:t=>{const n=t?.[0]??s("inc"),e=Number(n);return isNaN(e)&&i("inc"),t=>("number"!=typeof t&&o("inc"),t+e)},dec:t=>{const n=t?.[0]??s("dec"),e=Number(n);return isNaN(e)&&i("dec"),t=>("number"!=typeof t&&o("dec"),t-e)},mul:t=>{const n=t?.[0]??s("mul"),e=Number(n);return isNaN(e)&&i("mul"),t=>("number"!=typeof t&&o("mul"),t*e)},div:t=>{const n=t?.[0]??s("div"),e=Number(n);return isNaN(e)&&i("div"),t=>("number"!=typeof t&&o("div"),t/e)},fix:t=>{const n=Number(t?.[0]??0);return isNaN(n)&&i("div"),t=>("number"!=typeof t&&o("div"),t.toFixed(n))},locale:t=>{const n=t?.[0]??l.locale;return t=>("number"!=typeof t&&o("locale"),t.toLocaleString(n))},uc:t=>t=>t.toString().toUpperCase(),lc:t=>t=>t.toString().toLowerCase(),cap:t=>t=>{const n=t.toString();return 0===n.length?n:1===n.length?n.toUpperCase():n.charAt(0).toUpperCase()+n.slice(1)},trim:t=>t=>t.toString().trim(),slice:t=>{const n=t?.[0]??s("slice"),e=Number(n);return isNaN(e)&&i("slice"),t=>t.toString().slice(e)},substr:t=>{const n=t?.[0]??s("substr"),e=Number(n);isNaN(e)&&i("substr");const o=t?.[1]??s("substr"),r=Number(o);return isNaN(r)&&i("substr"),t=>t.toString().substr(e,r)},pad:t=>{const n=t?.[0]??s("pad"),e=Number(n);isNaN(e)&&i("pad");const o=t?.[1]??"0";return t=>t.toString().padStart(e,o)},rep:t=>{const n=t?.[0]??s("rep"),e=Number(n);return isNaN(e)&&i("rep"),t=>t.toString().repeat(e)},rev:t=>t=>t.toString().split("").reverse().join(""),int:t=>t=>parseInt(t,10),float:t=>t=>parseFloat(t),round:t=>{const n=t?.[0]??0,e=Math.pow(10,Number(n));return isNaN(e)&&i("round"),t=>("number"!=typeof t&&o("round"),Math.round(t*e)/e)},floor:t=>{const n=t?.[0]??0,e=Math.pow(10,Number(n));return isNaN(e)&&i("floor"),t=>("number"!=typeof t&&o("floor"),Math.floor(t*e)/e)},ceil:t=>{const n=t?.[0]??0,e=Math.pow(10,Number(n));return isNaN(e)&&i("ceil"),t=>("number"!=typeof t&&o("ceil"),Math.ceil(t*e)/e)},percent:t=>{const n=Number(t?.[0]??0);return isNaN(n)&&i("percent"),t=>("number"!=typeof t&&o("percent"),t.toFixed(n)+"%")},date:t=>{const n=t?.[0]??l.locale;return t=>(t instanceof Date||r("date"),t.toLocaleDateString(n))},time:t=>{const n=t?.[0]??l.locale;return t=>(t instanceof Date||r("time"),t.toLocaleTimeString(n))},datetime:t=>{const n=t?.[0]??l.locale;return t=>(t instanceof Date||r("datetime"),t.toLocaleString(n))},ymd:t=>{const n=t?.[0]??"-";return t=>{t instanceof Date||r("ymd");const e=t.getFullYear().toString(),s=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getDate().toString().padStart(2,"0");return`${e}${n}${s}${n}${i}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const n=t?.[0]??s("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?n:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},a=u,c=u;let h=0;function d(){return++h}function f(t){throw new Error(t)}const p={};const m={};function g(t,n){const e=new CSSStyleSheet;e.replaceSync(n),function(t,n){m[t]=n}(t,e)}function w(t,n){let e=t;if(0===n.length)return e;for(let t=0;t<n.length&&(e=e?.childNodes[n[t]]??null,null!==e);t++);return e}function y(t,n){const e=t[n.name];return e||f(`outputBuiltinFiltersFn: filter not found: ${name}`),e(n.options)}const b=new Map;function S(t,n){let e=b.get(n);if(void 0===e){e=[];for(let s=0;s<n.length;s++)e.push(y(t,n[s]));b.set(n,e)}return e}class x{#t;#n;#e;#s;#i;#o=[];get node(){return this.#n}get name(){return this.#e}get t(){return this.#e}get binding(){return this.#t}get i(){return this.#i}get filters(){return this.#s}get o(){return this.#o}constructor(t,n,e,s,i){this.#t=t,this.#n=n,this.#e=e,this.#s=s,this.#i=i}init(){}l(t){f("BindingNode: assignValue not implemented")}u(t,n){f("BindingNode: updateElements not implemented")}h(t){}p(t){if(t.m.has(this.binding))return;const n=this.binding.N.S(t.v);this.l(n),t.m.add(this.binding)}get I(){return this.node instanceof HTMLSelectElement}get value(){return null}get C(){return null}get $(){return!1}}class N extends x{#r;get t(){return this.#r}constructor(t,n,e,s,i){super(t,n,e,s,i);const[,o]=this.name.split(".");this.#r=o}l(t){(null==t||Number.isNaN(t))&&(t="");this.node.setAttribute(this.t,t.toString())}}class v extends x{l(t){Array.isArray(t)||f("BindingNodeCheckbox.update: value is not array");const n=this.node;n.checked=t.map((t=>t.toString())).includes(n.value)}}class I extends x{l(t){Array.isArray(t)||f("BindingNodeClassList.update: value is not array");this.node.className=t.join(" ")}}class C extends x{#r;get t(){return this.#r}constructor(t,n,e,s,i){super(t,n,e,s,i);const[,o]=this.name.split(".");this.#r=o}l(t){"boolean"!=typeof t&&f("BindingNodeClassName.update: value is not boolean");const n=this.node;t?n.classList.add(this.t):n.classList.remove(this.t)}}const $={};class L{static id=0;id=++L.id;L=this.id.toString();pattern;P;B;M;T;k;R;V;F;A;O;H;D;W;q;j;_;G;Z;U;J;children={};constructor(t){const n=n=>t===n?this:B(n),e=t.split("."),s=[],i=[],o=[],r={},l=[],u=[],a=[];let c="",h="",d=0;for(let t=0;t<e.length;t++)c+=e[t],"*"===e[t]&&(o.push(c),r[c]=d,l.push(n(c)),u.push(h),a.push(n(h)),d++),s.push(c),i.push(n(c)),h=c,c+=".";const f=o.length>0?o[o.length-1]:null,p=s.length>1?s[s.length-2]:null;this.pattern=t,this.P=e,this.B=e[e.length-1],this.M=s,this.T=new Set(s),this.k=i,this.R=new Set(i),this.V=o,this.F=new Set(o),this.O=r,this.A=l,this.H=new Set(l),this.D=u,this.W=new Set(u),this.q=a,this.j=new Set(a),this._=f,this.G=f?n(f):null,this.Z=p,this.U=p?n(p):null,this.J=d,this.U&&(this.U.children[this.B]=this)}}const P=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","watch","unwatch","eval","arguments","let","var","const","class","function","null","true","false","new","return"]);function B(t){const n=$[t];return void 0!==n?n:(P.has(t)&&f(`getStructuredPathInfo: pattern is reserved word: ${t}`),$[t]=new L(t))}const M=new Map;class E{static id=0;id=++E.id;name;elements;K;J;X;Y;info;constructor(t){const n=t.split("."),e=n.slice(),s=[];let i=0,o=0,r="",l=0,u="none",a=[];for(let t=0;t<n.length;t++){const u=n[t];if("*"===u)e[t]="*",a.push(null),i++,l++;else{const n=Number(u);Number.isNaN(n)||(e[t]="*",a.push(n),o++,l++)}r+=u,s.push(r),r+=t<n.length-1?".":""}const c=B(e.join("."));(i>0||o>0)&&(u=i===l?"context":o===l?"all":"partial"),this.name=t,this.elements=n,this.K=s,this.J=l,this.X=u,this.Y=a,this.info=c}}function T(t){let n;return M.get(t)??(M.set(t,n=new E(t)),n)}function k(t,n){const e=t.tt[t.nt];if(null==e)return null;const s=t.et[t.nt];if(null==s)return null;const i=e.O[n];return void 0!==i?s.at(i):null}function R(t,n,e){switch(t.X){case"none":return null;case"context":return k(e,t.info._??f("lastWildcardPath is null"))??f(`ListIndex not found: ${t.info.pattern}`);case"all":let n=null;for(let s=0;s<t.info.J;s++){const i=t.info.q[s]??f("wildcardParentPattern is null");n=(e.it.st(i,n)??f(`ListIndex not found: ${i.pattern}`))[t.Y[s]??f("wildcardIndex is null")]??f(`ListIndex not found: ${i.pattern}`)}return n;case"partial":f(`Partial wildcard type is not supported yet: ${t.info.pattern}`)}}const V="state",F=Symbol.for(`${V}.GetByRef`),A=Symbol.for(`${V}.SetByRef`),O=Symbol.for(`${V}.SetCacheable`),H=Symbol.for(`${V}.ConnectedCallback`),z=Symbol.for(`${V}.DisconnectedCallback`);function D(t,n,e){if(t.nt>=0){const e=t.tt[t.nt];null!==e&&t.it.rt.ot.has(e.pattern)&&!t.it.rt.ut.has(e.pattern)&&e.pattern!==n.pattern&&t.it.rt.ct(e.pattern,n.pattern)}}function W(t,n,e,s){t.nt++,t.nt>=t.tt.length&&(t.tt.push(null),t.et.push(null)),t.tt[t.nt]=n,t.et[t.nt]=e;try{return s()}finally{t.tt[t.nt]=null,t.et[t.nt]=null,t.nt--}}function q(t,n,e,s,i){if(D(i,n),i.it.ht.startsWith(n)&&0===i.it.rt.ot.intersection(n.T).size)return i.it.ht.get(n,e);if(n.pattern in t)return W(i,n,e,(()=>Reflect.get(t,n.pattern,s)));{const o=n.U??f("propRef.stateProp.parentInfo is undefined"),r=o.J<n.J?e?.dt??null:e,l=q(t,o,r,s,i),u=n.B;if("*"===u){const t=e?.index??f("propRef.listIndex?.index is undefined");return Reflect.get(l,t)}return Reflect.get(l,u)}}function j(t,n,e,s,i,o){try{if(o.it.ht.startsWith(n)&&0===o.it.rt.ut.intersection(n.T).size)return o.it.ht.set(n,e,s);if(n.pattern in t)return W(o,n,e,(()=>Reflect.set(t,n.pattern,s,i)));{const r=n.U??f("propRef.stateProp.parentInfo is undefined"),l=r.J<n.J?e?.dt??null:e,u=q(t,r,l,i,o),a=n.B;if("*"===a){const t=e?.index??f("propRef.listIndex?.index is undefined");return Reflect.set(u,t,s)}return Reflect.set(u,a,s)}}finally{o.wt.ft(n,e,s)}}function _(t,n,e,s){return(n,i,o)=>{const r=B(n),l=s.tt[s.nt]??null;null!==l&&l.pattern!==r.pattern&&s.it.rt.ot.has(l.pattern)&&!s.it.rt.ut.has(l.pattern)&&s.it.rt.ct(l.pattern,r.pattern);let u=null;for(let t=0;t<r.q.length;t++){const n=r.q[t]??f("wildcardParentPath is null");u=(s.it.st(n,u)??[])[i[t]??f("index is null")]??f(`ListIndex not found: ${n.pattern}`)}return void 0===o?q(t,r,u,e,s):j(t,r,u,o,e,s)}}function G(t,n,e,s){return t=>{const n=s.tt[s.nt]??f("Internal error: structuredPathInfoStack is null.");s.it.rt.ot.has(n.pattern)&&n.pattern!==t&&s.it.rt.ct(n.pattern,t)}}const Z="data-bind",U="@@:",J="@@|",K={};for(let t=0;t<32;t++)K[`$${t+1}`]=t;function Q(t,n,e,s){const i=K[n];if(void 0!==i){const t=s.et[s.nt];return t?.yt[i]??f(`ListIndex not found: ${n.toString()}`)}if("string"==typeof n){if("$"===n[0])switch(n){case"$resolve":return _(t,0,e,s);case"$getAll":return function(t,n,e,s){const i=_(t,0,e,s);return(t,n)=>{const e=B(t),o=s.tt[s.nt]??null;if(null!==o&&o.pattern!==e.pattern&&s.it.rt.ot.has(o.pattern)&&!s.it.rt.ut.has(o.pattern)&&s.it.rt.ct(o.pattern,e.pattern),void 0===n){for(let t=0;t<e.A.length;t++){const i=e.A[t]??f("wildcardPattern is null"),o=k(s,i.pattern);if(o){n=o.yt;break}}void 0===n&&(n=[])}const r=(t,n,e,i,o,l,u)=>{const a=t[n]??null;if(null===a)return void u.push(l);const c=s.it.st(a,e)??f(`ListIndex not found: ${a.pattern}`),h=i[o]??null;if(null===h)for(let e=0;e<c.length;e++){const s=c[e];r(t,n+1,s,i,o+1,l.concat(s.index),u)}else{const e=c[h]??f(`ListIndex not found: ${a.pattern}`);n+1<t.length&&r(t,n+1,e,i,o+1,l.concat(e.index),u)}},l=[];r(e.q,0,null,n,0,[],l);const u=[];for(let t=0;t<l.length;t++)u.push(i(e.pattern,l[t]));return u}}(t,0,e,s);case"$trackDependency":return G(0,0,0,s);case"$navigate":return t=>Kn()?.navigate(t);case"$component":return s.it.bt}const i=T(n),o=R(i,0,s);return q(t,i.info,o,e,s)}if("symbol"==typeof n)switch(n){case F:return(n,i)=>q(t,n,i,e,s);case A:return(n,i,o)=>j(t,n,i,o,e,s);case H:return()=>async function(t,n,e){const s=Reflect.get(t,"$connectedCallback");"function"==typeof s&&await s.call(e)}(t,0,e);case z:return()=>async function(t,n,e){const s=Reflect.get(t,"$disconnectedCallback");"function"==typeof s&&await s.call(e)}(t,0,e);default:return Reflect.get(t,n,e)}}let X=class{it;St=null;xt=Array(32).fill(null);Nt=-1;tt=Array(32).fill(null);et=Array(32).fill(null);nt=-1;vt=null;wt;constructor(t,n){this.it=t,this.wt=n}get(t,n,e){return Q(t,n,e,this)}set(t,n,e,s){return function(t,n,e,s,i){if("string"==typeof n){const o=T(n),r=R(o,0,i);return j(t,o.info,r,e,s,i)}return Reflect.set(t,n,e,s)}(t,n,e,s,this)}};async function Y(t,n,e,s,i){const o=new X(t,n),r=new Proxy(e,o);return async function(t,n,e){t.vt&&f("already in loop context"),t.vt=n;try{n?await async function(t,n,e,s){t.nt++,t.nt>=t.tt.length&&(t.tt.push(null),t.et.push(null)),t.tt[t.nt]=n,t.et[t.nt]=e;try{await s()}finally{t.tt[t.nt]=null,t.et[t.nt]=null,t.nt--}}(t,n.info,n.It,e):await e()}finally{t.vt=null}}(o,s,(async()=>{await i(r)}))}function tt(t,n,e,s){const i=e?.length??0;if(n.J===i)s(n,e);else{const o=n.q[i]??f("Invalid state property info"),r=t.st(o,e);if(r)for(let e=0;e<r.length;e++){tt(t,n,r[e],s)}}}function nt(t,n,e,s){tt(t,n,e,s)}function et(t,n,e,s,i){D(i,n);let o,r="";if(i.Ct){const t=null===e?n.L:n.L+"#"+e.L,s=i.cache.get(t);if(void 0!==s)return s;if(i.cache.has(t))return;r=t}try{if(i.it.ht.startsWith(n)&&0===i.it.rt.ot.intersection(n.T).size)return o=i.it.ht.get(n,e);if(n.pattern in t)return o=W(i,n,e,(()=>Reflect.get(t,n.pattern,s)));{const r=n.U??f("propRef.stateProp.parentInfo is undefined"),l=r.J<n.J?e?.dt??null:e,u=et(t,r,l,s,i),a=n.B;if("*"===a){const t=e?.index??f("propRef.listIndex?.index is undefined");return o=Reflect.get(u,t)}return o=Reflect.get(u,a)}}finally{i.Ct&&i.cache.set(r,o)}}function st(t,n,e,s){return(n,i,o)=>{const r=B(n),l=s.tt[s.nt]??null;null!==l&&l.pattern!==r.pattern&&s.it.rt.ot.has(l.pattern)&&!s.it.rt.ut.has(l.pattern)&&s.it.rt.ct(l.pattern,r.pattern);let u=null;for(let t=0;t<r.q.length;t++){const n=r.q[t]??f("wildcardParentPath is null");u=(s.it.st(n,u)??[])[i[t]??f("index is null")]??f(`ListIndex not found: ${n.pattern}`)}if(void 0===o)return et(t,r,u,e,s);f(`Cannot set value on a readonly proxy: ${n}`)}}function it(t,n,e,s){const i=K[n];if(void 0!==i){const t=s.et[s.nt];return t?.yt[i]??f(`ListIndex not found: ${n.toString()}`)}if("string"==typeof n){if("$"===n[0])switch(n){case"$resolve":return st(t,0,e,s);case"$getAll":return function(t,n,e,s){const i=st(t,0,e,s);return(t,n)=>{const e=B(t),o=s.tt[s.nt]??null;if(null!==o&&o.pattern!==e.pattern&&s.it.rt.ot.has(o.pattern)&&!s.it.rt.ut.has(o.pattern)&&s.it.rt.ct(o.pattern,e.pattern),void 0===n){for(let t=0;t<e.A.length;t++){const i=e.A[t]??f("wildcardPattern is null"),o=k(s,i.pattern);if(o){n=o.yt;break}}void 0===n&&(n=[])}const r=(t,n,e,i,o,l,u)=>{const a=t[n]??null;if(null===a)return void u.push(l);const c=s.it.st(a,e)??f(`ListIndex not found: ${a.pattern}`),h=i[o]??null;if(null===h)for(let e=0;e<c.length;e++){const s=c[e];r(t,n+1,s,i,o+1,l.concat(s.index),u)}else{const e=c[h]??f(`ListIndex not found: ${a.pattern}`);n+1<t.length&&r(t,n+1,e,i,o+1,l.concat(e.index),u)}},l=[];r(e.q,0,null,n,0,[],l);const u=[];for(let t=0;t<l.length;t++)u.push(i(e.pattern,l[t]));return u}}(t,0,e,s);case"$trackDependency":return G(0,0,0,s);case"$navigate":return t=>Kn()?.navigate(t);case"$component":return s.it.bt}const i=T(n),o=R(i,0,s);return et(t,i.info,o,e,s)}if("symbol"==typeof n)switch(n){case F:return(n,i)=>et(t,n,i,e,s);case O:return t=>function(t,n){t.Ct=!0,t.cache=new Map;try{n()}finally{t.Ct=!1}}(s,t);default:return Reflect.get(t,n,e)}}class ot{it;Ct=!1;cache=new Map;St=null;xt=Array(32).fill(null);Nt=-1;tt=Array(32).fill(null);et=Array(32).fill(null);nt=-1;vt=null;constructor(t){this.it=t}get(t,n,e){return it(t,n,e,this)}set(t,n,e,s){f(`Cannot set property ${String(n)} of readonly state.`)}}function rt(t,n){return new Proxy(n,new ot(t))}function lt(t,n){return null==n?t.L:t.L+"#"+n.L}let ut=0,at=0;class ct{#l=null;#u=0;#a=0;#c;#h=++at;#d=this.#h.toString();constructor(t,n){this.#l=t,this.#u=t?t.position+1:0,this.#a=n,this.#c=ut}get dt(){return this.#l}get id(){return this.#h}get L(){return this.#d}get position(){return this.#u}get length(){return this.#u+1}get index(){return this.#a}set index(t){this.#a=t,this.#c=++ut,this.yt[this.#u]=t}get version(){return this.#c}get $t(){return null!==this.#l&&(this.#l.$t||this.#l.version>this.#c)}#f;get yt(){return null===this.#l?void 0===this.#f&&(this.#f=[this.#a]):(void 0===this.#f||this.$t)&&(this.#f=[...this.#l.yt,this.#a],this.#c=ut),this.#f}#p;get Lt(){return null===this.#l?void 0===this.#p&&(this.#p=[new WeakRef(this)]):void 0===this.#p&&(this.#p=[...this.#l.Lt,new WeakRef(this)]),this.#p}get Pt(){return`${this.position+1}`}at(t){return t>=0?this.Lt[t]?.deref()||null:this.Lt[this.Lt.length+t]?.deref()||null}}function ht(t,n){return new ct(t,n)}function dt(t,n){const e=new Set;for(let s=0;s<t.length;s++){const t=ht(n,s);e.add(t)}return{newValue:t,oldValue:[],Bt:e,Mt:new Set(e),Et:new Set,Tt:!0}}function ft(t,n,e,s){if(null!=t&&null!=e){n||f("Old list indexes set is not provided for existing old value.");let i=null;if(t.length>0&&e.length>0)i=function(t,n,e,s){const i=new Set,o=new Set,r=new Set,l=Map.groupBy(n,(n=>t[n.index]));for(let t=0;t<e.length;t++){const n=l.get(e[t])?.shift();if(n)n.index!==t&&(n.index=t,o.add(n)),r.add(n);else{const n=ht(s,t);i.add(n),r.add(n)}}const u=n.difference(r);return{newValue:e,oldValue:t,Bt:i,kt:o,Rt:u,Mt:r,Et:n,Tt:!0}}(t,n,e,s);else if(e.length>0)i=dt(e,s);else if(t.length>0){const e=n?new Set(n):new Set;i={oldValue:t,newValue:[],Rt:e,Et:new Set(e),Mt:new Set,Tt:!0}}else i={oldValue:[],newValue:[],Et:new Set,Mt:new Set,Tt:!0};return i}if(null!=e)return dt(e,s);if(null!=t){const e=n?new Set(n):new Set;return{oldValue:t,newValue:[],Rt:e,Et:new Set(e),Mt:new Set,Tt:!0}}return{oldValue:[],newValue:[],Et:new Set,Mt:new Set,Tt:!0}}class pt{#m=new Set;#g=new Set;#w=new Map;#y;#b=null;constructor(t){this.#y=t}get m(){return this.#m}get Vt(){return this.#g}get v(){return this.#b||f("ReadonlyState is not initialized."),this.#b}get it(){return this.#y||f("Engine is not initialized."),this.#y}Ft(t){const n=this.#b=rt(this.#y,this.#y.state);try{n[O]((()=>{const e=new Map,s=new Map,i=new Map;for(let n=0;n<t.length;n++){const{info:o,It:r,value:l}=t[n],u=lt(o,r);this.At(o,r,!0,e,s),i.set(u,{info:o,It:r})}for(const[t,n]of e.entries()){const{info:e,It:s}=n;i.set(t,{info:e,It:s})}for(const[t,e]of i.entries())s.has(t)||this.Ot(e.info,e.It,this.Vt,this.m,n)}))}finally{this.#b=null,this.#w.clear(),this.#g.clear(),this.#m.clear()}}Ht(t,n){!1===this.zt(t)&&f("The specified info is not a list value.");const e=lt(t,n);let s=this.#w.get(e);if(!s){const i=this.v[F](t,n);s=ft(this.Dt(t,n),new Set(this.Wt(t,n)),i,n),this.#w.set(e,s),this.qt(t,n,i??[]),this.jt(t,n,Array.from(s.Mt??new Set))}return s}zt(t){return this.it.rt._t.has(t.pattern)}Wt(t,n){return this.it.st(t,n)??null}jt(t,n,e){this.it.Gt(t,n,e)}Dt(t,n){return this.it.Zt(t,n)??null}qt(t,n,e){this.it.Ut(t,n,Array.from(e))}Jt(t,n){return this.it.Jt(t,n)??[]}At(t,n,e,s,i,o=new Set){const r=lt(t,n);if(o.has(r))return;o.add(r);const l=this.zt(t)?B(t.pattern+".*"):null;let u=null;if(this.it.rt._t.has(t.pattern))u=this.Ht(t,n),u.Tt=!1,s.set(r,{info:t,It:n});else if(this.it.rt.elements.has(t.pattern)&&e){n||f(`Renderer.render: listIndex is null for element ${t.pattern}`);const e=t.U;e||f(`Renderer.render: parentInfo is not found for element ${t.pattern}`);const o=e.J<t.J?n?.at(-2)??null:n,l=this.v[F](t,n);u=this.u(t,n,l,e,o);const a=lt(e,o);s.set(a,{info:e,It:o}),i.set(r,{info:t,It:n})}for(const e of this.#y?.rt.Kt.get(t.pattern)??[]){const t=B(e);if(l?.pattern&&t.F.has(l.pattern))for(const n of u?.Mt??[])this.At(t,n,!1,s,i,o);else this.At(t,n,!1,s,i,o)}for(const e of this.#y?.rt.Qt.get(t.pattern)??[]){const t=B(e);if(t.J>0){const e=t.F.intersection(l?.F??new Set);if(e.size>0)if(u?.Mt?.size===e.size)for(const n of u?.Mt??[])nt(this.it,t,n,((t,n)=>{this.At(t,n,!1,s,i,o)}));else{const r=B(Array.from(e).at(-1)),l=n?.at(r.J-1)??null;nt(this.it,t,l,((t,n)=>{this.At(t,n,!1,s,i,o)}))}else nt(this.it,t,null,((t,n)=>{this.At(t,n,!1,s,i,o)}))}else this.At(t,null,!1,s,i,o)}}u(t,n,e,s,i=null){const o=this.Ht(s,i),r=e,l=n;if(-1===o.oldValue.indexOf(r))o.Xt=o.Xt?o.Xt.add(l):new Set([l]);else{const t=new Set([l]);t&&(o.Yt=o.Yt?o.Yt.union(t):t,o.kt=o.kt?o.kt.union(t):new Set(t))}return o}Ot(t,n,e,s,i){const o=lt(t,n);if(e.has(o))return;e.add(o);const r=this.Jt(t,n);for(let t=0;t<r.length;t++){const n=r[t];s.has(n)||n.p(this)}const l=this.zt(t),u=l?this.#w.get(o):null,a=l?B(t.pattern+".*"):null;for(const t of u?.kt??[]){const n=B(t.Pt),e=this.Jt(n,t);for(let t=0;t<e.length;t++){const n=e[t];s.has(n)||n.p(this)}}for(const o of this.#y?.rt.Kt.get(t.pattern)??[]){const t=B(o);if(a?.pattern&&t.F.has(a.pattern))for(const n of u?.Mt??[])this.Ot(t,n,e,s,i);else this.Ot(t,n,e,s,i)}for(const o of this.#y?.rt.Qt.get(t.pattern)??[]){const t=B(o);if(t.J>0){const o=t.F.intersection(a?.F??new Set);if(o.size>0)if(u?.Mt?.size===o.size)for(const n of u?.Mt??[])nt(this.it,t,n,((t,n)=>{this.Ot(t,n,e,s,i)}));else{const r=B(Array.from(o).at(-1)),l=n?.at(r.J-1)??null;nt(this.it,t,l,((t,n)=>{this.Ot(t,n,e,s,i)}))}else nt(this.it,t,null,((t,n)=>{this.Ot(t,n,e,s,i)}))}else this.Ot(t,null,e,s,i)}}}class mt{queue=[];#S=!1;#x=!1;#y=null;ft(t,n,e){this.queue.push({info:t,It:n,value:e}),this.#x||(this.#x=!0,queueMicrotask((()=>{this.tn()})))}async nn(t,n,e){try{this.#S=!0,this.#y=t,await Y(t,this,t.state,n,(async t=>{await e(t)}))}finally{this.#S=!1}}tn(){try{for(;this.queue.length>0;){const e=this.queue;this.queue=[],this.#y||f("Engine is not initialized."),t=e,n=this.#y,new pt(n).Ft(t)}}finally{this.#x=!1}var t,n}}async function gt(t,n,e){const s=new mt;await s.nn(t,n,(async t=>{await e(s,t)}))}class wt extends x{#r;constructor(t,n,e,s,i){super(t,n,e,s,i),this.#r=this.name.slice(2);n.addEventListener(this.t,(t=>this.en(t)))}get t(){return this.#r}update(){}async en(t){const n=this.binding.it,e=this.binding.rn.sn,s=e?.ln().map((t=>t.It.index))??[],i=this.i;i.includes("preventDefault")&&t.preventDefault(),i.includes("stopPropagation")&&t.stopPropagation(),await gt(n,e,(async(n,e)=>{const i=this.binding.N.un(e);"function"!=typeof i&&f(`BindingNodeEvent: ${this.name} is not a function.`),await Reflect.apply(i,e,[t,...s])}))}p(t){}}const yt=(t,n,e)=>(s,i,o)=>{const r=S(o,n);return new wt(s,i,t,r,e)};class bt extends x{#h;get id(){return this.#h}constructor(t,n,e,s,i){super(t,n,e,s,i);const o=this.node.textContent?.slice(3)??f("BindingNodeBlock.id: invalid node");this.#h=Number(o)}}class St extends bt{#N;#v;#I=[];#o;get o(){return this.#o}constructor(t,n,e,s,i){super(t,n,e,s,i),this.#N=Sn(this.binding,this.id,this.binding.it,"",null),this.#v=this.#o=[this.#N]}l(t){f("BindingNodeIf.assignValue: not implemented")}p(t){if(t.m.has(this.binding))return;const n=this.binding.N.S(t.v);"boolean"!=typeof n&&f("BindingNodeIf.update: value is not boolean");const e=this.node.parentNode;null==e&&f("BindingNodeIf.update: parentNode is null"),n?(this.#N.an(e,this.node),this.#N.p(t),this.#o=this.#v):(this.#N.unmount(),this.#o=this.#I),t.m.add(this.binding)}}class xt extends bt{#o=[];#C=new WeakMap;#$=[];#L=0;get o(){return this.#o}get $(){return!0}init(){}cn(t){let n;return this.#L>=0?(n=this.#$[this.#L],this.#L--,n.hn(t)):n=Sn(this.binding,this.id,this.binding.it,this.binding.N.pattern+".*",t),this.#C.set(t,n),n}dn(t){t.unmount(),t.vt?.fn()}get pn(){return this.#L}set pn(t){this.#L=t}get mn(){return this.#$.length}set mn(t){t<0&&f("BindingNodeFor.setPoolLength: length is negative"),this.#$.length=t}l(t){f("BindingNodeFor.assignValue: Not implemented. Use update or applyChange.")}p(t){if(t.m.has(this.binding))return;let n=[];const e=new Set,s=this.binding.N.info,i=this.binding.N.It,o=t.Ht(s,i),r=this.node.parentNode??f("BindingNodeFor.update: parentNode is null"),l=o.oldValue.length===o.Rt?.size&&o.oldValue.length>0;let u=!1;if(l){const t=Array.from(r.childNodes),n=this.#o.at(-1)??f("BindingNodeFor.update: lastContent is null");let e=t[0];for(;e&&e.nodeType===Node.TEXT_NODE&&""===e.textContent?.trim();)e=e.nextSibling;let s=t.at(-1)??null;for(;s&&s.nodeType===Node.TEXT_NODE&&""===s.textContent?.trim();)s=s.previousSibling;e===this.node&&s===n.gn(r)&&(u=!0)}if(l&&u){r.textContent="",r.append(this.node);for(let t=0;t<this.#o.length;t++){const n=this.#o[t];n.vt?.fn()}this.#$.push(...this.#o)}else{for(const t of o.Rt??[]){const n=this.#C.get(t);n&&(this.dn(n),e.add(n))}this.#$.push(...e)}let a=null;const c=this.node;this.pn=this.mn-1;const h=o.newValue.length===o.Bt?.size&&o.newValue.length>0;if(o.Tt){if(o.Yt){const t=Array.from(this.#o),e=Array.from(o.Yt);e.sort(((t,n)=>t.index-n.index));for(let n=0;n<e.length;n++){const s=e[n],i=this.#C.get(s);void 0===i&&f("BindingNodeFor.assignValue2: bindContent is not found"),t[s.index]=i;const o=t[s.index-1]?.gn(r)??c;i.an(r,o)}n=t}}else{const e=h?document.createDocumentFragment():r,s=h?null:c;for(const i of o.Mt??[]){const r=a?.gn(e)??s;let l;o.Bt?.has(i)?(l=this.cn(i),l.an(e,r),l.p(t)):(l=this.#C.get(i),void 0===l&&f("BindingNodeFor.assignValue2: bindContent is not found"),r?.nextSibling!==l.wn&&l.an(e,r)),n.push(l),a=l}if(h){const t=c.nextSibling;r.insertBefore(e,t)}}if(o.Xt)for(const n of o.Xt){const e=this.#C.get(n);void 0===e&&f("BindingNodeFor.assignValue2: bindContent is not found"),e.p(t)}this.mn=this.pn+1,this.#o=n}}const Nt=(t,n,e)=>(s,i,o)=>{const r=S(o,n);return new xt(s,i,t,r,e)},vt="textContent",It={radio:"checked",checkbox:"checked",button:"onclick"},Ct={},$t={HTMLElement:t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLOptionElement?"value":t instanceof HTMLButtonElement||t instanceof HTMLAnchorElement?"onclick":t instanceof HTMLFormElement?"onsubmit":t instanceof HTMLInputElement?It[t.type]??"value":vt,SVGElement:void 0,Text:t=>vt,yn:void 0};const Lt={value:"input",checked:"change",selected:"change"};class Pt extends x{get value(){return this.node[this.name]}get C(){let t=this.value;for(let n=0;n<this.filters.length;n++)t=this.filters[n](t);return t}constructor(t,n,e,s,i){super(t,n,e,s,i);if(!(this.node instanceof HTMLElement))return;if(!((o=this.node)instanceof HTMLInputElement||o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement))return;var o;const r=function(t,n){const e=t.constructor.name+"\t"+(t.type??"");return Ct[e]??(Ct[e]=$t[n]?.(t))}(this.node,"HTMLElement");if(r!==this.name)return;i.length>1&&f(`BindingNodeProperty: ${this.name} has multiple decorators`);const l=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??Lt[this.name]??"readonly";if("readonly"===l||"ro"===l)return;const u=this.binding.it;this.node.addEventListener(l,(async()=>{const n=this.binding.rn.sn,e=this.C;await gt(u,n,(async(n,s)=>{t.bn(s,e)}))}))}init(){}l(t){(null==t||Number.isNaN(t))&&(t=""),this.node[this.name]=t}}const Bt=(t,n,e)=>(s,i,o)=>{const r=S(o,n);return new Pt(s,i,t,r,e)};class Mt extends x{l(t){(null==t||Number.isNaN(t))&&(t="");const n=this.node;n.checked=t.toString()===n.value.toString()}}class Et extends x{#r;get t(){return this.#r}constructor(t,n,e,s,i){super(t,n,e,s,i);const[,o]=this.name.split(".");this.#r=o}l(t){(null==t||Number.isNaN(t))&&(t="");this.node.style.setProperty(this.t,t.toString())}}const Tt="component-state-input",kt=Symbol.for(`${Tt}.AssignState`),Rt=Symbol.for(`${Tt}.NotifyRedraw`),Vt=new WeakMap;class Ft extends x{#r;get t(){return this.#r}constructor(t,n,e,s,i){super(t,n,e,s,i);const[,o]=this.name.split(".");this.#r=o}init(){const t=this.binding.it;var n,e;n=t.bt,e=this.node,Vt.set(e,n);let s=t.Sn.get(this.node);void 0===s&&t.Sn.set(this.node,s=new Set),s.add(this.binding)}l(t){}h(t){const n=[],e=this.binding.N.info,s=this.binding.N.It?.at(e.J-1)??null,i=(s?.length??0)-1;for(const o of t)if(e.P.length>o.info.P.length){if(e.T.has(o.info.pattern)){const t=(o.It?.length??0)-1;if(t>=0){if(null===s)continue;if(o.It!==s?.at(t))continue}n.push({info:e,It:s})}}else if(!o.info.T.has(e.pattern)){if(i>=0&&o.It?.at(i)!==s)continue;n.push(o)}if(0===n.length)return;this.node.state[Rt](n)}}const At={0:{class:(t,n,e)=>(s,i,o)=>{const r=S(o,n);return new I(s,i,t,r,e)},checkbox:(t,n,e)=>(s,i,o)=>{const r=S(o,n);return new v(s,i,t,r,e)},radio:(t,n,e)=>(s,i,o)=>{const r=S(o,n);return new Mt(s,i,t,r,e)}},1:{if:(t,n,e)=>(s,i,o)=>{const r=S(o,n);return new St(s,i,t,r,e)}}},Ot={class:(t,n,e)=>(s,i,o)=>{const r=S(o,n);return new C(s,i,t,r,e)},attr:(t,n,e)=>(s,i,o)=>{const r=S(o,n);return new N(s,i,t,r,e)},style:(t,n,e)=>(s,i,o)=>{const r=S(o,n);return new Et(s,i,t,r,e)},state:(t,n,e)=>(s,i,o)=>{const r=S(o,n);return new Ft(s,i,t,r,e)}};const Ht={};function zt(t,n,e,s){const i=t instanceof Comment,o=t instanceof Element,r=i+"\t"+o+"\t"+n,l=Ht[r]??(Ht[r]=function(t,n,e){const s=At[t?1:0][e];if(void 0!==s)return s;if(t&&"for"===e)return Nt;t&&f(`getBindingNodeCreator: unknown node property ${e}`);const i=e.split("."),o=Ot[i[0]];return void 0!==o?o:n&&e.startsWith("on")?yt:Bt}(i,o,n));return l(n,e,s)}class Dt{#t;#P;#B;#M=null;#s;get pattern(){return this.#P}get info(){return this.#B}get It(){return null===this.#M?null:this.#M.deref()??f("listIndex is null")}get filters(){return this.#s}get binding(){return this.#t}constructor(t,n,e){this.#t=t,this.#P=n,this.#B=B(n),this.#s=e}un(t){return t[F](this.info,this.It)}S(t){let n=t[F](this.info,this.It);for(let t=0;t<this.#s.length;t++)n=this.#s[t](n);return n}init(){if(this.info.J>0){const t=this.info._??f("BindingState.init: wildcardLastParentPath is null"),n=this.binding.rn.sn?.find(t)??f("BindingState.init: loopContext is null");this.#M=n.xn}this.binding.it.Nn(this.info,this.It,this.binding)}l(t,n){t[A](this.info,this.It,n)}}class Wt{#t;#E;#M=null;#s;get pattern(){return f("Not implemented")}get info(){return f("Not implemented")}get It(){return null===this.#M?null:this.#M.deref()??f("listIndex is null")}get filters(){return this.#s}get binding(){return this.#t}constructor(t,n,e){this.#t=t;const s=Number(n.slice(1));isNaN(s)&&f("BindingStateIndex: pattern is not a number"),this.#E=s,this.#s=e}un(t){return this.It?.index??f("listIndex is null")}S(t){let n=this.It?.index??f("listIndex is null");for(let t=0;t<this.#s.length;t++)n=this.#s[t](n);return n}init(){const t=(this.binding.rn.sn??f("BindingState.init: loopContext is null")).ln();this.#M=t[this.#E-1].xn??f("BindingState.init: listIndexRef is null");const n=this.It??f("listIndex is null"),e=this.binding.it.vn.get(n);void 0===e?this.binding.it.vn.set(n,new Set([this.binding])):e.add(this.binding)}l(t,n){f("BindingStateIndex: assignValue is not implemented")}}const qt=new RegExp(/^\$\d+$/);function jt(t,n){return qt.test(t)?((t,n)=>(e,s)=>{const i=S(s,n);return new Wt(e,t,i)})(t,n):((t,n)=>(e,s)=>{const i=S(s,n);return new Dt(e,t,i)})(t,n)}const _t={};function Gt(t,n=(t=>t.constructor.name+"\t"+(t instanceof Comment?t.textContent?.[2]??"":""))(t)){return _t[n]??(_t[n]=(t=>t instanceof Comment&&":"===t.textContent?.[2]?"Text":t instanceof HTMLElement?"HTMLElement":t instanceof Comment&&"|"===t.textContent?.[2]?"Template":t instanceof SVGElement?"SVGElement":f(`Unknown NodeType: ${t.nodeType}`))(t))}const Zt=t=>t.trim(),Ut=t=>t.length>0,Jt=new RegExp(/^#(.*)#$/),Kt=t=>{const n=Jt.exec(t);return n?decodeURIComponent(n[1]):t},Qt=t=>{const[n,...e]=t.split(",").map(Zt);return{name:n,options:e.map(Kt)}},Xt=t=>{const[n,...e]=t.split("|").map(Zt);return{In:n,filters:e.map(Qt)}},Yt=t=>t.split(";").map(Zt).filter(Ut).map((t=>(t=>{const[n,e=null]=t.split("@").map(Zt),s=e?e.split(",").map(Zt):[],[i,o]=n.split(":").map(Zt),{In:r,filters:l}=Xt(i),{In:u,filters:a}=Xt(o);return{Cn:r,$n:u,Ln:l,Pn:a,i:s}})(t))),tn={};const nn=t=>{t.removeAttribute("data-bind")},en={HTMLElement:nn,SVGElement:nn,Text:void 0,yn:void 0};const sn={Text:t=>{const n=document.createTextNode("");return t.parentNode?.replaceChild(n,t),n},HTMLElement:void 0,yn:void 0,SVGElement:void 0};class on{nodeType;Bn;Mn;En=new Map;constructor(t){this.nodeType=Gt(t);const n=function(t,n){switch(t){case"Text":return"textContent:"+(n.textContent?.slice(3).trim()??"");case"HTMLElement":case"SVGElement":return n.getAttribute(Z)??"";case"Template":{const t=n.textContent?.slice(3).trim();return(fn(Number(t))??f(`Template not found: ${t}`)).getAttribute(Z)??""}default:return""}}(this.nodeType,t);(function(t,n){en[n]?.(t)})(t=function(t,n){return sn[n]?.(t)??t}(t,this.nodeType),this.nodeType),this.Bn=function(t){let n=[];for(;null!==t.parentNode;)n=[Array.from(t.parentNode.childNodes).indexOf(t),...n],t=t.parentNode;return n}(t),this.Mn=function(t){return""===t.trim()?[]:tn[t]??(tn[t]=Yt(t))}(n);for(let n=0;n<this.Mn.length;n++){const e=this.Mn[n],s={Tn:zt(t,e.Cn,e.Ln,e.i),kn:jt(e.$n,e.Pn)};this.En.set(e,s)}}}function rn(t){const n=[],e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode:t=>t instanceof Element?t.hasAttribute(Z)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:function(t){return t instanceof Comment&&(0===t.textContent?.indexOf(U)||0===t.textContent?.indexOf(J))}(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;e.nextNode();)n.push(e.currentNode);return n}const ln={},un={},an={};function cn(t){return rn(t).map((t=>function(t){return new on(t)}(t)))}const hn={};function dn(t,n,e){var s;return s=n.content,Array.from(s.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE||(t.nodeValue??"").trim()||s.removeChild(t)})),function(t,n,e=t){const s=cn(n),i=an[e]??(an[e]=new Set),o=un[e]??(un[e]=new Set);for(let t=0;t<s.length;t++){const n=s[t];for(let t=0;t<n.Mn.length;t++){const e=n.Mn[t];i.add(e.$n),"for"===e.Cn&&o.add(e.$n)}}ln[t]=s}(t,n.content,e),hn[t]=n,t}function fn(t){return hn[t]??f(`getTemplateById: template not found: ${t}`)}class pn{rn;node;it;Rn;N;version;constructor(t,n,e,s,i){this.rn=t,this.node=n,this.it=e,this.Rn=s(this,n,e.Vn),this.N=i(this,e.Fn)}get o(){return this.Rn.o}init(){this.Rn.init(),this.N.init()}bn(t,n){return this.N.l(t,n)}h(t){this.Rn.h(t)}p(t){t.m.has(this)||this.Rn.p(t)}}function mn(t,n,e,s,i){return new pn(t,n,e,s,i)}class gn{#T;#B;#M;#N;constructor(t,n,e){this.#T=t??f("name is required"),this.#B=B(this.#T),this.#M=new WeakRef(n),this.#N=e}get path(){return this.#T}get info(){return this.#B}get It(){return this.#M?.deref()??f("listIndex is null")}get xn(){return this.#M??f("listIndexRef is null")}hn(t){this.#M=new WeakRef(t)}fn(){this.#M=null}get An(){return this.#N}#k;get On(){if(void 0===this.#k){let t=this.An;for(;null!==t;){if(null!==t.vt&&t.vt!==this){this.#k=t.vt;break}t=t.Hn?.rn??null}void 0===this.#k&&(this.#k=null)}return this.#k}#R={};find(t){let n=this.#R[t];if(void 0===n){let e=this;for(;null!==e&&e.path!==t;)e=e.On;n=this.#R[t]=e}return n}zn(t){let n=this;for(;null!==n;)t(n),n=n.On}ln(){const t=[];return this.zn((n=>{t.unshift(n)})),t}}function wn(t){const n=fn(t)??f(`BindContent: template is not found: ${t}`),e=document.importNode(n.content,!0);if(Object.keys(Wn).length>0){const t=e.querySelectorAll(":not(:defined)");for(let n=0;n<t.length;n++){jn(t[n].tagName.toLowerCase())}}return e}function yn(t,n,e,s){const i=(t=>ln[t])(n)??f("BindContent: data-bind is not set"),o=[];for(let n=0;n<i.length;n++){const r=i[n],l=w(s,r.Bn)??f(`BindContent: node is not found: ${r.Bn}`);for(let n=0;n<r.Mn.length;n++){const s=r.Mn[n],i=r.En.get(s)??f(`BindContent: creator is not found: ${s}`),u=mn(t,l,e,i.Tn,i.kn);o.push(u)}}return o}class bn{vt;Hn;childNodes;fragment;it;#h;get id(){return this.#h}get Dn(){return this.childNodes.length>0&&this.childNodes[0].parentNode!==this.fragment}get wn(){return this.childNodes[0]??null}get Wn(){return this.childNodes[this.childNodes.length-1]??null}gn(t){const n=this.qn[this.qn.length-1],e=this.Wn;if(void 0!==n&&n.node===e&&n.o.length>0){const e=(n.o.at(-1)??f("BindContent: childBindContent is not found")).gn(t);if(null!==e)return e}return t!==e?.parentNode?null:e}#V;get sn(){if(void 0===this.#V){let t=this;for(;null!==t&&null===t.vt;)t=t.Hn?.rn??null;this.#V=t?.vt??null}return this.#V}constructor(t,n,e,s,i){this.Hn=t,this.#h=n,this.fragment=wn(n),this.childNodes=Array.from(this.fragment.childNodes),this.it=e,this.vt=null!==i?function(t,n,e){return new gn(t,n,e)}(s,i,this):null,this.qn=yn(this,n,e,this.fragment)}mount(t){for(let n=0;n<this.childNodes.length;n++)t.appendChild(this.childNodes[n])}jn(t,n){for(let e=0;e<this.childNodes.length;e++)t.insertBefore(this.childNodes[e],n)}an(t,n){const e=n?.nextSibling??null;for(let n=0;n<this.childNodes.length;n++)t.insertBefore(this.childNodes[n],e)}unmount(){const t=this.childNodes[0]?.parentElement??null;if(null!==t)for(let n=0;n<this.childNodes.length;n++)t.removeChild(this.childNodes[n])}qn=[];init(){for(let t=0;t<this.qn.length;t++)this.qn[t].init()}hn(t){null==this.vt&&f("BindContent: loopContext is null"),this.vt.hn(t),this.init()}p(t){for(let n=0;n<this.qn.length;n++){const e=this.qn[n];t.m.has(e)||e.p(t)}}}function Sn(t,n,e,s,i){const o=new bn(t,n,e,s,i);return o.init(),o}function xn(t,n,e){if(n.enableShadowDom)if(null===n._n||function(t){try{const n=document.createElement(t);return"function"==typeof n.attachShadow&&(n.attachShadow({mode:"open"}),!0)}catch{return!1}}(n._n)){if(!t.shadowRoot){t.attachShadow({mode:"open"}).adoptedStyleSheets=[e]}}else f(`ComponentEngine: Shadow DOM not supported for builtin components that extend ${n._n}`);else{const n=function(t){let n=t;for(;n;){if(n instanceof ShadowRoot)return n;n=n.parentNode}}(t.parentNode)||document,s=n.adoptedStyleSheets;s.includes(e)||(n.adoptedStyleSheets=[...s,e])}}class Nn{Gn=new Set;Zn=new Set;Un=new Map;Jn=new Map;Kn=new Map;Qn=new Map;qn=new WeakSet;Xn(t){if(this.qn.has(t))return;const n=t.N.pattern,e=t.Rn.t;if(this.Un.has(n))throw new Error(`Parent path "${n}" already has a child path.`);if(this.Jn.has(e))throw new Error(`Child path "${e}" already has a parent path.`);this.Un.set(n,e),this.Jn.set(e,n),this.Gn.add(n),this.Zn.add(e),this.Kn.set(n,t),this.Qn.set(e,t),this.qn.add(t)}Yn(t){return this.Un.get(t)}te(t){return this.Jn.get(t)}ee(t){const n=B(t).T.intersection(this.Zn);0===n.size&&f(`No parent path found for child path "${t}".`);const e=Array.from(n),s=e[e.length-1],i=t.slice(s.length),o=this.Jn.get(s);return void 0===o&&f(`No parent path found for child path "${t}".`),o+i}se(t){const n=B(t).T.intersection(this.Gn);0===n.size&&f(`No child path found for parent path "${t}".`);const e=Array.from(n),s=e[e.length-1],i=t.slice(s.length),o=this.Un.get(s);return void 0===o&&f(`No child path found for parent path "${t}".`),o+i}ie(t){if(0===this.Zn.size)return null;const n=t.T.intersection(this.Zn);if(0===n.size)return null;{const t=Array.from(n);return t[t.length-1]}}bind(t,n){const e=t.oe(n);for(const t of e??[])this.Xn(t)}}class vn{re;it;constructor(t,n){this.re=n,this.it=t}ue(t){gt(this.it,null,(async(n,e)=>{for(const[n,s]of Object.entries(t)){const t=B(n);e[A](t,null,s)}}))}h(t){for(const n of t)try{const t=B(this.re.se(n.info.pattern)),e=n.It,s=this.it.getPropertyValue(t,e);gt(this.it,null,(async(n,i)=>{n.ft(t,e,s)}))}catch(t){}}get(t,n,e){return n===kt?this.ue.bind(this):n===Rt?this.h.bind(this):"string"==typeof n?this.it.getPropertyValue(B(n),null):void f(`Property "${String(n)}" is not supported in ComponentStateInput.`)}set(t,n,e,s){if("string"==typeof n)return this.it.ae(B(n),null,e),!0;f(`Property "${String(n)}" is not supported in ComponentStateInput.`)}}class In{binding;constructor(t){this.binding=t}get(t,n){const e=this.binding.ie(t);null===e&&f(`No child path found for path "${t.toString()}".`);const s=this.binding.Qn.get(e);void 0===s&&f(`No binding found for child path "${e}".`);const i=B(this.binding.ee(t.pattern));return s.it.getPropertyValue(i,n??s.N.It)}set(t,n,e){const s=this.binding.ie(t);null===s&&f(`No child path found for path "${t.toString()}".`);const i=this.binding.Qn.get(s);void 0===i&&f(`No binding found for child path "${s}".`);const o=B(this.binding.ee(t.pattern));return gt(i.it,null,(async(t,s)=>{s[A](o,n??i.N.It,e)})),!0}startsWith(t){return null!==this.binding.ie(t)}st(t,n){const e=this.binding.ie(t);null===e&&f(`No child path found for path "${t.toString()}".`);const s=this.binding.Qn.get(e);void 0===s&&f(`No binding found for child path "${e}".`);const i=B(this.binding.ee(t.pattern));return s.it.st(i,n)}}class Cn{type="autonomous";config;ce;styleSheet;he;state;Vn;Fn;#N=null;get An(){return null===this.#N&&f("bindContent is not initialized yet"),this.#N}de=HTMLElement;bt;vn=new WeakMap;Sn=new WeakMap;fe=new Set;#F=Promise.withResolvers();#A=null;#O=function(){return new Nn}();pe;ht;#H=null;#z=null;#D=!1;constructor(t,n){this.config=t,this.config._n&&(this.type="builtin");const e=n.constructor;var s;this.ce=e.ce,this.styleSheet=e.styleSheet,this.he=e.he,this.state=new this.he,this.Vn=e.Vn,this.Fn=e.Fn,this.bt=n,this.pe=function(t,n){const e=new vn(t,n);return new Proxy({},e)}(this,this.#O),this.ht=(s=this.#O,new In(s))}get rt(){return this.bt.constructor.rt}me(){const t=this.bt.constructor;this.#N=Sn(null,t.id,this,null,null)}get we(){return this.#F}async connectedCallback(){if(await(this.#A?.promise),await(this.bt.ye?.we.promise),this.bt.dataset.state)try{const t=JSON.parse(this.bt.dataset.state);this.pe[kt](t)}catch(t){f("Failed to parse state from dataset")}const t=this.bt.ye;if(t&&(t.be(this.bt),this.#O.bind(t,this.bt)),this.config.Se)xn(this.bt,this.config,this.styleSheet);else{this.#z=this.bt.parentNode,this.#H=document.createComment("Structive block placeholder");try{this.#D=!0,this.bt.replaceWith(this.#H)}finally{this.#D=!1}}if(this.config.Se)this.An.mount(this.bt.shadowRoot??this.bt);else{const t=this.#z??f("Block parent node is not set");this.An.an(t,this.#H)}await gt(this,null,(async(t,n)=>{for(const n of this.rt.xe){const e=B(n);1===e.P.length&&(this.rt.Ne.has(n)||t.ft(e,null,null))}await n[H]()})),queueMicrotask((()=>{this.#F.resolve()}))}async disconnectedCallback(){this.#A=Promise.withResolvers();try{if(this.#D)return;await gt(this,null,(async(t,n)=>{await n[z]()})),this.bt.ye?.ve(this.bt),this.config.Se||(this.#H?.remove(),this.#H=null,this.#z=null)}finally{this.#A.resolve()}}#W={};#q=new WeakMap;Ie(){return{list:null,Lt:null,qn:[]}}Ce(t,n){if(null===n){let n=this.#W[t.id];return void 0===n&&(n=this.Ie(),this.#W[t.id]=n),n}{let e=this.#q.get(n);void 0===e&&(e={},this.#q.set(n,e));let s=e[t.id];return void 0===s&&(s=this.Ie(),e[t.id]=s),s}}Nn(t,n,e){this.Ce(t,n).qn.push(e)}Gt(t,n,e){this.Ce(t,n).Lt=e}Ut(t,n,e){this.Ce(t,n).list=e}Jt(t,n){return this.Ce(t,n).qn}st(t,n){if(this.ht.startsWith(t))return this.ht.st(t,n);return this.Ce(t,n).Lt}Zt(t,n){return this.Ce(t,n).list}getPropertyValue(t,n){return rt(this,this.state)[F](t,n)}ae(t,n,e){gt(this,null,(async(s,i)=>{i[A](t,n,e)}))}be(t){this.fe.add(t)}ve(t){this.fe.delete(t)}}const $n=/\{\{([^\}]+)\}\}/g,Ln=new Set(["if","for","endif","endfor","elseif","else"]);const Pn="http://www.w3.org/2000/svg";function Bn(t,n,e=t){if(n.parentNode?.replaceChild(document.createComment(`${J}${t}`),n),n.namespaceURI===Pn){const t=document.createElement("template"),e=Array.from(n.childNodes);for(let n=0;n<e.length;n++){const s=e[n];t.content.appendChild(s)}const s=n.getAttribute(Z);t.setAttribute(Z,s??""),n=t}return n.content.querySelectorAll("template").forEach((t=>{Bn(d(),t,e)})),dn(t,n,e),t}function Mn(t,n){const e=document.createElement("template");e.dataset.id=t.toString(),e.innerHTML=function(t){const n=[];return t.replaceAll($n,((t,e)=>{e=e.trim();const[s]=e.split(":");if(!Ln.has(s))return`\x3c!--${U}${e}--\x3e`;const i=e.slice(s.length+1).trim(),o={type:s,$e:e,Le:i};if("if"===s||"for"===s)return n.push(o),`<template data-bind="${e}">`;if("endif"===s){const t=[];for(;;){const e=n.pop()??f("replaceMustacheToTemplateOrEmbed: endif without if");if("if"===e.type){t.push("</template>");break}"elseif"===e.type?t.push("</template>"):f("replaceMustacheToTemplateOrEmbed: endif without if")}return t.join("")}if("endfor"===s){if("for"===(n.pop()??f("replaceMustacheToTemplateOrEmbed: endif without if")).type)return"</template>";f("replaceMustacheToTemplateOrEmbed: endfor without for")}else if("elseif"===s){const t=n.at(-1)??f("replaceMustacheToTemplateOrEmbed: elseif without if");if("if"===t.type||"elseif"===t.type)return n.push(o),`</template><template data-bind="if:${t.Le}|not"><template data-bind="if:${i}">`;f("replaceMustacheToTemplateOrEmbed: elseif without if")}else if("else"===s){const t=n.at(-1)??f("replaceMustacheToTemplateOrEmbed: else without if");if("if"===t.type)return`</template><template data-bind="if:${t.Le}|not">`;f("replaceMustacheToTemplateOrEmbed: else without if")}else f("replaceMustacheToTemplateOrEmbed: unknown type")}))}(n),Bn(t,e)}const En=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/,Tn=/^[a-zA-Z_$][0-9a-zA-Z_$]*(\.[a-zA-Z_$][0-9a-zA-Z_$]*|\.\*)*$/;function kn(t,n){const e=new Set(t.M).intersection(n);let s=-1,i="";for(const t of e){const n=t.split(".");1!==n.length&&(n.length>s&&(s=n.length,i=t))}if(i.length>0){if(!Tn.test(i))throw new Error(`Invalid path: ${i}`);const n=B(i),e=[];let s=n.J;for(let i=n.P.length;i<t.P.length;i++){const n=t.P[i];if("*"===n)e.push("[this.$"+(s+1)+"]"),s++;else{if(!En.test(n))throw new Error(`Invalid segment name: ${n}`);e.push("."+n)}}const o=e.join("");return{get:new Function("",`return this["${i}"]${o};`),set:new Function("value",`this["${i}"]${o} = value;`)}}{const n=[];let e=0;for(let s=0;s<t.P.length;s++){const i=t.P[s];if("*"===i)n.push("[this.$"+(e+1)+"]"),e++;else{if(!En.test(i))throw new Error(`Invalid segment name: ${i}`);n.push((n.length>0?".":"")+i)}}const s=n.join("");return{get:new Function("",`return this.${s};`),set:new Function("value",`this.${s} = value;`)}}}class Rn{xe=new Set;_t=new Set;elements=new Set;Ne=new Set;ot=new Set;ut=new Set;Pe=new Set;Kt=new Map;Qt=new Map;#h;#j;constructor(t){this.#h=t.id,this.#j=t.he;const n=(t=>an[t]??[])(this.#h);for(const t of n){const n=B(t);this.xe=this.xe.union(n.T)}const e=(t=>un[t]??[])(this.#h);this._t=this._t.union(e);for(const t of e){const n=t+".*";this.elements.add(n)}let s=this.#j.prototype;for(;s&&s!==Object.prototype;){const t=Object.getOwnPropertyDescriptors(s);if(t)for(const[n,e]of Object.entries(t)){if(P.has(n))continue;if("function"==typeof e.value){this.Ne.add(n);continue}const t=void 0!==e.get,s=void 0!==e.set,i=B(n);this.xe=this.xe.union(i.T),t&&this.ot.add(n),s&&this.ut.add(n)}s=Object.getPrototypeOf(s)}for(const t of this.xe){if(this.ot.has(t))continue;if(this.ut.has(t))continue;const n=B(t);if(1===n.P.length)continue;const e=kn(n,this.ot);Object.defineProperty(this.#j.prototype,t,{get:e.get,set:e.set,enumerable:!0,configurable:!0}),this.Pe.add(t)}for(const t of this.xe){const n=B(t);n.Z&&(this.Kt.get(n.Z)?.add(t)??this.Kt.set(n.Z,new Set([t])))}}ct(t,n){this.Qt.get(n)?.add(t)??this.Qt.set(n,new Set([t]))}}function Vn(t){const e=function(t){const e=n();return{Se:void 0===t.Se||t.Se,enableShadowDom:t.enableShadowDom??e.enableShadowDom,_n:t._n??null}}(t.he.Be??{}),s=d(),{Me:i,Ee:o,he:r}=t,l=Object.assign({},c),u=Object.assign({},a);r.Te=!0,Mn(s,i),g(s,o),function(t,n){p[t]=n}(s,r);const h=function(t){return t?document.createElement(t).constructor:HTMLElement}(e._n),w=e._n;return class extends h{#y;constructor(){super(),this.#y=function(t,n){return new Cn(t,n)}(e,this),this.#y.me()}connectedCallback(){this.#y.connectedCallback()}disconnectedCallback(){this.#y.disconnectedCallback()}#_;get ye(){var t;return void 0===this.#_&&(this.#_=(t=this,Vt.get(t)??null)),this.#_}get state(){return this.#y.pe}get ke(){return this.#y.he.Te??!1}get we(){return this.#y.we}oe(t){return this.#y.Sn.get(t)??null}be(t){this.#y.be(t)}ve(t){this.#y.ve(t)}static define(t){w?customElements.define(t,this,{_n:w}):customElements.define(t,this)}static get id(){return s}static#G=i;static get Me(){return this.#G}static set Me(t){this.#G=t,Mn(this.id,t),this.#Z=null,this.#U=null}static#J=o;static get Ee(){return this.#J}static set Ee(t){this.#J=t,g(this.id,t),this.#K=null}static#Z=null;static get ce(){return this.#Z||(this.#Z=fn(this.id)),this.#Z}static#K=null;static get styleSheet(){return this.#K||(this.#K=function(t){return m[t]??f(`getStyleSheetById: stylesheet not found: ${t}`)}(this.id)),this.#K}static#j=null;static get he(){return this.#j||(this.#j=function(t){return p[t]??f(`getStateClassById: stateClass not found: ${t}`)}(this.id)),this.#j}static#Q=l;static get Vn(){return this.#Q}static#X=u;static get Fn(){return this.#X}static#U=null;static get rt(){return this.#U||(this.#U=new Rn(this)),this.#U}}}function Fn(t){return t.replaceAll(/<!--\{\{([^\}]+)\}\}-->/g,((t,n)=>`{{${n}}}`))}async function An(t){const n=await fetch(import.meta.resolve(t));return async function(t){const n=document.createElement("template");n.innerHTML=function(t){return t.replaceAll(/\{\{([^\}]+)\}\}/g,((t,n)=>`\x3c!--{{${n}}}--\x3e`))}(t);const e=n.content.querySelector("template");e?.remove();const s=n.content.querySelector("script[type=module]"),i=btoa(String.fromCodePoint(...(new TextEncoder).encode(s.text))),o=s?await import("data:application/javascript;base64,"+i):{};s?.remove();const r=n.content.querySelector("style");r?.remove();const l=o.default??class{};return{text:t,Me:Fn(e?.innerHTML??"").trim(),Ee:r?.textContent??"",he:l}}(await n.text())}function On(t,n){n.define(t)}const Hn="@routes/",zn="@components/",Dn="#lazy",Wn={};async function qn(){const t=function(){const t={};return document.querySelectorAll("script[type='importmap']").forEach((n=>{const e=JSON.parse(n.innerHTML);e.imports&&(t.imports=Object.assign(t.imports||{},e.imports))})),t}();if(t.imports){const n=new Map;for(const[e,s]of Object.entries(t.imports)){let t,s;if(e.startsWith(Hn)){s=e.endsWith(Dn);const n=e.slice(7,s?-5:void 0);t="routes"+n.replace(/:[^\s/]+/g,"").replace(/\//g,"-"),Jn(t,"/root"===n?"/":n)}e.startsWith(zn)&&(s=e.endsWith(Dn),t=e.slice(12,s?-5:void 0)),t&&(s?Wn[t]=e:n.set(t,e))}for(const[t,e]of n.entries()){On(t,Vn(await An(e)))}}}function jn(t){const n=Wn[t];n?(delete Wn[t],queueMicrotask((async()=>{const e=Vn(await An(n));On(t,e)}))):console.warn(`loadLazyLoadComponent: alias not found for tagName: ${t}`)}const _n="routes:",Gn=[];let Zn=null;class Un extends HTMLElement{Re=window.location.pathname;Ve=window.location.pathname.split("/").pop()||"";Fe=document.querySelector("base")?.href.replace(window.location.origin,"")||"/";Ae;constructor(){super(),this.Ae=this.Oe.bind(this)}connectedCallback(){Zn=this,this.innerHTML='<slot name="content"></slot>',window.addEventListener("popstate",this.Ae),window.dispatchEvent(new Event("popstate"))}disconnectedCallback(){window.removeEventListener("popstate",this.Ae),Zn=null}Oe(t){t.preventDefault(),this.Ft()}navigate(t){const n="/"===t[0]?this.Fe+t.slice(1):t;history.pushState({},"",n),this.Ft()}Ft(){Array.from(this.childNodes).filter((t=>"content"===t.getAttribute?.("slot"))).forEach((t=>this.removeChild(t)));const t=window.location.pathname.split("/");t.at(-1)===this.Ve&&(t[t.length-1]="");const n=t.join("/").replace(this.Fe,""),e="/"!==n[0]?"/"+n:n;let s,i={};for(const[t,n]of Gn){const o=new RegExp("^"+t.replace(/:[^\s/]+/g,"([^/]+)")+"$");if(o.test(e)){s=n;const r=e.match(o);if(r){(t.match(/:[^\s/]+/g)||[]).forEach(((t,n)=>{i[t.substring(1)]=r[n+1]}))}break}}if(s){const t=document.createElement(s);t.setAttribute("data-state",JSON.stringify(i)),t.setAttribute("slot","content"),this.appendChild(t),function(t){return Wn.hasOwnProperty(t)}(s)&&jn(s)}else{const t=document.createElement("h1");t.setAttribute("slot","content"),t.textContent="404 Not Found",this.appendChild(t)}}}function Jn(t,n){n.startsWith(_n)&&(n=n.substring(_n.length)),Gn.push([n,t])}function Kn(){return Zn}const Qn="router",Xn=`<slot name="${Qn}"></slot>`;class Yn extends HTMLElement{constructor(){super(),e.enableShadowDom&&this.attachShadow({mode:"open"})}async connectedCallback(){await this.He(),this.Ft()}get root(){return this.shadowRoot??this}async He(){if(e.layoutPath){const t=await fetch(e.layoutPath);if(t.ok){const n=await t.text(),e=document.createElement("template");e.innerHTML=n;const s=e.content.querySelector("template"),i=e.content.querySelector("style");if(this.root.appendChild(s?.content??document.createDocumentFragment()),i){const t=this.shadowRoot??document,n=t.adoptedStyleSheets;n.includes(i)||(t.adoptedStyleSheets=[...n,i])}}else f(`Failed to load layout from ${e.layoutPath}`)}else this.root.innerHTML=Xn}Ft(){if(e.enableRouter){const t=document.createElement(e.routerTagName);t.setAttribute("slot",Qn),this.root.appendChild(t)}}}const te=e;let ne=!1;async function ee(t){await async function(t){for(const[n,s]of Object.entries(t)){let t=null;if(e.enableRouter){const t=s.startsWith("@routes")?s.slice(7):s;Jn(n,"/root"===t?"/":t)}t=await An(s),On(n,Vn(t))}}(t),te.autoInit&&await se()}async function se(){ne||(await async function(){if(e.autoLoadFromImportMap&&await qn(),e.enableRouter&&customElements.define(e.routerTagName,Un),e.enableMainWrapper&&(customElements.define(e.mainTagName,Yn),e.autoInsertMainWrapper)){const t=document.createElement(e.mainTagName);document.body.appendChild(t)}}(),ne=!0)}export{se as bootstrapStructive,te as config,ee as defineComponents};
//# sourceMappingURL=structive.min.js.map
