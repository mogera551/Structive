const t={debug:!1,locale:"en-US",enableShadowDom:!0,enableMainWrapper:!0,enableRouter:!0,autoInsertMainWrapper:!1,autoInit:!0,mainTagName:"app-main",routerTagName:"view-router",layoutPath:"",autoLoadFromImportMap:!1,optimizeList:!0,optimizeListElements:!0,optimizeAccessor:!0};function n(){return t}const e=n();function s(t){throw new Error(`${t} requires at least one option`)}function i(t){throw new Error(`${t} requires a number as option`)}function r(t){throw new Error(`${t} requires a number value`)}function o(t){throw new Error(`${t} requires a date value`)}const l=n(),a={eq:t=>{const n=t?.[0]??s("eq");return t=>{if("number"==typeof t){const e=Number(n);return isNaN(e)&&i("eq"),t===e}return t===n}},ne:t=>{const n=t?.[0]??s("ne");return t=>{if("number"==typeof t){const e=Number(n);return isNaN(e)&&i("eq"),t!==e}return t!==n}},not:t=>t=>("boolean"!=typeof t&&function(t){throw new Error(`${t} requires a boolean value`)}("not"),!t),lt:t=>{const n=t?.[0]??s("lt"),e=Number(n);return isNaN(e)&&i("lt"),t=>("number"!=typeof t&&r("lt"),t<e)},le:t=>{const n=t?.[0]??s("le"),e=Number(n);return isNaN(e)&&i("le"),t=>("number"!=typeof t&&r("le"),t<=e)},gt:t=>{const n=t?.[0]??s("gt"),e=Number(n);return isNaN(e)&&i("gt"),t=>("number"!=typeof t&&r("gt"),t>e)},ge:t=>{const n=t?.[0]??s("ge"),e=Number(n);return isNaN(e)&&i("ge"),t=>("number"!=typeof t&&r("ge"),t>=e)},inc:t=>{const n=t?.[0]??s("inc"),e=Number(n);return isNaN(e)&&i("inc"),t=>("number"!=typeof t&&r("inc"),t+e)},dec:t=>{const n=t?.[0]??s("dec"),e=Number(n);return isNaN(e)&&i("dec"),t=>("number"!=typeof t&&r("dec"),t-e)},mul:t=>{const n=t?.[0]??s("mul"),e=Number(n);return isNaN(e)&&i("mul"),t=>("number"!=typeof t&&r("mul"),t*e)},div:t=>{const n=t?.[0]??s("div"),e=Number(n);return isNaN(e)&&i("div"),t=>("number"!=typeof t&&r("div"),t/e)},fix:t=>{const n=Number(t?.[0]??0);return isNaN(n)&&i("div"),t=>("number"!=typeof t&&r("div"),t.toFixed(n))},locale:t=>{const n=t?.[0]??l.locale;return t=>("number"!=typeof t&&r("locale"),t.toLocaleString(n))},uc:t=>t=>t.toString().toUpperCase(),lc:t=>t=>t.toString().toLowerCase(),cap:t=>t=>{const n=t.toString();return 0===n.length?n:1===n.length?n.toUpperCase():n.charAt(0).toUpperCase()+n.slice(1)},trim:t=>t=>t.toString().trim(),slice:t=>{const n=t?.[0]??s("slice"),e=Number(n);return isNaN(e)&&i("slice"),t=>t.toString().slice(e)},substr:t=>{const n=t?.[0]??s("substr"),e=Number(n);isNaN(e)&&i("substr");const r=t?.[1]??s("substr"),o=Number(r);return isNaN(o)&&i("substr"),t=>t.toString().substr(e,o)},pad:t=>{const n=t?.[0]??s("pad"),e=Number(n);isNaN(e)&&i("pad");const r=t?.[1]??"0";return t=>t.toString().padStart(e,r)},rep:t=>{const n=t?.[0]??s("rep"),e=Number(n);return isNaN(e)&&i("rep"),t=>t.toString().repeat(e)},rev:t=>t=>t.toString().split("").reverse().join(""),int:t=>t=>parseInt(t,10),float:t=>t=>parseFloat(t),round:t=>{const n=t?.[0]??0,e=Math.pow(10,Number(n));return isNaN(e)&&i("round"),t=>("number"!=typeof t&&r("round"),Math.round(t*e)/e)},floor:t=>{const n=t?.[0]??0,e=Math.pow(10,Number(n));return isNaN(e)&&i("floor"),t=>("number"!=typeof t&&r("floor"),Math.floor(t*e)/e)},ceil:t=>{const n=t?.[0]??0,e=Math.pow(10,Number(n));return isNaN(e)&&i("ceil"),t=>("number"!=typeof t&&r("ceil"),Math.ceil(t*e)/e)},percent:t=>{const n=Number(t?.[0]??0);return isNaN(n)&&i("percent"),t=>("number"!=typeof t&&r("percent"),t.toFixed(n)+"%")},date:t=>{const n=t?.[0]??l.locale;return t=>(t instanceof Date||o("date"),t.toLocaleDateString(n))},time:t=>{const n=t?.[0]??l.locale;return t=>(t instanceof Date||o("time"),t.toLocaleTimeString(n))},datetime:t=>{const n=t?.[0]??l.locale;return t=>(t instanceof Date||o("datetime"),t.toLocaleString(n))},ymd:t=>{const n=t?.[0]??"-";return t=>{t instanceof Date||o("ymd");const e=t.getFullYear().toString(),s=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getDate().toString().padStart(2,"0");return`${e}${n}${s}${n}${i}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const n=t?.[0]??s("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?n:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},u=a,c=a;let h=0;function d(){return++h}function f(t){throw new Error(t)}const p={};const m={};function g(t,n){const e=new CSSStyleSheet;e.replaceSync(n),function(t,n){m[t]=n}(t,e)}function w(t,n){const e=t[n.name];return e||f(`outputBuiltinFiltersFn: filter not found: ${name}`),e(n.options)}const y=new Map;function b(t,n){let e=y.get(n);if(void 0===e){e=[];for(let s=0;s<n.length;s++)e.push(w(t,n[s]));y.set(n,e)}return e}class N{#t;#n;#e;#s;#i;#r=new Set;get node(){return this.#n}get name(){return this.#e}get t(){return this.#e}get binding(){return this.#t}get i(){return this.#i}get filters(){return this.#s}get o(){return this.#r}constructor(t,n,e,s,i){this.#t=t,this.#n=n,this.#e=e,this.#s=s,this.#i=i}init(){}l(t){f("BindingNode: assignValue not implemented")}u(t,n){f("BindingNode: updateElements not implemented")}h(t){}p(t){if(t.m.has(this.binding))return;const n=this.binding.S.N(t.v);this.l(n),t.m.add(this.binding)}get C(){return this.node instanceof HTMLSelectElement}get value(){return null}get $(){return null}get I(){return!1}}class x extends N{#o;get t(){return this.#o}constructor(t,n,e,s,i){super(t,n,e,s,i);const[,r]=this.name.split(".");this.#o=r}l(t){(null==t||Number.isNaN(t))&&(t="");this.node.setAttribute(this.t,t.toString())}}class S extends N{l(t){Array.isArray(t)||f("BindingNodeCheckbox.update: value is not array");const n=this.node;n.checked=t.map((t=>t.toString())).includes(n.value)}}class v extends N{l(t){Array.isArray(t)||f("BindingNodeClassList.update: value is not array");this.node.className=t.join(" ")}}class C extends N{#o;get t(){return this.#o}constructor(t,n,e,s,i){super(t,n,e,s,i);const[,r]=this.name.split(".");this.#o=r}l(t){"boolean"!=typeof t&&f("BindingNodeClassName.update: value is not boolean");const n=this.node;t?n.classList.add(this.t):n.classList.remove(this.t)}}const $={};class I{static id=0;id=++I.id;P=this.id.toString();pattern;B;L;T;M;k;R;F;A;O;V;H;D;W;q;j;_;G;Z;U;J;children={};constructor(t){const n=n=>t===n?this:B(n),e=t.split("."),s=[],i=[],r=[],o={},l=[],a=[],u=[];let c="",h="",d=0;for(let t=0;t<e.length;t++)c+=e[t],"*"===e[t]&&(r.push(c),o[c]=d,l.push(n(c)),a.push(h),u.push(n(h)),d++),s.push(c),i.push(n(c)),h=c,c+=".";const f=r.length>0?r[r.length-1]:null,p=s.length>1?s[s.length-2]:null;this.pattern=t,this.B=e,this.L=e[e.length-1],this.T=s,this.M=new Set(s),this.k=i,this.R=new Set(i),this.F=r,this.A=new Set(r),this.V=o,this.O=l,this.H=new Set(l),this.D=a,this.W=new Set(a),this.q=u,this.j=new Set(u),this._=f,this.G=f?n(f):null,this.Z=p,this.U=p?n(p):null,this.J=d,this.U&&(this.U.children[this.L]=this)}}const P=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","watch","unwatch","eval","arguments","let","var","const","class","function","null","true","false","new","return"]);function B(t){let n;return n=$[t],void 0!==n?n:(P.has(t)&&f(`getStructuredPathInfo: pattern is reserved word: ${t}`),$[t]=new I(t))}const L={};class T{static id=0;id=++T.id;name;elements;K;J;X;Y;info;constructor(t){const n=t.split("."),e=n.slice(),s=[];let i=0,r=0,o="",l=0,a="none",u=[];for(let t=0;t<n.length;t++){const a=n[t];if("*"===a)e[t]="*",u.push(null),i++,l++;else{const n=Number(a);Number.isNaN(n)||(e[t]="*",u.push(n),r++,l++)}o+=a,s.push(o),o+=t<n.length-1?".":""}const c=B(e.join("."));(i>0||r>0)&&(a=i===l?"context":r===l?"all":"partial"),this.name=t,this.elements=n,this.K=s,this.J=l,this.X=a,this.Y=u,this.info=c}}function E(t){return L[t]??(L[t]=new T(t))}function M(t,n){const e=t.tt[t.nt];if(null==e)return null;const s=e.V[n];if(s>=0){const n=t.et[t.nt];return void 0===n?null:n?.at(s)??null}return null}function k(t,n,e){switch(t.X){case"none":return null;case"context":return M(e,t.info._??f("lastWildcardPath is null"))??f(`ListIndex not found: ${t.info.pattern}`);case"all":let n=null;for(let s=0;s<t.info.J;s++){const i=t.info.q[s]??f("wildcardParentPattern is null");n=Array.from(e.it.st(i,n)??[])[t.Y[s]??f("wildcardIndex is null")]??f(`ListIndex not found: ${i.pattern}`)}return n;case"partial":f(`Partial wildcard type is not supported yet: ${t.info.pattern}`)}}const R="state",F=Symbol.for(`${R}.GetByRef`),A=Symbol.for(`${R}.SetByRef`),O=Symbol.for(`${R}.SetCacheable`),V=Symbol.for(`${R}.ConnectedCallback`),H=Symbol.for(`${R}.DisconnectedCallback`);function z(t,n,e,s){t.nt++,t.nt>=t.tt.length&&(t.tt.push(null),t.et.push(null)),t.tt[t.nt]=n,t.et[t.nt]=e;try{return s()}finally{t.tt[t.nt]=null,t.et[t.nt]=null,t.nt--}}function D(t,n,e){const s=n.rt[n.ot]??null;null!=s&&n.it.ct.ut.has(s.pattern)&&n.it.ht(s,t,"reference"),n.ot++,n.ot>=n.rt.length&&n.rt.push(null),n.rt[n.ot]=t,n.dt=n.rt[n.ot]??null;try{return e()}finally{n.rt[n.ot]=null,n.ot--,n.dt=n.rt[n.ot]??null}}function W(t,n,e,s,i){return D(n,i,(()=>function(t,n,e,s,i){if(i.it.ft.startsWith(n)&&0===i.it.ct.ut.intersection(n.M).size)return i.it.ft.get(n,e);if(n.pattern in t)return z(i,n,e,(()=>Reflect.get(t,n.pattern,s)));{const r=n.U??f("propRef.stateProp.parentInfo is undefined"),o=r.J<n.J?e?.wt??null:e,l=W(t,r,o,s,i),a=n.L;if("*"===a){const t=e?.index??f("propRef.listIndex?.index is undefined");return Reflect.get(l,t)}return Reflect.get(l,a)}}(t,n,e,s,i)))}function q(t,n,e,s,i,r){try{if(r.it.ft.startsWith(n)&&0===r.it.ct.yt.intersection(n.M).size)return r.it.ft.set(n,e,s);if(n.pattern in t)return z(r,n,e,(()=>Reflect.set(t,n.pattern,s,i)));{const o=n.U??f("propRef.stateProp.parentInfo is undefined"),l=o.J<n.J?e?.wt??null:e,a=W(t,o,l,i,r),u=n.L;if("*"===u){const t=e?.index??f("propRef.listIndex?.index is undefined");return Reflect.set(a,t,s)}return Reflect.set(a,u,s)}}finally{r.Nt.bt(n,e,s)}}function j(t,n,e,s){return(n,i,r)=>{const o=B(n);null!=s.dt&&s.it.ct.ut.has(s.dt.pattern)&&s.it.ht(s.dt,o,"reference");let l=null;for(let t=0;t<o.q.length;t++){const n=o.q[t]??f("wildcardParentPath is null");l=Array.from(s.it.st(n,l)??[])[i[t]??f("index is null")]??f(`ListIndex not found: ${n.pattern}`)}return void 0===r?W(t,o,l,e,s):q(t,o,l,r,e,s)}}function _(t,n,e,s){return t=>{const n=B(t);null!=s.dt&&s.it.ct.ut.has(s.dt.pattern)&&s.it.ht(s.dt,n,"reference")}}const G="data-bind",Z="@@:",U="@@|",J={};for(let t=0;t<32;t++)J[`$${t+1}`]=t;function K(t,n,e,s){const i=J[n];if(void 0!==i){const t=s.et[s.nt];return t?.xt[i]??f(`ListIndex not found: ${n.toString()}`)}if("string"==typeof n){if("$"===n[0])switch(n){case"$resolve":return j(t,0,e,s);case"$getAll":return function(t,n,e,s){const i=j(t,0,e,s);return(t,n)=>{const e=B(t);if(null!=s.dt&&s.it.ct.ut.has(s.dt.pattern)&&s.it.ht(s.dt,e,"reference"),void 0===n){for(let t=0;t<e.O.length;t++){const i=e.O[t]??f("wildcardPattern is null"),r=M(s,i.pattern);if(r){n=r.xt;break}}void 0===n&&(n=[])}const r=(t,n,e,i,o,l,a)=>{const u=t[n]??null;if(null===u)return void a.push(l);const c=s.it.st(u,e)??f(`ListIndex not found: ${u.pattern}`),h=Array.from(c),d=i[o]??null;if(null===d)for(let e=0;e<h.length;e++){const s=h[e];r(t,n+1,s,i,o+1,l.concat(s.index),a)}else{const e=h[d]??f(`ListIndex not found: ${u.pattern}`);n+1<t.length&&r(t,n+1,e,i,o+1,l.concat(e.index),a)}},o=[];r(e.q,0,null,n,0,[],o);const l=[];for(let t=0;t<o.length;t++)l.push(i(e.pattern,o[t]));return l}}(t,0,e,s);case"$trackDependency":return _(0,0,0,s);case"$navigate":return t=>Un()?.navigate(t);case"$component":return s.it.St}const i=E(n),r=k(i,0,s);return W(t,i.info,r,e,s)}if("symbol"==typeof n)switch(n){case F:return(n,i)=>W(t,n,i,e,s);case A:return(n,i,r)=>q(t,n,i,r,e,s);case V:return()=>async function(t,n,e){const s=Reflect.get(t,"$connectedCallback");"function"==typeof s&&await s.call(e)}(t,0,e);case H:return()=>async function(t,n,e){const s=Reflect.get(t,"$disconnectedCallback");"function"==typeof s&&await s.call(e)}(t,0,e);default:return Reflect.get(t,n,e)}}let Q=class{it;dt=null;rt=Array(32).fill(null);ot=-1;tt=Array(32).fill(null);et=Array(32).fill(null);nt=-1;vt=null;Nt;constructor(t,n){this.it=t,this.Nt=n}get(t,n,e){return K(t,n,e,this)}set(t,n,e,s){return function(t,n,e,s,i){if("string"==typeof n){const r=E(n),o=k(r,0,i);return q(t,r.info,o,e,s,i)}return Reflect.set(t,n,e,s)}(t,n,e,s,this)}};async function X(t,n,e,s,i){const r=new Q(t,n),o=new Proxy(e,r);return async function(t,n,e){t.vt&&f("already in loop context"),t.vt=n;try{n?await async function(t,n,e,s){t.nt++,t.nt>=t.tt.length&&(t.tt.push(null),t.et.push(null)),t.tt[t.nt]=n,t.et[t.nt]=e;try{await s()}finally{t.tt[t.nt]=null,t.et[t.nt]=null,t.nt--}}(t,n.info,n.Ct,e):await e()}finally{t.vt=null}}(r,s,(async()=>{await i(o)}))}function Y(t,n,e,s,i){return D(n,i,(()=>function(t,n,e,s,i){let r,o="";if(i.$t){const t=null===e?n.P:n.P+"#"+e.P,s=i.cache[t];if(void 0!==s)return s;if(t in i.cache)return;o=t}try{if(i.it.ft.startsWith(n)&&0===i.it.ct.ut.intersection(n.M).size)return r=i.it.ft.get(n,e);if(n.pattern in t)return r=z(i,n,e,(()=>Reflect.get(t,n.pattern,s)));{const o=n.U??f("propRef.stateProp.parentInfo is undefined"),l=o.J<n.J?e?.wt??null:e,a=Y(t,o,l,s,i),u=n.L;if("*"===u){const t=e?.index??f("propRef.listIndex?.index is undefined");return r=Reflect.get(a,t)}return r=Reflect.get(a,u)}}finally{i.$t&&(i.cache[o]=r)}}(t,n,e,s,i)))}function tt(t,n,e,s){return(n,i,r)=>{const o=B(n);null!=s.dt&&s.it.ct.ut.has(s.dt.pattern)&&s.it.ht(s.dt,o,"reference");let l=null;for(let t=0;t<o.q.length;t++){const n=o.q[t]??f("wildcardParentPath is null");l=Array.from(s.it.st(n,l)??[])[i[t]??f("index is null")]??f(`ListIndex not found: ${n.pattern}`)}if(void 0===r)return Y(t,o,l,e,s);f(`Cannot set value on a readonly proxy: ${n}`)}}function nt(t,n,e,s){const i=J[n];if(void 0!==i){const t=s.et[s.nt];return t?.xt[i]??f(`ListIndex not found: ${n.toString()}`)}if("string"==typeof n){if("$"===n[0])switch(n){case"$resolve":return tt(t,0,e,s);case"$getAll":return function(t,n,e,s){const i=tt(t,0,e,s);return(t,n)=>{const e=B(t);if(null!=s.dt&&s.it.ct.ut.has(s.dt.pattern)&&s.it.ht(s.dt,e,"reference"),void 0===n){for(let t=0;t<e.O.length;t++){const i=e.O[t]??f("wildcardPattern is null"),r=M(s,i.pattern);if(r){n=r.xt;break}}void 0===n&&(n=[])}const r=(t,n,e,i,o,l,a)=>{const u=t[n]??null;if(null===u)return void a.push(l);const c=s.it.st(u,e)??f(`ListIndex not found: ${u.pattern}`),h=Array.from(c),d=i[o]??null;if(null===d)for(let e=0;e<h.length;e++){const s=h[e];r(t,n+1,s,i,o+1,l.concat(s.index),a)}else{const e=h[d]??f(`ListIndex not found: ${u.pattern}`);n+1<t.length&&r(t,n+1,e,i,o+1,l.concat(e.index),a)}},o=[];r(e.q,0,null,n,0,[],o);const l=[];for(let t=0;t<o.length;t++)l.push(i(e.pattern,o[t]));return l}}(t,0,e,s);case"$trackDependency":return _(0,0,0,s);case"$navigate":return t=>Un()?.navigate(t);case"$component":return s.it.St}const i=E(n),r=k(i,0,s);return Y(t,i.info,r,e,s)}if("symbol"==typeof n)switch(n){case F:return(n,i)=>Y(t,n,i,e,s);case O:return t=>function(t,n){t.$t=!0,t.cache={};try{n()}finally{t.$t=!1}}(s,t);default:return Reflect.get(t,n,e)}}class et{it;$t=!1;cache={};dt=null;rt=Array(32).fill(null);ot=-1;tt=Array(32).fill(null);et=Array(32).fill(null);nt=-1;vt=null;constructor(t){this.it=t}get(t,n,e){return nt(t,n,e,this)}set(t,n,e,s){f(`Cannot set property ${String(n)} of readonly state.`)}}function st(t,n){return new Proxy(n,new et(t))}function it(t,n){return null==n?t.P:t.P+"#"+n.P}let rt=0,ot=0;class lt{#l=null;#a=0;#u=0;#c;#h=++ot;#d=this.#h.toString();constructor(t,n){this.#l=t,this.#a=t?t.position+1:0,this.#u=n,this.#c=rt}get wt(){return this.#l}get id(){return this.#h}get P(){return this.#d}get position(){return this.#a}get length(){return this.#a+1}get index(){return this.#u}set index(t){this.#u=t,this.#c=++rt,this.xt[this.#a]=t}get version(){return this.#c}get It(){return null!==this.#l&&(this.#l.It||this.#l.version>this.#c)}#f;get xt(){return null===this.#l?void 0===this.#f&&(this.#f=[this.#u]):(void 0===this.#f||this.It)&&(this.#f=[...this.#l.xt,this.#u],this.#c=rt),this.#f}#p;get Pt(){return null===this.#l?void 0===this.#p&&(this.#p=[new WeakRef(this)]):void 0===this.#p&&(this.#p=[...this.#l.Pt,new WeakRef(this)]),this.#p}at(t){return t>=0?this.Pt[t]?.deref()||null:this.Pt[this.Pt.length+t]?.deref()||null}}function at(t,n){return new lt(t,n)}function ut(t,n){const e=new Set,s=new Set;for(let i=0;i<t.length;i++){const t=at(n,i);e.add(t),s.add(t)}return{Bt:e,Lt:s}}function ct(t,n,e,s){if(null!=t&&null!=e){if(n||f("Old list indexes set is not provided for existing old value."),t.length>0&&e.length>0)return function(t,n,e,s){const i=new Set,r=new Set,o=new Set,l=Map.groupBy(n,(n=>t[n.index]));for(let t=0;t<e.length;t++){const n=l.get(e[t])?.shift();if(n)n.index!==t&&(n.index=t,r.add(n)),o.add(n);else{const n=at(s,t);i.add(n),o.add(n)}}return{Bt:i,Tt:r,Et:n.difference(o),Lt:o}}(t,n,e,s);if(e.length>0)return ut(e,s);return{Et:n?new Set(n):new Set}}if(null!=e)return ut(e,s);return{Et:n?new Set(n):new Set}}class ht{#m=new Set;#g=new Set;#w=new Map;#y;#b=null;constructor(t){this.#y=t}get m(){return this.#m}get Mt(){return this.#g}get v(){return this.#b||f("ReadonlyState is not initialized."),this.#b}get it(){return this.#y||f("Engine is not initialized."),this.#y}kt(t){const n=this.#b=st(this.#y,this.#y.state);try{n[O]((()=>{for(const n of t)this.it.ct.Rt.has(n.info.pattern)&&this.Ft(n.info,n.Ct);for(const e of t)this.At(e.info,e.Ct,this.Mt,this.m,n)}))}finally{this.#b=null,this.#w.clear(),this.#g.clear(),this.#m.clear()}}Ot(t,n){!1===this.Vt(t)&&f("The specified info is not a list value.");const e=it(t,n);let s=this.#w.get(e);if(!s){const i=this.v[F](t,n);s=ct(this.Ht(t,n),this.zt(t,n),i,n),this.#w.set(e,s),this.Dt(t,n,i??[]),this.Wt(t,n,s.Lt??new Set)}return s}Vt(t){return this.it.ct.Rt.has(t.pattern)}zt(t,n){return this.it.st(t,n)??null}Wt(t,n,e){this.it.qt(t,n,e)}Ht(t,n){return this.it.jt(t,n)??null}Dt(t,n,e){this.it._t(t,n,e)}Gt(t,n){return this.it.Gt(t,n)??[]}Ft(t,n){const e=this.Ot(t,n);for(const n of this.it.ct.Rt){const s=B(n),i=s.q.at(-2);if(void 0!==i&&i===t)for(const t of e.Bt??[])this.Ft(s,t)}}At(t,n,e,s,i){const r=it(t,n);if(e.has(r))return;e.add(r);const o=this.Gt(t,n);for(const t of o)s.has(t)||t.p(this);const l=this.Vt(t),a=l?this.#w.get(r):null,u=l?t.pattern+".*":null;for(const r of this.#y?.ct.Zt.get(t.pattern)??[]){const t=B(r);if(u&&t.A.has(u))for(const n of a?.Lt??[])this.At(t,n,e,s,i);else this.At(t,n,e,s,i)}for(const r of this.#y?.ct.Ut.get(t.pattern)??[]){const o=B(r);if(u&&o.A.has(u))for(const t of a?.Lt??[])this.At(o,t,e,s,i);else if(o.A.has(t.pattern)){const r=o.A.intersection(t.A),l=n?.at(r.size-1)??null;this.At(o,l,e,s,i)}else this.At(o,null,e,s,i)}}}class dt{queue=[];#N=!1;#x=!1;#y=null;bt(t,n,e){this.queue.push({info:t,Ct:n,value:e}),this.#x||(this.#x=!0,queueMicrotask((()=>{this.Jt()})))}async Kt(t,n,e){try{this.#N=!0,this.#y=t,await X(t,this,t.state,n,(async t=>{await e(t)}))}finally{this.#N=!1}}Jt(){try{for(;this.queue.length>0;){const e=this.queue;this.queue=[],this.#y||f("Engine is not initialized."),t=e,n=this.#y,new ht(n).kt(t)}}finally{this.#x=!1}var t,n}}async function ft(t,n,e){const s=new dt;await s.Kt(t,n,(async t=>{await e(s,t)}))}class pt extends N{#o;constructor(t,n,e,s,i){super(t,n,e,s,i),this.#o=this.name.slice(2);n.addEventListener(this.t,(t=>this.Qt(t)))}get t(){return this.#o}update(){}async Qt(t){const n=this.binding.it,e=this.binding.Yt.Xt,s=e?.tn().map((t=>t.Ct.index))??[],i=this.i;i.includes("preventDefault")&&t.preventDefault(),i.includes("stopPropagation")&&t.stopPropagation(),await ft(n,e,(async(n,e)=>{const i=this.binding.S.nn(e);"function"!=typeof i&&f(`BindingNodeEvent: ${this.name} is not a function.`),await Reflect.apply(i,e,[t,...s])}))}}const mt=(t,n,e)=>(s,i,r)=>{const o=b(r,n);return new pt(s,i,t,o,e)};class gt extends N{#h;get id(){return this.#h}constructor(t,n,e,s,i){super(t,n,e,s,i);const r=this.node.textContent?.slice(3)??f("BindingNodeBlock.id: invalid node");this.#h=Number(r)}}class wt extends gt{#S;#v;#C=new Set;#r;get o(){return this.#r}constructor(t,n,e,s,i){super(t,n,e,s,i),this.#S=wn(this.binding,this.id,this.binding.it,"",null),this.#v=this.#r=new Set([this.#S])}p(t){if(t.m.has(this.binding))return;const n=this.binding.S.N(t.v);"boolean"!=typeof n&&f("BindingNodeIf.update: value is not boolean");const e=this.node.parentNode;null==e&&f("BindingNodeIf.update: parentNode is null"),n?(this.#S.en(e,this.node),this.#S.p(t),this.#r=this.#v):(this.#S.unmount(),this.#r=this.#C),t.m.add(this.binding)}}class yt extends gt{#$=new Set;#I=new WeakMap;#P=[];#B=0;#L=new Set;get o(){return this.#$}get I(){return!0}init(){}sn(t){let n;return this.#B>=0?(n=this.#P[this.#B],this.#B--,n.rn(t)):n=wn(this.binding,this.id,this.binding.it,this.binding.S.pattern+".*",t),this.#I.set(t,n),n}ln(t){t.unmount(),t.vt?.an()}get un(){return this.#B}set un(t){this.#B=t}get cn(){return this.#P.length}set cn(t){t<0&&f("BindingNodeFor.setPoolLength: length is negative"),this.#P.length=t}l(t){f("BindingNodeFor.assignValue: Not implemented. Use update or applyChange.")}p(t){if(!t.m.has(this.binding))return;const n=new Set,e=new Set,s=this.binding.S.info,i=this.binding.S.Ct,r=t.Ot(s,i);for(const t of r.Et??[]){const n=this.#I.get(t);n&&(this.ln(n),e.add(n))}this.#P.push(...e);let o=null;const l=this.node.parentNode??f("BindingNodeFor.update: parentNode is null"),a=this.node;this.un=this.cn-1;for(const e of r.Lt??[]){const s=o?.hn(l)??a;let i;!1===r.Bt?.has(e)?(i=this.sn(e),i.en(l,s),i.p(t)):(i=this.#I.get(e),void 0===i&&f("BindingNodeFor.assignValue2: bindContent is not found"),s?.nextSibling!==i.dn&&i.en(l,s)),n.add(i),o=i}this.cn=this.un+1,this.#$=n}}const bt=(t,n,e)=>(s,i,r)=>{const o=b(r,n);return new yt(s,i,t,o,e)},Nt="textContent",xt={radio:"checked",checkbox:"checked",button:"onclick"},St={},vt={HTMLElement:t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLOptionElement?"value":t instanceof HTMLButtonElement||t instanceof HTMLAnchorElement?"onclick":t instanceof HTMLFormElement?"onsubmit":t instanceof HTMLInputElement?xt[t.type]??"value":Nt,SVGElement:void 0,Text:t=>Nt,fn:void 0};const Ct={value:"input",checked:"change",selected:"change"};class $t extends N{get value(){return this.node[this.name]}get $(){let t=this.value;for(let n=0;n<this.filters.length;n++)t=this.filters[n](t);return t}constructor(t,n,e,s,i){super(t,n,e,s,i);if(!(this.node instanceof HTMLElement))return;if(!((r=this.node)instanceof HTMLInputElement||r instanceof HTMLTextAreaElement||r instanceof HTMLSelectElement))return;var r;const o=function(t,n){const e=t.constructor.name+"\t"+(t.type??"");return St[e]??(St[e]=vt[n]?.(t))}(this.node,"HTMLElement");if(o!==this.name)return;i.length>1&&f(`BindingNodeProperty: ${this.name} has multiple decorators`);const l=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??Ct[this.name]??"readonly";if("readonly"===l||"ro"===l)return;const a=this.binding.it;this.node.addEventListener(l,(async()=>{const n=this.binding.Yt.Xt,e=this.$;await ft(a,n,(async(n,s)=>{t.pn(s,e)}))}))}init(){}l(t){(null==t||Number.isNaN(t))&&(t=""),this.node[this.name]=t}}const It=(t,n,e)=>(s,i,r)=>{const o=b(r,n);return new $t(s,i,t,o,e)};class Pt extends N{l(t){(null==t||Number.isNaN(t))&&(t="");const n=this.node;n.checked=t.toString()===n.value.toString()}}class Bt extends N{#o;get t(){return this.#o}constructor(t,n,e,s,i){super(t,n,e,s,i);const[,r]=this.name.split(".");this.#o=r}l(t){(null==t||Number.isNaN(t))&&(t="");this.node.style.setProperty(this.t,t.toString())}}const Lt="component-state-input",Tt=Symbol.for(`${Lt}.AssignState`),Et=Symbol.for(`${Lt}.NotifyRedraw`),Mt=new WeakMap;class kt extends N{#o;get t(){return this.#o}constructor(t,n,e,s,i){super(t,n,e,s,i);const[,r]=this.name.split(".");this.#o=r}init(){const t=this.binding.it;var n,e;n=t.St,e=this.node,Mt.set(e,n);let s=t.mn.get(this.node);void 0===s&&t.mn.set(this.node,s=new Set),s.add(this.binding)}l(t){}h(t){const n=[],e=this.binding.S.info,s=this.binding.S.Ct?.at(e.J-1)??null,i=(s?.length??0)-1;for(const r of t)if(e.B.length>r.info.B.length){if(e.M.has(r.info.pattern)){const t=(r.Ct?.length??0)-1;if(t>=0){if(null===s)continue;if(r.Ct!==s?.at(t))continue}n.push({info:e,Ct:s})}}else if(!r.info.M.has(e.pattern)){if(i>=0&&r.Ct?.at(i)!==s)continue;n.push(r)}if(0===n.length)return;this.node.state[Et](n)}}const Rt={0:{class:(t,n,e)=>(s,i,r)=>{const o=b(r,n);return new v(s,i,t,o,e)},checkbox:(t,n,e)=>(s,i,r)=>{const o=b(r,n);return new S(s,i,t,o,e)},radio:(t,n,e)=>(s,i,r)=>{const o=b(r,n);return new Pt(s,i,t,o,e)}},1:{if:(t,n,e)=>(s,i,r)=>{const o=b(r,n);return new wt(s,i,t,o,e)}}},Ft={class:(t,n,e)=>(s,i,r)=>{const o=b(r,n);return new C(s,i,t,o,e)},attr:(t,n,e)=>(s,i,r)=>{const o=b(r,n);return new x(s,i,t,o,e)},style:(t,n,e)=>(s,i,r)=>{const o=b(r,n);return new Bt(s,i,t,o,e)},state:(t,n,e)=>(s,i,r)=>{const o=b(r,n);return new kt(s,i,t,o,e)}};const At={};function Ot(t,n,e,s){const i=t instanceof Comment,r=t instanceof Element,o=i+"\t"+r+"\t"+n,l=At[o]??(At[o]=function(t,n,e){const s=Rt[t?1:0][e];if(void 0!==s)return s;if(t&&"for"===e)return bt;t&&f(`getBindingNodeCreator: unknown node property ${e}`);const i=e.split("."),r=Ft[i[0]];return void 0!==r?r:n&&e.startsWith("on")?mt:It}(i,r,n));return l(n,e,s)}class Vt{#t;#T;#E;#M=null;#s;get pattern(){return this.#T}get info(){return this.#E}get Ct(){return null===this.#M?null:this.#M.deref()??f("listIndex is null")}get filters(){return this.#s}get binding(){return this.#t}constructor(t,n,e){this.#t=t,this.#T=n,this.#E=B(n),this.#s=e}nn(t){return t[F](this.info,this.Ct)}N(t){let n=this.nn(t);for(let t=0;t<this.#s.length;t++)n=this.#s[t](n);return n}init(){if(this.info.J>0){const t=this.info._??f("BindingState.init: wildcardLastParentPath is null"),n=this.binding.Yt.Xt?.find(t)??f("BindingState.init: loopContext is null");this.#M=n.gn}this.binding.it.wn(this.info,this.Ct,this.binding)}l(t,n){t[A](this.info,this.Ct,n)}}class Ht{#t;#k;#M=null;#s;get pattern(){return f("Not implemented")}get info(){return f("Not implemented")}get Ct(){return null===this.#M?null:this.#M.deref()??f("listIndex is null")}get filters(){return this.#s}get binding(){return this.#t}constructor(t,n,e){this.#t=t;const s=Number(n.slice(1));isNaN(s)&&f("BindingStateIndex: pattern is not a number"),this.#k=s,this.#s=e}nn(t){return this.Ct?.index??f("listIndex is null")}N(t){let n=this.nn(t);for(let t=0;t<this.#s.length;t++)n=this.#s[t](n);return n}init(){const t=(this.binding.Yt.Xt??f("BindingState.init: loopContext is null")).tn();this.#M=t[this.#k-1].gn??f("BindingState.init: listIndexRef is null");const n=this.Ct??f("listIndex is null"),e=this.binding.it.yn.get(n);void 0===e?this.binding.it.yn.set(n,new Set([this.binding])):e.add(this.binding)}l(t,n){f("BindingStateIndex: assignValue is not implemented")}}const zt=new RegExp(/^\$\d+$/);function Dt(t,n){return zt.test(t)?((t,n)=>(e,s)=>{const i=b(s,n);return new Ht(e,t,i)})(t,n):((t,n)=>(e,s)=>{const i=b(s,n);return new Vt(e,t,i)})(t,n)}const Wt={};function qt(t,n=(t=>t.constructor.name+"\t"+(t instanceof Comment?t.textContent?.[2]??"":""))(t)){return Wt[n]??(Wt[n]=(t=>t instanceof Comment&&":"===t.textContent?.[2]?"Text":t instanceof HTMLElement?"HTMLElement":t instanceof Comment&&"|"===t.textContent?.[2]?"Template":t instanceof SVGElement?"SVGElement":f(`Unknown NodeType: ${t.nodeType}`))(t))}const jt=t=>t.trim(),_t=t=>t.length>0,Gt=new RegExp(/^#(.*)#$/),Zt=t=>{const n=Gt.exec(t);return n?decodeURIComponent(n[1]):t},Ut=t=>{const[n,...e]=t.split(",").map(jt);return{name:n,options:e.map(Zt)}},Jt=t=>{const[n,...e]=t.split("|").map(jt);return{bn:n,filters:e.map(Ut)}},Kt=t=>t.split(";").map(jt).filter(_t).map((t=>(t=>{const[n,e=null]=t.split("@").map(jt),s=e?e.split(",").map(jt):[],[i,r]=n.split(":").map(jt),{bn:o,filters:l}=Jt(i),{bn:a,filters:u}=Jt(r);return{Nn:o,xn:a,Sn:l,vn:u,i:s}})(t))),Qt={};const Xt=t=>{t.removeAttribute("data-bind")},Yt={HTMLElement:Xt,SVGElement:Xt,Text:void 0,fn:void 0};const tn={Text:t=>{const n=document.createTextNode("");return t.parentNode?.replaceChild(n,t),n},HTMLElement:void 0,fn:void 0,SVGElement:void 0};class nn{nodeType;Cn;$n;In=new Map;constructor(t){this.nodeType=qt(t);const n=function(t,n){switch(t){case"Text":return"textContent:"+(n.textContent?.slice(3).trim()??"");case"HTMLElement":case"SVGElement":return n.getAttribute(G)??"";case"Template":{const t=n.textContent?.slice(3).trim();return(cn(Number(t))??f(`Template not found: ${t}`)).getAttribute(G)??""}default:return""}}(this.nodeType,t);(function(t,n){Yt[n]?.(t)})(t=function(t,n){return tn[n]?.(t)??t}(t,this.nodeType),this.nodeType),this.Cn=function(t){let n=[];for(;null!==t.parentNode;)n=[Array.from(t.parentNode.childNodes).indexOf(t),...n],t=t.parentNode;return n}(t),this.$n=function(t){return""===t.trim()?[]:Qt[t]??(Qt[t]=Kt(t))}(n);for(let n=0;n<this.$n.length;n++){const e=this.$n[n],s={Pn:Ot(t,e.Nn,e.Sn,e.i),Bn:Dt(e.xn,e.vn)};this.In.set(e,s)}}}function en(t){const n=[],e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode:t=>t instanceof Element?t.hasAttribute(G)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:function(t){return t instanceof Comment&&(0===t.textContent?.indexOf(Z)||0===t.textContent?.indexOf(U))}(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;e.nextNode();)n.push(e.currentNode);return n}const sn={},rn={},on={};function ln(t){return en(t).map((t=>function(t){return new nn(t)}(t)))}const an={};function un(t,n,e){var s;return s=n.content,Array.from(s.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE||(t.nodeValue??"").trim()||s.removeChild(t)})),function(t,n,e=t){const s=ln(n),i=on[e]??(on[e]=new Set),r=rn[e]??(rn[e]=new Set);for(let t=0;t<s.length;t++){const n=s[t];for(let t=0;t<n.$n.length;t++){const e=n.$n[t];i.add(e.xn),"for"===e.Nn&&r.add(e.xn)}}sn[t]=s}(t,n.content,e),an[t]=n,t}function cn(t){return an[t]??f(`getTemplateById: template not found: ${t}`)}class hn{Yt;node;it;Ln;S;version;constructor(t,n,e,s,i){this.Yt=t,this.node=n,this.it=e,this.Ln=s(this,n,e.Tn),this.S=i(this,e.En)}get o(){return this.Ln.o}init(){this.Ln.init(),this.S.init()}pn(t,n){return this.S.l(t,n)}h(t){this.Ln.h(t)}p(t){t.m.has(this)&&this.Ln.p(t)}}function dn(t,n,e,s,i){return new hn(t,n,e,s,i)}class fn{#R;#E;#M;#S;constructor(t,n,e){this.#R=t??f("name is required"),this.#E=B(this.#R),this.#M=new WeakRef(n),this.#S=e}get path(){return this.#R}get info(){return this.#E}get Ct(){return this.#M?.deref()??f("listIndex is null")}get gn(){return this.#M??f("listIndexRef is null")}rn(t){this.#M=new WeakRef(t)}an(){this.#M=null}get Mn(){return this.#S}#F;get kn(){if(void 0===this.#F){let t=this.Mn;for(;null!==t;){if(null!==t.vt&&t.vt!==this){this.#F=t.vt;break}t=t.Rn?.Yt??null}void 0===this.#F&&(this.#F=null)}return this.#F}#A={};find(t){let n=this.#A[t];if(void 0===n){let e=this;for(;null!==e&&e.path!==t;)e=e.kn;n=this.#A[t]=e}return n}Fn(t){let n=this;for(;null!==n;)t(n),n=n.kn}tn(){const t=[];return this.Fn((n=>{t.unshift(n)})),t}}function pn(t){const n=cn(t)??f(`BindContent: template is not found: ${t}`),e=document.importNode(n.content,!0);if(Object.keys(zn).length>0){const t=e.querySelectorAll(":not(:defined)");for(let n=0;n<t.length;n++){Wn(t[n].tagName.toLowerCase())}}return e}function mn(t,n,e,s){const i=(t=>sn[t])(n)??f("BindContent: data-bind is not set"),r=[];for(let n=0;n<i.length;n++){const l=i[n],a=(o=s,l.Cn.reduce(((t,n)=>t?.childNodes[n]??null),o)??f(`BindContent: node is not found: ${l.Cn}`));for(let n=0;n<l.$n.length;n++){const s=l.$n[n],i=l.In.get(s)??f(`BindContent: creator is not found: ${s}`),o=dn(t,a,e,i.Pn,i.Bn);r.push(o)}}var o;return r}class gn{vt;Rn;childNodes;fragment;it;#h;get id(){return this.#h}get An(){return this.childNodes.length>0&&this.childNodes[0].parentNode!==this.fragment}get dn(){return this.childNodes[0]??null}get On(){return this.childNodes[this.childNodes.length-1]??null}hn(t){const n=this.Vn[this.Vn.length-1],e=this.On;if(void 0!==n&&n.node===e&&n.o.size>0){const e=(Array.from(n.o).at(-1)??f("BindContent: childBindContent is not found")).hn(t);if(null!==e)return e}return t!==e?.parentNode?null:e}#O;get Xt(){if(void 0===this.#O){let t=this;for(;null!==t&&null===t.vt;)t=t.Rn?.Yt??null;this.#O=t?.vt??null}return this.#O}constructor(t,n,e,s,i){this.Rn=t,this.#h=n,this.fragment=pn(n),this.childNodes=Array.from(this.fragment.childNodes),this.it=e,this.vt=null!==i?function(t,n,e){return new fn(t,n,e)}(s,i,this):null,this.Vn=mn(this,n,e,this.fragment)}mount(t){for(let n=0;n<this.childNodes.length;n++)t.appendChild(this.childNodes[n])}Hn(t,n){for(let e=0;e<this.childNodes.length;e++)t.insertBefore(this.childNodes[e],n)}en(t,n){const e=n?.nextSibling??null;for(let n=0;n<this.childNodes.length;n++)t.insertBefore(this.childNodes[n],e)}unmount(){const t=this.childNodes[0]?.parentElement??null;if(null!==t)for(let n=0;n<this.childNodes.length;n++)t.removeChild(this.childNodes[n])}Vn=[];init(){this.Vn.forEach((t=>t.init()))}rn(t){null==this.vt&&f("BindContent: loopContext is null"),this.vt.rn(t),this.init()}p(t){for(const n of this.Vn)n.p(t)}}function wn(t,n,e,s,i){const r=new gn(t,n,e,s,i);return r.init(),r}function yn(t,n,e){if(n.enableShadowDom)if(null===n.zn||function(t){try{const n=document.createElement(t);return"function"==typeof n.attachShadow&&(n.attachShadow({mode:"open"}),!0)}catch{return!1}}(n.zn)){if(!t.shadowRoot){t.attachShadow({mode:"open"}).adoptedStyleSheets=[e]}}else f(`ComponentEngine: Shadow DOM not supported for builtin components that extend ${n.zn}`);else{const n=function(t){let n=t;for(;n;){if(n instanceof ShadowRoot)return n;n=n.parentNode}}(t.parentNode)||document,s=n.adoptedStyleSheets;s.includes(e)||(n.adoptedStyleSheets=[...s,e])}}const bn={};class Nn{Dn=new Set;Wn=new Set;qn=new Map;jn=new Map;_n=new Map;Gn=new Map;Vn=new WeakSet;Zn(t){if(this.Vn.has(t))return;const n=t.S.pattern,e=t.Ln.t;if(this.qn.has(n))throw new Error(`Parent path "${n}" already has a child path.`);if(this.jn.has(e))throw new Error(`Child path "${e}" already has a parent path.`);this.qn.set(n,e),this.jn.set(e,n),this.Dn.add(n),this.Wn.add(e),this._n.set(n,t),this.Gn.set(e,t),this.Vn.add(t)}Un(t){return this.qn.get(t)}Jn(t){return this.jn.get(t)}Kn(t){const n=B(t).M.intersection(this.Wn);0===n.size&&f(`No parent path found for child path "${t}".`);const e=Array.from(n),s=e[e.length-1],i=t.slice(s.length),r=this.jn.get(s);return void 0===r&&f(`No parent path found for child path "${t}".`),r+i}Qn(t){const n=B(t).M.intersection(this.Dn);0===n.size&&f(`No child path found for parent path "${t}".`);const e=Array.from(n),s=e[e.length-1],i=t.slice(s.length),r=this.qn.get(s);return void 0===r&&f(`No child path found for parent path "${t}".`),r+i}Xn(t){if(0===this.Wn.size)return null;const n=t.M.intersection(this.Wn);if(0===n.size)return null;{const t=Array.from(n);return t[t.length-1]}}bind(t,n){const e=t.Yn(n);for(const t of e??[])this.Zn(t)}}class xn{te;it;constructor(t,n){this.te=n,this.it=t}ee(t){ft(this.it,null,(async(n,e)=>{for(const[n,s]of Object.entries(t)){const t=B(n);e[A](t,null,s)}}))}h(t){for(const n of t)try{const t=B(this.te.Qn(n.info.pattern)),e=n.Ct,s=this.it.getPropertyValue(t,e);ft(this.it,null,(async(n,i)=>{n.bt(t,e,s)}))}catch(t){}}get(t,n,e){return n===Tt?this.ee.bind(this):n===Et?this.h.bind(this):"string"==typeof n?this.it.getPropertyValue(B(n),null):void f(`Property "${String(n)}" is not supported in ComponentStateInput.`)}set(t,n,e,s){if("string"==typeof n)return this.it.se(B(n),null,e),!0;f(`Property "${String(n)}" is not supported in ComponentStateInput.`)}}class Sn{binding;constructor(t){this.binding=t}get(t,n){const e=this.binding.Xn(t);null===e&&f(`No child path found for path "${t.toString()}".`);const s=this.binding.Gn.get(e);void 0===s&&f(`No binding found for child path "${e}".`);const i=B(this.binding.Kn(t.pattern));return s.it.getPropertyValue(i,n??s.S.Ct)}set(t,n,e){const s=this.binding.Xn(t);null===s&&f(`No child path found for path "${t.toString()}".`);const i=this.binding.Gn.get(s);void 0===i&&f(`No binding found for child path "${s}".`);const r=B(this.binding.Kn(t.pattern));return ft(i.it,null,(async(t,s)=>{s[A](r,n??i.S.Ct,e)})),!0}startsWith(t){return null!==this.binding.Xn(t)}st(t,n){const e=this.binding.Xn(t);null===e&&f(`No child path found for path "${t.toString()}".`);const s=this.binding.Gn.get(e);void 0===s&&f(`No binding found for child path "${e}".`);const i=B(this.binding.Kn(t.pattern));return s.it.st(i,n)}}class vn{type="autonomous";config;ie;styleSheet;re;state;Tn;En;#S=null;get Mn(){return null===this.#S&&f("bindContent is not initialized yet"),this.#S}oe=HTMLElement;St;yn=new WeakMap;ae=new Map;mn=new WeakMap;ue=new Set;#V=Promise.withResolvers();#H=null;#z=function(){return new Nn}();ce;ft;#D=null;#W=null;#q=!1;constructor(t,n){this.config=t,this.config.zn&&(this.type="builtin");const e=n.constructor;var s;this.ie=e.ie,this.styleSheet=e.styleSheet,this.re=e.re,this.state=new this.re,this.Tn=e.Tn,this.En=e.En,this.St=n,this.ce=function(t,n){const e=new xn(t,n);return new Proxy({},e)}(this,this.#z),this.ft=(s=this.#z,new Sn(s))}get ct(){return this.St.constructor.ct}he(){const t=this.St.constructor;this.#S=wn(null,t.id,this,null,null)}get de(){return this.#V}async connectedCallback(){if(await(this.#H?.promise),await(this.St.fe?.de.promise),this.St.dataset.state)try{const t=JSON.parse(this.St.dataset.state);this.ce[Tt](t)}catch(t){f("Failed to parse state from dataset")}const t=this.St.fe;if(t&&(t.pe(this.St),this.#z.bind(t,this.St)),this.config.me)yn(this.St,this.config,this.styleSheet);else{this.#W=this.St.parentNode,this.#D=document.createComment("Structive block placeholder");try{this.#q=!0,this.St.replaceWith(this.#D)}finally{this.#q=!1}}if(this.config.me)this.Mn.mount(this.St.shadowRoot??this.St);else{const t=this.#W??f("Block parent node is not set");this.Mn.en(t,this.#D)}await ft(this,null,(async(t,n)=>{for(const n of this.ct.we){const e=B(n);1===e.B.length&&t.bt(e,null,null)}await n[V]()})),queueMicrotask((()=>{this.#V.resolve()}))}async disconnectedCallback(){this.#H=Promise.withResolvers();try{if(this.#q)return;await ft(this,null,(async(t,n)=>{await n[H]()})),this.St.fe?.ye(this.St),this.config.me||(this.#D?.remove(),this.#D=null,this.#W=null)}finally{this.#H.resolve()}}#j={};#_={};be(){return{list:null,Ne:null,Vn:[]}}xe(t,n){if(null===n){let n=this.#_[t.id];return void 0===n&&(n=this.be(),this.#_[t.id]=n),n}{let e=this.#j[t.id];void 0===e&&(e=new WeakMap,this.#j[t.id]=e);let s=e.get(n);return void 0===s&&(s=this.be(),e.set(n,s)),s}}wn(t,n,e){this.xe(t,n).Vn.push(e)}qt(t,n,e){this.xe(t,n).Ne=e}_t(t,n,e){this.xe(t,n).list=e}Gt(t,n){return this.xe(t,n).Vn}Se(t){return void 0!==this.#_[t.id]||void 0!==this.#j[t.id]}st(t,n){if(this.ft.startsWith(t))return this.ft.st(t,n);return this.xe(t,n).Ne}jt(t,n){return this.xe(t,n).list}ht(t,n,e){let s=this.ae.get(n);void 0===s&&(s=new Set,this.ae.set(n,s));const i=function(t,n){const e=function(t,n){return`${t.pattern}@${n}`}(t,n);return bn[e]??(bn[e]={info:t,type:n})}(t,e);s.add(i)}getPropertyValue(t,n){return st(this,this.state)[F](t,n)}se(t,n,e){ft(this,null,(async(s,i)=>{i[A](t,n,e)}))}pe(t){this.ue.add(t)}ye(t){this.ue.delete(t)}}const Cn=/\{\{([^\}]+)\}\}/g,$n=new Set(["if","for","endif","endfor","elseif","else"]);const In="http://www.w3.org/2000/svg";function Pn(t,n,e=t){if(n.parentNode?.replaceChild(document.createComment(`${U}${t}`),n),n.namespaceURI===In){const t=document.createElement("template");for(let e of Array.from(n.childNodes))t.content.appendChild(e);const e=n.getAttribute(G);t.setAttribute(G,e??""),n=t}return n.content.querySelectorAll("template").forEach((t=>{Pn(d(),t,e)})),un(t,n,e),t}function Bn(t,n){const e=document.createElement("template");e.dataset.id=t.toString(),e.innerHTML=function(t){const n=[];return t.replaceAll(Cn,((t,e)=>{e=e.trim();const[s]=e.split(":");if(!$n.has(s))return`\x3c!--${Z}${e}--\x3e`;const i=e.slice(s.length+1).trim(),r={type:s,ve:e,Ce:i};if("if"===s||"for"===s)return n.push(r),`<template data-bind="${e}">`;if("endif"===s){const t=[];for(;;){const e=n.pop()??f("replaceMustacheToTemplateOrEmbed: endif without if");if("if"===e.type){t.push("</template>");break}"elseif"===e.type?t.push("</template>"):f("replaceMustacheToTemplateOrEmbed: endif without if")}return t.join("")}if("endfor"===s){if("for"===(n.pop()??f("replaceMustacheToTemplateOrEmbed: endif without if")).type)return"</template>";f("replaceMustacheToTemplateOrEmbed: endfor without for")}else if("elseif"===s){const t=n.at(-1)??f("replaceMustacheToTemplateOrEmbed: elseif without if");if("if"===t.type||"elseif"===t.type)return n.push(r),`</template><template data-bind="if:${t.Ce}|not"><template data-bind="if:${i}">`;f("replaceMustacheToTemplateOrEmbed: elseif without if")}else if("else"===s){const t=n.at(-1)??f("replaceMustacheToTemplateOrEmbed: else without if");if("if"===t.type)return`</template><template data-bind="if:${t.Ce}|not">`;f("replaceMustacheToTemplateOrEmbed: else without if")}else f("replaceMustacheToTemplateOrEmbed: unknown type")}))}(n),Pn(t,e)}const Ln=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/,Tn=/^[a-zA-Z_$][0-9a-zA-Z_$]*(\.[a-zA-Z_$][0-9a-zA-Z_$]*|\.\*)*$/;function En(t,n){const e=new Set(t.T).intersection(n);let s=-1,i="";for(const t of e){const n=t.split(".");1!==n.length&&(n.length>s&&(s=n.length,i=t))}if(i.length>0){if(!Tn.test(i))throw new Error(`Invalid path: ${i}`);const n=B(i),e=[];let s=n.J;for(let i=n.B.length;i<t.B.length;i++){const n=t.B[i];if("*"===n)e.push("[this.$"+(s+1)+"]"),s++;else{if(!Ln.test(n))throw new Error(`Invalid segment name: ${n}`);e.push("."+n)}}const r=e.join("");return{get:new Function("",`return this["${i}"]${r};`),set:new Function("value",`this["${i}"]${r} = value;`)}}{const n=[];let e=0;for(const s of t.B)if("*"===s)n.push("[this.$"+(e+1)+"]"),e++;else{if(!Ln.test(s))throw new Error(`Invalid segment name: ${s}`);n.push((n.length>0?".":"")+s)}const s=n.join("");return{get:new Function("",`return this.${s};`),set:new Function("value",`this.${s} = value;`)}}}class Mn{we=new Set;Rt=new Set;elements=new Set;ut=new Set;yt=new Set;$e=new Set;Zt=new Map;Ut=new Map;#h;#G;constructor(t){this.#h=t.id,this.#G=t.re;const n=(t=>on[t]??[])(this.#h);for(const t of n){const n=B(t);this.we=this.we.union(n.M)}const e=(t=>rn[t]??[])(this.#h);this.Rt=this.Rt.union(e);for(const t of e){const n=t+".*";this.elements.add(n)}let s=this.#G.prototype;for(;s&&s!==Object.prototype;){const t=Object.getOwnPropertyDescriptors(s);if(t)for(const[n,e]of Object.entries(t)){const t=void 0!==e.get,s=void 0!==e.set,i=B(n);this.we=this.we.union(i.M),t&&this.ut.add(n),s&&this.yt.add(n)}s=Object.getPrototypeOf(s)}for(const t of this.we){if(this.ut.has(t))continue;if(this.yt.has(t))continue;const n=B(t);if(1===n.B.length)continue;const e=En(n,this.ut);Object.defineProperty(this.#G.prototype,t,{get:e.get,set:e.set,enumerable:!0,configurable:!0}),this.$e.add(t)}for(const t of this.we){const n=B(t);n.Z&&(this.Zt.get(n.Z)?.add(t)??this.Zt.set(n.Z,new Set))}}Ie(t,n){this.Ut.get(n)?.add(t)??this.Ut.set(n,new Set([t]))}}function kn(t){const e=function(t){const e=n();return{me:void 0===t.me||t.me,enableShadowDom:t.enableShadowDom??e.enableShadowDom,zn:t.zn??null}}(t.re.Pe??{}),s=d(),{Be:i,Le:r,re:o}=t,l=Object.assign({},c),a=Object.assign({},u);o.Te=!0,Bn(s,i),g(s,r),function(t,n){p[t]=n}(s,o);const h=function(t){return t?document.createElement(t).constructor:HTMLElement}(e.zn),w=e.zn;return class extends h{#y;constructor(){super(),this.#y=function(t,n){return new vn(t,n)}(e,this),this.#y.he()}connectedCallback(){this.#y.connectedCallback()}disconnectedCallback(){this.#y.disconnectedCallback()}#Z;get fe(){var t;return void 0===this.#Z&&(this.#Z=(t=this,Mt.get(t)??null)),this.#Z}get state(){return this.#y.ce}get Ee(){return this.#y.re.Te??!1}get de(){return this.#y.de}Yn(t){return this.#y.mn.get(t)??null}pe(t){this.#y.pe(t)}ye(t){this.#y.ye(t)}static define(t){w?customElements.define(t,this,{zn:w}):customElements.define(t,this)}static get id(){return s}static#U=i;static get Be(){return this.#U}static set Be(t){this.#U=t,Bn(this.id,t),this.#J=null,this.#K=null}static#Q=r;static get Le(){return this.#Q}static set Le(t){this.#Q=t,g(this.id,t),this.#X=null}static#J=null;static get ie(){return this.#J||(this.#J=cn(this.id)),this.#J}static#X=null;static get styleSheet(){return this.#X||(this.#X=function(t){return m[t]??f(`getStyleSheetById: stylesheet not found: ${t}`)}(this.id)),this.#X}static#G=null;static get re(){return this.#G||(this.#G=function(t){return p[t]??f(`getStateClassById: stateClass not found: ${t}`)}(this.id)),this.#G}static#Y=l;static get Tn(){return this.#Y}static#tt=a;static get En(){return this.#tt}static#K=null;static get ct(){return this.#K||(this.#K=new Mn(this)),this.#K}}}function Rn(t){return t.replaceAll(/<!--\{\{([^\}]+)\}\}-->/g,((t,n)=>`{{${n}}}`))}async function Fn(t){const n=await fetch(import.meta.resolve(t));return async function(t){const n=document.createElement("template");n.innerHTML=function(t){return t.replaceAll(/\{\{([^\}]+)\}\}/g,((t,n)=>`\x3c!--{{${n}}}--\x3e`))}(t);const e=n.content.querySelector("template");e?.remove();const s=n.content.querySelector("script[type=module]"),i=btoa(String.fromCodePoint(...(new TextEncoder).encode(s.text))),r=s?await import("data:application/javascript;base64,"+i):{};s?.remove();const o=n.content.querySelector("style");o?.remove();const l=r.default??class{};return{text:t,Be:Rn(e?.innerHTML??"").trim(),Le:o?.textContent??"",re:l}}(await n.text())}function An(t,n){n.define(t)}const On="@routes/",Vn="@components/",Hn="#lazy",zn={};async function Dn(){const t=function(){const t={};return document.querySelectorAll("script[type='importmap']").forEach((n=>{const e=JSON.parse(n.innerHTML);e.imports&&(t.imports=Object.assign(t.imports||{},e.imports))})),t}();if(t.imports){const n=new Map;for(const[e,s]of Object.entries(t.imports)){let t,s;if(e.startsWith(On)){s=e.endsWith(Hn);const n=e.slice(7,s?-5:void 0);t="routes"+n.replace(/:[^\s/]+/g,"").replace(/\//g,"-"),Zn(t,"/root"===n?"/":n)}e.startsWith(Vn)&&(s=e.endsWith(Hn),t=e.slice(12,s?-5:void 0)),t&&(s?zn[t]=e:n.set(t,e))}for(const[t,e]of n.entries()){An(t,kn(await Fn(e)))}}}function Wn(t){const n=zn[t];n?(delete zn[t],queueMicrotask((async()=>{const e=kn(await Fn(n));An(t,e)}))):console.warn(`loadLazyLoadComponent: alias not found for tagName: ${t}`)}const qn="routes:",jn=[];let _n=null;class Gn extends HTMLElement{Me=window.location.pathname;ke=window.location.pathname.split("/").pop()||"";Re=document.querySelector("base")?.href.replace(window.location.origin,"")||"/";Fe;constructor(){super(),this.Fe=this.Ae.bind(this)}connectedCallback(){_n=this,this.innerHTML='<slot name="content"></slot>',window.addEventListener("popstate",this.Fe),window.dispatchEvent(new Event("popstate"))}disconnectedCallback(){window.removeEventListener("popstate",this.Fe),_n=null}Ae(t){t.preventDefault(),this.kt()}navigate(t){const n="/"===t[0]?this.Re+t.slice(1):t;history.pushState({},"",n),this.kt()}kt(){Array.from(this.childNodes).filter((t=>"content"===t.getAttribute?.("slot"))).forEach((t=>this.removeChild(t)));const t=window.location.pathname.split("/");t.at(-1)===this.ke&&(t[t.length-1]="");const n=t.join("/").replace(this.Re,""),e="/"!==n[0]?"/"+n:n;let s,i={};for(const[t,n]of jn){const r=new RegExp("^"+t.replace(/:[^\s/]+/g,"([^/]+)")+"$");if(r.test(e)){s=n;const o=e.match(r);if(o){(t.match(/:[^\s/]+/g)||[]).forEach(((t,n)=>{i[t.substring(1)]=o[n+1]}))}break}}if(s){const t=document.createElement(s);t.setAttribute("data-state",JSON.stringify(i)),t.setAttribute("slot","content"),this.appendChild(t),function(t){return zn.hasOwnProperty(t)}(s)&&Wn(s)}else{const t=document.createElement("h1");t.setAttribute("slot","content"),t.textContent="404 Not Found",this.appendChild(t)}}}function Zn(t,n){n.startsWith(qn)&&(n=n.substring(qn.length)),jn.push([n,t])}function Un(){return _n}const Jn="router",Kn=`<slot name="${Jn}"></slot>`;class Qn extends HTMLElement{constructor(){super(),e.enableShadowDom&&this.attachShadow({mode:"open"})}async connectedCallback(){await this.Oe(),this.kt()}get root(){return this.shadowRoot??this}async Oe(){if(e.layoutPath){const t=await fetch(e.layoutPath);if(t.ok){const n=await t.text(),e=document.createElement("template");e.innerHTML=n;const s=e.content.querySelector("template"),i=e.content.querySelector("style");if(this.root.appendChild(s?.content??document.createDocumentFragment()),i){const t=this.shadowRoot??document,n=t.adoptedStyleSheets;n.includes(i)||(t.adoptedStyleSheets=[...n,i])}}else f(`Failed to load layout from ${e.layoutPath}`)}else this.root.innerHTML=Kn}kt(){if(e.enableRouter){const t=document.createElement(e.routerTagName);t.setAttribute("slot",Jn),this.root.appendChild(t)}}}const Xn=e;let Yn=!1;async function te(t){await async function(t){for(const[n,s]of Object.entries(t)){let t=null;if(e.enableRouter){const t=s.startsWith("@routes")?s.slice(7):s;Zn(n,"/root"===t?"/":t)}t=await Fn(s),An(n,kn(t))}}(t),Xn.autoInit&&await ne()}async function ne(){Yn||(await async function(){if(e.autoLoadFromImportMap&&await Dn(),e.enableRouter&&customElements.define(e.routerTagName,Gn),e.enableMainWrapper&&(customElements.define(e.mainTagName,Qn),e.autoInsertMainWrapper)){const t=document.createElement(e.mainTagName);document.body.appendChild(t)}}(),Yn=!0)}export{ne as bootstrapStructive,Xn as config,te as defineComponents};
//# sourceMappingURL=structive.min.js.map
