const t={debug:!1,locale:"en-US",enableShadowDom:!0,enableMainWrapper:!0,enableRouter:!0,autoInsertMainWrapper:!1,autoInit:!0,mainTagName:"app-main",routerTagName:"view-router",layoutPath:"",autoLoadFromImportMap:!1,optimizeList:!0,optimizeListElements:!0,optimizeAccessor:!0};function e(){return t}const n=e();function s(t){if("string"==typeof t)throw new Error(t);const{message:e,code:n,context:s,hint:o,t:r,o:i,i:c}=t,d=new Error(e);throw d.code=n,s&&(d.context=s),o&&(d.hint=o),r&&(d.t=r),i&&(d.o=i),c&&(d.i=c),d}function o(t){s({code:"FLT-202",message:`${t} requires at least one option`,context:{l:t},t:"./docs/error-codes.md#flt"})}function r(t){s({code:"FLT-202",message:`${t} requires a number as option`,context:{l:t},t:"./docs/error-codes.md#flt"})}function i(t){s({code:"FLT-202",message:`${t} requires a number value`,context:{l:t},t:"./docs/error-codes.md#flt"})}function c(t){s({code:"FLT-202",message:`${t} requires a date value`,context:{l:t},t:"./docs/error-codes.md#flt"})}const d=e(),a={eq:t=>{const e=t?.[0]??o("eq");return t=>{if("number"==typeof t){const n=Number(e);return isNaN(n)&&r("eq"),t===n}return t===e}},ne:t=>{const e=t?.[0]??o("ne");return t=>{if("number"==typeof t){const n=Number(e);return isNaN(n)&&r("ne"),t!==n}return t!==e}},not:t=>t=>{var e;return"boolean"!=typeof t&&s({code:"FLT-202",message:`${e="not"} requires a boolean value`,context:{l:e},t:"./docs/error-codes.md#flt"}),!t},lt:t=>{const e=t?.[0]??o("lt"),n=Number(e);return isNaN(n)&&r("lt"),t=>("number"!=typeof t&&i("lt"),t<n)},le:t=>{const e=t?.[0]??o("le"),n=Number(e);return isNaN(n)&&r("le"),t=>("number"!=typeof t&&i("le"),t<=n)},gt:t=>{const e=t?.[0]??o("gt"),n=Number(e);return isNaN(n)&&r("gt"),t=>("number"!=typeof t&&i("gt"),t>n)},ge:t=>{const e=t?.[0]??o("ge"),n=Number(e);return isNaN(n)&&r("ge"),t=>("number"!=typeof t&&i("ge"),t>=n)},inc:t=>{const e=t?.[0]??o("inc"),n=Number(e);return isNaN(n)&&r("inc"),t=>("number"!=typeof t&&i("inc"),t+n)},dec:t=>{const e=t?.[0]??o("dec"),n=Number(e);return isNaN(n)&&r("dec"),t=>("number"!=typeof t&&i("dec"),t-n)},mul:t=>{const e=t?.[0]??o("mul"),n=Number(e);return isNaN(n)&&r("mul"),t=>("number"!=typeof t&&i("mul"),t*n)},div:t=>{const e=t?.[0]??o("div"),n=Number(e);return isNaN(n)&&r("div"),t=>("number"!=typeof t&&i("div"),t/n)},fix:t=>{const e=Number(t?.[0]??0);return isNaN(e)&&r("fix"),t=>("number"!=typeof t&&i("fix"),t.toFixed(e))},locale:t=>{const e=t?.[0]??d.locale;return t=>("number"!=typeof t&&i("locale"),t.toLocaleString(e))},uc:t=>t=>t.toString().toUpperCase(),lc:t=>t=>t.toString().toLowerCase(),cap:t=>t=>{const e=t.toString();return 0===e.length?e:1===e.length?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1)},trim:t=>t=>t.toString().trim(),slice:t=>{const e=t?.[0]??o("slice"),n=Number(e);return isNaN(n)&&r("slice"),t=>t.toString().slice(n)},substr:t=>{const e=t?.[0]??o("substr"),n=Number(e);isNaN(n)&&r("substr");const s=t?.[1]??o("substr"),i=Number(s);return isNaN(i)&&r("substr"),t=>t.toString().substr(n,i)},pad:t=>{const e=t?.[0]??o("pad"),n=Number(e);isNaN(n)&&r("pad");const s=t?.[1]??"0";return t=>t.toString().padStart(n,s)},rep:t=>{const e=t?.[0]??o("rep"),n=Number(e);return isNaN(n)&&r("rep"),t=>t.toString().repeat(n)},rev:t=>t=>t.toString().split("").reverse().join(""),int:t=>t=>parseInt(t,10),float:t=>t=>parseFloat(t),round:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&r("round"),t=>("number"!=typeof t&&i("round"),Math.round(t*n)/n)},floor:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&r("floor"),t=>("number"!=typeof t&&i("floor"),Math.floor(t*n)/n)},ceil:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&r("ceil"),t=>("number"!=typeof t&&i("ceil"),Math.ceil(t*n)/n)},percent:t=>{const e=Number(t?.[0]??0);return isNaN(e)&&r("percent"),t=>("number"!=typeof t&&i("percent"),(100*t).toFixed(e)+"%")},date:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("date"),t.toLocaleDateString(e))},time:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("time"),t.toLocaleTimeString(e))},datetime:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("datetime"),t.toLocaleString(e))},ymd:t=>{const e=t?.[0]??"-";return t=>{t instanceof Date||c("ymd");const n=t.getFullYear().toString(),s=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${n}${e}${s}${e}${o}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const e=t?.[0]??o("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?e:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},l=a,h=a;let u=0;function f(){return++u}const m={};const p={};function g(t,e){const n=new CSSStyleSheet;n.replaceSync(e),function(t,e){p[t]=e}(t,n)}function w(t,e){let n=t;if(0===e.length)return n;for(let t=0;t<e.length&&(n=n?.childNodes[e[t]]??null,null!==n);t++);return n}function y(t,e){const n=t[e.name];return n||s({code:"FLT-201",message:`Filter not found: ${e.name}`,context:{h:"createFilters.textToFilter",name:e.name},t:"./docs/error-codes.md#flt"}),n(e.options)}const x=new Map;function b(t,e){let n=x.get(e);if(void 0===n){n=[];for(let s=0;s<e.length;s++)n.push(y(t,e[s]));x.set(e,n)}return n}class N{#t;#e;#n;#s;#o;#r=[];get node(){return this.#e}get name(){return this.#n}get u(){return this.#n}get binding(){return this.#t}get m(){return this.#o}get filters(){return this.#s}get p(){return this.#r}constructor(t,e,n,s,o){this.#t=t,this.#e=e,this.#n=n,this.#s=s,this.#o=o}init(){}N(t){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingNode.assignValue",name:this.name},t:"/docs/error-codes.md#bind"})}S(t,e){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingNode.updateElements",name:this.name},t:"/docs/error-codes.md#bind"})}I(t){}v(t){if(t.T.has(this.binding))return;const e=this.binding.B.C(t.P,t.U);this.N(e),t.T.add(this.binding)}get $(){return this.node instanceof HTMLSelectElement}get value(){return null}get L(){return null}get M(){return!1}get D(){return!1}}class S extends N{#i;get u(){return this.#i}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,r]=this.name.split(".");this.#i=r}N(t){(null==t||Number.isNaN(t))&&(t="");this.node.setAttribute(this.u,t.toString())}}class I extends N{N(t){Array.isArray(t)||s({code:"BIND-201",message:"Value is not array",context:{h:"BindingNodeCheckbox.update",k:typeof t},t:"/docs/error-codes.md#bind",o:"error"});const e=this.node;e.checked=t.map((t=>t.toString())).includes(e.value)}}class v extends N{N(t){Array.isArray(t)||s({code:"BIND-201",message:"Value is not array",context:{h:"BindingNodeClassList.update",k:typeof t},t:"/docs/error-codes.md#bind",o:"error"});this.node.className=t.join(" ")}}class T extends N{#i;get u(){return this.#i}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,r]=this.name.split(".");this.#i=r}N(t){"boolean"!=typeof t&&s({code:"BIND-201",message:"Value is not boolean",context:{h:"BindingNodeClassName.update",k:typeof t},t:"/docs/error-codes.md#bind",o:"error"});this.node.classList.toggle(this.u,t)}}const C="data-bind",B="@@:",P="@@|",U=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","watch","unwatch","eval","arguments","let","var","const","class","function","null","true","false","new","return"]),$={};class L{static id=0;id=++L.id;R=this.id.toString();pattern;A;F;V;W;H;O;j;q;_;G;Z;J;K;X;Y;tt;et;nt;st;ot;children={};constructor(t){const e=e=>t===e?this:M(e),n=t.split("."),s=[],o=[],r=[],i={},c=[],d=[],a=[];let l="",h="",u=0;for(let t=0;t<n.length;t++)l+=n[t],"*"===n[t]&&(r.push(l),i[l]=u,c.push(e(l)),d.push(h),a.push(e(h)),u++),s.push(l),o.push(e(l)),h=l,l+=".";const f=r.length>0?r[r.length-1]:null,m=s.length>1?s[s.length-2]:null;this.pattern=t,this.A=n,this.F=n[n.length-1],this.V=s,this.W=new Set(s),this.H=o,this.O=new Set(o),this.j=r,this.q=new Set(r),this.G=i,this._=c,this.Z=new Set(c),this.J=d,this.K=new Set(d),this.X=a,this.Y=new Set(a),this.tt=f,this.et=f?e(f):null,this.nt=m,this.st=m?e(m):null,this.ot=u,this.st&&(this.st.children[this.F]=this)}}function M(t){U.has(t)&&s({code:"STATE-202",message:`Pattern is reserved word: ${t}`,context:{h:"getStructuredPathInfo",rt:t},t:"./docs/error-codes.md#state"});const e=$[t];return void 0!==e?e:$[t]=new L(t)}class E{nt;it;name;ct;level;constructor(t,e,n){this.nt=t,this.it=t?t+"."+e:e,this.name=e,this.level=n,this.ct=new Map}find(t,e=0){if(e>=t.length)return null;const n=t[e],s=this.ct.get(n);return s?e===t.length-1?s:s.find(t,e+1):null}appendChild(t){let e=this.ct.get(t);if(!e){const n=this.nt?this.nt+"."+this.name:this.name;e=new E(n,t,this.level+1),this.ct.set(t,e)}return e}}const D=new Map;function k(t,e){let n=D.get(t);n||(n=new Map,D.set(t,n));let s=n.get(e)??null;if(s)return s;const o=M(e);return s=t.find(o.A),n.set(e,s),s}function R(t,e){const n=M(e);if(null===n.nt)return t.appendChild(e);{let e=k(t,n.nt);return null===e&&(e=R(t,n.nt)),e.appendChild(n.F)}}const A="state",F=Symbol.for(`${A}.GetByRef`),V=Symbol.for(`${A}.SetByRef`),W=Symbol.for(`${A}.ConnectedCallback`),H=Symbol.for(`${A}.DisconnectedCallback`),O=Symbol.for(`${A}.GetListIndexesByRef`),z=new Map;class j{static id=0;id=++j.id;name;elements;dt;ot;ht;ut;info;constructor(t){const e=t.split("."),n=e.slice(),s=[];let o=0,r=0,i="",c=0,d="none",a=[];for(let t=0;t<e.length;t++){const d=e[t];if("*"===d)n[t]="*",a.push(null),o++,c++;else{const e=Number(d);Number.isNaN(e)||(n[t]="*",a.push(e),r++,c++)}i+=d,s.push(i),i+=t<e.length-1?".":""}const l=M(n.join("."));(o>0||r>0)&&(d=o===c?"context":r===c?"all":"partial"),this.name=t,this.elements=e,this.dt=s,this.ot=c,this.ht=d,this.ut=a,this.info=l}}function q(t){let e;return z.get(t)??(z.set(t,e=new j(t)),e)}class _{info;#c;get ft(){return null===this.#c?null:this.#c.deref()??s({code:"LIST-201",message:"listIndex is null",context:{R:this.info.R,key:this.key},t:"./docs/error-codes.md#list"})}key;constructor(t,e){this.info=t,this.#c=null!==e?new WeakRef(e):null,this.key=function(t,e){return null==e?t.R:t.R+"#"+e.R}(t,e)}get wt(){const t=this.info.st;if(!t)return null;return J(t,(this.info.ot>t.ot?this.ft?.at(-2):this.ft)??null)}}const G=new WeakMap,Z={};function J(t,e){let n=null;if(null!==e){let s=G.get(e);return void 0===s&&(s={},G.set(e,s)),n=s[t.pattern],void 0===n&&(n=new _(t,e),s[t.pattern]=n),n}return n=Z[t.pattern],void 0===n&&(n=new _(t,null),Z[t.pattern]=n),n}function K(t,e){const n=t.yt;if(null==n)return null;if(null==n.info)return null;if(null==n.ft)return null;const s=n.info.G[e];return void 0!==s?n.ft.at(s):null}function Q(t,e,n){switch(t.ht){case"none":return null;case"context":return K(n,t.info.tt??s({code:"STATE-202",message:"lastWildcardPath is null",context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#state"}))??s({code:"LIST-201",message:`ListIndex not found: ${t.info.pattern}`,context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#list"});case"all":let o=null;for(let n=0;n<t.info.ot;n++){const r=t.info.X[n]??s({code:"STATE-202",message:"wildcardParentPattern is null",context:{h:"getListIndex",pattern:t.info.pattern,index:n},t:"/docs/error-codes.md#state"}),i=J(r,o),c=e[O](i)??s({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{h:"getListIndex",xt:r.pattern},t:"/docs/error-codes.md#list"}),d=t.ut[n]??s({code:"STATE-202",message:"wildcardIndex is null",context:{h:"getListIndex",pattern:t.info.pattern,index:n},t:"/docs/error-codes.md#state"});o=c[d]??s({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{h:"getListIndex",xt:r.pattern,bt:d},t:"/docs/error-codes.md#list"})}return o;case"partial":s({code:"STATE-202",message:`Partial wildcard type is not supported yet: ${t.info.pattern}`,context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#state"})}}const X={};for(let t=0;t<32;t++)X[`$${t+1}`]=t;let Y=0,tt=0;class et{#d=null;#a=0;#l=0;#h;#u=++tt;#f=this.#u.toString();constructor(t,e){this.#d=t,this.#a=t?t.position+1:0,this.#l=e,this.#h=Y}get Nt(){return this.#d}get id(){return this.#u}get R(){return this.#f}get position(){return this.#a}get length(){return this.#a+1}get index(){return this.#l}set index(t){this.#l=t,this.#h=++Y,this.St[this.#a]=t}get version(){return this.#h}get It(){return null!==this.#d&&(this.#d.It||this.#d.version>this.#h)}#m;get St(){return null===this.#d?void 0===this.#m&&(this.#m=[this.#l]):(void 0===this.#m||this.It)&&(this.#m=[...this.#d.St,this.#l],this.#h=Y),this.#m}#p;get vt(){return null===this.#d?void 0===this.#p&&(this.#p=[new WeakRef(this)]):void 0===this.#p&&(this.#p=[...this.#d.vt,new WeakRef(this)]),this.#p}get Tt(){return`${this.position+1}`}at(t){return t>=0?this.vt[t]?.deref()||null:this.vt[this.vt.length+t]?.deref()||null}}function nt(t,e){return new et(t,e)}function st(t,e,n,o){let r;!function(t,e){if(t.Ct>=0){const n=t.yt?.info??null;null!==n&&t.Ut.Pt.Bt.has(n.pattern)&&n.pattern!==e.info.pattern&&t.Ut.Pt.$t(n.pattern,e.info.pattern)}}(o,e);const i=o.Ut.Pt.Lt.has(e.info.pattern),c=e.info.ot>0||o.Ut.Pt.Mt.has(e.info.pattern);let d;if(c||i){d=o.Ut.cache.get(e);const t=o.Ut.Et.get(e.info.pattern);if(void 0!==d){if(void 0===t)return d.value;if(d.version>o.Dt.version)return d.value;if(!(d.version<t.version||d.kt<t.kt))return d.value}}if(o.Ut.Rt.startsWith(e.info)&&0===o.Ut.Pt.Mt.intersection(e.info.W).size)return o.Ut.Rt.get(e);if(e.info.pattern in t){0===o.At.length&&s({code:"STC-002",message:"handler.refStack is empty in getByRef"}),o.Ct++,o.Ct>=o.At.length&&o.At.push(null),o.At[o.Ct]=o.yt=e;try{return r=Reflect.get(t,e.info.pattern,n)}finally{if(o.At[o.Ct]=null,o.Ct--,o.yt=o.Ct>=0?o.At[o.Ct]:null,c||i){let t;if(i){null!==o.Ft&&(o.Ft.Vt.has(e)||o.Ft.Wt.has(e)||(o.Ft.Vt.set(e,d?.value),o.Ft.Wt.set(e,d?.vt??[])));t={value:r,vt:function(t,e,n,s){e=Array.isArray(e)?e:[];const o=[];if(0===(n=Array.isArray(n)?n:[]).length)return[];if(0===e.length){for(let e=0;e<n.length;e++){const n=nt(t,e);o.push(n)}return o}if(function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(e,n))return s;const r=new Map;for(let t=0;t<e.length;t++)r.set(e[t],t);for(let e=0;e<n.length;e++){const i=n[e],c=r.get(i);if(void 0===c){const n=nt(t,e);o.push(n)}else{const t=s[c];t.index!==e&&(t.index=e),o.push(t)}}return o}(e.ft,d?.value,r,d?.vt??[]),version:o.Dt.version,kt:o.Dt.kt}}else t={value:r,vt:null,version:o.Dt.version,kt:o.Dt.kt};o.Ut.cache.set(e,t)}}}else s({code:"STC-001",message:`Property "${e.info.pattern}" does not exist in state.`,t:"./docs/error-codes.md#stc"})}function ot(t,e,n,o,r){const i=r.Ut.Pt.elements.has(e.info.pattern);let c=null,d=null;i&&(c=e.wt??s({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{h:"setByRef (element)",Ht:e.info.pattern},t:"/docs/error-codes.md#state"}),d=r.Dt.Ot.get(c)||null,null===d&&(d={value:[...o[F](c)??[]],vt:[...o[O](c)??[]]},r.Dt.Ot.set(c,d)));try{if(r.Ut.Rt.startsWith(e.info)&&0===r.Ut.Pt.zt.intersection(e.info.W).size)return r.Ut.Rt.set(e,n);if(!(e.info.pattern in t)){const i=e.info.st??s({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{h:"setByRef",Ht:e.info.pattern},t:"/docs/error-codes.md#state"}),c=i.ot<e.info.ot?e.ft?.Nt??null:e.ft,d=st(t,J(i,c),o,r),a=e.info.F;if("*"===a){const t=e.ft?.index??s({code:"STATE-202",message:"propRef.listIndex?.index is undefined",context:{h:"setByRef",Ht:e.info.pattern},t:"/docs/error-codes.md#state"});return Reflect.set(d,t,n)}return Reflect.set(d,a,n)}r.Ct++,r.Ct>=r.At.length&&r.At.push(null),r.At[r.Ct]=r.yt=e;try{return Reflect.set(t,e.info.pattern,n,o)}finally{r.At[r.Ct]=null,r.Ct--,r.yt=r.Ct>=0?r.At[r.Ct]:null}}finally{if(r.Dt.jt(e),i){const t=d.value.indexOf(n),s=o[O](c)??[],i=e.ft.index,a=-1!==t?d.vt[t]:nt(c.ft,-1);s[i]=a;if(new Set(o[F](c)??[]).size===d.value.length){for(let t=0;t<s.length;t++)s[t].index=t;r.Dt.Ot.delete(c)}}}}function rt(t,e,n,o){return(e,r,i)=>{const c=M(e),d=o.yt?.info??null;null!==d&&d.pattern!==c.pattern&&o.Ut.Pt.Bt.has(d.pattern)&&o.Ut.Pt.$t(d.pattern,c.pattern),c.X.length>r.length&&s({code:"STATE-202",message:`indexes length is insufficient: ${e}`,context:{path:e,qt:c.X.length,_t:r.length},t:"/docs/error-codes.md#state",o:"error"});let a=null;for(let e=0;e<c.X.length;e++){const i=c.X[e],d=J(i,a);st(t,d,n,o);const l=n[O](d);null==l&&s({code:"LIST-201",message:`ListIndexes not found: ${i.pattern}`,context:{pattern:i.pattern},t:"/docs/error-codes.md#list",o:"error"});const h=r[e];a=l[h]??s({code:"LIST-201",message:`ListIndex not found: ${i.pattern}`,context:{pattern:i.pattern,index:h},t:"/docs/error-codes.md#list",o:"error"})}const l=J(c,a),h=void 0!==i;if(V in n){if(!h)return st(t,l,n,o);ot(t,l,i,n,o)}else{if(!h)return st(t,l,n,o);s({code:"STATE-202",message:`Cannot set value on a readonly proxy: ${e}`,context:{path:e},t:"/docs/error-codes.md#state",o:"error"})}}}function it(t,e,n,o){const r=X[e];if(void 0!==r){const t=o.yt?.ft;return t?.St[r]??s({code:"LIST-201",message:`ListIndex not found: ${e.toString()}`,context:{Gt:String(e),St:t?.St??null,index:r},t:"/docs/error-codes.md#list",o:"error"})}if("string"==typeof e){if("$"===e[0])switch(e){case"$resolve":return rt(t,0,n,o);case"$getAll":return function(t,e,n,o){const r=rt(t,0,n,o);return(e,i)=>{const c=M(e),d=o.yt?.info??null;if(null!==d&&d.pattern!==c.pattern&&o.Ut.Pt.Bt.has(d.pattern)&&o.Ut.Pt.$t(d.pattern,c.pattern),void 0===i){for(let t=0;t<c._.length;t++){const e=c._[t]??s({code:"BIND-201",message:"wildcardPattern is null",context:{index:t,Zt:c.pattern},t:"/docs/error-codes.md#bind",o:"error"}),n=K(o,e.pattern);if(n){i=n.St;break}}void 0===i&&(i=[])}const a=(e,r,i,c,d,l,h)=>{const u=e[r]??null;if(null===u)return void h.push(l);const f=J(u,i);st(t,f,n,o);const m=n[O](f);null===m&&s({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{pattern:u.pattern},t:"/docs/error-codes.md#list",o:"error"});const p=c[d]??null;if(null===p)for(let t=0;t<m.length;t++){const n=m[t];a(e,r+1,n,c,d+1,l.concat(n.index),h)}else{const t=m[p]??s({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{pattern:u.pattern,index:p},t:"/docs/error-codes.md#list",o:"error"});r+1<e.length?a(e,r+1,t,c,d+1,l.concat(t.index),h):h.push(l.concat(t.index))}},l=[];a(c.X,0,null,i,0,[],l);const h=[];for(let t=0;t<l.length;t++)h.push(r(c.pattern,l[t]));return h}}(t,0,n,o);case"$trackDependency":return function(t,e,n,o){return t=>{const e=o.yt?.info??s({code:"STATE-202",message:"Internal error: lastRefStack is null",context:{h:"trackDependency",path:t},t:"/docs/error-codes.md#state"});o.Ut.Pt.Mt.has(e.pattern)&&e.pattern!==t&&o.Ut.Pt.$t(e.pattern,t)}}(0,0,0,o);case"$navigate":return t=>qe?.navigate(t);case"$component":return o.Ut.Jt}const r=q(e),i=Q(r,n,o),c=J(r.info,i);return st(t,c,n,o)}if("symbol"==typeof e){if(!o.symbols.has(e))return Reflect.get(t,e,n);switch(e){case F:return e=>st(t,e,n,o);case V:return(e,s)=>ot(t,e,s,n,o);case O:return e=>function(t,e,n,o){o.Ut.Pt.Lt.has(e.info.pattern)||s({code:"LIST-201",message:`path is not a list: ${e.info.pattern}`,context:{h:"getListIndexesByRef",pattern:e.info.pattern},t:"/docs/error-codes.md#state"}),st(t,e,n,o);const r=o.Ut.cache.get(e);void 0===r&&s({code:"LIST-202",message:`List cache entry not found: ${e.info.pattern}`,context:{h:"getListIndexesByRef",pattern:e.info.pattern},t:"/docs/error-codes.md#state"});const i=r.vt;return null==i&&s({code:"LIST-203",message:`List indexes not found in cache entry: ${e.info.pattern}`,context:{h:"getListIndexesByRef",pattern:e.info.pattern},t:"/docs/error-codes.md#state"}),i}(t,e,n,o);case W:return()=>async function(t,e,n){const s=Reflect.get(t,"$connectedCallback");"function"==typeof s&&await s.call(n)}(t,0,n);case H:return()=>async function(t,e,n){const s=Reflect.get(t,"$disconnectedCallback");"function"==typeof s&&await s.call(n)}(t,0,n)}}}let ct=class{Ut;Dt;Ft;At=Array(32).fill(null);Ct=-1;yt=null;Kt=null;symbols=new Set([F,O]);Qt=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e,n){this.Ut=t,this.Dt=e,this.Ft=n}get(t,e,n){return it(t,e,n,this)}set(t,e,n,o){s({code:"STATE-202",message:`Cannot set property ${String(e)} of readonly state`,context:{h:"createReadonlyStateProxy.set",Gt:String(e)},t:"./docs/error-codes.md#state"})}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.Qt.has(e)}};function dt(t,e,n){return new ct(t,e,n)}function at(t,e){return new Proxy(t,e)}class lt{Ut;At=Array(32).fill(null);Ct=-1;yt=null;Kt=null;Dt;Ft=null;symbols=new Set([F,V,O,W,H]);Qt=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e){this.Ut=t,this.Dt=e}get(t,e,n){return it(t,e,n,this)}set(t,e,n,s){return function(t,e,n,s,o){if("string"==typeof e){const r=q(e),i=Q(r,s,o);return ot(t,J(r.info,i),n,s,o)}return Reflect.set(t,e,n,s)}(t,e,n,s,this)}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.Qt.has(e)}}async function ht(t,e,n,o,r){const i=new lt(t,e),c=new Proxy(n,i);return async function(t,e,n){t.Kt&&s({code:"STATE-301",message:"already in loop context",context:{h:"setLoopContext"},t:"/docs/error-codes.md#state"}),t.Kt=e;try{if(e){0===t.At.length&&s({code:"STC-002",message:"handler.refStack is empty in getByRef"}),t.Ct++,t.Ct>=t.At.length&&t.At.push(null),t.At[t.Ct]=t.yt=e.Xt;try{await n()}finally{t.At[t.Ct]=null,t.Ct--,t.yt=t.Ct>=0?t.At[t.Ct]:null}}else await n()}finally{t.Kt=null}}(i,o,(async()=>{await r(c,i)}))}class ut{#g=[];#w=new Set;#y=new Set;#x=new Set;#b;#N=null;#S=null;#I=new Map;#v=new Map;#T=new Map;#C;constructor(t,e){this.#b=t,this.#C=e}get Yt(){return this.#g}get te(){return this.#w}get T(){return this.#y}get ee(){return this.#x}get P(){return this.#N||s({code:"UPD-002",message:"ReadonlyState not initialized",t:"./docs/error-codes.md#upd"}),this.#N}get U(){return this.#S||s({code:"UPD-002",message:"ReadonlyHandler not initialized",t:"./docs/error-codes.md#upd"}),this.#S}get Ut(){return this.#b||s({code:"UPD-001",message:"Engine not initialized",t:"./docs/error-codes.md#upd"}),this.#b}get Vt(){return this.#v}get Wt(){return this.#T}se(t){const e=dt(this.#b,this.#C,this);return t(at(this.#b.state,e),e)}oe(t){this.#I.clear(),this.#x.clear(),this.#y.clear(),this.#g=[...t],this.#w=new Set(t),this.se(((e,n)=>{this.#N=e,this.#S=n;try{const e=[],n=new Map,o=new Set;for(let r=0;r<t.length;r++){const i=t[r];if(o.add(i),!this.#b.Pt.elements.has(i.info.pattern)){e.push(i);continue}const c=i.wt??s({code:"UPD-004",message:`ParentInfo is null for ref: ${i.key}`,context:{re:i.key,pattern:i.info.pattern},t:"./docs/error-codes.md#upd"});n.has(c)||n.set(c,new Set),n.get(c).add(i)}for(const[t,e]of n){if(o.has(t)){for(const t of e)this.#x.add(t);continue}const n=this.#b.ie(t);for(let t=0;t<n.length;t++){const e=n[t];this.#y.has(e)||e.v(this)}this.ee.add(t)}for(let t=0;t<e.length;t++){const n=e[t],o=k(this.#b.Pt.ce,n.info.pattern);null===o&&s({code:"PATH-101",message:`PathNode not found: ${n.info.pattern}`,context:{pattern:n.info.pattern},t:"./docs/error-codes.md#path"}),this.ee.has(n)||this.de(n,o)}}finally{this.#N=null,this.#S=null}}))}de(t,e){this.ee.add(t);const n=this.#b.ie(t);for(let t=0;t<n.length;t++){const e=n[t];this.#y.has(e)||e.v(this)}let o=new Set;if(this.#b.Pt.Lt.has(t.info.pattern)){const e=new Set(this.P[O](t)??[]),n=new Set(this.Wt.get(t)??[]);o=e.difference(n)}for(const[n,s]of e.ct){const e=M(s.it);if("*"===n)for(const t of o){const n=J(e,t);this.ee.has(n)||this.de(n,s)}else{const n=J(e,t.ft);this.ee.has(n)||this.de(n,s)}}const r=this.#b.Pt.ae.get(t.info.pattern);if(r)for(const t of r){const e=M(t),n=k(this.#b.Pt.ce,e.pattern);if(null===n&&s({code:"PATH-101",message:`PathNode not found: ${e.pattern}`,context:{pattern:e.pattern},t:"./docs/error-codes.md#path"}),e.ot>0){const t=e.X,s=(o,r,i)=>{const c=this.P[O](o)||[];if(r+1<t.length)for(let e=0;e<c.length;e++){const n=J(i,c[e]);s(n,r+1,t[r+1])}else for(let t=0;t<c.length;t++){const s=J(e,c[t]);this.ee.has(s)||this.de(s,n)}},o=J(e.X[0],null);s(o,0,e.X[1]||null)}else{const t=J(e,null);this.ee.has(t)||this.de(t,n)}}}}class ft{queue=[];#B=!1;#b;#h;#P=0;#U=new Map;constructor(t){this.#b=t,this.#h=t.he()}get version(){return this.#h}get kt(){return this.#P}get Ot(){return this.#U}jt(t){this.#P++,this.queue.push(t),this.ue(this.#b,t.info.pattern,this.#b.Et,this.#P),this.#B||(this.#B=!0,queueMicrotask((()=>{this.fe()})))}async update(t,e){await ht(this.#b,this,this.#b.state,t,(async(t,n)=>{await e(t,n)}))}fe(){try{for(;this.queue.length>0;){const n=this.queue;this.queue=[],t=n,e=this.#b,new ut(e,this).oe(t)}}finally{this.#B=!1}var t,e}me(t,e,n,o,r){if(o.has(e))return;if(r&&t.Pt.elements.has(e))return;o.add(e);for(const[e,s]of n.ct.entries()){const e=s.it;this.me(t,e,s,o,!1)}const i=t.Pt.ae.get(e)??[];for(const e of i){const n=k(t.Pt.ce,e);null===n&&s({code:"UPD-004",message:`Path node not found for pattern: ${e}`,t:"./docs/error-codes.md#upd"}),this.me(t,e,n,o,!1)}}#$=new Map;ue(t,e,n,o){const r=k(t.Pt.ce,e);null===r&&s({code:"UPD-003",message:`Path node not found for pattern: ${e}`,t:"./docs/error-codes.md#upd"});let i=this.#$.get(e);void 0===i&&(i=new Set,this.me(t,e,r,i,!0));const c={version:this.version,kt:o};for(const t of i)n.set(t,c);this.#$.set(e,i)}se(t){const e=dt(this.#b,this,null);return t(at(this.#b.state,e),e)}}function mt(t,e){return e(new ft(t))}class pt extends N{#i;constructor(t,e,n,s,o){super(t,e,n,s,o),this.#i=this.name.slice(2);e.addEventListener(this.u,(t=>this.pe(t)))}get u(){return this.#i}update(){}async pe(t){const e=this.binding.Ut,n=this.binding.ye.we,o=n?.xe().map((t=>t.ft.index))??[],r=this.m;r.includes("preventDefault")&&t.preventDefault(),r.includes("stopPropagation")&&t.stopPropagation(),await mt(e,(async e=>{await e.update(n,(async(e,n)=>{const r=this.binding.B.be(e,n);"function"!=typeof r&&s({code:"BIND-201",message:`${this.name} is not a function`,context:{h:"BindingNodeEvent.handler",name:this.name,k:typeof r},t:"/docs/error-codes.md#bind",o:"error"}),await Reflect.apply(r,e,[t,...o])}))}))}v(t){}}const gt=(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new pt(s,o,t,i,n)};class wt extends N{#u;get id(){return this.#u}get D(){return!0}constructor(t,e,n,o,r){super(t,e,n,o,r);const i=this.node.textContent?.slice(3)??s({code:"BIND-201",message:"Invalid node",context:{h:"BindingNodeBlock.id",textContent:this.node.textContent??null},t:"/docs/error-codes.md#bind",o:"error"});this.#u=Number(i)}}class yt extends wt{#L;#M;#E=[];#r;get p(){return this.#r}constructor(t,e,n,s,o){super(t,e,n,s,o);const r=J(M(""),null);this.#L=ye(this.binding,this.id,this.binding.Ut,r),this.#M=this.#r=[this.#L]}N(t){s({code:"BIND-201",message:"Not implemented",context:{h:"BindingNodeIf.assignValue",name:this.name},t:"/docs/error-codes.md#bind",o:"error"})}v(t){if(t.T.has(this.binding))return;const e=this.binding.B.C(t.P,t.U);"boolean"!=typeof e&&s({code:"BIND-201",message:"Value is not boolean",context:{h:"BindingNodeIf.update",valueType:typeof e},t:"/docs/error-codes.md#bind",o:"error"});const n=this.node.parentNode;null==n&&s({code:"BIND-201",message:"ParentNode is null",context:{h:"BindingNodeIf.update",nodeType:this.node.nodeType},t:"/docs/error-codes.md#bind",o:"error"}),e?(this.#L.Ne(n,this.node),this.#L.v(t),this.#r=this.#M):(this.#L.unmount(),this.#r=this.#E),t.T.add(this.binding)}}const xt=new Set,bt=!0===globalThis.__STRUCTIVE_USE_ALL_APPEND__;class Nt extends wt{#r=[];#D=new WeakMap;#k=[];#R=0;#A=void 0;#F=void 0;#V=[];#W=new Set;get p(){return this.#r}get M(){return!0}init(){}Se(t){let e;if(this.#R>=0)e=this.#k[this.#R],this.#R--,e.Ie(t);else{const n=J(this.ve,t);e=ye(this.binding,this.id,this.binding.Ut,n)}return this.#D.set(t,e),e}Te(t){t.unmount(),t.Kt?.Ce()}get Be(){return this.#R}set Be(t){this.#R=t}get Pe(){return this.#k.length}set Pe(t){t<0&&s({code:"BIND-202",message:"Length is negative",context:{h:"BindingNodeFor.setPoolLength",length:t},t:"./docs/error-codes.md#bind"}),this.#k.length=t}get ve(){if(void 0===this.#A){const t=this.binding.B.pattern+".*";this.#A=M(t)}return this.#A}N(t){s({code:"BIND-301",message:"Not implemented. Use update or applyChange",context:{h:"BindingNodeFor.assignValue"},t:"./docs/error-codes.md#bind"})}v(t){if(t.T.has(this.binding))return;let e=[];const n=t.P[F](this.binding.B.Xt),o=t.P[O](this.binding.B.Xt)??[],r=new Set(o);new Set(this.#F??xt);const i=this.#F?.length??0,c=0===r.size?this.#W:this.#W.difference(r),d=0===this.#W.size?r:r.difference(this.#W),a=n?.length??0,l=new Set,h=new Set,u=this.binding.B.info.pattern+".*";for(let e=0;e<t.Yt.length;e++){const n=t.Yt[e];if(n.info.pattern!==u)continue;if(t.ee.has(n))continue;const o=n.ft;null===o&&s({code:"BIND-201",message:"ListIndex is null",context:{h:"BindingNodeFor.applyChange",Xt:n},t:"./docs/error-codes.md#bind"}),this.#W.has(o)?l.add(o):h.add(o),t.ee.add(n)}const f=this.node.parentNode??s({code:"BIND-201",message:"ParentNode is null",context:{h:"BindingNodeFor.applyChange"},t:"./docs/error-codes.md#bind"}),m=new Set,p=i===c.size&&i>0;let g=!1;if(p){const t=Array.from(f.childNodes),e=this.#r.at(-1)??s({code:"BIND-201",message:"Last content is null",context:{h:"BindingNodeFor.applyChange"},t:"/docs/error-codes.md#bind"});let n=t[0];for(;n&&n.nodeType===Node.TEXT_NODE&&""===n.textContent?.trim();)n=n.nextSibling;let o=t.at(-1)??null;for(;o&&o.nodeType===Node.TEXT_NODE&&""===o.textContent?.trim();)o=o.previousSibling;n===this.node&&o===e.Ue(f)&&(g=!0)}if(p&&g){f.textContent="",f.append(this.node);for(let t=0;t<this.#r.length;t++){const e=this.#r[t];e.Kt?.Ce()}this.#k.push(...this.#r)}else if(c.size>0){for(const t of c){const e=this.#D.get(t);void 0===e&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",$e:"removes"},t:"./docs/error-codes.md#bind"}),this.Te(e),m.add(e)}this.#k.push(...m)}let w=null;const y=this.node;this.Be=this.Pe-1;const x=bt&&a===d.size&&a>0;if(0===d.size&&0===c.size&&(l.size>0||h.size>0)){if(l.size>0){const t=Array.from(this.#r),n=Array.from(l);n.sort(((t,e)=>t.index-e.index));for(const e of n){const n=this.#D.get(e);void 0===n&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",$e:"reorder"},t:"/docs/error-codes.md#bind"}),t[e.index]=n;const o=t[e.index-1]?.Ue(f)??y;n.Ne(f,o)}e=t}if(h.size>0)for(const e of h){const n=this.#D.get(e);void 0===n&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",$e:"overwrites"},t:"./docs/error-codes.md#bind"}),n.v(t)}}else{const n=new Map;for(let t=0;t<this.#V.length;t++)n.set(this.#V[t],t);const r=x?document.createDocumentFragment():f,i=x?null:y,c=[];for(let a=0;a<o.length;a++){const l=o[a],h=w?.Ue(r)??i;let u;if(d.has(l))u=this.Se(l),u.Ne(r,h),u.v(t);else{u=this.#D.get(l),void 0===u&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",$e:"reuse"},t:"./docs/error-codes.md#bind"}),h?.nextSibling!==u.Le&&u.Ne(r,h);const t=n.get(l);void 0!==t&&t!==a&&c.push(l)}e.push(u),w=u}if(x){const t=y.nextSibling;f.insertBefore(r,t)}for(const e of c){const n=this.binding.Me.get(e)??[];for(const e of n)e.v(t)}}this.Pe=this.Be+1,this.#r=e,this.#F=[...n],this.#V=[...o],this.#W=r,t.T.add(this.binding)}}const St=(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Nt(s,o,t,i,n)};const It={value:"input",valueAsNumber:"input",valueAsDate:"input",checked:"change",selected:"change"},vt={radio:new Set(["checked"]),checkbox:new Set(["checked"])},Tt=new Set(["value","valueAsNumber","valueAsDate"]),Ct=new Set;class Bt extends N{get value(){return this.node[this.name]}get L(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}constructor(t,e,n,o,r){super(t,e,n,o,r);if(!(this.node instanceof HTMLElement))return;if(!((i=this.node)instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement))return;var i;const c=(t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLOptionElement?Tt:t instanceof HTMLInputElement?vt[t.type]??Tt:Ct)(this.node);if(!c.has(this.name))return;r.length>1&&s({code:"BIND-201",message:"Has multiple decorators",context:{h:"BindingNodeProperty.constructor",name:this.name,Ee:r.length},t:"/docs/error-codes.md#bind",o:"error"});const d=(r[0]?.startsWith("on")?r[0]?.slice(2):r[0])??null??It[this.name]??"readonly";if("readonly"===d||"ro"===d)return;const a=this.binding.Ut;this.node.addEventListener(d,(async()=>{const e=this.binding.ye.we,n=this.L;await mt(a,(async s=>{await s.update(e,(async(e,s)=>{t.De(e,s,n)}))}))}))}init(){}N(t){(null==t||Number.isNaN(t))&&(t=""),this.node[this.name]=t}}const Pt=(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Bt(s,o,t,i,n)};class Ut extends N{N(t){(null==t||Number.isNaN(t))&&(t="");const e=this.node;e.checked=t.toString()===e.value.toString()}}class $t extends N{#i;get u(){return this.#i}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,r]=this.name.split(".");this.#i=r}N(t){(null==t||Number.isNaN(t))&&(t="");this.node.style.setProperty(this.u,t.toString())}}const Lt="component-state-input",Mt=Symbol.for(`${Lt}.AssignState`),Et=Symbol.for(`${Lt}.NotifyRedraw`),Dt=new WeakMap;class kt extends N{#i;get u(){return this.#i}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,r]=this.name.split(".");this.#i=r}init(){const t=this.binding.Ut;var e,n;e=t.Jt,n=this.node,Dt.set(n,e);let s=t.ke.get(this.node);void 0===s&&t.ke.set(this.node,s=new Set),s.add(this.binding)}N(t){}I(t){const e=[],n=this.binding.B.info,s=this.binding.B.ft?.at(n.ot-1)??null,o=(s?.length??0)-1;for(const r of t)if(n.A.length>r.info.A.length){if(n.W.has(r.info.pattern)){const t=(r.ft?.length??0)-1;if(t>=0){if(null===s)continue;if(r.ft!==s?.at(t))continue}const o=J(n,s);e.push(o)}}else if(!r.info.W.has(n.pattern)){if(o>=0&&r.ft?.at(o)!==s)continue;e.push(r)}if(0===e.length)return;this.node.state[Et](e)}}const Rt={0:{class:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new v(s,o,t,i,n)},checkbox:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new I(s,o,t,i,n)},radio:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Ut(s,o,t,i,n)}},1:{if:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new yt(s,o,t,i,n)}}},At={class:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new T(s,o,t,i,n)},attr:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new S(s,o,t,i,n)},style:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new $t(s,o,t,i,n)},state:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new kt(s,o,t,i,n)}};const Ft={};function Vt(t,e,n,o){const r=t instanceof Comment,i=t instanceof Element,c=r+"\t"+i+"\t"+e,d=Ft[c]??(Ft[c]=function(t,e,n){const o=Rt[t?1:0][n];if(void 0!==o)return o;if(t&&"for"===n)return St;t&&s(`getBindingNodeCreator: unknown node property ${n}`);const r=n.split("."),i=At[r[0]];return void 0!==i?i:e&&n.startsWith("on")?gt:Pt}(r,i,e));return d(e,n,o)}class Wt{#t;#H;#O;#s;#z=null;#j=null;#q=null;get pattern(){return this.#H}get info(){return this.#O}get ft(){return this.Xt.ft}get Xt(){return null!==this.#z?(null===this.#q&&(this.#q=J(this.#O,this.#z.ft)),this.#q):this.#j??s({code:"BIND-201",message:"ref is null",context:{pattern:this.#H},t:"/docs/error-codes.md#bind",o:"error"})}get filters(){return this.#s}get binding(){return this.#t}get Re(){return!1}constructor(t,e,n){this.#t=t,this.#H=e,this.#O=M(e),this.#j=0===this.#O.ot?J(this.#O,null):null,this.#s=n}be(t,e){return st(this.binding.Ut.state,this.Xt,t,e)}C(t,e){let n=st(this.binding.Ut.state,this.Xt,t,e);for(let t=0;t<this.#s.length;t++)n=this.#s[t](n);return n}init(){if(this.info.ot>0){const t=this.info.tt??s({code:"BIND-201",message:"Wildcard last parentPath is null",context:{h:"BindingState.init",pattern:this.#H},t:"/docs/error-codes.md#bind",o:"error"});this.#z=this.binding.ye.we?.find(t)??s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindingState.init",tt:t},t:"/docs/error-codes.md#bind",o:"error"}),this.#q=null}this.binding.Ut.Ae(this.Xt,this.binding)}N(t,e,n){ot(this.binding.Ut.state,this.Xt,n,t,e)}}class Ht{#t;#_;#s;#z=null;get pattern(){return s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.pattern"},t:"/docs/error-codes.md#bind"})}get info(){return s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.info"},t:"/docs/error-codes.md#bind"})}get ft(){return this.#z?.ft??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.listIndex"},t:"/docs/error-codes.md#list"})}get Xt(){return this.#z?.Xt??s({code:"STATE-202",message:"ref is null",context:{h:"BindingStateIndex.ref"},t:"/docs/error-codes.md#state"})}get filters(){return this.#s}get binding(){return this.#t}get Re(){return!0}constructor(t,e,n){this.#t=t;const o=Number(e.slice(1));isNaN(o)&&s({code:"BIND-202",message:"Pattern is not a number",context:{h:"BindingStateIndex.constructor",pattern:e},t:"/docs/error-codes.md#bind"}),this.#_=o,this.#s=n}be(t,e){return this.ft?.index??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.getValue"},t:"/docs/error-codes.md#list"})}C(t,e){let n=this.ft?.index??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.getFilteredValue"},t:"/docs/error-codes.md#list"});for(let t=0;t<this.#s.length;t++)n=this.#s[t](n);return n}init(){const t=(this.binding.ye.we??s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindingStateIndex.init"},t:"/docs/error-codes.md#bind"})).xe();this.#z=t[this.#_-1]??s({code:"BIND-201",message:"Current loopContext is null",context:{h:"BindingStateIndex.init",Fe:this.#_},t:"/docs/error-codes.md#bind"});const e=this.#z.We.Ve;null==e&&s({code:"BIND-201",message:"Binding for list is null",context:{h:"BindingStateIndex.init"},t:"/docs/error-codes.md#bind"});const n=e.Me.get(this.ft);void 0===n?e.Me.set(this.ft,new Set([this.binding])):n.add(this.binding)}N(t,e,n){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.assignValue"},t:"/docs/error-codes.md#bind"})}}const Ot=new RegExp(/^\$\d+$/);function zt(t,e){return Ot.test(t)?((t,e)=>(n,s)=>{const o=b(s,e);return new Ht(n,t,o)})(t,e):((t,e)=>(n,s)=>{const o=b(s,e);return new Wt(n,t,o)})(t,e)}const jt={};function qt(t,e=(t=>t.constructor.name+"\t"+(t instanceof Comment?t.textContent?.[2]??"":""))(t)){return jt[e]??(jt[e]=(t=>t instanceof Comment&&":"===t.textContent?.[2]?"Text":t instanceof HTMLElement?"HTMLElement":t instanceof Comment&&"|"===t.textContent?.[2]?"Template":t instanceof SVGElement?"SVGElement":s(`Unknown NodeType: ${t.nodeType}`))(t))}const _t=t=>t.trim(),Gt=t=>t.length>0,Zt=new RegExp(/^#(.*)#$/),Jt=t=>{const e=Zt.exec(t);return e?decodeURIComponent(e[1]):t},Kt=t=>{const[e,...n]=t.split(",").map(_t);return{name:e,options:n.map(Jt)}},Qt=t=>{const[e,...n]=t.split("|").map(_t);return{He:e,filters:n.map(Kt)}},Xt=t=>t.split(";").map(_t).filter(Gt).map((t=>(t=>{const[e,n=null]=t.split("@").map(_t),s=n?n.split(",").map(_t):[],[o,r]=e.split(":").map(_t),{He:i,filters:c}=Qt(o),{He:d,filters:a}=Qt(r);return{Oe:i,ze:d,je:c,qe:a,m:s}})(t))),Yt={};const te=t=>{t.removeAttribute("data-bind")},ee={HTMLElement:te,SVGElement:te,Text:void 0,_e:void 0};const ne={Text:t=>{const e=document.createTextNode("");return t.parentNode?.replaceChild(e,t),e},HTMLElement:void 0,_e:void 0,SVGElement:void 0};class se{nodeType;Ge;Ze;Je=new Map;constructor(t){this.nodeType=qt(t);const e=function(t,e){switch(t){case"Text":return"textContent:"+(e.textContent?.slice(3).trim()??"");case"HTMLElement":case"SVGElement":return e.getAttribute(C)??"";case"Template":{const t=e.textContent?.slice(3).trim();return(he(Number(t))??s(`Template not found: ${t}`)).getAttribute(C)??""}default:return""}}(this.nodeType,t);(function(t,e){ee[e]?.(t)})(t=function(t,e){return ne[e]?.(t)??t}(t,this.nodeType),this.nodeType),this.Ge=function(t){let e=[];for(;null!==t.parentNode;)e=[Array.from(t.parentNode.childNodes).indexOf(t),...e],t=t.parentNode;return e}(t),this.Ze=function(t){return""===t.trim()?[]:Yt[t]??(Yt[t]=Xt(t))}(e);for(let e=0;e<this.Ze.length;e++){const n=this.Ze[e],s={Ke:Vt(t,n.Oe,n.je,n.m),Qe:zt(n.ze,n.qe)};this.Je.set(n,s)}}}function oe(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode:t=>t instanceof Element?t.hasAttribute(C)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:function(t){return t instanceof Comment&&(0===t.textContent?.indexOf(B)||0===t.textContent?.indexOf(P))}(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;n.nextNode();)e.push(n.currentNode);return e}const re={},ie={},ce={};function de(t){return oe(t).map((t=>function(t){return new se(t)}(t)))}const ae={};function le(t,e,n){var s;return s=e.content,Array.from(s.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE||(t.nodeValue??"").trim()||s.removeChild(t)})),function(t,e,n=t){const s=de(e),o=ce[n]??(ce[n]=new Set),r=ie[n]??(ie[n]=new Set);for(let t=0;t<s.length;t++){const e=s[t];for(let t=0;t<e.Ze.length;t++){const n=e.Ze[t];o.add(n.ze),"for"===n.Oe&&r.add(n.ze)}}re[t]=s}(t,e.content,n),ae[t]=e,t}function he(t){return ae[t]??s({code:"TMP-001",message:`Template not found: ${t}`,context:{h:"registerTemplate.getTemplateById",Xe:t},t:"./docs/error-codes.md#tmp"})}class ue{ye;node;Ut;Ye;B;version;Me=new WeakMap;constructor(t,e,n,s,o){this.ye=t,this.node=e,this.Ut=n,this.Ye=s(this,e,n.tn),this.B=o(this,n.en)}get p(){return this.Ye.p}init(){this.Ye.init(),this.B.init()}De(t,e,n){return this.B.N(t,e,n)}I(t){this.Ye.I(t)}v(t){if(t.T.has(this))return;this.Ye.v(t);const e=this.B.Xt;if(!this.B.Re&&!this.Ut.Pt.ae.has(e.info.pattern)){1===this.Ut.ie(e).length&&t.ee.add(e)}}}function fe(t,e,n,s,o){return new ue(t,e,n,s,o)}class me{#q;#O;#L;constructor(t,e){this.#q=t,this.#O=t.info,this.#L=e}get Xt(){return this.#q??s({code:"STATE-202",message:"ref is null",context:{h:"LoopContext.ref",path:this.#O.pattern},t:"/docs/error-codes.md#state"})}get path(){return this.Xt.info.pattern}get info(){return this.Xt.info}get ft(){return this.Xt.ft??s({code:"LIST-201",message:"listIndex is required",context:{h:"LoopContext.listIndex",path:this.#O.pattern},t:"/docs/error-codes.md#list"})}Ie(t){this.#q=J(this.#O,t)}Ce(){this.#q=null}get We(){return this.#L}#G;get nn(){if(void 0===this.#G){let t=this.We;for(;null!==t;){if(null!==t.Kt&&t.Kt!==this){this.#G=t.Kt;break}t=t.Ve?.ye??null}void 0===this.#G&&(this.#G=null)}return this.#G}#Z={};find(t){let e=this.#Z[t];if(void 0===e){let n=this;for(;null!==n&&n.path!==t;)n=n.nn;e=this.#Z[t]=n}return e}sn(t){let e=this;for(;null!==e;)t(e),e=e.nn}xe(){const t=[];return this.sn((e=>{t.unshift(e)})),t}}function pe(t){const e=he(t)??s({code:"BIND-101",message:`Template not found: ${t}`,context:{h:"BindContent.createContent",Xe:t},t:"./docs/error-codes.md#bind"}),n=document.importNode(e.content,!0);if(Object.keys(We).length>0){const t=n.querySelectorAll(":not(:defined)");for(let e=0;e<t.length;e++){Oe(t[e].tagName.toLowerCase())}}return n}function ge(t,e,n,o){const r=(t=>re[t])(e)??s({code:"BIND-101",message:"Data-bind is not set",context:{h:"BindContent.createBindings",Xe:e},t:"./docs/error-codes.md#bind"}),i=[],c=[];for(let d=0;d<r.length;d++){const a=r[d],l=w(o,a.Ge)??s({code:"BIND-102",message:`Node not found: ${a.Ge}`,context:{h:"BindContent.createBindings",Xe:e,Ge:a.Ge},t:"./docs/error-codes.md#bind"});for(let o=0;o<a.Ze.length;o++){const r=a.Ze[o],d=a.Je.get(r)??s({code:"BIND-103",message:`Creator not found: ${r}`,context:{h:"BindContent.createBindings",Xe:e,rn:r},t:"./docs/error-codes.md#bind"}),h=fe(t,l,n,d.Ke,d.Qe);h.Ye.D&&c.push(h),i.push(h)}}return[i,c]}class we{Kt;Ve;childNodes;fragment;Ut;cn=[];dn=[];#u;get id(){return this.#u}get an(){return this.childNodes.length>0&&this.childNodes[0].parentNode!==this.fragment}get Le(){return this.childNodes[0]??null}get ln(){return this.childNodes[this.childNodes.length-1]??null}get hn(){return this.dn.length>0}Ue(t){const e=this.cn[this.cn.length-1],n=this.ln;if(void 0!==e&&e.node===n&&e.p.length>0){const n=(e.p.at(-1)??s({code:"BIND-104",message:"Child bindContent not found",context:{h:"BindContent.getLastNode",Xe:this.#u},t:"./docs/error-codes.md#bind"})).Ue(t);if(null!==n)return n}return t!==n?.parentNode?null:n}#J;get we(){if(void 0===this.#J){let t=this;for(;null!==t&&null===t.Kt;)t=t.Ve?.ye??null;this.#J=t?.Kt??null}return this.#J}constructor(t,e,n,s){this.Ve=t,this.#u=e,this.fragment=pe(e),this.childNodes=Array.from(this.fragment.childNodes),this.Ut=n,this.Kt=null!==s.ft?new me(s,this):null;const[o,r]=ge(this,e,n,this.fragment);this.cn=o,this.dn=r}mount(t){for(let e=0;e<this.childNodes.length;e++)t.appendChild(this.childNodes[e])}un(t,e){for(let n=0;n<this.childNodes.length;n++)t.insertBefore(this.childNodes[n],e)}Ne(t,e){const n=e?.nextSibling??null;for(let e=0;e<this.childNodes.length;e++)t.insertBefore(this.childNodes[e],n)}unmount(){const t=this.childNodes[0]?.parentNode??null;if(null!==t)for(let e=0;e<this.childNodes.length;e++)t.removeChild(this.childNodes[e])}init(){for(let t=0;t<this.cn.length;t++)this.cn[t].init()}Ie(t){null==this.Kt&&s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindContent.assignListIndex",Xe:this.#u},t:"./docs/error-codes.md#bind"}),this.Kt.Ie(t),this.init()}v(t){for(let e=0;e<this.cn.length;e++){const n=this.cn[e];t.T.has(n)||n.v(t)}}}function ye(t,e,n,s){const o=new we(t,e,n,s);return o.init(),o}function xe(t,e,n){if(e.enableShadowDom)if(null===e.fn||function(t){try{const e=document.createElement(t);return"function"==typeof e.attachShadow&&(e.attachShadow({mode:"open"}),!0)}catch{return!1}}(e.fn)){if(!t.shadowRoot){t.attachShadow({mode:"open"}).adoptedStyleSheets=[n]}}else s(`ComponentEngine: Shadow DOM not supported for builtin components that extend ${e.fn}`);else{const e=function(t){let e=t;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}}(t.parentNode)||document,s=e.adoptedStyleSheets;s.includes(n)||(e.adoptedStyleSheets=[...s,n])}}class be{mn=new Set;pn=new Set;gn=new Map;wn=new Map;yn=new Map;xn=new Map;cn=new WeakSet;bn(t){if(this.cn.has(t))return;const e=t.B.pattern,n=t.Ye.u;this.gn.has(e)&&s({code:"STATE-303",message:`Parent path "${e}" already has a child path`,context:{nt:e,Nn:this.gn.get(e)},t:"./docs/error-codes.md#state"}),this.wn.has(n)&&s({code:"STATE-303",message:`Child path "${n}" already has a parent path`,context:{Sn:n,In:this.wn.get(n)},t:"./docs/error-codes.md#state"}),this.gn.set(e,n),this.wn.set(n,e),this.mn.add(e),this.pn.add(n),this.yn.set(e,t),this.xn.set(n,t),this.cn.add(t)}vn(t){return this.gn.get(t)}Tn(t){return this.wn.get(t)}Cn(t){const e=M(t).W.intersection(this.pn);0===e.size&&s({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{Sn:t},t:"./docs/error-codes.md#state"});const n=Array.from(e),o=n[n.length-1],r=t.slice(o.length),i=this.wn.get(o);return void 0===i&&s({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{Sn:t,Bn:o},t:"./docs/error-codes.md#state"}),i+r}Pn(t){const e=M(t).W.intersection(this.mn);0===e.size&&s({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{nt:t},t:"./docs/error-codes.md#state"});const n=Array.from(e),o=n[n.length-1],r=t.slice(o.length),i=this.gn.get(o);return void 0===i&&s({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{nt:t,Bn:o},t:"./docs/error-codes.md#state"}),i+r}Un(t){if(0===this.pn.size)return null;const e=t.W.intersection(this.pn);if(0===e.size)return null;{const t=Array.from(e);return t[t.length-1]}}bind(t,e){const n=t.$n(e);for(const t of n??[])this.bn(t)}}class Ne{Ln;Ut;constructor(t,e){this.Ln=e,this.Ut=t}Mn(t){mt(this.Ut,(e=>{e.update(null,((e,n)=>{for(const[n,s]of Object.entries(t)){const t=J(M(n),null);e[V](t,s)}}))}))}I(t){for(const e of t)try{const t=M(this.Ln.Pn(e.info.pattern)),n=J(t,e.ft),s=this.Ut.getPropertyValue(n);mt(this.Ut,(t=>{t.update(null,((t,e)=>{t[V](n,s)}))}))}catch(t){}}get(t,e,n){if(e===Mt)return this.Mn.bind(this);if(e===Et)return this.I.bind(this);if("string"==typeof e){const t=J(M(e),null);return this.Ut.getPropertyValue(t)}s(`Property "${String(e)}" is not supported in ComponentStateInput.`)}set(t,e,n,o){if("string"==typeof e){const t=J(M(e),null);return this.Ut.En(t,n),!0}s(`Property "${String(e)}" is not supported in ComponentStateInput.`)}}class Se{binding;constructor(t){this.binding=t}get(t){const e=this.binding.Un(t.info);null===e&&s(`No child path found for path "${t.info.toString()}".`);const n=this.binding.xn.get(e);void 0===n&&s(`No binding found for child path "${e}".`);const o=J(M(this.binding.Cn(t.info.pattern)),t.ft??n.B.ft);return n.Ut.getPropertyValue(o)}set(t,e){const n=this.binding.Un(t.info);null===n&&s(`No child path found for path "${t.info.toString()}".`);const o=this.binding.xn.get(n);void 0===o&&s(`No binding found for child path "${n}".`);const r=M(this.binding.Cn(t.info.pattern)),i=o.Ut,c=J(r,t.ft??o.B.ft);return mt(i,(t=>{t.update(null,((t,n)=>{t[V](c,e)}))})),!0}startsWith(t){return null!==this.binding.Un(t)}Dn(t){const e=this.binding.Un(t.info);null===e&&s(`No child path found for path "${t.info.toString()}".`);const n=this.binding.xn.get(e);void 0===n&&s(`No binding found for child path "${e}".`);const o=J(M(this.binding.Cn(t.info.pattern)),t.ft);return n.Ut.Dn(o)}}class Ie{type="autonomous";config;kn;styleSheet;Rn;state;tn;en;#L=null;get We(){return null===this.#L&&s({code:"BIND-201",message:"bindContent not initialized yet",context:{h:"ComponentEngine.bindContent.get",An:this.Jt.constructor.id},t:"./docs/error-codes.md#bind"}),this.#L}Fn=HTMLElement;Jt;ke=new WeakMap;Vn=new Set;#K=Promise.withResolvers();#Q=null;#X=function(){return new be}();Wn;Rt;#Y=null;#tt=null;#et=!1;#nt=0;get Hn(){return this.#nt}he(){return++this.#nt}cache=new WeakMap;Et=new Map;constructor(t,e){this.config=t,this.config.fn&&(this.type="builtin");const n=e.constructor;var s;this.kn=n.kn,this.styleSheet=n.styleSheet,this.Rn=n.Rn,this.state=new this.Rn,this.tn=n.tn,this.en=n.en,this.Jt=e,this.Wn=function(t,e){const n=new Ne(t,e);return new Proxy({},n)}(this,this.#X),this.Rt=(s=this.#X,new Se(s))}get Pt(){return this.Jt.constructor.Pt}On(){for(const t in this.state)U.has(t)||this.Pt.zn.has(t)||(this.Pt.zn.add(t),R(this.Pt.ce,t));const t=this.Jt.constructor,e=J(M(""),null);this.#L=ye(null,t.id,this,e)}get jn(){return this.#K}async connectedCallback(){if(await(this.#Q?.promise),await(this.Jt.qn?.jn.promise),this.Jt.dataset.state)try{const t=JSON.parse(this.Jt.dataset.state);this.Wn[Mt](t)}catch(t){s({code:"STATE-202",message:"Failed to parse state from dataset",context:{h:"ComponentEngine.connectedCallback",_n:this.Jt.dataset.state},t:"./docs/error-codes.md#state",i:t})}const t=this.Jt.qn;if(t&&(t.Gn(this.Jt),this.#X.bind(t,this.Jt)),this.config.Zn)xe(this.Jt,this.config,this.styleSheet);else{this.#tt=this.Jt.parentNode,this.#Y=document.createComment("Structive block placeholder");try{this.#et=!0,this.Jt.replaceWith(this.#Y)}finally{this.#et=!1}}if(this.config.Zn)this.We.mount(this.Jt.shadowRoot??this.Jt);else{const t=this.#tt??s({code:"BIND-201",message:"Block parent node is not set",context:{h:"ComponentEngine.connectedCallback",mode:"block"},t:"./docs/error-codes.md#bind"});this.We.Ne(t,this.#Y)}await mt(this,(async t=>{await t.update(null,(async(e,n)=>{for(const e of this.Pt.zn){const n=M(e);if(1!==n.A.length)continue;if(this.Pt.Jn.has(e))continue;const s=J(n,null);t.jt(s)}await e[W]()}))})),queueMicrotask((()=>{this.#K.resolve()}))}async disconnectedCallback(){this.#Q=Promise.withResolvers();try{if(this.#et)return;await mt(this,(async t=>{await t.update(null,(async(t,e)=>{await t[H]()}))})),this.Jt.qn?.Kn(this.Jt),this.config.Zn||(this.#Y?.remove(),this.#Y=null,this.#tt=null)}finally{this.#Q.resolve()}}#st=new WeakMap;#ot=new WeakMap;Ae(t,e){if(null!==t.ft){const n=this.#ot.get(t.ft);if(void 0!==n){const s=n.get(t.info);return void 0!==s?void s.push(e):void n.set(t.info,[e])}this.#ot.set(t.ft,new Map([[t.info,[e]]]))}else{const n=this.#st.get(t);if(void 0!==n)return void n.push(e);this.#st.set(t,[e])}}ie(t){if(null!==t.ft){const e=this.#ot.get(t.ft);if(void 0!==e){const n=e.get(t.info);if(void 0!==n)return n}}else{const e=this.#st.get(t);if(void 0!==e)return e}return[]}Dn(t){if(this.Rt.startsWith(t.info))return this.Rt.Dn(t);let e=null;return mt(this,(n=>{e=n.se(((e,n)=>e[O](t)))})),e}getPropertyValue(t){let e;return mt(this,(n=>{e=n.se(((e,n)=>e[F](t)))})),e}En(t,e){mt(this,(n=>{n.update(null,((n,s)=>{n[V](t,e)}))}))}Gn(t){this.Vn.add(t)}Kn(t){this.Vn.delete(t)}}const ve=/\{\{([^\}]+)\}\}/g,Te=new Set(["if","for","endif","endfor","elseif","else"]);const Ce="http://www.w3.org/2000/svg";function Be(t,e,n=t){if(e.parentNode?.replaceChild(document.createComment(`${P}${t}`),e),e.namespaceURI===Ce){const t=document.createElement("template"),n=Array.from(e.childNodes);for(let e=0;e<n.length;e++){const s=n[e];t.content.appendChild(s)}const s=e.getAttribute(C);t.setAttribute(C,s??""),e=t}return e.content.querySelectorAll("template").forEach((t=>{Be(f(),t,n)})),le(t,e,n),t}function Pe(t,e){const n=document.createElement("template");n.dataset.id=t.toString(),n.innerHTML=function(t){const e=[];return t.replaceAll(ve,((t,n)=>{n=n.trim();const[o]=n.split(":");if(!Te.has(o))return`\x3c!--${B}${n}--\x3e`;const r=n.slice(o.length+1).trim(),i={type:o,Qn:n,Xn:r};if("if"===o||"for"===o)return e.push(i),`<template data-bind="${n}">`;if("endif"===o){const t=[];for(;;){const o=e.pop()??s({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",Qn:n,Yn:e.length},t:"./docs/error-codes.md#tmp"});if("if"===o.type){t.push("</template>");break}"elseif"===o.type?t.push("</template>"):s({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",ts:o.type,Qn:n},t:"./docs/error-codes.md#tmp"})}return t.join("")}if("endfor"===o){const t=e.pop()??s({code:"TMP-102",message:"Endfor without for",context:{h:"replaceMustacheWithTemplateTag",Qn:n,Yn:e.length},t:"./docs/error-codes.md#tmp"});if("for"===t.type)return"</template>";s({code:"TMP-102",message:"Endfor without for",context:{h:"replaceMustacheWithTemplateTag",ts:t.type,Qn:n},t:"./docs/error-codes.md#tmp"})}else if("elseif"===o){const t=e.at(-1)??s({code:"TMP-102",message:"Elseif without if",context:{h:"replaceMustacheWithTemplateTag",Qn:n,Yn:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type||"elseif"===t.type)return e.push(i),`</template><template data-bind="if:${t.Xn}|not"><template data-bind="if:${r}">`;s({code:"TMP-102",message:"Elseif without if",context:{h:"replaceMustacheWithTemplateTag",ts:t.type,Qn:n},t:"./docs/error-codes.md#tmp"})}else if("else"===o){const t=e.at(-1)??s({code:"TMP-102",message:"Else without if",context:{h:"replaceMustacheWithTemplateTag",Qn:n,Yn:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type)return`</template><template data-bind="if:${t.Xn}|not">`;s({code:"TMP-102",message:"Else without if",context:{h:"replaceMustacheWithTemplateTag",ts:t.type,Qn:n},t:"./docs/error-codes.md#tmp"})}else s({code:"TMP-102",message:"Unknown type",context:{h:"replaceMustacheWithTemplateTag",type:o,Qn:n},t:"./docs/error-codes.md#tmp"})}))}(e),Be(t,n)}const Ue=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/,$e=/^[a-zA-Z_$][0-9a-zA-Z_$]*(\.[a-zA-Z_$][0-9a-zA-Z_$]*|\.\*)*$/;function Le(t,e){const n=new Set(t.V).intersection(e);let o=-1,r="";for(const t of n){const e=t.split(".");1!==e.length&&(e.length>o&&(o=e.length,r=t))}if(r.length>0){$e.test(r)||s({code:"STATE-202",message:`Invalid path: ${r}`,context:{es:r},t:"./docs/error-codes.md#state"});const e=M(r),n=[];let o=e.ot;for(let i=e.A.length;i<t.A.length;i++){const e=t.A[i];"*"===e?(n.push("[this.$"+(o+1)+"]"),o++):(Ue.test(e)||s({code:"STATE-202",message:`Invalid segment name: ${e}`,context:{ns:e,es:r},t:"./docs/error-codes.md#state"}),n.push("."+e))}const i=n.join("");return{get:new Function("",`return this["${r}"]${i};`),set:new Function("value",`this["${r}"]${i} = value;`)}}{const e=[];let n=0;for(let o=0;o<t.A.length;o++){const r=t.A[o];"*"===r?(e.push("[this.$"+(n+1)+"]"),n++):(Ue.test(r)||s({code:"STATE-202",message:`Invalid segment name: ${r}`,context:{ns:r},t:"./docs/error-codes.md#state"}),e.push((e.length>0?".":"")+r))}const o=e.join("");return{get:new Function("",`return this.${o};`),set:new Function("value",`this.${o} = value;`)}}}class Me{zn=new Set;Lt=new Set;elements=new Set;Jn=new Set;Mt=new Set;Bt=new Set;zt=new Set;ss=new Set;rs=new Set;cs=new Map;ae=new Map;ce=function(){return new E("","",0)}();#u;#rt;constructor(t){this.#u=t.id,this.#rt=t.Rn;const e=(t=>ce[t]??[])(this.#u);for(const t of e){const e=M(t);this.zn=this.zn.union(e.W)}const n=(t=>ie[t]??[])(this.#u);this.Lt=this.Lt.union(n);for(const t of n){const e=t+".*";this.elements.add(e)}let s=this.#rt.prototype;for(;s&&s!==Object.prototype;){const t=Object.getOwnPropertyDescriptors(s);if(t)for(const[e,n]of Object.entries(t)){if(U.has(e))continue;if("function"==typeof n.value){this.Jn.add(e);continue}const t=void 0!==n.get,s=void 0!==n.set,o=M(e);this.zn=this.zn.union(o.W),t&&this.Mt.add(e),s&&this.zt.add(e),t&&!s&&this.Bt.add(e),t&&s&&this.ss.add(e)}s=Object.getPrototypeOf(s)}for(const t of this.zn){if(this.Mt.has(t))continue;if(this.zt.has(t))continue;const e=M(t);if(1===e.A.length)continue;const n=Le(e,this.Mt);Object.defineProperty(this.#rt.prototype,t,{get:n.get,set:n.set,enumerable:!0,configurable:!0}),this.rs.add(t)}for(const t of this.zn){R(this.ce,t);const e=M(t);e.nt&&(this.cs.get(e.nt)?.add(t)??this.cs.set(e.nt,new Set([t])))}}addPath(t){const e=M(t);for(const t of e.W){if(this.zn.has(t))continue;this.zn.add(t),R(this.ce,t);const e=M(t);if(e.A.length>1){const n=Le(e,this.Mt);Object.defineProperty(this.#rt.prototype,t,{get:n.get,set:n.set,enumerable:!0,configurable:!0}),this.rs.add(t)}e.nt&&(this.cs.get(e.nt)?.add(t)??this.cs.set(e.nt,new Set([t])))}}#it=new Set;$t(t,e){const n=`${e}=>${t}`;this.#it.has(n)||(this.zn.has(e)||this.addPath(e),this.#it.add(n),this.ae.get(e)?.add(t)??this.ae.set(e,new Set([t])))}}function Ee(t){const n=function(t){const n=e();return{Zn:void 0===t.Zn||t.Zn,enableShadowDom:t.enableShadowDom??n.enableShadowDom,fn:t.fn??null}}(t.Rn.ds??{}),o=f(),{ls:r,hs:i,Rn:c}=t,d=Object.assign({},h),a=Object.assign({},l);c.us=!0,Pe(o,r),g(o,i),function(t,e){m[t]=e}(o,c);const u=function(t){return t?document.createElement(t).constructor:HTMLElement}(n.fn),w=n.fn;return class extends u{#b;constructor(){super(),this.#b=function(t,e){return new Ie(t,e)}(n,this),this.#b.On()}connectedCallback(){this.#b.connectedCallback()}disconnectedCallback(){this.#b.disconnectedCallback()}#ct;get qn(){var t;return void 0===this.#ct&&(this.#ct=(t=this,Dt.get(t)??null)),this.#ct}get state(){return this.#b.Wn}get fs(){return this.#b.Rn.us??!1}get jn(){return this.#b.jn}$n(t){return this.#b.ke.get(t)??null}Gn(t){this.#b.Gn(t)}Kn(t){this.#b.Kn(t)}static define(t){w?customElements.define(t,this,{fn:w}):customElements.define(t,this)}static get id(){return o}static#dt=r;static get ls(){return this.#dt}static set ls(t){this.#dt=t,Pe(this.id,t),this.#at=null,this.#lt=null}static#ht=i;static get hs(){return this.#ht}static set hs(t){this.#ht=t,g(this.id,t),this.#ut=null}static#at=null;static get kn(){return this.#at||(this.#at=he(this.id)),this.#at}static#ut=null;static get styleSheet(){return this.#ut||(this.#ut=function(t){return p[t]??s({code:"CSS-001",message:`Stylesheet not found: ${t}`,context:{h:"registerStyleSheet.getStyleSheetById",ps:t},t:"./docs/error-codes.md#css"})}(this.id)),this.#ut}static#rt=null;static get Rn(){return this.#rt||(this.#rt=function(t){return m[t]??s({code:"STATE-101",message:`StateClass not found: ${t}`,context:{h:"registerStateClass.getStateClassById",gs:t},t:"./docs/error-codes.md#state"})}(this.id)),this.#rt}static#ft=d;static get tn(){return this.#ft}static#mt=a;static get en(){return this.#mt}static#lt=null;static get Pt(){return this.#lt||(this.#lt=new Me(this)),this.#lt}}}function De(t){return t.replaceAll(/<!--\{\{([^\}]+)\}\}-->/g,((t,e)=>`{{${e}}}`))}async function ke(t){const e=import.meta.resolve?import.meta.resolve(t):t,n=await fetch(e);return async function(t){const e=document.createElement("template");e.innerHTML=function(t){return t.replaceAll(/\{\{([^\}]+)\}\}/g,((t,e)=>`\x3c!--{{${e}}}--\x3e`))}(t);const n=e.content.querySelector("template");n?.remove();const s=e.content.querySelector("script[type=module]");let o={};if(s){const t=btoa(String.fromCodePoint(...(new TextEncoder).encode(s.text)));o=await import("data:application/javascript;base64,"+t)}s?.remove();const r=e.content.querySelector("style");r?.remove();const i=o.default??class{};return{text:t,ls:De(n?.innerHTML??"").trim(),hs:r?.textContent??"",Rn:i}}(await n.text())}function Re(t,e){e.define(t)}const Ae="@routes/",Fe="@components/",Ve="#lazy",We={};async function He(){const t=function(){const t={};return document.querySelectorAll("script[type='importmap']").forEach((e=>{const n=JSON.parse(e.innerHTML);n.imports&&(t.imports=Object.assign(t.imports||{},n.imports))})),t}();if(t.imports){const e=new Map;for(const[n,s]of Object.entries(t.imports)){let t,s;if(n.startsWith(Ae)){s=n.endsWith(Ve);const e=n.slice(7,s?-5:void 0);t="routes"+e.replace(/:[^\s/]+/g,"").replace(/\//g,"-"),Ge(t,"/root"===e?"/":e)}n.startsWith(Fe)&&(s=n.endsWith(Ve),t=n.slice(12,s?-5:void 0)),t&&(s?We[t]=n:e.set(t,n))}for(const[t,n]of e.entries()){Re(t,Ee(await ke(n)))}}}function Oe(t){const e=We[t];if(e)delete We[t],queueMicrotask((async()=>{const n=Ee(await ke(e));Re(t,n)}));else{const e={code:"IMP-201",message:`Alias not found for tagName: ${t}`,context:{h:"loadFromImportMap.loadLazyLoadComponent",tagName:t},t:"./docs/error-codes.md#imp",o:"warn"};console.warn(e.message,{code:e.code,context:e.context,t:e.t,o:e.o})}}const ze="routes:",je=[];let qe=null;class _e extends HTMLElement{ws=window.location.pathname;ys=window.location.pathname.split("/").pop()||"";xs=document.querySelector("base")?.href.replace(window.location.origin,"")||"/";bs;constructor(){super(),this.bs=this.Ns.bind(this)}connectedCallback(){qe=this,this.innerHTML='<slot name="content"></slot>',window.addEventListener("popstate",this.bs),window.dispatchEvent(new Event("popstate"))}disconnectedCallback(){window.removeEventListener("popstate",this.bs),qe=null}Ns(t){t.preventDefault(),this.oe()}navigate(t){const e="/"===t[0]?this.xs+t.slice(1):t;history.pushState({},"",e),this.oe()}oe(){Array.from(this.childNodes).filter((t=>"content"===t.getAttribute?.("slot"))).forEach((t=>this.removeChild(t)));const t=window.location.pathname.split("/");t.at(-1)===this.ys&&(t[t.length-1]="");const e=t.join("/").replace(this.xs,""),n="/"!==e[0]?"/"+e:e;let s,o={};for(const[t,e]of je){const r=new RegExp("^"+t.replace(/:[^\s/]+/g,"([^/]+)")+"$");if(r.test(n)){s=e;const i=n.match(r);if(i){(t.match(/:[^\s/]+/g)||[]).forEach(((t,e)=>{o[t.substring(1)]=i[e+1]}))}break}}if(s){const t=document.createElement(s);t.setAttribute("data-state",JSON.stringify(o)),t.setAttribute("slot","content"),this.appendChild(t),function(t){return We.hasOwnProperty(t)}(s)&&Oe(s)}else{const t=document.createElement("h1");t.setAttribute("slot","content"),t.textContent="404 Not Found",this.appendChild(t)}}}function Ge(t,e){e.startsWith(ze)&&(e=e.substring(ze.length)),je.push([e,t])}const Ze="router",Je=`<slot name="${Ze}"></slot>`;class Ke extends HTMLElement{constructor(){super(),n.enableShadowDom&&this.attachShadow({mode:"open"})}async connectedCallback(){await this.Ss(),this.oe()}get root(){return this.shadowRoot??this}async Ss(){if(n.layoutPath){const t=await fetch(n.layoutPath);if(t.ok){const e=await t.text(),n=document.createElement("template");n.innerHTML=e;const s=n.content.querySelector("template"),o=n.content.querySelector("style");if(this.root.appendChild(s?.content??document.createDocumentFragment()),o){const t=this.shadowRoot??document,e=t.adoptedStyleSheets;e.includes(o)||(t.adoptedStyleSheets=[...e,o])}}else s({code:"TMP-101",message:`Failed to load layout from ${n.layoutPath}`,context:{layoutPath:n.layoutPath},t:"/docs/error-codes.md#tmp",o:"error"})}else this.root.innerHTML=Je}oe(){if(n.enableRouter){const t=document.createElement(n.routerTagName);t.setAttribute("slot",Ze),this.root.appendChild(t)}}}const Qe=n;let Xe=!1;async function Ye(t){await async function(t){for(const[e,s]of Object.entries(t)){let t=null;if(n.enableRouter){const t=s.startsWith("@routes")?s.slice(7):s;Ge(e,"/root"===t?"/":t)}t=await ke(s),Re(e,Ee(t))}}(t),Qe.autoInit&&await tn()}async function tn(){Xe||(await async function(){if(n.autoLoadFromImportMap&&await He(),n.enableRouter&&customElements.define(n.routerTagName,_e),n.enableMainWrapper&&(customElements.define(n.mainTagName,Ke),n.autoInsertMainWrapper)){const t=document.createElement(n.mainTagName);document.body.appendChild(t)}}(),Xe=!0)}export{tn as bootstrapStructive,Qe as config,Ye as defineComponents};
//# sourceMappingURL=structive.min.js.map
